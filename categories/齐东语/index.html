<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>category: 齐东语 | 瀚清</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="瀚清">
<meta property="og:url" content="http://yoursite.com/categories/齐东语/index.html">
<meta property="og:site_name" content="瀚清">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="瀚清">
  
    <link rel="alternate" href="/atom.xml" title="瀚清" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/lib/jquery/dist/jquery.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
  
  
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="wrapper">
    <header id="header" class="clearfix">
	<a id="logo" href="/" title="瀚清">瀚清</a>
	
	<nav id="nav-menu" class="clearfix">
		<form id="search" method="post" action="./" role="search">
			<input id="search-input" type="text" name="s" class="inputbox" value="搜索" onfocus="if (value =='搜索'){value =''}" onblur="if (value ==''){value='搜索'}">
		</form>
		<ul>
      
				
        <li><a class="main-nav-link" href="/">主页</a></li>
      
				
        <li><a class="main-nav-link" href="/archives">归档</a></li>
      
		</ul>
	</nav>
</header>
    <section id="main" class="clearfix">
  <article class="post-detail">
    <h1 class="post-title"><a href="/">字典树</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 18</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x5B57;&#x5178;&#x6811;(Trie)&#x7528;&#x6765;&#x89E3;&#x51B3;&#x5B57;&#x7B26;&#x4E32;&#x524D;&#x7F00;&#xFF0C;&#x5224;&#x65AD;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x51FA;&#x73B0;&#xFF0C;&#x5F02;&#x6216;&#x7B49;&#x76F8;&#x5173;&#x95EE;&#x9898;&#x3002;&#x7528;&#x7A7A;&#x95F4;&#x6362;&#x53D6;&#x65F6;&#x95F4;&#x3002;</p>
<a id="more"></a>
<p>&#x5728;VJ&#x4E0A;&#x62C9;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/141731#overview" target="_blank" rel="noopener">Here</a>&#x3002;</p>
<h4 id="a"><a href="#A" class="headerlink" title="A"></a>A</h4><p>&#x8F93;&#x51FA;&#x6240;&#x6709;&#x7531;&#x5176;&#x4ED6;&#x4E24;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x5F62;&#x6210;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<p>&#x5148;&#x628A;&#x6240;&#x6709;&#x5B57;&#x7B26;&#x4E32;&#x63D2;&#x8FDB;&#x5B57;&#x5178;&#x6811;&#xFF0C;&#x7136;&#x540E;&#x679A;&#x4E3E;&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x65AD;&#x5F00;&#x4F4D;&#x7F6E;&#xFF0C;&#x5224;&#x65AD;&#x4E24;&#x90E8;&#x5206;&#x5B50;&#x4E32;&#x662F;&#x5426;&#x90FD;&#x5728;&#x5B57;&#x5178;&#x6811;&#x91CC;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">50010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> tot, root;</span><br><span class="line">    <span class="keyword">int</span> child[MAX][NUM];</span><br><span class="line">    <span class="keyword">bool</span> flag[MAX];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="built_in">memset</span>(child[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[<span class="number">1</span>]));</span><br><span class="line">        tot = root = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span> *p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                <span class="built_in">memset</span>(child[tot], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[tot]));</span><br><span class="line">                flag[*cur] = <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        flag[*cur] = <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">query</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p &amp;&amp; *cur; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> *cur &amp;&amp; flag[*cur];</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> s[MAX_N][<span class="number">25</span>];</span><br><span class="line"><span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    dic.init();</span><br><span class="line">    <span class="keyword">while</span> (gets(s[++n])) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s[n], <span class="string">&quot;&quot;</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        dic.insert(s[n]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s[i]);</span><br><span class="line">        <span class="keyword">char</span> tmp1[<span class="number">20</span>], tmp2[<span class="number">20</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len - <span class="number">1</span>; ++j) {</span><br><span class="line">            tmp1[j] = s[i][j], tmp1[j + <span class="number">1</span>] = <span class="string">&apos;\0&apos;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = j + <span class="number">1</span>; k &lt;= len; ++k) tmp2[k - j - <span class="number">1</span>] = s[i][k];</span><br><span class="line">            <span class="keyword">if</span> (dic.query(tmp1) &amp;&amp; dic.query(tmp2)) {</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s[i]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="b"><a href="#B" class="headerlink" title="B"></a>B</h4><p>&#x5927;&#x6570;&#xFF0C;&#x7565;&#x3002;</p>
<h4 id="c"><a href="#C" class="headerlink" title="C"></a>C</h4><p>&#x5148;&#x7ED9;$P\leq 10000$&#x4E2A;&#x957F;&#x5EA6;&#x4E0D;&#x8D85;&#x8FC7;$20$&#x7684;&#x53EA;&#x542B;&#x5C0F;&#x5199;&#x5B57;&#x6BCD;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x518D;&#x6709;$Q\leq 100000$&#x4E2A;&#x8BE2;&#x95EE;&#xFF0C;&#x8F93;&#x51FA;$P$&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5B50;&#x4E32;&#x4E2D;&#x5B58;&#x5728;&#x8BE2;&#x95EE;&#x4E32;&#x7684;&#x4E2A;&#x6570;&#x3002;</p>
<p>&#x4E3B;&#x8981;&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x6240;&#x6709;&#x5B50;&#x4E32;&#x7684;&#x7EDF;&#x8BA1;&#x53BB;&#x91CD;&#xFF1A;&#x5148;&#x628A;&#x6240;&#x6709;&#x5B50;&#x4E32;&#x5728;&#x5B57;&#x5178;&#x6811;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF08;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;&#x70B9;&#xFF09;&#x5B58;&#x5728;<code>vector</code>&#x4E2D;&#xFF0C;&#x53BB;&#x91CD;&#x540E;&#x7EDF;&#x4E00;&#x52A0;1&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;:: iterator it;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> tot, root;</span><br><span class="line">    <span class="keyword">int</span> child[MAX][NUM], cnt[MAX];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="built_in">memset</span>(child[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[<span class="number">1</span>]));</span><br><span class="line">        tot = root = <span class="number">1</span>, cnt[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                <span class="built_in">memset</span>(child[tot], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[tot]));</span><br><span class="line">                cnt[tot] = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">            vec.push_back(*cur);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> cnt[*cur];</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    dic.init();</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">        vec.clear();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; ++j) dic.insert(s + j);</span><br><span class="line">        sort(vec.begin(), vec.end());</span><br><span class="line">        it = unique(vec.begin(), vec.end());</span><br><span class="line">        vec.erase(it, vec.end());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; vec.size(); ++j) {</span><br><span class="line">            dic.cnt[vec[j]]++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dic.query(s));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="d"><a href="#D" class="headerlink" title="D"></a>D</h4><p>&#x6839;&#x636E;&#x624B;&#x673A;&#x952E;&#x76D8;&#x4E0A;&#x7684;&#x6570;&#x5B57;&#x548C;&#x5B57;&#x6BCD;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF0C;&#x8F93;&#x51FA;&#x6570;&#x5B57;&#x4E32;&#x53EF;&#x80FD;&#x5BF9;&#x5E94;&#x7684;&#x5B57;&#x6BCD;&#x4E32;&#x7684;&#x4E2A;&#x6570;&#x3002;</p>
<p>&#x641E;&#x6E05;&#x695A;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF0C;&#x5C31;&#x662F;&#x7EDF;&#x8BA1;&#x524D;&#x7F00;&#x4E32;&#x7684;&#x4E2A;&#x6570;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m;</span><br><span class="line"><span class="keyword">int</span> match[MAX];</span><br><span class="line"><span class="keyword">char</span> id[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> tot, root;</span><br><span class="line">    <span class="keyword">int</span> child[MAX][NUM], cnt[MAX];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="built_in">memset</span>(child[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[<span class="number">1</span>]));</span><br><span class="line">        tot = root = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;2&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                <span class="built_in">memset</span>(child[tot], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[tot]));</span><br><span class="line">                cnt[tot] = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> *cur;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;2&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        cnt[*cur]++;</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    id[<span class="number">0</span>] = id[<span class="number">1</span>] = id[<span class="number">2</span>] = <span class="string">&apos;2&apos;</span>, id[<span class="number">3</span>] = id[<span class="number">4</span>] = id[<span class="number">5</span>] = <span class="string">&apos;3&apos;</span>;</span><br><span class="line">    id[<span class="number">6</span>] = id[<span class="number">7</span>] = id[<span class="number">8</span>] = <span class="string">&apos;4&apos;</span>, id[<span class="number">9</span>] = id[<span class="number">10</span>] = id[<span class="number">11</span>] = <span class="string">&apos;5&apos;</span>;</span><br><span class="line">    id[<span class="number">12</span>] = id[<span class="number">13</span>] = id[<span class="number">14</span>] = <span class="string">&apos;6&apos;</span>;</span><br><span class="line">    id[<span class="number">15</span>] = id[<span class="number">16</span>] = id[<span class="number">17</span>] = id[<span class="number">18</span>] = <span class="string">&apos;7&apos;</span>;</span><br><span class="line">    id[<span class="number">19</span>] = id[<span class="number">20</span>] = id[<span class="number">21</span>] = <span class="string">&apos;8&apos;</span>;</span><br><span class="line">    id[<span class="number">22</span>] = id[<span class="number">23</span>] = id[<span class="number">24</span>] = id[<span class="number">25</span>] = <span class="string">&apos;9&apos;</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">char</span> s[<span class="number">10</span>];</span><br><span class="line">        dic.init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">            match[i] = dic.insert(s);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">            <span class="keyword">char</span> change[<span class="number">10</span>];</span><br><span class="line">            <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; ++j) change[j] = id[s[j] - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">            change[len] = <span class="string">&apos;\0&apos;</span>;</span><br><span class="line">            dic.update(change);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dic.cnt[match[i]]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="e"><a href="#E" class="headerlink" title="E"></a>E</h4><p>&#x7ED9;&#x51FA;&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5BF9;&#x5E94;&#x4E32;&#xFF0C;&#x8FDB;&#x884C;&#x8BED;&#x53E5;&#x7FFB;&#x8BD1;&#x3002;</p>
<p>&#x5E94;&#x8BE5;&#x4E5F;&#x53EF;&#x4EE5;<code>map</code>&#x505A;&#x7684;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> match[MAX];</span><br><span class="line"><span class="keyword">int</span> child[MAX][NUM];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> tot, root;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="built_in">memset</span>(child[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[<span class="number">1</span>]));</span><br><span class="line">        root = tot = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str, <span class="keyword">const</span> <span class="keyword">char</span>* rhs)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                <span class="built_in">memset</span>(child[tot], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[tot]));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        match[*cur] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(rhs);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) match[*cur] += rhs[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">query</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> match[*cur];</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> a[<span class="number">3010</span>], b[<span class="number">3010</span>], read[<span class="number">3010</span>];</span><br><span class="line"><span class="built_in">string</span> ans = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    dic.init();</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, a)) <span class="keyword">if</span> (<span class="built_in">strcmp</span>(a, <span class="string">&quot;START&quot;</span>) == <span class="number">0</span>) <span class="keyword">break</span>; </span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, a);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(a, <span class="string">&quot;END&quot;</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, b);</span><br><span class="line">        dic.insert(b, a);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (gets(read)) <span class="keyword">if</span> (<span class="built_in">strcmp</span>(read, <span class="string">&quot;START&quot;</span>) == <span class="number">0</span>) <span class="keyword">break</span>; </span><br><span class="line">    <span class="keyword">while</span> (gets(read)) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(read, <span class="string">&quot;END&quot;</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(read), num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) {</span><br><span class="line">            <span class="keyword">if</span> (read[i] &lt; <span class="string">&apos;a&apos;</span> || read[i] &gt; <span class="string">&apos;z&apos;</span>) {</span><br><span class="line">                <span class="keyword">if</span> (num) {</span><br><span class="line">                    a[num] = <span class="string">&apos;\0&apos;</span>;</span><br><span class="line">                    <span class="built_in">string</span> change = dic.query(a);</span><br><span class="line">                    <span class="keyword">if</span> (change == <span class="string">&quot;&quot;</span>) {</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; num; ++j) ans += a[j];</span><br><span class="line">                    } <span class="keyword">else</span> ans += change;</span><br><span class="line">                    num = <span class="number">0</span>;</span><br><span class="line">                }</span><br><span class="line">                ans += read[i];</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                a[num++] = read[i];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        ans += <span class="string">&apos;\n&apos;</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> len = ans.length();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) <span class="built_in">putchar</span>(ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="f"><a href="#F" class="headerlink" title="F"></a>F</h4><p>&#x8FD8;&#x662F;&#x6839;&#x636E;&#x624B;&#x673A;&#x952E;&#x76D8;&#x4E0A;&#x7684;&#x6570;&#x5B57;&#x548C;&#x5B57;&#x6BCD;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x3002;&#x7ED9;&#x51FA;&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x9891;&#x7387;&#xFF0C;&#x7136;&#x540E;&#x8F93;&#x51FA;&#x5F53;&#x6253;&#x5165;&#x6BCF;&#x4E2A;&#x6570;&#x5B57;&#x4E32;&#x65F6;&#xFF0C;&#x6309;&#x7167;&#x9891;&#x7387;&#x663E;&#x793A;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<p>&#x8981;&#x8003;&#x8651;&#x524D;&#x7F00;&#x53E0;&#x52A0;&#x3002;&#x5148;&#x628A;&#x6240;&#x6709;&#x4E32;&#x63D2;&#x8FDB;&#x5B57;&#x5178;&#x6811;&#xFF0C;&#x7136;&#x540E;<code>dfs</code>&#x5224;&#x65AD;&#x6240;&#x6709;&#x957F;&#x5EA6;&#x7684;&#x5B57;&#x6BCD;&#x4E32;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">26</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> match[<span class="number">15</span>][<span class="number">5</span>] = {<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;abc&quot;</span>, <span class="string">&quot;def&quot;</span>, <span class="string">&quot;ghi&quot;</span>, <span class="string">&quot;jkl&quot;</span>, </span><br><span class="line"><span class="string">&quot;mno&quot;</span>, <span class="string">&quot;pqrs&quot;</span>, <span class="string">&quot;tuv&quot;</span>, <span class="string">&quot;wxyz&quot;</span>};</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> child[MAX][NUM], cnt[MAX], Max;</span><br><span class="line"><span class="keyword">char</span> store[<span class="number">110</span>], ans[<span class="number">110</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> tot, root;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="built_in">memset</span>(child[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[<span class="number">1</span>]));</span><br><span class="line">        tot = root = <span class="number">1</span>; cnt[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span>* str, <span class="keyword">const</span> <span class="keyword">int</span> num)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                <span class="built_in">memset</span>(child[tot], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[tot]));</span><br><span class="line">                cnt[tot] = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">            cnt[*cur] += num;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m, cases = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">char</span>* str, <span class="keyword">int</span> cur, <span class="keyword">int</span> limit, <span class="keyword">int</span>&amp; flag)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (cnt[x] == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (cur &gt;= limit) {</span><br><span class="line">        <span class="keyword">if</span> (cnt[x] &gt; Max) {</span><br><span class="line">            Max = cnt[x];</span><br><span class="line">            <span class="built_in">memcpy</span>(ans, store, <span class="keyword">sizeof</span> (store));</span><br><span class="line">            flag = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> now = str[cur] - <span class="string">&apos;0&apos;</span>, K = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (now == <span class="number">7</span> || now == <span class="number">9</span>) K = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; ++i) {</span><br><span class="line">        store[cur] = match[now][i], store[cur + <span class="number">1</span>] = <span class="string">&apos;\0&apos;</span>;</span><br><span class="line">        dfs(child[x][match[now][i] - <span class="string">&apos;a&apos;</span>], str, cur + <span class="number">1</span>, limit, flag);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        <span class="keyword">char</span> str[<span class="number">110</span>];</span><br><span class="line">        dic.init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="keyword">int</span> num;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, str, &amp;num);</span><br><span class="line">            dic.insert(str, num);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Scenario #%d:\n&quot;</span>, ++cases);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">            <span class="keyword">int</span> len = <span class="built_in">strlen</span>(str);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len - <span class="number">1</span>; ++j) {</span><br><span class="line">                Max = <span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">                dfs(dic.root, str, <span class="number">0</span>, j + <span class="number">1</span>, flag);</span><br><span class="line">                <span class="keyword">if</span> (flag) <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, ans);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;MANUALLY\n&quot;</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">&apos;\n&apos;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&apos;\n&apos;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="g"><a href="#G" class="headerlink" title="G"></a>G</h4><p>&#x7EDF;&#x8BA1;&#x524D;&#x7F00;&#x4E32;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x7565;&#x3002;</p>
<h4 id="h"><a href="#H" class="headerlink" title="H"></a>H</h4><p>&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;$n*m(n,m\in [20,500])$&#x7684;&#x5B57;&#x6BCD;&#x8868;&#xFF0C;&#x5BF9;&#x6BCF;&#x4E2A;&#x8BE2;&#x95EE;&#x4E32;&#x8F93;&#x51FA;&#x5B83;&#x5728;&#x5B57;&#x6BCD;&#x8868;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x53EF;&#x4EE5;&#x4ECE;&#x67D0;&#x4E2A;&#x4F4D;&#x7F6E;&#x4E00;&#x76F4;&#x5411;&#x53F3;&#xFF0C;&#x4E00;&#x76F4;&#x5411;&#x53F3;&#x4E0B;&#x67E5;&#x627E;&#x6216;&#x8005;&#x4E00;&#x76F4;&#x5411;&#x4E0B;&#xFF0C;&#x8F93;&#x51FA;&#x6700;&#x5DE6;&#x4E0A;&#x7684;&#x8D77;&#x59CB;&#x4F4D;&#x7F6E;&#x3002;&#x67E5;&#x627E;&#x4E0D;&#x5230;&#x8F93;&#x51FA;$(-1,-1)$&#x3002;</p>
<p>&#x5148;&#x628A;&#x6240;&#x6709;&#x7684;&#x8BE2;&#x95EE;&#x4E32;&#x521B;&#x5EFA;&#x5B57;&#x5178;&#x6811;&#xFF0C;&#x7136;&#x540E;&#x626B;&#x63CF;&#x5B57;&#x6BCD;&#x8868;&#xFF0C;&#x770B;&#x5B57;&#x6BCD;&#x8868;&#x4E2D;&#x7684;&#x4E32;&#x662F;&#x5426;&#x6709;&#x5728;&#x5B57;&#x5178;&#x6811;&#x4E2D;&#x51FA;&#x73B0;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">26</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>] = {{<span class="number">0</span>, <span class="number">1</span>}, {<span class="number">1</span>, <span class="number">1</span>}, {<span class="number">1</span>, <span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> child[MAX][NUM], bel[MAX];</span><br><span class="line"><span class="keyword">char</span> mat[<span class="number">510</span>][<span class="number">510</span>];</span><br><span class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; ans[<span class="number">10010</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> tot, root;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="built_in">memset</span>(child[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[<span class="number">1</span>]));</span><br><span class="line">        tot = root = <span class="number">1</span>; bel[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str, <span class="keyword">const</span> <span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p - <span class="string">&apos;A&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                <span class="built_in">memset</span>(child[tot], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[tot]));</span><br><span class="line">                bel[tot] = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        bel[*cur] = id;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> x, <span class="keyword">const</span> <span class="keyword">int</span> y, <span class="keyword">const</span> <span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> step = <span class="number">0</span>, tmpx = x, tmpy = y;</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">if</span> (step &gt; <span class="number">20</span> || tmpx &gt;= n || tmpy &gt;= m) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">char</span> ch = mat[tmpx][tmpy];</span><br><span class="line">            cur = &amp;child[*cur][ch - <span class="string">&apos;A&apos;</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">int</span> pos = bel[*cur];</span><br><span class="line">            <span class="keyword">if</span> (pos != <span class="number">0</span> &amp;&amp; ans[pos].first == <span class="number">-1</span>) ans[pos] = make_pair(x, y);</span><br><span class="line">            tmpx += dir[id][<span class="number">0</span>], tmpy += dir[id][<span class="number">1</span>];</span><br><span class="line">            step++; </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, mat[i]);</span><br><span class="line">    <span class="keyword">char</span> str[<span class="number">20</span>];</span><br><span class="line">    getchar(); getchar();</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">    dic.init();</span><br><span class="line">    <span class="keyword">while</span> (gets(str) &amp;&amp; str[<span class="number">0</span>] != <span class="string">&apos;-&apos;</span>) {</span><br><span class="line">        dic.insert(str, ++num);</span><br><span class="line">        ans[num] = make_pair(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; ++k) {</span><br><span class="line">                dic.query(i, j, k);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= num; ++i) <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, ans[i].first, ans[i].second);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="i"><a href="#I" class="headerlink" title="I"></a>I</h4><p>&#x7ED9;&#x51FA;$n\leq  10^5$&#x4E2A;&#x6B63;&#x6574;&#x6570;$a_i$&#xFF0C;&#x7136;&#x540E;$m\leq 10^5$&#x4E2A;&#x8BE2;&#x95EE;&#xFF0C;&#x8F93;&#x51FA;&#x4E0E;$b_i$&#x5F02;&#x6216;&#x503C;&#x6700;&#x5927;&#x7684;$a_j$&#x3002;&#x6240;&#x6709;&#x6B63;&#x6574;&#x6570;&#x4E0D;&#x8D85;&#x8FC7;$2^{32}$&#x3002;</p>
<p>&#x628A;&#x6240;&#x6709;$a_i$&#x4ECE;&#x9AD8;&#x4F4D;&#x5F00;&#x59CB;&#x63D2;&#x8FDB;&#x5B57;&#x5178;&#x6811;&#xFF0C;&#x8D2A;&#x5FC3;&#x67E5;&#x627E;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">3200010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tot, root;</span><br><span class="line"><span class="keyword">int</span> child[MAX][NUM];</span><br><span class="line">ll value[MAX];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        tot = root = <span class="number">1</span>;</span><br><span class="line">        child[<span class="number">1</span>][<span class="number">0</span>] = child[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> ll x)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">32</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">            cur = &amp;child[*cur][(x &gt;&gt; i) &amp; <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                child[tot][<span class="number">0</span>] = child[tot][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">                value[tot] = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        value[*cur] = x;</span><br><span class="line">    }</span><br><span class="line">    <span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">const</span> ll x)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> *cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">32</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">            <span class="keyword">if</span> (((x &gt;&gt; i) &amp; <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">if</span> (child[*cur][<span class="number">1</span>] != <span class="number">0</span>) cur = &amp;child[*cur][<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> cur = &amp;child[*cur][<span class="number">0</span>];</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">if</span> (child[*cur][<span class="number">0</span>] != <span class="number">0</span>) cur = &amp;child[*cur][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">else</span> cur = &amp;child[*cur][<span class="number">1</span>];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> value[*cur];</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m, cases = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        dic.init();</span><br><span class="line">        ll tmp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;tmp);</span><br><span class="line">            dic.insert(tmp);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d:\n&quot;</span>, ++cases);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;tmp);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dic.query(tmp));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="j"><a href="#J" class="headerlink" title="J"></a>J</h4><p>&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E2A;&#x6700;&#x77ED;&#x8DEF;&#x3002;&#x53EA;&#x662F;&#x7ED9;&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x5EFA;&#x4E2A;&#x5B57;&#x5178;&#x6811;&#xFF0C;&#x7136;&#x540E;&#x5224;&#x65AD;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x51FA;&#x73B0;&#x8FC7;&#xFF0C;<code>map</code>&#x4E5F;&#x53EF;&#x4EE5;&#x3002;&#x6CE8;&#x610F;&#x5EFA;&#x53CC;&#x5411;&#x8FB9;&#xFF0C;&#x8DD1;&#x4E00;&#x4E0B;<code>SPFA</code>&#x5C31;&#x884C;&#x4E86;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">10010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">300</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">20010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> child[MAX][NUM], id[MAX];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> tot, root, left;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="built_in">memset</span>(child[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[<span class="number">1</span>]));</span><br><span class="line">        id[<span class="number">1</span>] = left = <span class="number">0</span>, root = tot = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* p = str; *p; ++p) {</span><br><span class="line">            cur = &amp;child[*cur][*p];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                <span class="built_in">memset</span>(child[tot], <span class="number">0</span>, <span class="keyword">sizeof</span> (child[tot]));</span><br><span class="line">                id[*cur] = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (id[*cur] == <span class="number">0</span>) id[*cur] = ++left;</span><br><span class="line">        <span class="keyword">return</span> id[*cur];</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, edge_num, st, ed;</span><br><span class="line"><span class="keyword">int</span> head[MAX_N], dis[MAX_N], vis[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> {</span></span><br><span class="line">    <span class="keyword">int</span> v, w, next;</span><br><span class="line"></span><br><span class="line">    Edge() {}</span><br><span class="line">    Edge(<span class="keyword">int</span> _v, <span class="keyword">int</span> _w, <span class="keyword">int</span> _next): v(_v), w(_w), next(_next) {}</span><br><span class="line">} edge[MAX_N * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>{</span><br><span class="line">    edge[edge_num] = Edge(v, w, head[u]);</span><br><span class="line">    head[u] = edge_num++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPFA</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= dic.left; ++i) dis[i] = inf;</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> (vis));</span><br><span class="line">    dis[st] = <span class="number">0</span>, vis[st] = <span class="number">1</span>;</span><br><span class="line">    que.push(st);</span><br><span class="line">    <span class="keyword">while</span> (!que.empty()) {</span><br><span class="line">        <span class="keyword">int</span> u = que.front(); que.pop();</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i != <span class="number">-1</span>; i = edge[i].next) {</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (dis[u] &lt; inf &amp;&amp; dis[u] + w &lt; dis[v]) {</span><br><span class="line">                dis[v] = dis[u] + w;</span><br><span class="line">                <span class="keyword">if</span> (!vis[v]) {</span><br><span class="line">                    vis[v] = <span class="number">1</span>;</span><br><span class="line">                    que.push(v);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dis[ed] == inf) dis[ed] = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dis[ed]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) &amp;&amp; n != <span class="number">-1</span>) {</span><br><span class="line">        dic.init();</span><br><span class="line">        <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> (head));</span><br><span class="line">        edge_num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span> a[<span class="number">40</span>], b[<span class="number">40</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">        st = dic.insert(a), ed = dic.insert(b);</span><br><span class="line">        <span class="keyword">int</span> cost, ida, idb;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s%s%d&quot;</span>, a, b, &amp;cost);</span><br><span class="line">            ida = dic.insert(a), idb = dic.insert(b);</span><br><span class="line">            AddEdge(ida, idb, cost);</span><br><span class="line">            AddEdge(idb, ida, cost);</span><br><span class="line">        }</span><br><span class="line">        SPFA();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="k"><a href="#K" class="headerlink" title="K"></a>K</h4><p>&#x5224;&#x65AD;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x4E32;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x4E32;&#x7684;&#x524D;&#x7F00;&#x3002;</p>
<h4 id="l"><a href="#L" class="headerlink" title="L"></a>L</h4><p>&#x8BF4;&#x4E86;&#x4E00;&#x5927;&#x4E32;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x628A;&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x53BB;&#x9664;&#x524D;&#x5BFC;0&#x540E;&#xFF0C;&#x7EDF;&#x8BA1;&#x51FA;&#x73B0;&#x6B21;&#x6570;&#x6700;&#x591A;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x4E2A;&#x6570;&#x3002;</p>
<h4 id="m"><a href="#M" class="headerlink" title="M"></a>M</h4><p>&#x7C7B;&#x4F3C;H&#x3002;</p>
<h4 id="n"><a href="#N" class="headerlink" title="N"></a>N</h4><p>&#x5224;&#x65AD;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x4E32;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x4E32;&#x7684;&#x524D;&#x7F00;&#x3002;</p>
<h4 id="o"><a href="#O" class="headerlink" title="O"></a>O</h4><p>&#x5E76;&#x67E5;&#x96C6;+&#x5B57;&#x5178;&#x6811;&#x6216;&#x8005;<code>map</code>&#x7EDF;&#x8BA1;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x51FA;&#x73B0;&#x3002;</p>
<h4 id="hdu-5536"><a href="#HDU-5536" class="headerlink" title="HDU 5536"></a>HDU 5536</h4><p>&#x7ED9;$n\leq 1000$&#x4E2A;$\leq 1e9$&#x7684;&#x6B63;&#x6574;&#x6570;$a_i$&#xFF0C;&#x4ECE;&#x4E2D;&#x627E;&#x5230;&#x4E09;&#x4E2A;&#x4E92;&#x4E0D;&#x76F8;&#x540C;&#x7684;$a_i,a_j,a_k$&#x4F7F;&#x5F97;$(a_i+a_j)\otimes a_k$&#x6700;&#x5927;&#x3002;&#x8F93;&#x51FA;&#x6700;&#x5927;&#x503C;&#x3002;$\otimes$&#x8868;&#x793A;&#x5F02;&#x6216;&#x3002;</p>
<p>&#x7C7B;&#x4F3C;I&#x9898;&#xFF0C;&#x53EA;&#x8981;&#x518D;&#x652F;&#x6301;&#x4E00;&#x4E2A;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x4FDD;&#x8BC1;&#x4E92;&#x4E0D;&#x76F8;&#x540C;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n^2 * 30)$&#xFF0C;&#x518D;&#x4E58;&#x4E0A;&#x4E00;&#x4E2A;&#x5FAE;&#x5C0F;&#x7684;&#x5E38;&#x6570;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> child[MAX][NUM], cnt[MAX];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span> {</span></span><br><span class="line">    <span class="keyword">int</span> root, tot;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        root = tot = <span class="number">1</span>;</span><br><span class="line">        child[<span class="number">1</span>][<span class="number">0</span>] = child[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        cnt[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">            cur = &amp;child[*cur][(x &gt;&gt; i) &amp; <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (*cur == <span class="number">0</span>) {</span><br><span class="line">                *cur = ++tot;</span><br><span class="line">                child[tot][<span class="number">0</span>] = child[tot][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">                cnt[tot] = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">            cnt[*cur]++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">            cur = &amp;child[*cur][(x &gt;&gt; i) &amp; <span class="number">1</span>];</span><br><span class="line">            cnt[*cur]--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>* cur = &amp;root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">            <span class="keyword">int</span> now = (x &gt;&gt; i) &amp; <span class="number">1</span>, store = *cur;</span><br><span class="line">            <span class="keyword">if</span> (now == <span class="number">0</span>) {</span><br><span class="line">                cur = &amp;child[*cur][<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (cnt[*cur]) ret += (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">                <span class="keyword">else</span> cur = &amp;child[store][<span class="number">0</span>];</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                cur = &amp;child[*cur][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (cnt[*cur]) ret += (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">                <span class="keyword">else</span> cur = &amp;child[store][<span class="number">1</span>];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line">} dic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n;</span><br><span class="line"><span class="keyword">int</span> a[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        dic.init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">            dic.insert(a[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            dic.remove(a[i]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt;= n; ++j) {</span><br><span class="line">                dic.remove(a[j]);</span><br><span class="line">                ans = max(ans, dic.query(a[i] + a[j]));</span><br><span class="line">                dic.insert(a[j]);</span><br><span class="line">            }</span><br><span class="line">            dic.insert(a[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">FFT &amp; NTT &amp; FWT (二)  (待补) </a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 9</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>Reference:<br><a href="http://blog.miskcoo.com/2015/04/polynomial-multiplication-and-fast-fourier-transform#i-19" target="_blank" rel="noopener">by-Miskcoo</a><br><a href="http://www.cnblogs.com/naturepengchen/articles/4681711.html" target="_blank" rel="noopener">by-Natureal</a><br><a href="http://www.sdwalker.com/archives/493" target="_blank" rel="noopener">by-shad0w_walker</a><br><a id="more"></a></p>
<h4 id="hdu-5322-hope"><a href="#HDU-5322-Hope" class="headerlink" title="HDU 5322 Hope"></a>HDU 5322 Hope</h4><p>&#x7ED9;&#x4E00;&#x4E2A;$n\leq 10^5$&#xFF0C;&#x5BF9;&#x4E8E;$1\sim n$&#x7684;&#x4E00;&#x4E2A;&#x6392;&#x5217;&#xFF0C;&#x5BF9;&#x4E8E;$A_i$&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x6700;&#x5C0F;&#x7684;$j &gt; i$&#x5E76;&#x4E14;$A_j &gt; A_i$&#x90A3;&#x4E48;$i$&#x548C;$j$&#x4E4B;&#x95F4;&#x6709;&#x4E00;&#x6761;&#x8FB9;&#xFF0C;&#x90A3;&#x4E48;&#x4E00;&#x79CD;&#x6392;&#x5217;&#x5C31;&#x4F1A;&#x5F62;&#x6210;&#x82E5;&#x5E72;&#x8FDE;&#x901A;&#x5757;&#xFF0C;&#x628A;&#x6BCF;&#x4E2A;&#x8FDE;&#x901A;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x6C42;&#x548C;&#x4E3A;$P$&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6392;&#x5217;&#x7684;&#x8D21;&#x732E;&#x5C31;&#x662F;$P*P$&#xFF0C;&#x6C42;$1\sim n$&#x7684;&#x6240;&#x6709;&#x6392;&#x5217;&#x7684;&#x8D21;&#x732E;&#x548C;&#xFF0C;&#x7B54;&#x6848;&#x5BF9;$998244353$&#x53D6;&#x6A21;&#x3002;</p>
<p>&#x7528;$dp[i]$&#x8868;&#x793A;$1\sim i$&#x6240;&#x6709;&#x6392;&#x5217;&#x7684;&#x8D21;&#x732E;&#x548C;&#x3002;&#x679A;&#x4E3E;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDE;&#x901A;&#x5757;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDE;&#x901A;&#x5757;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#x5FC5;&#x7136;&#x662F;$i$&#xFF0C;&#x521D;&#x59CB;&#x5316;$dp[0]=1$&#xFF0C;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>dp[i]=\sum_{j=1}^{i}C_{i-1}^{j-1}*(j-1)!*j^{2}*dp[i-1]=(i-1)!*\sum_{j=1}^{i}j^2*\frac{dp[i-j]}{(i-j)!}<br>$$<br>&#x5206;&#x6CBB;&#x9884;&#x5904;&#x7406;+NTT&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n\log^2 n)$&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    cdq(left, mid);</span><br><span class="line">    <span class="keyword">int</span> len = right - left + <span class="number">1</span>;</span><br><span class="line">    init(len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= mid - left; ++i) {</span><br><span class="line">        A1[i] = <span class="number">1l</span>l * dp[i + left] * afac[i + left] % MOD;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid - left + <span class="number">1</span>; i &lt; N; ++i) A1[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A2[i] = sq[i];</span><br><span class="line">    NTT(A1, N, <span class="number">1</span>); NTT(A2, N, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = <span class="number">1l</span>l * A1[i] * A2[i] % MOD;</span><br><span class="line">    NTT(A1, N, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid - left + <span class="number">1</span>; i &lt;= right - left; ++i) {</span><br><span class="line">        dp[i + left] += <span class="number">1l</span>l * A1[i] * fac[i + left - <span class="number">1</span>] % MOD;</span><br><span class="line">        dp[i + left] %= MOD;</span><br><span class="line">    }</span><br><span class="line">    cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100000</span>; ++i) fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    afac[<span class="number">100000</span>] = Qpow(fac[<span class="number">100000</span>], MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">100000</span>; i &gt;= <span class="number">1</span>; --i) afac[i - <span class="number">1</span>] = <span class="number">1l</span>l * afac[i] * i % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100000</span>; ++i) sq[i] = <span class="number">1l</span>l * i * i % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAX_N; ++i) inv[i] = Qpow(i, MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    cdq(<span class="number">0</span>, <span class="number">100000</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    solve();</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x)) {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dp[x]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="hdu-5552-&#x56FE;&#x8BA1;&#x6570;"><a href="#HDU-5552-&#x56FE;&#x8BA1;&#x6570;" class="headerlink" title="HDU 5552 &#x56FE;&#x8BA1;&#x6570;"></a>HDU 5552 &#x56FE;&#x8BA1;&#x6570;</h4><p>&#x7ED9;&#x4E00;&#x4E2A;$n\leq 10000$&#x548C;$m &lt; 2^{31}$&#xFF0C;&#x8868;&#x793A;&#x4E00;&#x4E2A;$n$&#x4E2A;&#x70B9;&#x7684;&#x65E0;&#x5411;&#x56FE;&#x548C;&#x6BCF;&#x6761;&#x8FB9;&#x53EF;&#x4EE5;&#x88AB;&#x67D3;&#x6210;$m$&#x79CD;&#x989C;&#x8272;&#xFF0C;&#x6C42;&#x6EE1;&#x8DB3;&#x4E0B;&#x9762;&#x6761;&#x4EF6;&#x7684;&#x65E0;&#x5411;&#x56FE;&#x7684;&#x4E2A;&#x6570;&#xFF1A;</p>
<ul>
<li>&#x4E24;&#x4E2A;&#x70B9;&#x6700;&#x591A;&#x53EA;&#x6709;&#x4E00;&#x6761;&#x8FB9;</li>
<li>&#x81F3;&#x5C11;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x73AF;</li>
<li>&#x56FE;&#x8FDE;&#x901A;&#xFF0C;&#x5373;&#x56FE;&#x4E0A;&#x4EFB;&#x610F;&#x4E24;&#x70B9;&#x53EF;&#x4E92;&#x8FBE;&#x3002;</li>
</ul>
<p>&#x7ED3;&#x679C;&#x5BF9;$152076289$&#x53D6;&#x6A21;&#x3002;</p>
<p>&#x5B9A;&#x4E49;$g[n]$&#x8868;&#x793A;$n$&#x4E2A;&#x70B9;&#x7684;&#x751F;&#x6210;&#x56FE;&#x8BA1;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x8FDE;&#x901A;&#xFF0C;&#x6BCF;&#x6761;&#x8FB9;&#x6709;$m+1$&#x79CD;&#x9009;&#x62E9;(&#x4E0D;&#x53D6;&#x8FD9;&#x6761;&#x8FB9;&#x548C;$m$&#x79CD;&#x67D3;&#x8272;)&#xFF0C;&#x4E00;&#x5171;&#x6709;$\frac{n*(n-1)}{2}$&#x6761;&#x8FB9;&#xFF0C;&#x90A3;&#x4E48;&#xFF1A;<br>$$<br>g[n]=(m+1)^{\frac{n*(n-1)}{2}}<br>$$<br>&#x5B9A;&#x4E49;$h[n]$&#x8868;&#x793A;$n$&#x4E2A;&#x70B9;&#x7684;&#x751F;&#x6210;&#x6811;&#x8BA1;&#x6570;&#xFF0C;&#x6839;&#x636E;Prufer&#x5E8F;&#x5217;&#x548C;&#x4E00;&#x5171;&#x6709;$n-1$&#x6761;&#x8FB9;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>h[n]=n^{n-2}*m^{n-1}<br>$$<br>&#x5B9A;&#x4E49;$f[n]$&#x8868;&#x793A;$n$&#x4E2A;&#x70B9;&#x7684;&#x8FDE;&#x901A;&#x56FE;&#x8BA1;&#x6570;&#xFF0C;&#x90A3;&#x4E48;$f[n]=$&#x56FE;&#x7684;&#x603B;&#x6570;-&#x975E;&#x8054;&#x901A;&#x56FE;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x679A;&#x4E3E;$1$&#x53F7;&#x70B9;&#x6240;&#x5728;&#x8FDE;&#x901A;&#x5757;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>\begin{aligned}<br>f[n]&amp;=g[n]-\sum_{i=1}^{n-1}C_{n-1}^{i-1}*f[i]*g[n-i]\\<br>&amp;=g[n]-(n-1)!*\sum_{i=1}^{n-1}\frac{f[i]}{(i-1)!}*\frac{g[n-i]}{(n-i)!}<br>\end{aligned}<br>$$<br>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x660E;&#x663E;&#x7684;&#x5377;&#x79EF;&#x5F62;&#x5F0F;&#xFF0C;&#x5206;&#x6CBB;+NTT&#x641E;&#x4E0B;&#x3002;&#x6700;&#x540E;$n$&#x4E2A;&#x70B9;&#x7684;&#x6709;&#x73AF;&#x56FE;&#x4E2A;&#x6570;=$f[n]-h[n]$&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n\log^2 n)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T, n, m, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> fac[<span class="number">10010</span> * <span class="number">2</span>], afac[<span class="number">10010</span> * <span class="number">2</span>], dp[<span class="number">10010</span> * <span class="number">2</span>], g[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Pre</span><span class="params">()</span> </span>{</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">10010</span> * <span class="number">2</span>; ++i) fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    afac[<span class="number">10000</span> * <span class="number">2</span>] = Qpow(fac[<span class="number">10000</span> * <span class="number">2</span>], MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10000</span> * <span class="number">2</span>; i &gt;= <span class="number">1</span>; --i) afac[i - <span class="number">1</span>] = <span class="number">1l</span>l * afac[i] * i % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAX_N; ++i) inv[i] = Qpow(i, MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUM; ++i) {</span><br><span class="line">        <span class="keyword">int</span> t = <span class="number">1</span> &lt;&lt; i;</span><br><span class="line">        wn[<span class="number">0</span>][i] = Qpow(G, (MOD - <span class="number">1</span>) / t, MOD); <span class="comment">// &#x9884;&#x5904;&#x7406;&#x6C42;&#x503C;&#x70B9;</span></span><br><span class="line">        wn[<span class="number">1</span>][i] = Qpow(wn[<span class="number">0</span>][i], MOD - <span class="number">2</span>, MOD); <span class="comment">// &#x6C42;&#x503C;&#x70B9;&#x9006;&#x5143;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>, len = right - left + <span class="number">1</span>;</span><br><span class="line">    cdq(left, mid);</span><br><span class="line">    init(len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= mid - left; ++i) A1[i] = <span class="number">1l</span>l * dp[i + left] * afac[i + left - <span class="number">1</span>] % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid - left + <span class="number">1</span>; i &lt; N; ++i) A1[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A2[i] = <span class="number">1l</span>l * g[i] * afac[i] % MOD;</span><br><span class="line"></span><br><span class="line">    NTT(A1, N, <span class="number">1</span>); NTT(A2, N, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = <span class="number">1l</span>l * A1[i] * A2[i] % MOD;</span><br><span class="line">    NTT(A1, N, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid - left + <span class="number">1</span>; i &lt;= right - left; ++i) {</span><br><span class="line">        dp[i + left] -= <span class="number">1l</span>l * fac[i + left - <span class="number">1</span>] * A1[i] % MOD;</span><br><span class="line">        <span class="keyword">if</span> (dp[i + left] &lt; <span class="number">0</span>) dp[i + left] += MOD;</span><br><span class="line">    }</span><br><span class="line">    cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    Pre();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n * <span class="number">2</span>; ++i) {</span><br><span class="line">            dp[i] = g[i] = Qpow(m + <span class="number">1</span>, i * (i - <span class="number">1</span>) / <span class="number">2</span>, MOD);</span><br><span class="line">        }</span><br><span class="line">        cdq(<span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">int</span> h = <span class="number">1l</span>l * Qpow(n, n - <span class="number">2</span>, MOD) * Qpow(m, n - <span class="number">1</span>, MOD) % MOD;</span><br><span class="line">        <span class="keyword">int</span> ans = (dp[n] - h + MOD) % MOD;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %d\n&quot;</span>, ++cases, ans);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="hdu-5829-&#x5377;&#x79EF;&#x5E73;&#x79FB;"><a href="#HDU-5829-&#x5377;&#x79EF;&#x5E73;&#x79FB;" class="headerlink" title="HDU 5829 &#x5377;&#x79EF;&#x5E73;&#x79FB;"></a>HDU 5829 &#x5377;&#x79EF;&#x5E73;&#x79FB;</h4><p>&#x7ED9;$n\leq 10^5$&#x4E2A;&#x6570;&#xFF0C;$a_i\in [0, 10^9]$&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;$n$&#x4E2A;&#x6570;&#x7684;&#x6240;&#x6709;&#x7EC4;&#x5408;&#x7684;&#x975E;&#x7A7A;&#x5B50;&#x96C6;$s_i$($2^{n}-1$&#x4E2A;),&#x4ECE;&#x4E2D;&#x627E;&#x5230;&#x6700;&#x5927;&#x7684;$\min(|s_i|,k)$&#x4E2A;&#x6570;&#x6C42;&#x548C;&#xFF0C;&#x5BF9;&#x6240;&#x6709;&#x7684;$k\in [1,n]$&#x8F93;&#x51FA;&#x5BF9;$998244353$&#x53D6;&#x6A21;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x5148;&#x628A;&#x6240;&#x6709;&#x7684;&#x6570;&#x6309;&#x7167;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x6392;&#x5E8F;&#xFF0C;&#x8003;&#x8651;&#x6BCF;&#x4E2A;&#x6570;&#x7684;&#x8D21;&#x732E;&#xFF1A;<br>$$<br>\begin{aligned}<br>dp[k]&amp;=\sum_{i=k}^{n}(C_{i-1}^{0} + C_{i-1}^{1}+..+C_{i-1}^{k-1})*2^{n-i}*a_i \\<br>&amp;=dp[k-1]+\frac{1}{(k-1)!}\sum_{i=k}^{n}((i-1)!*2^{n-i}*a[i])*\frac{1}{(i-k)!} \\<br>&amp;=dp[k-1]+\frac{1}{(k-1)!}\sum_{i=k}^{n}A[i]*B[i-k]\\<br>\end{aligned}<br>$$<br>&#x5176;&#x4E2D;&#xFF1A;<br>$$<br>A[i]=(i-1)!*2^{n-i}*a[i],\quad B[i-k]=\frac{1}{(i-k)!}<br>$$<br>&#x5982;&#x679C;&#x628A;$B[i]$&#x6539;&#x4E3A;$B[i]=\frac{1}{(n-i)!}$&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>\begin{aligned}<br>dp[n+k]&amp;=\frac{1}{(k-1)!}\sum A[i]*B[n-i] \\<br>&amp;=\frac{1}{(k-1)!}\sum A[i]*B[n-(n+k-i)] \\<br>&amp;=\frac{1}{(k-1)!}\sum A[i]*B[i-k] \\<br>\end{aligned}<br>$$<br>&#x8FD9;&#x6837;&#x5B50;&#x5C31;&#x548C;&#x521D;&#x59CB;&#x7684;&#x5F0F;&#x5B50;&#x7B49;&#x4EF7;&#x4E86;&#x3002;&#x6700;&#x540E;&#x522B;&#x5FD8;&#x4E86;&#x524D;&#x7F00;&#x548C;&#x3002;&#x8FD9;&#x9053;&#x9898;&#x63D0;&#x4EA4;&#x65F6;&#x8FD8;&#x9700;&#x8981;&#x5FEB;&#x8BFB;&#x3002;&#x3002;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n\log n)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> data[<span class="number">100010</span>], pw[<span class="number">100010</span>], fac[<span class="number">100010</span>], afac[<span class="number">100010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> a &gt; b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Pre</span><span class="params">()</span> </span>{</span><br><span class="line">    pw[<span class="number">0</span>] = fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100010</span>; ++i) {</span><br><span class="line">        pw[i] = <span class="number">1l</span>l * pw[i - <span class="number">1</span>] * <span class="number">2</span> % MOD;</span><br><span class="line">        fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    }</span><br><span class="line">    afac[<span class="number">100000</span>] = Qpow(fac[<span class="number">100000</span>], MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">100000</span>; i &gt;= <span class="number">1</span>; --i) afac[i - <span class="number">1</span>] = <span class="number">1l</span>l * afac[i] * i % MOD; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAX_N; ++i) inv[i] = Qpow(i, MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUM; ++i) {</span><br><span class="line">        <span class="keyword">int</span> t = <span class="number">1</span> &lt;&lt; i;</span><br><span class="line">        wn[<span class="number">0</span>][i] = Qpow(G, (MOD - <span class="number">1</span>) / t, MOD); <span class="comment">// &#x9884;&#x5904;&#x7406;&#x6C42;&#x503C;&#x70B9;</span></span><br><span class="line">        wn[<span class="number">1</span>][i] = Qpow(wn[<span class="number">0</span>][i], MOD - <span class="number">2</span>, MOD); <span class="comment">// &#x6C42;&#x503C;&#x70B9;&#x9006;&#x5143;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FastIO</span> {</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> S = <span class="number">1000000</span>;</span><br><span class="line">    <span class="keyword">int</span> wpos, pos, len;</span><br><span class="line">    <span class="keyword">char</span> wbuf[S];</span><br><span class="line">    FastIO(): wpos(<span class="number">0</span>) {}</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">xchar</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[S];</span><br><span class="line">        <span class="keyword">if</span> (pos == len) pos = <span class="number">0</span>, len = fread(buf, <span class="number">1</span>, S, <span class="built_in">stdin</span>);</span><br><span class="line">        <span class="keyword">if</span> (pos == len) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> buf[pos++];</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">xint</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> c = xchar(), x = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (c &lt;= <span class="number">32</span> &amp;&amp; ~c) c = xchar();</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="number">-1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; c &gt;= <span class="string">&apos;0&apos;</span> &amp;&amp; c &lt;= <span class="string">&apos;9&apos;</span>; c = xchar()) x = x * <span class="number">10</span> + (c - <span class="string">&apos;0&apos;</span>);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    }</span><br><span class="line">} io;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    Pre();</span><br><span class="line">    <span class="keyword">int</span> T, n;</span><br><span class="line">    T = io.xint();</span><br><span class="line">    <span class="comment">//scanf(&quot;%d&quot;, &amp;T);</span></span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        n = io.xint();</span><br><span class="line">       <span class="comment">// n = Read();</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)  data[i] = io.xint(); </span><br><span class="line">        sort(data + <span class="number">1</span>, data + n + <span class="number">1</span>, cmp);</span><br><span class="line">        init(<span class="number">2</span> * n + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = A2[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            A1[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * pw[n - i] % MOD * data[i] % MOD;</span><br><span class="line">            A2[i] = afac[n - i];</span><br><span class="line">        }</span><br><span class="line">        NTT(A1, N, <span class="number">1</span>); NTT(A2, N, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = <span class="number">1l</span>l * A1[i] * A2[i] % MOD;</span><br><span class="line">        NTT(A1, N, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= <span class="number">2</span> * n; ++i) {</span><br><span class="line">            sum += <span class="number">1l</span>l * A1[i] * afac[i - n - <span class="number">1</span>] % MOD;</span><br><span class="line">            <span class="keyword">if</span> (sum &gt;= MOD) sum -= MOD;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, sum);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">FFT &amp; NTT &amp; FWT (一) </a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 9</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>Reference:<br><a href="http://blog.miskcoo.com/2015/04/polynomial-multiplication-and-fast-fourier-transform#i-19" target="_blank" rel="noopener">by-Miskcoo</a><br><a href="http://www.cnblogs.com/naturepengchen/articles/4681711.html" target="_blank" rel="noopener">by-Natureal</a><br><a href="http://www.sdwalker.com/archives/493" target="_blank" rel="noopener">by-shad0w_walker</a><br><a id="more"></a></p>
<p>FFT:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = (<span class="number">1</span> &lt;&lt; <span class="number">18</span>) + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> DPI = <span class="number">2.0</span> * <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CP</span> {</span></span><br><span class="line">    <span class="keyword">double</span> a, b;</span><br><span class="line"></span><br><span class="line">    CP() {}</span><br><span class="line">    CP(<span class="keyword">double</span> _a, <span class="keyword">double</span> _b): a(_a), b(_b) {}</span><br><span class="line">    CP <span class="keyword">operator</span> * (<span class="keyword">const</span> CP&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">return</span> CP(a * rhs.a - b * rhs.b, a * rhs.b + b * rhs.a);</span><br><span class="line">    }</span><br><span class="line">    CP <span class="keyword">operator</span> + (<span class="keyword">const</span> CP&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">return</span> CP(a + rhs.a, b + rhs.b);</span><br><span class="line">    }</span><br><span class="line">    CP <span class="keyword">operator</span> - (<span class="keyword">const</span> CP&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">return</span> CP(a - rhs.a, b - rhs.b);</span><br><span class="line">    }</span><br><span class="line">} A1[MAX_N], A2[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, bit;</span><br><span class="line"><span class="keyword">int</span> rev[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x521D;&#x59CB;&#x5316;&#x4F4D;&#x9006;&#x5E8F;&#x7F6E;&#x6362;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> Max)</span> </span>{ <span class="comment">// Max=( &#x53D8;&#x6362;&#x524D;&#x6700;&#x9AD8;&#x6B21;&#x9879;&#x6B21;&#x6570; )*2 + 1</span></span><br><span class="line">    <span class="comment">// &#x4E8C;&#x8FDB;&#x5236;&#x5E73;&#x644A;&#x7FFB;&#x8F6C;&#x7F6E;&#x6362;</span></span><br><span class="line">    <span class="keyword">for</span> (N = <span class="number">1</span>, bit = <span class="number">0</span>; N &lt; Max; N &lt;&lt;= <span class="number">1</span>, bit++) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) {</span><br><span class="line">        rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (bit - <span class="number">1</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FFT</span><span class="params">(CP *A, <span class="keyword">int</span> n, <span class="keyword">int</span> ope)</span> </span>{ <span class="comment">// ope=1:DFT, ope=-1:IDFT</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) { </span><br><span class="line">        <span class="comment">// &#x4EA4;&#x6362;&#x4E92;&#x4E3A;&#x4E0B;&#x6807;&#x53CD;&#x8F6C;&#x7684;&#x5143;&#x7D20;</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i]) swap(A[i], A[rev[i]]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">2</span>; m &lt;= n; m &lt;&lt;= <span class="number">1</span>) { <span class="comment">// &#x63A7;&#x5236;&#x5C42;&#x6570;</span></span><br><span class="line">        CP wm(cos(DPI / m), ope * sin(DPI / m)); // m &#x6B21;&#x5355;&#x4F4D;&#x590D;&#x6839;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k += m) { <span class="comment">// &#x63A7;&#x5236;&#x8D77;&#x59CB;&#x4E0B;&#x6807;</span></span><br><span class="line">            <span class="function">CP <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>; <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x87BA;&#x65CB;&#x56E0;&#x5B50;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = k; j &lt; k + (m &gt;&gt; <span class="number">1</span>); ++j) { <span class="comment">// &#x914D;&#x5BF9;</span></span><br><span class="line">                CP t = w * A[j + (m &gt;&gt; <span class="number">1</span>)];</span><br><span class="line">                CP u = A[j];</span><br><span class="line">                A[j] = u + t;</span><br><span class="line">                A[j + (m &gt;&gt; <span class="number">1</span>)] = u - t;</span><br><span class="line">                w = w * wm; <span class="comment">// &#x66F4;&#x65B0;&#x87BA;&#x65CB;&#x56E0;&#x5B50;</span></span><br><span class="line">            } <span class="comment">// &#x4E0A;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x53EB;&#x8774;&#x8776;&#x64CD;&#x4F5C;</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (ope == <span class="number">-1</span>) { <span class="comment">// IDFT</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">            A[i].a /= n;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>NTT:<br>&#x6A21;&#x6570;&#x9700;&#x8981;&#x6EE1;&#x8DB3;&#x5F62;&#x5F0F;&#xFF1A;$a*2^{k}+1$&#xFF0C;&#x5E76;&#x4E14;$k$&#x56E0;&#x4E3A;&#x5C3D;&#x91CF;&#x5927;&#x7684;&#x6570;&#x5B57;&#xFF0C;&#x7136;&#x540E;&#x6C42;&#x539F;&#x6839;&#x4E3A;$G$&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;$998244353$&#x7684;&#x539F;&#x6839;&#x4E3A;$3$&#xFF0C;$152076289$&#x7684;&#x539F;&#x6839;&#x4E3A;$106$&#x3002;</p>
<p>&#x6BD4;&#x8F83;&#x597D;&#x7528;&#x7684;&#x7D20;&#x6570;&#x6709;&#xFF1A;$2281701377=17*2^{27}+1$&#xFF0C;&#x5E73;&#x65B9;&#x521A;&#x597D;&#x4E0D;&#x4F1A;&#x7206; <code>long long</code>;$1004535809=479*2^{21}+1$&#x52A0;&#x8D77;&#x6765;&#x521A;&#x597D;&#x4E0D;&#x4F1A;&#x7206; int&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E2A;&#x6570;&#x7684;&#x539F;&#x6839;&#x662F;$3$&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = (<span class="number">1</span> &lt;&lt; <span class="number">18</span>) + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">152076289</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> G = <span class="number">106</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> DPI = <span class="number">2.0</span> * <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, bit;</span><br><span class="line"><span class="keyword">int</span> rev[MAX_N], A1[MAX_N], A2[MAX_N], wn[<span class="number">2</span>][NUM], inv[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Qpow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> mod)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>; a %= mod;</span><br><span class="line">    <span class="keyword">while</span> (b) {</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1l</span>l * ret * a % mod;</span><br><span class="line">        a = <span class="number">1l</span>l * a * a % mod; b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> Max)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (N = <span class="number">1</span>, bit = <span class="number">0</span>; N &lt; Max; N &lt;&lt;= <span class="number">1</span>, ++bit) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) {</span><br><span class="line">        rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (bit - <span class="number">1</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span> *A, <span class="keyword">int</span> n, <span class="keyword">int</span> ope)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">if</span> (i &lt; rev[i]) swap(A[i], A[rev[i]]);</span><br><span class="line">    <span class="keyword">int</span> id = (ope == <span class="number">-1</span>) ? <span class="number">1</span> : <span class="number">0</span>, p = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">2</span>; m &lt;= n; m &lt;&lt;= <span class="number">1</span>, ++p) { <span class="comment">// m&#x6B21;&#x5355;&#x4F4D;&#x6839;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k += m) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = k, w = <span class="number">1</span>; j &lt; k + (m &gt;&gt; <span class="number">1</span>); ++j) { <span class="comment">// &#x6298;&#x534A;</span></span><br><span class="line">                <span class="keyword">int</span> t = <span class="number">1l</span>l * w * A[j + (m &gt;&gt; <span class="number">1</span>)] % MOD; <span class="comment">// &#x53F3;&#x9879;</span></span><br><span class="line">                <span class="keyword">int</span> u = A[j] % MOD; <span class="comment">// &#x5DE6;&#x9879;</span></span><br><span class="line">                A[j] = u + t, A[j + (m &gt;&gt; <span class="number">1</span>)] = u - t;</span><br><span class="line">                <span class="keyword">if</span> (A[j] &gt;= MOD) A[j] -= MOD;</span><br><span class="line">                <span class="keyword">if</span> (A[j + (m &gt;&gt; <span class="number">1</span>)] &lt; <span class="number">0</span>) A[j + (m &gt;&gt; <span class="number">1</span>)] += MOD;</span><br><span class="line">                w = <span class="number">1l</span>l * w * wn[id][p] % MOD;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (ope == <span class="number">-1</span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">            A[i] = <span class="number">1l</span>l * A[i] * inv[n] % MOD;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Pre</span><span class="params">()</span> </span>{</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">10010</span> * <span class="number">2</span>; ++i) fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    afac[<span class="number">10000</span> * <span class="number">2</span>] = Qpow(fac[<span class="number">10000</span> * <span class="number">2</span>], MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10000</span> * <span class="number">2</span>; i &gt;= <span class="number">1</span>; --i) afac[i - <span class="number">1</span>] = <span class="number">1l</span>l * afac[i] * i % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAX_N; ++i) inv[i] = Qpow(i, MOD - <span class="number">2</span>, MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUM; ++i) {</span><br><span class="line">        <span class="keyword">int</span> t = <span class="number">1</span> &lt;&lt; i;</span><br><span class="line">        wn[<span class="number">0</span>][i] = Qpow(G, (MOD - <span class="number">1</span>) / t, MOD); <span class="comment">// &#x9884;&#x5904;&#x7406;&#x6C42;&#x503C;&#x70B9;</span></span><br><span class="line">        wn[<span class="number">1</span>][i] = Qpow(wn[<span class="number">0</span>][i], MOD - <span class="number">2</span>, MOD); <span class="comment">// &#x6C42;&#x503C;&#x70B9;&#x9006;&#x5143;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="hdu-4609-&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x6982;&#x7387;"><a href="#HDU-4609-&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x6982;&#x7387;" class="headerlink" title="HDU 4609 &#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x6982;&#x7387;"></a>HDU 4609 &#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x6982;&#x7387;</h4><p>&#x9898;&#x76EE;&#x94FE;&#x63A5;&#xFF1A;<a href="http://acm.hdu.edu.cn/showproblem.php?pid=4609" target="_blank" rel="noopener">Here</a></p>
<p>&#x7ED9;$n\in [3,10^5]$&#x6839;&#x6728;&#x68CD;&#xFF0C;&#x6BCF;&#x6839;&#x6728;&#x68CD;&#x7684;&#x957F;&#x5EA6;$a_i\in[1,10^5]$&#xFF0C;&#x6C42;&#x4ECE;&#x4E2D;&#x4EFB;&#x9009;&#x4E09;&#x6839;&#x53EF;&#x4EE5;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x6982;&#x7387;&#xFF1F;</p>
<p>&#x5047;&#x8BBE;&#x4E09;&#x6839;&#x6728;&#x68CD;&#x7684;&#x957F;&#x5EA6;&#x4E3A;$a\leq b\leq c$&#xFF0C;&#x90A3;&#x4E48;&#x80FD;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x6761;&#x4EF6;&#x662F;$a+b &gt; c$&#xFF0C;&#x5982;&#x679C;&#x679A;&#x4E3E;$c$&#x7684;&#x8BDD;&#xFF0C;&#x53EA;&#x8981;&#x77E5;&#x9053;$a+b &gt; c$&#x7684;&#x6784;&#x9020;&#x65B9;&#x6848;&#x6570;&#x5373;&#x53EF;&#x3002;&#x5229;&#x7528;FFT&#x83B7;&#x5F97;$a+b$&#x7684;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x65B9;&#x6848;&#x6570;&#x3002;&#x9700;&#x8981;&#x53BB;&#x6389;$a=b$&#x7684;&#x60C5;&#x51B5;&#x548C;$(a,b)=(b,a)$&#x7684;&#x60C5;&#x51B5;&#xFF08;&#x65E0;&#x5E8F;&#x6027;&#xFF09;&#x3002;&#x8BE6;&#x7EC6;&#x7684;&#x770B;&#x4EE3;&#x7801;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">    Max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) { Max = max(Max, len[i]); }</span><br><span class="line">    init(Max * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) {</span><br><span class="line">        A1[i] = CP(<span class="number">0</span>, <span class="number">0</span>), A2[i] = CP(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">        A1[len[i]].a += <span class="number">1</span>;</span><br><span class="line">        A2[len[i]].a += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    FFT(A1, N, <span class="number">1</span>); FFT(A2, N, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = A1[i] * A2[i];</span><br><span class="line">    FFT(A1, N, <span class="number">-1</span>);</span><br><span class="line">    sort(len + <span class="number">1</span>, len + n + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// &#x51CF;&#x6389;&#x53D6;&#x4E24;&#x4E2A;&#x76F8;&#x540C;&#x7684;&#x7EC4;&#x5408;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) A1[len[i] &lt;&lt; <span class="number">1</span>].a -= <span class="number">1</span>;</span><br><span class="line">    sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// &#x6C42;&#x524D;&#x7F00;&#x548C;&#xFF0C;&#x53BB;&#x6389;&#x6709;&#x5E8F;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Max2; ++i) {</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + (ll)(A1[i].a + <span class="number">0.5</span>) / <span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) { <span class="comment">// &#x679A;&#x4E3E;&#x6700;&#x957F;&#x8FB9;</span></span><br><span class="line">        ans += sum[Max2 - <span class="number">1</span>] - sum[len[i]];</span><br><span class="line">        <span class="comment">// &#x51CF;&#x6389;&#x4E00;&#x4E2A;&#x53D6;&#x5927;&#xFF0C;&#x4E00;&#x4E2A;&#x53D6;&#x5C0F;&#x7684;</span></span><br><span class="line">        ans -= <span class="number">1l</span>l * (n - i) * (i - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// &#x51CF;&#x6389;&#x4E00;&#x4E2A;&#x53D6;&#x672C;&#x8EAB;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x53D6;&#x5176;&#x4ED6;</span></span><br><span class="line">        ans -= (n - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// &#x51CF;&#x6389;&#x5927;&#x4E8E;&#x5B83;&#x7684;&#x53D6;&#x4E24;&#x4E2A;&#x7EC4;&#x5408;</span></span><br><span class="line">        ans -= <span class="number">1l</span>l * (n - i) * (n - i - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">double</span> ret = <span class="number">1.0</span> * n * (n - <span class="number">1</span>) * (n - <span class="number">2</span>) / <span class="number">6</span>;</span><br><span class="line">    ret = <span class="number">1.0</span> * ans / ret;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.7lf\n&quot;</span>, ret);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="hdu-1402-&#x5927;&#x6570;&#x4E58;&#x6CD5;"><a href="#HDU-1402-&#x5927;&#x6570;&#x4E58;&#x6CD5;" class="headerlink" title="HDU 1402 &#x5927;&#x6570;&#x4E58;&#x6CD5;"></a>HDU 1402 &#x5927;&#x6570;&#x4E58;&#x6CD5;</h4><p>&#x7ED9;&#x4E24;&#x4E2A;&#x957F;&#x5EA6;&#x4E0D;&#x8D85;&#x8FC7;$10000$&#x7684;&#x5927;&#x6570;&#xFF0C;&#x6C42;&#x5927;&#x6570;&#x76F8;&#x4E58;&#x7684;&#x7ED3;&#x679C;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, sa, sb)) {</span><br><span class="line">        <span class="keyword">int</span> lena = <span class="built_in">strlen</span>(sa), lenb = <span class="built_in">strlen</span>(sb);</span><br><span class="line">        <span class="keyword">int</span> ka = <span class="number">0</span>, kb = <span class="number">0</span>;</span><br><span class="line">        init(max(lena, lenb) * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = A2[i] = CP(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lena; ++i) A1[lena - <span class="number">1</span> - i].a = sa[i] - <span class="string">&apos;0&apos;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lenb; ++i) A2[lenb - <span class="number">1</span> - i].a = sb[i] - <span class="string">&apos;0&apos;</span>;</span><br><span class="line">        </span><br><span class="line">        FFT(A1, N, <span class="number">1</span>); FFT(A2, N, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = A1[i] * A2[i];</span><br><span class="line">        FFT(A1, N, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) {</span><br><span class="line">            ans[i] = (<span class="keyword">int</span>)(A1[i].a + <span class="number">0.5</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> carry = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) {</span><br><span class="line">            <span class="keyword">int</span> t = ans[i] + carry;</span><br><span class="line">            ans[i] = t % <span class="number">10</span>;</span><br><span class="line">            carry = t / <span class="number">10</span>; </span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (carry) {</span><br><span class="line">            ans[N++] = carry % <span class="number">10</span>;</span><br><span class="line">            carry /= <span class="number">10</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (N &gt; <span class="number">1</span> &amp;&amp; ans[N - <span class="number">1</span>] == <span class="number">0</span>) N--;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = N - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, ans[i] + <span class="string">&apos;0&apos;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="uva-12633-&#x8D85;&#x7EA7;&#x8F66;"><a href="#UVA-12633-&#x8D85;&#x7EA7;&#x8F66;" class="headerlink" title="UVA 12633 &#x8D85;&#x7EA7;&#x8F66;"></a>UVA 12633 &#x8D85;&#x7EA7;&#x8F66;</h4><p>&#x5728;&#x4E00;&#x4E2A;&#x6700;&#x5927;$R*C(R,C\leq 50000)$&#x7684;&#x68CB;&#x76D8;&#x4E0A;&#x653E;$n\leq 50000$&#x4E2A;&#x8D85;&#x7EA7;&#x8F66;&#xFF0C;&#x6BCF;&#x4E2A;&#x8D85;&#x7EA7;&#x8F66;&#x80FD;&#x653B;&#x51FB;&#x540C;&#x884C; / &#x540C;&#x5217; / &#x540C;&#x4E3B;&#x659C;&#x7EBF;&#x4E0A;&#x7684;&#x683C;&#x5B50;&#xFF08;&#x4E3B;&#x659C;&#x7EBF;&#x5373;&#xFF1A;&#x5DE6;&#x4E0A;&#x5230;&#x53F3;&#x4E0B;&#x7684;&#x659C;&#x7EBF;&#xFF09;&#x3002;&#x95EE;&#x653E;&#x5B8C;&#x6240;&#x6709;&#x8D85;&#x7EA7;&#x8F66;&#x540E;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x683C;&#x5B50;&#x4E0D;&#x4F1A;&#x88AB;&#x653B;&#x51FB;&#x5230;?</p>
<p>&#x4E00;&#x6761;&#x4E3B;&#x5BF9;&#x89D2;&#x7EBF;&#x4E0A;&#x7684;&#x70B9;&#x7684;&#x540C;&#x4E00;&#x5F62;&#x5F0F;&#xFF1A;$C-y+x$&#x3002;&#x628A;&#x6240;&#x6709;&#x7684;&#x6CA1;&#x88AB;&#x653B;&#x51FB;&#x5230;&#x7684;&#x683C;&#x5B50;&#x90FD;&#x5F53;&#x6210;&#x662F;&#x4E3B;&#x5BF9;&#x89D2;&#x7EBF;&#x4E0A;&#x6CA1;&#x88AB;&#x653B;&#x51FB;&#x6765;&#x7EDF;&#x8BA1;&#x3002;&#x5BF9;&#x88AB;&#x653B;&#x51FB;&#x5230;&#x7684;&#x884C;&#xFF0C;&#x5217;&#xFF0C;&#x4E3B;&#x5BF9;&#x89D2;&#x7EBF;&#x505A;&#x6807;&#x8BB0;&#xFF0C;&#x7136;&#x540E;&#x6CA1;&#x88AB;&#x653B;&#x51FB;&#x5230;&#x7684;&#x884C;&#x5217;&#x505A;&#x5377;&#x79EF;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">    init();</span><br><span class="line">    <span class="built_in">memset</span>(A1, <span class="number">0</span>, <span class="keyword">sizeof</span> (A1));</span><br><span class="line">    <span class="built_in">memset</span>(A2, <span class="number">0</span>, <span class="keyword">sizeof</span> (A2));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; R; ++i) <span class="keyword">if</span> (!row[i]) A1[i].a += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; C; ++i) <span class="keyword">if</span> (!col[i]) A2[i].a += <span class="number">1</span>;</span><br><span class="line">    FFT(A1, N, <span class="number">1</span>); FFT(A2, N, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = A1[i] * A2[i];</span><br><span class="line">    FFT(A1, N, <span class="number">-1</span>);</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Max; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (!dia[i]) {</span><br><span class="line">            ans += (ll)(A1[i].a + <span class="number">0.5</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Case %d: %lld\n&quot;</span>, ++cases, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">memset</span>(row, <span class="number">0</span>, <span class="keyword">sizeof</span> (row));</span><br><span class="line">        <span class="built_in">memset</span>(col, <span class="number">0</span>, <span class="keyword">sizeof</span> (col));</span><br><span class="line">        <span class="built_in">memset</span>(dia, <span class="number">0</span>, <span class="keyword">sizeof</span> (dia));</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;R, &amp;C, &amp;n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="keyword">int</span> x, y;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">            x--, y = C - y;</span><br><span class="line">            row[x] = <span class="number">1</span>, col[y] = <span class="number">1</span>;</span><br><span class="line">            dia[x + y] = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        solve();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="spoj-triple-sum"><a href="#SPOJ-Triple-Sum" class="headerlink" title="SPOJ Triple Sum"></a>SPOJ Triple Sum</h4><p>&#x7ED9;&#x51FA;$n\leq 40000$&#x4E2A;&#x4E92;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x6570;$a_i\in [-20000, 20000]$&#xFF0C;&#x4EFB;&#x53D6;&#x4E09;&#x4E2A;&#x6570;&#xFF08;&#x6BCF;&#x4E2A;&#x6570;&#x4E0D;&#x80FD;&#x91CD;&#x590D;&#x53D6;&#xFF09;&#x6C42;&#x548C;&#xFF0C;&#x95EE;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x7EC4;&#x6210;&#x7684;&#x548C;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x7EC4;&#x6210;&#x65B9;&#x6848;&#x6570;&#x3002;</p>
<p>&#x5148;&#x628A;&#x6570;&#x57DF;&#x5E73;&#x79FB;&#x81F3;$[0,40000]$&#xFF0C;&#x7136;&#x540E;&#x7EDF;&#x8BA1;&#x6BCF;&#x4E2A;&#x6570;&#x51FA;&#x73B0;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x4F5C;&#x4E3A;&#x7CFB;&#x6570;&#x591A;&#x9879;&#x5F0F;$A[]$&#x3002;&#x5B9A;&#x4E49;$f(x)=\sum{x^{a_i}},f(2x)=\sum{x^{2*a_i}}$&#x3002;<br>$$<br>\begin{aligned}<br>A=f(x)\bigotimes f(x)\bigotimes f(x) &amp;=6*x^{a_{1}+a_{2}+a_{3}}+3*x^{2a_{1}+a_2}+x^{3a_1} \\<br>B=f(2x)\bigotimes f(x)&amp;= x^{2a_{1}+a_2}+x^{3a_1} \\<br>C=f(3x)&amp;=x^{3a_1}<br>\end{aligned}<br>$$<br>&#x6240;&#x4EE5;&#xFF1A;<br>$$<br>Ans=\frac{A-3*B+2*C}{6}<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">    init(Max * <span class="number">3</span> + <span class="number">10</span>);</span><br><span class="line">    FFT(A1, N, <span class="number">1</span>); FFT(A2, N, <span class="number">1</span>); FFT(B, N, <span class="number">1</span>);;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) {</span><br><span class="line">        A1[i] = A1[i] * A2[i];</span><br><span class="line">        A1[i] = A1[i] * A2[i];</span><br><span class="line">        B[i] = B[i] * A2[i];</span><br><span class="line">    }</span><br><span class="line">    FFT(A1, N, <span class="number">-1</span>); FFT(B, N, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Max2; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (A1[i].a &lt;= eps) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">double</span> ans = (A1[i].a - B[i].a * <span class="number">3</span> + C[i].a * <span class="number">2</span>) / <span class="number">6.0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ans &gt; eps) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d : %.0lf\n&quot;</span>, i - <span class="number">60000</span>, ans);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    Max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">        <span class="keyword">int</span> t;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">        t += <span class="number">20000</span>;</span><br><span class="line">        A1[t].a += <span class="number">1</span>;</span><br><span class="line">        A2[t].a += <span class="number">1</span>;</span><br><span class="line">        B[<span class="number">2</span> * t].a += <span class="number">1</span>;</span><br><span class="line">        C[<span class="number">3</span> * t].a += <span class="number">1</span>;</span><br><span class="line">        Max = max(Max, t);</span><br><span class="line">    }</span><br><span class="line">    solve();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="hdu-5730-shell-necklace"><a href="#HDU-5730-Shell-Necklace" class="headerlink" title="HDU 5730 Shell Necklace"></a>HDU 5730 Shell Necklace</h4><p>&#x7ED9;&#x4E00;&#x6392;$n\leq 10^5$&#x9897;&#x73CD;&#x73E0;&#xFF08;&#x4E0D;&#x8003;&#x8651;&#x6210;&#x73AF;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x7528;$a_i$&#x8868;&#x793A;&#x53EF;&#x4EE5;&#x628A;&#x8FDE;&#x7EED;&#x7684;$i$&#x9897;&#x73CD;&#x73E0;&#x67D3;&#x8272;&#x7684;&#x67D3;&#x8272;&#x65B9;&#x6848;&#x6570;&#xFF0C;&#x6C42;$n$&#x9897;&#x73CD;&#x73E0;&#x7684;&#x67D3;&#x8272;&#x65B9;&#x6848;&#x6570;&#xFF0C;&#x5BF9;$313$&#x53D6;&#x6A21;&#x3002;</p>
<p>&#x7528;$dp[i]$&#x8868;&#x793A;&#x5C06;$i$&#x9897;&#x73CD;&#x73E0;&#x67D3;&#x8272;&#x7684;&#x67D3;&#x8272;&#x65B9;&#x6848;&#x6570;&#xFF0C;&#x521D;&#x59CB;&#x5316;$dp[0]=1$&#xFF0C;&#x679A;&#x4E3E;&#x7B2C;&#x4E00;&#x4E32;&#x8FDE;&#x7EED;&#x7684;&#x73CD;&#x73E0;&#x7684;&#x67D3;&#x8272;&#x65B9;&#x6848;&#x6570;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>dp[i]=\sum_{j=1}^{i}a[j]*dp[i-j]<br>$$<br>&#x7528;&#x5206;&#x6CBB;+FFT&#x5377;&#x79EF;&#x52A0;&#x901F;&#xFF0C;&#x5148;&#x7528;<code>double</code>&#x5B58;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x53D6;&#x6A21;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n\log^2 n)$&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    cdq(left, mid);</span><br><span class="line">    <span class="keyword">int</span> len = right - left + <span class="number">1</span>;</span><br><span class="line">    init(len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= mid - left; ++i) A1[i].a = dp[i + left] % MOD, A1[i].b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid - left + <span class="number">1</span>; i &lt; N; ++i) A1[i].a = A1[i].b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A2[i].a = data[i], A2[i].b = <span class="number">0</span>;</span><br><span class="line">    FFT(A1, N, <span class="number">1</span>); FFT(A2, N, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) A1[i] = A1[i] * A2[i];</span><br><span class="line">    FFT(A1, N, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid - left + <span class="number">1</span>; i &lt;= right - left; ++i) {</span><br><span class="line">        dp[i + left] = (dp[i + left] + (ll)(A1[i].a + <span class="number">0.5</span>) % MOD) % MOD;</span><br><span class="line">    }</span><br><span class="line">    cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) &amp;&amp; n) {</span><br><span class="line">        <span class="built_in">memset</span>(data, <span class="number">0</span>, <span class="keyword">sizeof</span> (data));</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span> (dp));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) { </span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;data[i]); </span><br><span class="line">            data[i] %= MOD;</span><br><span class="line">        }</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        cdq(<span class="number">0</span>, n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dp[n]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">普吕弗序列</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 8</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x5728;&#x56FE;&#x8BBA;&#x4E2D;&#xFF0C;&#x6807;&#x53F7;&#x6811;&#x7684;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x662F;&#x7531;&#x6811;&#x552F;&#x4E00;&#x5730;&#x4EA7;&#x751F;&#x7684;&#x5E8F;&#x5217;&#x3002;$n$&#x9876;&#x70B9;&#x7684;&#x6807;&#x53F7;&#x6811;&#x6709;&#x957F;$n &#x2212; 2$&#x7684;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x3002;<br><a id="more"></a></p>
<h4 id="&#x7531;&#x65E0;&#x6839;&#x6811;&#x751F;&#x6210;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;"><a href="#&#x7531;&#x65E0;&#x6839;&#x6811;&#x751F;&#x6210;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;" class="headerlink" title="&#x7531;&#x65E0;&#x6839;&#x6811;&#x751F;&#x6210;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;"></a>&#x7531;&#x65E0;&#x6839;&#x6811;&#x751F;&#x6210;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;</h4><p>&#x6BCF;&#x6B21;&#xFF08;&#x7B2C;$i$&#x6B21;&#xFF09;&#x53BB;&#x6389;&#x6811;&#x4E0A;&#x7F16;&#x53F7;&#x6700;&#x5C0F;&#x7684;&#x7684;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#xFF0C;&#x5E76;&#x628A;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x7684;&#x7B2C;$i$&#x9879;&#x8BBE;&#x4E3A;&#x8FD9;&#x4E2A;&#x53F6;&#x5B50;&#x7684;&#x90BB;&#x9876;&#x70B9;&#x7684;&#x6807;&#x53F7;&#x3002;&#x4E00;&#x68F5;&#x6811;&#x7684;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x662F;&#x552F;&#x4E00;&#x7684;&#x3002;<br><img src="/images/prufer.png" alt="prufer"><br>&#x4E0A;&#x9762;&#x7684;&#x6811;&#x7ED3;&#x6784;&#x53EF;&#x5F97;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#xFF1A;{4,4,4,5}&#x3002;</p>
<h4 id="&#x4ECE;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x8FD8;&#x539F;&#x65E0;&#x6839;&#x6811;"><a href="#&#x4ECE;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x8FD8;&#x539F;&#x65E0;&#x6839;&#x6811;" class="headerlink" title="&#x4ECE;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x8FD8;&#x539F;&#x65E0;&#x6839;&#x6811;"></a>&#x4ECE;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x8FD8;&#x539F;&#x65E0;&#x6839;&#x6811;</h4><p>&#x8BBE;&#x8FD9;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x957F;$n &#x2212; 2$&#x3002;&#x9996;&#x5148;&#x5199;&#x51FA;&#x6570;1&#x81F3;$n$&#x3002;&#x7B2C;&#x4E00;&#x6B65;&#xFF0C;&#x627E;&#x51FA;1&#x81F3;$n$&#x4E2D;&#x6CA1;&#x6709;&#x5728;&#x5E8F;&#x5217;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x6700;&#x5C0F;&#x6570;&#x3002;&#x628A;&#x6807;&#x53F7;&#x4E3A;&#x8FD9;&#x6570;&#x7684;&#x9876;&#x70B9;&#x548C;&#x6807;&#x53F7;&#x4E3A;&#x5E8F;&#x5217;&#x9996;&#x9879;&#x7684;&#x9876;&#x70B9;&#x8FDE;&#x8D77;&#x6765;&#xFF0C;&#x5E76;&#x628A;&#x8FD9;&#x6570;&#x4ECE;1&#x81F3;$n$&#x4E2D;&#x5220;&#x53BB;&#xFF0C;&#x5E8F;&#x5217;&#x7684;&#x9996;&#x9879;&#x4E5F;&#x5220;&#x53BB;&#x3002;&#x63A5;&#x7740;&#x6BCF;&#x4E00;&#x6B65;&#x4EE5;1&#x81F3;$n$&#x4E2D;&#x5269;&#x4E0B;&#x7684;&#x6570;&#x548C;&#x4F59;&#x4E0B;&#x5E8F;&#x5217;&#x91CD;&#x590D;&#x4EE5;&#x4E0A;&#x6B65;&#x9AA4;&#x3002;&#x6700;&#x540E;&#x5F53;&#x5E8F;&#x5217;&#x7528;&#x5B8C;&#xFF0C;&#x628A;1&#x81F3;n&#x4E2D;&#x6700;&#x540E;&#x5269;&#x4E0B;&#x7684;&#x4E24;&#x6570;&#x7684;&#x9876;&#x70B9;&#x8FDE;&#x8D77;&#x6765;&#x3002;</p>
<h4 id="&#x7ED3;&#x8BBA;"><a href="#&#x7ED3;&#x8BBA;" class="headerlink" title="&#x7ED3;&#x8BBA;"></a>&#x7ED3;&#x8BBA;</h4><ul>
<li>&#x4E00;&#x4E2A;&#x957F;&#x4E3A;$n&#x2212;2$&#x4E14;&#x6BCF;&#x9879;&#x90FD;&#x5728;1&#x81F3;$n$&#x4E4B;&#x95F4;&#x7684;&#x5E8F;&#x5217;$S$&#xFF0C;&#x6709;&#x552F;&#x4E00;&#x7684;&#x6807;&#x53F7;&#x6811;&#x4EE5;$S$&#x4E3A;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x3002;</li>
<li>&#x957F;$n&#x2212;2$&#x7684;&#x5E8F;&#x5217;&#x5171;&#x6709;$n^{n&#x2212;2}$&#x4E2A;&#xFF0C;&#x4ECE;&#x800C;&#x8BC1;&#x660E;&#x51EF;&#x83B1;&#x516C;&#x5F0F;&#xFF1A;$n$&#x9876;&#x70B9;&#x7684;&#x6807;&#x53F7;&#x65E0;&#x6839;&#x6811;&#x5171;&#x6709;$n^{n&#x2212;2}$&#x68F5;&#x3002;</li>
<li>&#x4E00;&#x68F5;&#x6807;&#x53F7;&#x6811;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6807;&#x53F7;&#x5B8C;&#x5168;&#x56FE;&#x7684;&#x4E00;&#x68F5;&#x751F;&#x6210;&#x6811;&#x3002;&#x5BF9;&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x52A0;&#x4EE5;&#x9650;&#x5236;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x6807;&#x53F7;&#x5B8C;&#x5168;&#x4E8C;&#x5206;&#x56FE;&#x7684;&#x751F;&#x6210;&#x6811;&#x603B;&#x6570;&#x3002;&#x82E5;$G$&#x662F;&#x5B8C;&#x5168;&#x4E8C;&#x5206;&#x56FE;&#xFF0C;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x9876;&#x70B9;&#x6807;&#x53F7;1&#x5230;$n_1$&#xFF0C;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x9876;&#x70B9;&#x6807;&#x53F7;$n_{1} + 1$&#x5230;$n$&#x3002;$G$&#x7684;&#x6807;&#x53F7;&#x751F;&#x6210;&#x6811;&#x603B;&#x6570;&#x4E3A;&#xFF0C;$n_{1}^{n_{2}-1}*n_{2}^{n_{1}-1}$&#x5176;&#x4E2D;$n_{2} = n &#x2212; n_1$&#x3002;</li>
<li>&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x4E2D;&#x67D0;&#x4E2A;&#x7F16;&#x53F7;$i$&#x51FA;&#x73B0;&#x7684;&#x6B21;&#x6570;$=d(i)-1,d(i)$&#x662F;&#x8FD9;&#x4E2A;&#x7F16;&#x53F7;&#x7684;&#x8282;&#x70B9;&#x5728;&#x65E0;&#x6839;&#x6811;&#x4E2D;&#x7684;&#x5EA6;&#x6570;</li>
<li>$n$&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5EA6;&#x4F9D;&#x6B21;&#x4E3A;$d_1, d_2,\cdots , d_n$&#x7684;&#x65E0;&#x6839;&#x6811;&#x5171;&#x6709; $ \frac{(n-2)!} {[ (d_1-1)!*(d_2-1)!*\cdots *(d_n-1)! ] }$&#x4E2A;&#xFF0C;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;$Pr&#xFC;fer$&#x7F16;&#x7801;&#x4E2D;&#x7684;&#x6570;&#x5B57;$i$&#x6070;&#x597D;&#x51FA;&#x73B0;$d_i-1$&#x6B21;&#x3002;</li>
<li>$n$&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5EA6;&#x4F9D;&#x6B21;&#x4E3A;$d_1, d_2,\cdots , d_n$&#xFF0C;&#x53E6;&#x6709;$m$&#x4E2A;&#x8282;&#x70B9;&#x5EA6;&#x6570;&#x672A;&#x77E5;&#xFF0C;&#x6C42;&#x6709;&#x591A;&#x5C11;&#x79CD;&#x751F;&#x6210;&#x6811;&#xFF1F;[BZOJ1005 &#x660E;&#x660E;&#x7684;&#x70E6;&#x607C;]</li>
</ul>
<p>&#x4EE4;&#x6BCF;&#x4E2A;&#x5DF2;&#x77E5;&#x5EA6;&#x6570;&#x7684;&#x8282;&#x70B9;&#x7684;&#x5EA6;&#x6570;&#x4E3A;$d_i(i:1\sim k)$&#xFF0C;&#x6709;$n$&#x4E2A;&#x8282;&#x70B9;&#xFF0C;$m$&#x4E2A;&#x8282;&#x70B9;&#x672A;&#x77E5;&#x5EA6;&#x6570;&#xFF0C;$sum=\sum_{i=1}^{k}(d(i)-1)$&#x3002;<br>$$<br>Ans=C_{n-2}^{sum}*\frac{sum!}{\prod_{i=1}^{k}(d(i)-1)!}*(n-k)^{n-sum-2}<br>$$</p>
<ul>
<li>$n$&#x4E2A;&#x70B9;&#x7684;&#x6709;&#x6807;&#x53F7;&#x6709;&#x6839;&#x6811;&#x7684;&#x8BA1;&#x6570;&#xFF1A;$n^{n-2}*n = n^{n-1}$</li>
</ul>
<h4 id="bzoj1211"><a href="#BZOJ1211" class="headerlink" title="BZOJ1211"></a>BZOJ1211</h4><p>&#x7ED9;&#x5B9A;&#x4E00;&#x68F5;$n\leq 150$&#x4E2A;&#x7ED3;&#x70B9;&#x7684;&#x6811;&#x4E2D;&#x6240;&#x6709;&#x70B9;&#x7684;&#x5EA6;&#x6570;&#xFF0C;&#x6C42;&#x6709;&#x591A;&#x5C11;&#x79CD;&#x53EF;&#x80FD;&#x7684;&#x6811;&#xFF1F;</p>
<p>&#x76F4;&#x63A5;&#x4E58;&#x4F1A;&#x7206;<code>long long</code>&#xFF0C;&#x6240;&#x4EE5;&#x5148;&#x628A;&#x6BCF;&#x4E2A;&#x6570;&#x5206;&#x89E3;&#x8D28;&#x56E0;&#x6570;&#xFF0C;&#x628A;&#x8D28;&#x56E0;&#x6570;&#x7684;&#x6B21;&#x6570;&#x76F8;&#x52A0;&#x76F8;&#x51CF;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4E58;&#x8D77;&#x6765;&#x3002;&#x65E0;&#x89E3;&#x9700;&#x8981;&#x8F93;&#x51FA;0&#x3002;&#x5F53;<code>n!=1&amp;&amp;d[i]==0</code>&#x65F6;&#x6216;&#x8005;&#x5F53;$\sum(d[i]-1)!=n-2$&#x65F6;&#x65E0;&#x89E3;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> num[<span class="number">200</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Qpow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">    ll ret = <span class="number">1</span>, t = a;</span><br><span class="line">    <span class="keyword">while</span> (b) {</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret *= t;</span><br><span class="line">        t *= t;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> flag)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i * i &lt;= x; ++i) {</span><br><span class="line">        <span class="keyword">while</span> (x % i == <span class="number">0</span>) num[i] += flag, x /= i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">1</span>) num[x] += flag;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n - <span class="number">2</span>; ++i) update(i, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">        <span class="keyword">int</span> d;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d);</span><br><span class="line">        <span class="keyword">if</span> (d == <span class="number">0</span> &amp;&amp; n &gt; <span class="number">1</span>) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>); </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        sum += d;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt;= d - <span class="number">1</span>; ++j) update(j, <span class="number">-1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (sum != <span class="number">2</span> * n - <span class="number">2</span>) <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        ll ans = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="keyword">if</span> (num[i]) ans *= Qpow(i, num[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="hdu-5629"><a href="#HDU-5629" class="headerlink" title="HDU 5629"></a>HDU 5629</h4><p>&#x7ED9;$n\leq 50$&#x4E2A;&#x70B9;&#xFF0C;&#x6BCF;&#x4E2A;&#x7ED3;&#x70B9;&#x7684;&#x5EA6;&#x6570;&#x4E0D;&#x8D85;&#x8FC7;$a_i\in [1,n]$&#xFF0C;&#x6C42;&#x6784;&#x9020;&#x6811;&#x5927;&#x5C0F;&#xFF08;&#x7ED3;&#x70B9;&#x4E2A;&#x6570;&#xFF09;&#x4E3A;$s\in [1,n]$&#x7684;&#x65B9;&#x6848;&#x6570;&#xFF0C;&#x7B54;&#x6848;&#x5BF9;$1e9+7$&#x53D6;&#x6A21;&#x3002;</p>
<p>&#x7528;$dp[i][j][k]$&#x8868;&#x793A;&#x5904;&#x7406;&#x5230;&#x7B2C;$i$&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4ECE;&#x4E2D;&#x9009;&#x62E9;$j$&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4E14;&#x53EF;&#x91CD;&#x96C6;&#x5927;&#x5C0F;(&#x666E;&#x5415;&#x5F17;&#x5E8F;&#x5217;&#x957F;&#x5EA6;)&#x4E3A;$k$&#x7684;&#x6392;&#x5217;&#x7EC4;&#x5408;&#x6570;&#x3002;&#x521D;&#x59CB;&#x5316;$dp[0][0][0]=1$&#xFF0C;&#x8003;&#x8651;&#x7528;$dp[i-1][j][k]$&#x6765;&#x66F4;&#x65B0;$dp[i][][]$&#x7684;&#x72B6;&#x6001;:&#x4E0D;&#x7528;&#x7B2C;$i$&#x4E2A;&#x7ED3;&#x70B9;&#x548C;&#x679A;&#x4E3E;&#x7B2C;$i$&#x4E2A;&#x7ED3;&#x70B9;&#x7684;&#x5EA6;&#x6570;&#x3002;&#x6EDA;&#x52A8;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n^4)$&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;$FFT$&#x4F18;&#x5316;&#x5230;$O(n^3\log n)$&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x5E38;&#x6570;&#x539F;&#x56E0;&#xFF0C;&#x5DEE;&#x522B;&#x4E0D;&#x5927;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">55</span>;</span><br><span class="line"><span class="keyword">const</span> ll mod = (ll)(<span class="number">1e9</span>) + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n;</span><br><span class="line"><span class="keyword">int</span> a[MAX_N];</span><br><span class="line">ll dp[<span class="number">2</span>][MAX_N][MAX_N], C[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; ++i) {</span><br><span class="line">        C[i][<span class="number">0</span>] = C[i][i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; ++j) {</span><br><span class="line">            C[i][j] = (C[i - <span class="number">1</span>][j] + C[i - <span class="number">1</span>][j - <span class="number">1</span>]) % mod;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span> (dp));</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            now ^= <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">memset</span>(dp[now], <span class="number">0</span>, <span class="keyword">sizeof</span> (dp[now]));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; ++j) {</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= n - <span class="number">2</span>; ++k) {</span><br><span class="line">                    dp[now][j][k] += dp[now ^ <span class="number">1</span>][j][k];</span><br><span class="line">                    <span class="keyword">if</span> (dp[now][j][k] &gt;= mod) dp[now][j][k] -= mod;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">1</span>; p &lt;= a[i] &amp;&amp; k + p - <span class="number">1</span> &lt;= n - <span class="number">2</span>; ++p) {</span><br><span class="line">                        dp[now][j + <span class="number">1</span>][p + k - <span class="number">1</span>] += dp[now ^ <span class="number">1</span>][j][k] * C[k + p - <span class="number">1</span>][p - <span class="number">1</span>] % mod;</span><br><span class="line">                        <span class="keyword">if</span> (dp[now][j + <span class="number">1</span>][p + k - <span class="number">1</span>] &gt;= mod) dp[now][j + <span class="number">1</span>][p + k - <span class="number">1</span>] -= mod;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt;= n; ++j) <span class="built_in">printf</span>(<span class="string">&quot; %lld&quot;</span>, dp[now][j][j - <span class="number">2</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">cdq分治与整体二分</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>Reference:<br><a href="http://zyk1997.github.io/2015/06/22/CDQ/" target="_blank" rel="noopener">Link1-by zyk1997</a><br><a href="http://blog.csdn.net/txl199106/article/details/45538441" target="_blank" rel="noopener">Link2-by Tank_long</a><br><a href="http://blog.csdn.net/lwt36/article/details/50669972" target="_blank" rel="noopener">Link3-by TaoSama</a><br><a href="http://www.cnblogs.com/zig-zag/archive/2013/04/18/3027707.html" target="_blank" rel="noopener">Link4-by Zig-zag</a><br><a id="more"></a></p>
<h4 id="&#x6574;&#x4F53;&#x4E8C;&#x5206;"><a href="#&#x6574;&#x4F53;&#x4E8C;&#x5206;" class="headerlink" title="&#x6574;&#x4F53;&#x4E8C;&#x5206;"></a>&#x6574;&#x4F53;&#x4E8C;&#x5206;</h4><h5 id="poj-2104&#x533A;&#x95F4;&#x7B2C;k&#x5C0F;"><a href="#POJ-2104-&#x533A;&#x95F4;&#x7B2C;-k-&#x5C0F;" class="headerlink" title="[POJ 2104:&#x533A;&#x95F4;&#x7B2C;$k$&#x5C0F;]"></a>[POJ 2104:&#x533A;&#x95F4;&#x7B2C;$k$&#x5C0F;]</h5><p>$n\leq 10^{5}$&#x4E2A;&#x6570;&#x548C;$m\leq 5000$&#x4E2A;&#x8BE2;&#x95EE;&#xFF0C;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x533A;&#x95F4;$[left,right]$&#x7B2C;$k_i$&#x5C0F;&#x7684;&#x6570;&#x662F;&#xFF1F;</p>
<p>&#x9996;&#x5148;&#x5BF9;&#x4E8E;&#x4E00;&#x6B21;&#x8BE2;&#x95EE;&#x53EF;&#x4EE5;&#x4E8C;&#x5206;&#x7B54;&#x6848;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x9A8C;&#x8BC1;&#x6BD4;&#x7B54;&#x6848;&#x5927;&#x7684;&#x6570;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x6765;&#x4E0D;&#x65AD;&#x5730;&#x7F29;&#x5C0F;&#x7B54;&#x6848;&#x8303;&#x56F4;&#x76F4;&#x81F3;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x51C6;&#x786E;&#x7684;&#x7B54;&#x6848;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x591A;&#x4E2A;&#x8BE2;&#x95EE;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x8BE2;&#x95EE;&#x90FD;&#x9700;&#x8981;&#x5224;&#x5B9A;&#x4E00;&#x4E0B;&#xFF0C;&#x4EE5;&#x51B3;&#x5B9A;&#x5B83;&#x88AB;&#x5212;&#x5206;&#x5230;&#x54EA;&#x4E00;&#x4E2A;&#x7B54;&#x6848;&#x7684;&#x533A;&#x95F4;&#x91CC;&#x3002;&#x8FD9;&#x4E2A;&#x5224;&#x5B9A;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x6BD4;&#x4E8C;&#x5206;&#x7684;$mid$&#x5927;&#x7684;&#x6570;&#x7684;&#x4E2A;&#x6570;$num$&#x548C;$k_i$&#x7684;&#x5927;&#x5C0F;&#x5173;&#x7CFB;&#x3002;&#x5982;&#x679C;&#x6BD4;&#x4E8C;&#x5206;&#x7684;$mid$&#x5C0F;&#x7684;&#x6570;&#x7684;&#x4E2A;&#x6570;$num$&#x5C0F;&#x4E8E;$k_i$&#xFF0C;&#x5219;&#x9700;&#x8981;&#x53BB;&#x5BFB;&#x627E;&#x7684;&#x7B54;&#x6848;&#x4E00;&#x5B9A;&#x5927;&#x4E8E;$mid$&#xFF0C;&#x8FD9;&#x65F6;$k&#x2019;_{i}=k_{i}-num$&#x3002;&#x5982;&#x679C;$num\geq k_i$&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x5BFB;&#x627E;&#x7684;&#x7B54;&#x6848;&#x4E00;&#x5B9A;$\leq mid$&#x3002;&#x76F4;&#x5230;&#x9012;&#x5F52;&#x7ED3;&#x675F;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O((n+m)*\log ^{2} (n+m)*\log (inf))$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">5010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = (<span class="keyword">int</span>)(<span class="number">1e9</span>) + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> ans[MAX_M], bit[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> {</span></span><br><span class="line">	<span class="keyword">int</span> type, x, y, k, id;</span><br><span class="line">} Q[MAX_N + MAX_M], Q1[MAX_N + MAX_M], Q2[MAX_N + MAX_M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; (-x); }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= n; i += lowbit(i)) {</span><br><span class="line">		bit[i] += value;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">		ret += bit[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> qL, <span class="keyword">int</span> qR, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (qL &gt; qR) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (L == R) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = qL; i &lt;= qR; ++i) {</span><br><span class="line">			<span class="keyword">if</span> (Q[i].type == <span class="number">2</span>) ans[Q[i].id] = L;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> mid = (L + R) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> tp1 = <span class="number">0</span>, tp2 = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = qL; i &lt;= qR; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (Q[i].type == <span class="number">1</span>) {</span><br><span class="line">			<span class="keyword">if</span> (Q[i].x &lt;= mid) {</span><br><span class="line">				update(Q[i].id, Q[i].y); <span class="comment">// Q[i].y = 1</span></span><br><span class="line">				Q1[tp1++] = Q[i];</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				Q2[tp2++] = Q[i];</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="keyword">int</span> small = query(Q[i].y) - query(Q[i].x - <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (small &gt;= Q[i].k) Q1[tp1++] = Q[i];</span><br><span class="line">			<span class="keyword">else</span> {</span><br><span class="line">				Q[i].k -= small;</span><br><span class="line">				Q2[tp2++] = Q[i];</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tp1; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (Q1[i].type == <span class="number">1</span>) update(Q1[i].id, -Q1[i].y);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(Q + qL, Q1, tp1 * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">	<span class="built_in">memcpy</span>(Q + qL + tp1, Q2, tp2 * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">	cdq(qL, qL + tp1 - <span class="number">1</span>, L, mid);</span><br><span class="line">	cdq(qL + tp1, qR, mid + <span class="number">1</span>, R);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;Q[i].x);</span><br><span class="line">			Q[i].type = <span class="number">1</span>, Q[i].y = <span class="number">1</span>;</span><br><span class="line">			Q[i].id = i;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;Q[n + i].x, &amp;Q[n + i].y, &amp;Q[n + i].k);</span><br><span class="line">			Q[n + i].type = <span class="number">2</span>, Q[n + i].id = i;</span><br><span class="line">		}</span><br><span class="line">		cdq(<span class="number">1</span>, n + m, -inf, inf);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="bzoj-3110-&#x7B2C;k&#x5927;&#x6570;"><a href="#BZOJ-3110-&#x7B2C;-k-&#x5927;&#x6570;" class="headerlink" title="[BZOJ 3110 &#x7B2C;$k$&#x5927;&#x6570;]"></a>[BZOJ 3110 &#x7B2C;$k$&#x5927;&#x6570;]</h5><p>$n\leq 50000$&#x4E2A;&#x4F4D;&#x7F6E;&#xFF0C;$m\leq 50000$&#x4E2A;&#x64CD;&#x4F5C;&#x3002;&#x64CD;&#x4F5C;&#x6709;&#x4E24;&#x79CD;:</p>
<ul>
<li>$1\quad a\quad b\quad c$&#x7684;&#x5F62;&#x5F0F;&#x8868;&#x793A;&#x5728;&#x7B2C;$a$&#x4E2A;&#x4F4D;&#x7F6E;&#x5230;&#x7B2C;$b$&#x4E2A;&#x4F4D;&#x7F6E;&#xFF0C;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x6570;$c(abs(c)\leq n)$</li>
<li>$2\quad a\quad b\quad c$&#x5F62;&#x5F0F;&#xFF0C;&#x8868;&#x793A;&#x8BE2;&#x95EE;&#x4ECE;&#x7B2C;$a$&#x4E2A;&#x4F4D;&#x7F6E;&#x5230;&#x7B2C;$b$&#x4E2A;&#x4F4D;&#x7F6E;&#xFF0C;&#x7B2C;$c(c\leq Maxlongint)$&#x5927;&#x7684;&#x6570;&#x662F;&#x591A;&#x5C11;?(&#x540C;&#x4E00;&#x4F4D;&#x7F6E;&#x53EF;&#x80FD;&#x6709;&#x591A;&#x4E2A;&#x6570;)</li>
</ul>
<p>&#x6574;&#x4F53;&#x4E8C;&#x5206;&#xFF0C;&#x5BF9;&#x5DE6;&#x533A;&#x95F4;&#x64CD;&#x4F5C;1&#x4E2D;&#x7684;$c\leq mid$&#x8FDB;&#x884C;&#x533A;&#x95F4;&#x6BCF;&#x4E2A;&#x6570;&#x90FD;&#x52A0;1&#xFF0C;&#x7EDF;&#x8BA1;&#x6570;&#x5B57;&#x4E2A;&#x6570;&#x3002;&#x7136;&#x540E;&#x5BF9;&#x4E8E;&#x53F3;&#x533A;&#x95F4;&#x7684;&#x6BCF;&#x4E2A;&#x64CD;&#x4F5C;2&#x8FDB;&#x884C;&#x533A;&#x95F4;&#x67E5;&#x8BE2;&#x6570;&#x5B57;&#x4E2A;&#x6570;&#x3002;&#x6BD4;&#x8F83;&#x5212;&#x5206;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">50010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line">ll B[MAX_N], C[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> {</span></span><br><span class="line">	<span class="keyword">int</span> id, type, a, b, ans;</span><br><span class="line">	ll c;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Query&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> id &lt; rhs.id;</span><br><span class="line">	}</span><br><span class="line">} ques[MAX_N], newq1[MAX_N], newq2[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; -x; }</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">	ll ret1 = <span class="number">0</span>, ret2 = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">		ret1 += C[i], ret2 += B[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret1 * (x + <span class="number">1</span>) - ret2;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= n; i += lowbit(i)) {</span><br><span class="line">		C[i] += value, B[i] += value * x;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> qL, <span class="keyword">int</span> qR, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (qL &gt; qR) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (left == right) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = qL; i &lt;= qR; ++i) {</span><br><span class="line">			<span class="keyword">if</span> (ques[i].type == <span class="number">2</span>) ques[i].ans = left;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;	</span><br><span class="line">	<span class="keyword">int</span> tp1 = <span class="number">0</span>, tp2 = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = qL; i &lt;= qR; ++i) {</span><br><span class="line">		<span class="keyword">int</span> L = ques[i].a, R = ques[i].b;</span><br><span class="line">		<span class="keyword">if</span> (ques[i].type == <span class="number">1</span>) {</span><br><span class="line">			<span class="keyword">if</span> (ques[i].c &lt;= mid) newq1[tp1++] = ques[i];</span><br><span class="line">			<span class="keyword">else</span> {</span><br><span class="line">				update(L, <span class="number">1</span>);</span><br><span class="line">				update(R + <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">				newq2[tp2++] = ques[i];</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			ll cnt = query(R) - query(L - <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (cnt &lt; ques[i].c) {</span><br><span class="line">				ques[i].c -= cnt;</span><br><span class="line">				newq1[tp1++] = ques[i];</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				newq2[tp2++] = ques[i];</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tp2; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (newq2[i].type == <span class="number">1</span>) {</span><br><span class="line">			update(newq2[i].a, <span class="number">-1</span>);</span><br><span class="line">			update(newq2[i].b + <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(ques + qL, newq1, tp1 * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">	<span class="built_in">memcpy</span>(ques + qL + tp1, newq2, tp2 * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">	solve(qL, qL + tp1 - <span class="number">1</span>, left, mid);</span><br><span class="line">	solve(qL + tp1, qR, mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%lld&quot;</span>, &amp;ques[i].type, &amp;ques[i].a, &amp;ques[i].b, &amp;ques[i].c);</span><br><span class="line">		ques[i].id = i;</span><br><span class="line">	}</span><br><span class="line">	solve(<span class="number">1</span>, m, -n, n);</span><br><span class="line">	sort(ques, ques + m + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (ques[i].type == <span class="number">2</span>) {</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ques[i].ans);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="cdq&#x5206;&#x6CBB;&#x65F6;&#x95F4;&#x5206;&#x6CBB;"><a href="#cdq&#x5206;&#x6CBB;-&#x65F6;&#x95F4;&#x5206;&#x6CBB;" class="headerlink" title="cdq&#x5206;&#x6CBB;(&#x65F6;&#x95F4;&#x5206;&#x6CBB;)"></a>cdq&#x5206;&#x6CBB;(&#x65F6;&#x95F4;&#x5206;&#x6CBB;)</h4><p>cdq&#x5206;&#x6CBB;&#x7B97;&#x6CD5;&#x7684;&#x6838;&#x5FC3;&#x5728;&#x4E8E;&#xFF1A;&#x53BB;&#x6389;&#x65F6;&#x95F4;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x67E5;&#x8BE2;&#x8981;&#x6C42;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x523B;&#x540C;&#x5316;&#xFF0C;&#x5316;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x4E3A;&#x9759;&#x6001;&#x67E5;&#x8BE2;&#x3002;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x95EE;&#x9898;&#x6765;&#x8BF4;&#x53EF;&#x4EE5;&#x628A;&#x67D0;&#x4E00;&#x7EF4;&#x7684;&#x9650;&#x5236;&#x901A;&#x8FC7;&#x6392;&#x5E8F;&#x770B;&#x4F5C;&#x65F6;&#x95F4;&#x9650;&#x5236;&#x7136;&#x540E;&#x8FD0;&#x7528;cdq&#x5206;&#x6CBB;&#x3002;&#x89E3;&#x51B3;&#x4E09;&#x7EF4;&#x504F;&#x5E8F;&#x95EE;&#x9898;&#x4E00;&#x822C;&#x8981;&#x7B2C;&#x4E00;&#x7EF4;&#x6392;&#x5E8F;&#xFF0C;&#x7B2C;&#x4E8C;&#x7EF4;cdq&#x5206;&#x6CBB;&#xFF0C;&#x7B2C;&#x4E09;&#x4F4D;&#x501F;&#x7528;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1A;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#xFF0C;&#x7EBF;&#x6BB5;&#x6811;&#xFF0C;&#x5E73;&#x8861;&#x6811;&#x7B49;&#x3002;</p>
<p>1.&#x4F7F;&#x7528;CDQ&#x5206;&#x6CBB;&#x7684;&#x524D;&#x63D0;</p>
<ul>
<li>&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x5BF9;&#x8BE2;&#x95EE;&#x7684;&#x8D21;&#x732E;&#x72EC;&#x7ACB;&#xFF0C;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;</li>
<li>&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x79BB;&#x7EBF;&#x7B97;&#x6CD5;</li>
</ul>
<p>2.&#x4E00;&#x822C;&#x6B65;&#x9AA4;</p>
<ul>
<li>&#x5C06;&#x6574;&#x4E2A;&#x64CD;&#x4F5C;&#x5E8F;&#x5217;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x957F;&#x5EA6;&#x76F8;&#x7B49;&#x7684;&#x90E8;&#x5206;&#x3010;&#x5206;&#x3011;</li>
<li>&#x9012;&#x5F52;&#x5904;&#x7406;&#x524D;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x5B50;&#x95EE;&#x9898; &#x3010;&#x6CBB;1&#x3011;</li>
<li>&#x8BA1;&#x7B97;&#x524D;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x5B50;&#x95EE;&#x9898;&#x4E2D;&#x7684;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x5BF9;&#x540E;&#x4E00;&#x90E8;&#x5206;&#x5B50;&#x95EE;&#x9898;&#x7684;&#x5F71;&#x54CD; &#x3010;&#x6CBB;2&#x3011;</li>
<li>&#x9012;&#x5F52;&#x5904;&#x7406;&#x540E;&#x4E00;&#x90E8;&#x5206;&#x5B50;&#x95EE;&#x9898; &#x3010;&#x6CBB;3&#x3011;</li>
</ul>
<p>3.&#x5206;&#x6CBB;&#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF08;$k$&#x662F;&#x4E00;&#x4E2A;&#x548C;$n$&#x65E0;&#x5173;&#x7684;&#x591A;&#x9879;&#x5F0F;&#xFF09;</p>
<ul>
<li>$T(n)=2T(\frac{n}{2})+O(kn) \rightarrow T(n)=O(kn \log n)$</li>
<li>$T(n)=2T(\frac{n}{2})+O(kn\log n)\rightarrow T(n)=O(kn\log^{2} n)$</li>
<li>$T(n)=2T(\frac{n}{2})+O(k)\rightarrow T(n)=O(kn)$</li>
</ul>
<h5 id="neu-1702-&#x4E09;&#x7EF4;&#x9006;&#x5E8F;&#x5BF9;&#x4E25;&#x683C;&#x5927;&#x4E8E;"><a href="#NEU-1702-&#x4E09;&#x7EF4;&#x9006;&#x5E8F;&#x5BF9;&#xFF08;&#x4E25;&#x683C;&#x5927;&#x4E8E;&#xFF09;" class="headerlink" title="[NEU 1702 &#x4E09;&#x7EF4;&#x9006;&#x5E8F;&#x5BF9;&#xFF08;&#x4E25;&#x683C;&#x5927;&#x4E8E;&#xFF09;]"></a>[NEU 1702 &#x4E09;&#x7EF4;&#x9006;&#x5E8F;&#x5BF9;&#xFF08;&#x4E25;&#x683C;&#x5927;&#x4E8E;&#xFF09;]</h5><p>&#x5B9A;&#x4E49;&#x70B9;$i\leq j$&#x5F53;&#x4E14;&#x4EC5;&#x5F53;$x_{i}\leq x_{j},y_{i}\leq y_{j},z_{i}\leq z_{j}$&#x3002;&#x7ED9;$n\leq 10^5$&#x4E2A;&#x70B9;&#xFF0C;&#x5BF9;&#x6BCF;&#x4E2A;&#x70B9;&#x6C42;&#x51FA;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x5B83;&#x7684;&#x70B9;&#x7684;&#x6570;&#x91CF;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, MaxZ;</span><br><span class="line"><span class="keyword">int</span> bit[MAX_N], same[MAX_N], ans[MAX_N], Z[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> {</span></span><br><span class="line">	<span class="keyword">int</span> x, y, z, id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> x == rhs.x &amp;&amp; y == rhs.y &amp;&amp; z == rhs.z;</span><br><span class="line">	}</span><br><span class="line">} P[MAX_N], Q[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">xyz</span><span class="params">(Point a, Point b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (a.x != b.x) <span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">	<span class="keyword">if</span> (a.y != b.y) <span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">	<span class="keyword">return</span> a.z &lt; b.z;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">yzx</span><span class="params">(Point a, Point b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (a.y != b.y) <span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">	<span class="keyword">if</span> (a.z != b.z) <span class="keyword">return</span> a.z &lt; b.z;</span><br><span class="line">	<span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; (-x); }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= MaxZ; i += lowbit(i)) {</span><br><span class="line">		bit[i] += value;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">		ret += bit[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>, xmid = P[mid].x;</span><br><span class="line">	cdq(left, mid);</span><br><span class="line">	<span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		Q[total++] = P[i];</span><br><span class="line">	}</span><br><span class="line">	sort(Q, Q + total, yzx);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; total; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (Q[i].x &lt;= xmid) update(Q[i].z, <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">else</span> {</span><br><span class="line">			ans[Q[i].id] += query(Q[i].z);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; total; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (Q[i].x &lt;= xmid) update(Q[i].z, <span class="number">-1</span>);</span><br><span class="line">	}</span><br><span class="line">	cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;P[i].x, &amp;P[i].y, &amp;P[i].z);</span><br><span class="line">			P[i].id = i, Z[i] = P[i].z;</span><br><span class="line">		}</span><br><span class="line">		sort(Z, Z + n);</span><br><span class="line">		MaxZ = unique(Z, Z + n) - Z;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			P[i].z = lower_bound(Z, Z + MaxZ, P[i].z) - Z + <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line">		sort(P, P + n, xyz);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; n; ) {</span><br><span class="line">			<span class="keyword">while</span> (j &lt; n &amp;&amp; P[i] == P[j]) ++j;</span><br><span class="line">			<span class="keyword">while</span> (i &lt; j) {</span><br><span class="line">				same[P[i].id] = P[j - <span class="number">1</span>].id;</span><br><span class="line">				++i;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) { </span><br><span class="line">			P[i].x = i; <span class="comment">// &#x8FD9;&#x4E00;&#x6B65;&#x662F;&#x5FC5;&#x987B;&#x7684;</span></span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= MaxZ; ++i) { bit[i] = <span class="number">0</span>; }</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) { ans[i] = <span class="number">0</span>; }</span><br><span class="line">		cdq(<span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[same[i]]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="uvalive-6776-&#x4E09;&#x7EF4;lis"><a href="#UVALive-6776-&#x4E09;&#x7EF4;LIS" class="headerlink" title="[UVALive 6776 &#x4E09;&#x7EF4;LIS]"></a>[UVALive 6776 &#x4E09;&#x7EF4;LIS]</h5><p>&#x5B9A;&#x4E49;&#x4E24;&#x4E2A;&#x70B9;$i$&#x548C;$j$,&#x5982;&#x679C;&#x6EE1;&#x8DB3;$x_i&lt;x_j,y_i&lt;y_j,z_i&lt;z_j$&#xFF0C;&#x90A3;&#x4E48;&#x79F0;&#xFF1A;$i&lt;j$&#xFF0C;&#x7ED9;$n\leq 3*10^{5}$&#x4E2A;&#x70B9;&#x8BA1;&#x7B97;LIS&#x3002;</p>
<p>&#x5148;&#x628A;&#x6240;&#x6709;&#x70B9;&#x7684;$Z$&#x5750;&#x6807;&#x79BB;&#x6563;&#x5316;&#xFF0C;&#x7136;&#x540E;&#x6309;&#x7167;$XYZ$&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6392;&#x5E8F;&#xFF0C;&#x8003;&#x8651;cdq&#x5206;&#x6CBB;&#x3002;&#x5BF9;&#x4E8E;&#x533A;&#x95F4;$[left,right]$&#x5185;&#x7684;&#x70B9;&#x518D;&#x6309;&#x7167;$YZX$&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6392;&#x5E8F;&#xFF0C;&#x8BB0;&#x5F55;&#x4E0B;$mid+1$&#x7684;&#x6A2A;&#x5750;&#x6807;&#xFF0C;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x501F;&#x7528;&#x4E24;&#x68F5;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">300010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, MaxZ;</span><br><span class="line"><span class="keyword">int</span> bit[<span class="number">2</span>][MAX_N], dp[MAX_N], Z[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> {</span></span><br><span class="line">	<span class="keyword">int</span> x, y, z, id;</span><br><span class="line">} P[MAX_N], Q[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">xyz</span><span class="params">(Point a, Point b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (a.x != b.x) <span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">	<span class="keyword">if</span> (a.y != b.y) <span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">	<span class="keyword">return</span> a.z &lt; b.z;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">yzx</span><span class="params">(Point a, Point b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (a.y != b.y) <span class="keyword">return</span> a.y &lt; b.y; </span><br><span class="line">	<span class="keyword">if</span> (a.z != b.z) <span class="keyword">return</span> a.z &gt; b.z;</span><br><span class="line">	<span class="keyword">return</span> a.x &gt; b.x;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; (-x); }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= MaxZ; i += lowbit(i)) {</span><br><span class="line">		bit[id][i] = max(bit[id][i], value);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">		ret = max(ret, bit[id][i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Clear</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= MaxZ; i += lowbit(i)) {</span><br><span class="line">		bit[id][i] = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>, midX = P[mid + <span class="number">1</span>].x;</span><br><span class="line">	cdq(left, mid);</span><br><span class="line">	<span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		Q[total] = P[i];</span><br><span class="line">		Q[total++].id = i; <span class="comment">// &#x91CD;&#x65B0;&#x7F16;&#x53F7;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0B;&#x9762;&#x7684;&#x6BD4;&#x8F83;&#x63D2;&#x5165;&#x548C;&#x67E5;&#x8BE2;</span></span><br><span class="line">	}</span><br><span class="line">	sort(Q, Q + total, yzx);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; total; ++i) {</span><br><span class="line">		<span class="keyword">int</span> pos = Q[i].id, tmp;</span><br><span class="line">		<span class="keyword">if</span> (pos &lt;= mid) {</span><br><span class="line">			update(<span class="number">0</span>, Q[i].z, dp[pos]);</span><br><span class="line">			<span class="keyword">if</span> (Q[i].x != midX) update(<span class="number">1</span>, Q[i].z, dp[pos]); <span class="comment">// &#x5355;&#x72EC;&#x5EFA;&#x6811;</span></span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="keyword">if</span> (Q[i].x != midX) tmp = query(<span class="number">0</span>, Q[i].z - <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">else</span> tmp = query(<span class="number">1</span>, Q[i].z - <span class="number">1</span>);</span><br><span class="line">			dp[pos] = max(dp[pos], tmp + <span class="number">1</span>);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; total; ++i) {</span><br><span class="line">		<span class="keyword">int</span> pos = Q[i].id;</span><br><span class="line">		<span class="keyword">if</span> (pos &lt;= mid) { <span class="comment">// &#x6E05;&#x7A7A;&#x6811;&#x72B6;&#x6570;&#x7EC4;</span></span><br><span class="line">			Clear(<span class="number">0</span>, Q[i].z);</span><br><span class="line">			<span class="keyword">if</span> (Q[i].x != midX) Clear(<span class="number">1</span>, Q[i].z);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;P[i].x, &amp;P[i].y, &amp;P[i].z);</span><br><span class="line">		dp[i] = <span class="number">1</span>, P[i].id = i;</span><br><span class="line">		Z[i] = P[i].z;</span><br><span class="line">	}</span><br><span class="line">	sort(Z, Z + n);</span><br><span class="line">	MaxZ = unique(Z, Z + n) - Z;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		P[i].z = lower_bound(Z, Z + MaxZ, P[i].z) - Z + <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">	sort(P, P + n, xyz);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= MaxZ; ++i) { bit[<span class="number">0</span>][i] = bit[<span class="number">1</span>][i] = <span class="number">0</span>; }</span><br><span class="line">	cdq(<span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		ans = max(ans, dp[i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="bzoj-3295-&#x52A8;&#x6001;&#x9006;&#x5E8F;&#x5BF9;"><a href="#BZOJ-3295-&#x52A8;&#x6001;&#x9006;&#x5E8F;&#x5BF9;" class="headerlink" title="[BZOJ 3295 &#x52A8;&#x6001;&#x9006;&#x5E8F;&#x5BF9;]"></a>[BZOJ 3295 &#x52A8;&#x6001;&#x9006;&#x5E8F;&#x5BF9;]</h5><p>$n\leq 10^5$&#x4E2A;&#x5143;&#x7D20;&#x4F9D;&#x6B21;&#x5220;&#x9664;$m\leq 5*10^4 $&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x5C5E;&#x4E8E;$1\sim n$&#x4E2D;&#x95F4;&#x7684;&#x6B63;&#x6574;&#x6570;&#xFF0C;&#x6C42;&#x5220;&#x9664;&#x5143;&#x7D20;&#x4E4B;&#x524D;&#x5E8F;&#x5217;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x9006;&#x5E8F;&#x5BF9;&#x3002;</p>
<p>&#x9996;&#x5148;&#x628A;&#x5220;&#x9664;&#x770B;&#x6210;&#x9006;&#x5E8F;&#x63D2;&#x5165;&#x3002;&#x5B9A;&#x4E49;$x$&#x8868;&#x793A;&#x63D2;&#x5165;&#x65F6;&#x95F4;&#xFF0C;$y$&#x8868;&#x793A;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x521D;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;$z$&#x8868;&#x793A;&#x5143;&#x7D20;&#x503C;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6BCF;&#x5BF9;&#x9006;&#x5E8F;&#x5BF9;&#x5373;&#x662F;&#x4E09;&#x7EF4;&#x504F;&#x5E8F;&#x5173;&#x7CFB;&#x3002;&#x5982;&#x679C;&#x6700;&#x5916;&#x5C42;&#x6309;&#x7167;$y$&#x6392;&#x5E8F;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x533A;&#x95F4;$[left,right]$&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;$y$&#x5355;&#x8C03;&#x9012;&#x589E;&#xFF0C;&#x7136;&#x540E;&#x5229;&#x7528;$x$&#x548C;$mid$&#x7684;&#x5927;&#x5C0F;&#x5173;&#x7CFB;&#x5212;&#x5206;&#x533A;&#x95F4;&#x3002;&#x6B64;&#x65F6;&#x5728;&#x533A;&#x95F4;$[left,mid]$&#x548C;$[mid+1,right]$&#x5185;&#x90E8;&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;$y$&#x5355;&#x8C03;&#x9012;&#x589E;&#x5E76;&#x4E14;&#x5B50;&#x533A;&#x95F4;$[mid+1,right]$&#x7684;&#x6BCF;&#x4E00;&#x4E2A;$x$&#x90FD;&#x662F;&#x6BD4;&#x5DE6;&#x533A;&#x95F4;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;$x$&#x5927;&#x7684;&#x8003;&#x8651;&#x5229;&#x7528;&#x5DE6;&#x5B50;&#x533A;&#x95F4;&#x66F4;&#x65B0;&#x53F3;&#x5B50;&#x533A;&#x95F4;&#x3002;</p>
<ul>
<li>&#x5DE6;&#x8FB9;&#x6570;&#x503C;&#x5927;&#x7684;&#x9020;&#x6210;&#x7684;&#x9006;&#x5E8F;&#x5BF9;</li>
</ul>
<p>&#x56E0;&#x4E3A;&#x6B64;&#x65F6;&#x5B50;&#x533A;&#x95F4;&#x5185;&#x90E8;&#x90FD;&#x662F;$y$&#x5355;&#x8C03;&#x9012;&#x589E;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x679A;&#x4E3E;&#x7684;&#x53F3;&#x5B50;&#x533A;&#x95F4;$i:mid+1\sim right$&#x7684;$y$&#x5927;&#x5C0F;&#x6765;&#x786E;&#x5B9A;&#x662F;&#x5426;&#x5C06;&#x5DE6;&#x5B50;&#x533A;&#x95F4;&#x7684;&#x5143;&#x7D20;&#x7684;$z$&#x4FE1;&#x606F;&#x63D2;&#x5165;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#xFF0C;&#x6B64;&#x65F6;&#x5B8C;&#x5168;&#x4E0D;&#x7528;&#x7BA1;$x$&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x4E3A;&#x53F3;&#x5B50;&#x533A;&#x95F4;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7684;$x$&#x90FD;&#x6BD4;&#x5DE6;&#x5B50;&#x533A;&#x95F4;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7684;$x$&#x90FD;&#x5927;&#x3002;&#x5728;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x6BD4;&#x5F53;&#x524D;$i$&#x7684;$z$&#x5C0F;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x63D2;&#x5165;&#x7684;$z$&#x7684;&#x603B;&#x4E2A;&#x6570;&#x51CF;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x5F97;&#x5230;$z$&#x5927;&#x7684;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x4E86;&#x3002;&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#x5904;&#x7406;&#x5B8C;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x6839;&#x636E;&#x63D2;&#x5165;&#x201C;&#x6E05;&#x7A7A;&#x201D;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#x4FE1;&#x606F;&#x3002;</p>
<ul>
<li>&#x53F3;&#x8FB9;&#x6570;&#x5C0F;&#x9020;&#x6210;&#x7684;&#x9006;&#x5E8F;&#x5BF9;</li>
</ul>
<p>&#x904D;&#x5386;&#x53F3;&#x5B50;&#x533A;&#x95F4;$i:right\sim mid+1$&#xFF0C;&#x5C06;&#x5DE6;&#x5B50;&#x533A;&#x95F4;&#x7684;$z$&#x4E5F;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#x63D2;&#x5165;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#xFF0C;&#x8FD9;&#x6837;&#x5B50;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x5DE6;&#x5B50;&#x533A;&#x95F4;$y$&#x5927;&#x7684;&#x90FD;&#x63D2;&#x8FDB;&#x4E86;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#xFF0C;&#x6B63;&#x5E38;&#x67E5;&#x8BE2;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n\log n)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> bit[MAX_N], vis[MAX_N], pos[MAX_N];</span><br><span class="line">ll ans[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> {</span></span><br><span class="line">	<span class="keyword">int</span> x, y, z;</span><br><span class="line">} P[MAX_N], Q[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; -x; }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= n; i += lowbit(i)) {</span><br><span class="line">		bit[i] += value;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">		ret += bit[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (P[i].x &lt;= mid) Q[tp1++] = P[i];</span><br><span class="line">		<span class="keyword">else</span> Q[tp2++] = P[i];</span><br><span class="line">	}</span><br><span class="line">	tp1 = left;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (tp1 &lt;= mid &amp;&amp; Q[tp1].y &lt; Q[i].y) {</span><br><span class="line">			update(Q[tp1].z, <span class="number">1</span>);</span><br><span class="line">			tp1++;</span><br><span class="line">		}	</span><br><span class="line">		ans[Q[i].x] += (tp1 - left) - query(Q[i].z - <span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt; tp1; ++i) update(Q[i].z, <span class="number">-1</span>);</span><br><span class="line">	</span><br><span class="line">	tp1 = mid;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = right; i &gt;= mid + <span class="number">1</span>; --i) {</span><br><span class="line">		<span class="keyword">while</span> (tp1 &gt;= left &amp;&amp; Q[tp1].y &gt; Q[i].y) {</span><br><span class="line">			update(Q[tp1].z, <span class="number">1</span>);</span><br><span class="line">			tp1--;</span><br><span class="line">		}</span><br><span class="line">		ans[Q[i].x] += query(Q[i].z - <span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = mid; i &gt; tp1; --i) update(Q[i].z, <span class="number">-1</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(P + left, Q + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span>(Node));</span><br><span class="line">	cdq(left, mid);</span><br><span class="line">	cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;P[i].z);</span><br><span class="line">		P[i].x = <span class="number">0</span>, P[i].y = i, pos[P[i].z] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> sz = n, t;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">		vis[t] = <span class="number">1</span>;</span><br><span class="line">		P[pos[t]].x = sz--;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (vis[i]) <span class="keyword">continue</span>;</span><br><span class="line">		P[pos[i]].x = sz--;</span><br><span class="line">	}</span><br><span class="line">	cdq(<span class="number">1</span>, n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) ans[i] += ans[i - <span class="number">1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt; n - m; --i) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans[i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="bzoj-2244-&#x5BFC;&#x5F39;&#x62E6;&#x622A;"><a href="#BZOJ-2244-&#x5BFC;&#x5F39;&#x62E6;&#x622A;" class="headerlink" title="[BZOJ 2244 &#x5BFC;&#x5F39;&#x62E6;&#x622A;]"></a>[BZOJ 2244 &#x5BFC;&#x5F39;&#x62E6;&#x622A;]</h5><p>&#x62E6;&#x622A;&#x7CFB;&#x7EDF;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#xFF1A;&#x867D;&#x7136;&#x5B83;&#x7684;&#x7B2C;&#x4E00;&#x53D1;&#x70AE;&#x5F39;&#x80FD;&#x591F;&#x5230;&#x8FBE;&#x4EFB;&#x610F;&#x7684;&#x9AD8;&#x5EA6;&#x3001;&#x5E76;&#x4E14;&#x80FD;&#x591F;&#x62E6;&#x622A;&#x4EFB;&#x610F;&#x901F;&#x5EA6;&#x7684;&#x5BFC;&#x5F39;&#xFF0C;&#x4F46;&#x662F;&#x4EE5;&#x540E;&#x6BCF;&#x4E00;&#x53D1;&#x70AE;&#x5F39;&#x90FD;&#x4E0D;&#x80FD;&#x9AD8;&#x4E8E;&#x524D;&#x4E00;&#x53D1;&#x7684;&#x9AD8;&#x5EA6;&#xFF0C;&#x5176;&#x62E6;&#x622A;&#x7684;&#x5BFC;&#x5F39;&#x7684;&#x98DE;&#x884C;&#x901F;&#x5EA6;&#x4E5F;&#x4E0D;&#x80FD;&#x5927;&#x4E8E;&#x524D;&#x4E00;&#x53D1;&#x3002;&#x7ED9;&#x51FA;$n\leq 5*10^4$&#x679A;&#x5BFC;&#x5F39;&#x7684;&#x9AD8;&#x5EA6;&#x548C;&#x901F;&#x5EA6;&#xFF0C;&#x6C42;&#x6BCF;&#x679A;&#x5BFC;&#x5F39;&#x88AB;&#x62E6;&#x622A;&#x5230;&#x7684;&#x6982;&#x7387;&#x3002;</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6C42;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x4E09;&#x7EF4;LIS&#x4E0A;&#x7ED3;&#x70B9;&#x7684;&#x6982;&#x7387;&#x3002;&#x65B9;&#x6848;&#x6570;&#x53EF;&#x80FD;&#x5F88;&#x5927;&#xFF0C;&#x9700;&#x8981;&#x7528;double&#x5B58;&#x3002;&#x6B63;&#x53CD;&#x641E;&#x4E24;&#x6B21;cdq&#x5206;&#x522B;&#x6C42;&#x51FA;&#x4EE5;&#x7B2C;$i$&#x4E2A;&#x5143;&#x7D20;&#x7ED3;&#x5C3E;&#x524D;&#x534A;&#x90E8;&#x5206;&#x7684;LIS&#x548C;&#x4EE5;&#x7B2C;$i$&#x4E2A;&#x5143;&#x7D20;&#x8D77;&#x59CB;&#x540E;&#x534A;&#x90E8;&#x5206;&#x7684;LIS&#xFF0C;&#x5229;&#x7528;BIT&#x66F4;&#x65B0;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x548C;&#x65B9;&#x6848;&#x6570;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">50010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Max, m;</span><br><span class="line"><span class="keyword">int</span> Y[MAX_N], Z[MAX_N], sta[MAX_N];</span><br><span class="line"><span class="keyword">double</span> way[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> {</span></span><br><span class="line">	<span class="keyword">int</span> x, y, z, id;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">if</span> (y != rhs.y) <span class="keyword">return</span> y &lt; rhs.y;</span><br><span class="line">		<span class="keyword">if</span> (z != rhs.z) <span class="keyword">return</span> z &lt; rhs.z;</span><br><span class="line">		<span class="keyword">return</span> x &lt; rhs.x;</span><br><span class="line">	}</span><br><span class="line">} P[MAX_N], Q[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ans</span> {</span></span><br><span class="line">	<span class="keyword">int</span> dp[<span class="number">2</span>]; <span class="comment">// dp[0]: &#x4EE5; i &#x7ED3;&#x5C3E;&#x524D;&#x534A;&#x90E8;&#x5206;&#x7684; LIS</span></span><br><span class="line">	<span class="comment">// dp[1]: &#x4EE5; i &#x8D77;&#x59CB;&#x540E;&#x534A;&#x90E8;&#x5206;&#x7684; LIS</span></span><br><span class="line">	<span class="keyword">double</span> way[<span class="number">2</span>]; <span class="comment">// way[]: &#x5206;&#x522B;&#x662F;&#x65B9;&#x6848;&#x6570;</span></span><br><span class="line">} ans[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Bit</span> {</span></span><br><span class="line">	<span class="keyword">int</span> len;</span><br><span class="line">	<span class="keyword">double</span> sum;</span><br><span class="line"></span><br><span class="line">	Bit() {}</span><br><span class="line">	Bit(<span class="keyword">int</span> _len, <span class="keyword">double</span> _sum): len(_len), sum(_sum) {}</span><br><span class="line">} bit[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; -x; }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> len, <span class="keyword">double</span> sum)</span> </span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= Max; i += lowbit(i)) {</span><br><span class="line">		<span class="keyword">if</span> (len &gt; bit[i].len) {</span><br><span class="line">			<span class="keyword">if</span> (bit[i].len == <span class="number">0</span>) sta[m++] = i;</span><br><span class="line">			bit[i] = Bit(len, sum);</span><br><span class="line">		} <span class="keyword">else</span> <span class="keyword">if</span> (len == bit[i].len) bit[i].sum += sum;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">Bit <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">	Bit ret = Bit(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">		<span class="keyword">if</span> (bit[i].len &gt; ret.len) ret = Bit(bit[i].len, bit[i].sum);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (bit[i].len == ret.len) ret.sum += bit[i].sum;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Clear</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= Max; i += lowbit(i)) {</span><br><span class="line">		bit[i] = Bit(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> cur)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (P[i].x &lt;= mid) Q[tp1++] = P[i];</span><br><span class="line">		<span class="keyword">else</span> Q[tp2++] = P[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(P + left, Q + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Point));</span><br><span class="line">	cdq(left, mid, cur);</span><br><span class="line">	tp1 = left;</span><br><span class="line">	m = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (tp1 &lt;= mid &amp;&amp; Q[tp1].y &lt;= Q[i].y) {</span><br><span class="line">			update(Q[tp1].z, ans[Q[tp1].id].dp[cur], ans[Q[tp1].id].way[cur]);</span><br><span class="line">			tp1++;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">int</span> pos = Q[i].id;</span><br><span class="line">		Bit tmp = query(Q[i].z);</span><br><span class="line">		<span class="keyword">if</span> (tmp.len + <span class="number">1</span> &gt; ans[pos].dp[cur]) {</span><br><span class="line">			ans[pos].dp[cur] = tmp.len + <span class="number">1</span>;</span><br><span class="line">			ans[pos].way[cur] = tmp.sum;</span><br><span class="line">		} <span class="keyword">else</span> <span class="keyword">if</span> (tmp.len + <span class="number">1</span> == ans[pos].dp[cur]) {</span><br><span class="line">			ans[pos].way[cur] += tmp.sum;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = tp1 - <span class="number">1</span>; i &gt;= left; --i) {</span><br><span class="line">		Clear(Q[i].z);</span><br><span class="line">	}</span><br><span class="line">	cdq(mid + <span class="number">1</span>, right, cur);</span><br><span class="line">	</span><br><span class="line">	tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (tp1 &lt;= mid &amp;&amp; (tp2 &gt; right ||</span><br><span class="line">			P[tp1] &lt; P[tp2])) Q[i] = P[tp1++];</span><br><span class="line">	   	<span class="keyword">else</span> Q[i] = P[tp2++];	</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(P + left, Q + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Point));</span><br><span class="line">	</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">	sort(Z, Z + n); sort(Y, Y + n);</span><br><span class="line">	Max = unique(Z, Z + n) - Z;</span><br><span class="line">	<span class="keyword">int</span> tot = unique(Y, Y + n) - Y;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		P[i].y = lower_bound(Y, Y + tot, P[i].y) - Y;</span><br><span class="line">		P[i].z = lower_bound(Z, Z + Max, P[i].z) - Z;</span><br><span class="line">		P[i].y = tot - P[i].y, P[i].z = Max - P[i].z;</span><br><span class="line">	}</span><br><span class="line">	sort(P + <span class="number">1</span>, P + n + <span class="number">1</span>); <span class="comment">// yzx</span></span><br><span class="line">	cdq(<span class="number">1</span>, n, <span class="number">0</span>); </span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		P[i].x = n - P[i].x + <span class="number">1</span>;</span><br><span class="line">		P[i].y = tot - P[i].y + <span class="number">1</span>;</span><br><span class="line">		P[i].z = Max - P[i].z + <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">	sort(P + <span class="number">1</span>, P + n + <span class="number">1</span>); <span class="comment">// yzx</span></span><br><span class="line">	cdq(<span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (len &lt; ans[i].dp[<span class="number">0</span>]) {</span><br><span class="line">			len = ans[i].dp[<span class="number">0</span>];</span><br><span class="line">			sum = ans[i].way[<span class="number">0</span>];</span><br><span class="line">		} <span class="keyword">else</span> <span class="keyword">if</span> (len == ans[i].dp[<span class="number">0</span>]) {</span><br><span class="line">			sum += ans[i].way[<span class="number">0</span>];</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, len);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (i &gt; <span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">		<span class="keyword">int</span> tmp = ans[i].dp[<span class="number">0</span>] + ans[i].dp[<span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (tmp &lt; len) <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%.5lf&quot;</span>, ans[i].way[<span class="number">0</span>] * ans[i].way[<span class="number">1</span>] / sum);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;P[i].y, &amp;P[i].z);</span><br><span class="line">		P[i].x = P[i].id = i;</span><br><span class="line">		Y[i - <span class="number">1</span>] = P[i].y, Z[i - <span class="number">1</span>] = P[i].z;</span><br><span class="line">		ans[i].dp[<span class="number">0</span>] = ans[i].dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">		ans[i].way[<span class="number">0</span>] = ans[i].way[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">	solve();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="bzoj-1176-mokia"><a href="#BZOJ-1176-Mokia" class="headerlink" title="[BZOJ 1176 Mokia]"></a>[BZOJ 1176 Mokia]</h5><p>&#x4E00;&#x4E2A;$W*W$&#x7684;&#x68CB;&#x76D8;&#xFF0C;&#x6BCF;&#x4E2A;&#x683C;&#x5B50;&#x5185;&#x6709;&#x4E00;&#x4E2A;&#x6570;&#xFF0C;&#x521D;&#x59CB;&#x65F6;&#x5168;&#x90E8;&#x4E3A;0&#xFF0C;&#x73B0;&#x5728;&#x8981;&#x6C42;&#x7EF4;&#x62A4;&#x4E24;&#x79CD;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li>$1\quad x\quad y\quad z$&#x5C06;&#x683C;&#x5B50;$(x,y)$&#x5185;&#x7684;&#x6570;&#x52A0;&#x4E0A;$z$</li>
<li>$2\quad x_1\quad y_1\quad x_2\quad y_2$&#x8BE2;&#x95EE;&#x77E9;&#x9635;$(x_1,y_1,x_2,y_2)$&#x5185;&#x6240;&#x6709;&#x683C;&#x5B50;&#x7684;&#x6570;&#x7684;&#x548C;&#x3002;</li>
</ul>
<p>&#x64CD;&#x4F5C;1$\leq 160000$&#xFF0C;&#x64CD;&#x4F5C;2$\leq 10000$&#xFF0C;$1\leq W\leq 2*10^6$&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x8BE2;&#x95EE;&#x77E9;&#x9635;$(x_1,y_1,x_2,y_2)$&#xFF0C;&#x6839;&#x636E;&#x5BB9;&#x65A5;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x4E09;&#x4E2A;&#x8BE2;&#x95EE;$(x_1-1,y_1-1),(x_2,y_1-1),(x_1-1,y_2)$&#xFF0C;&#x548C;&#x6BCF;&#x4E2A;&#x8BE2;&#x95EE;&#x7684;&#x7B26;&#x53F7;$flag$,&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;&#x8BE2;&#x95EE;&#xFF0C;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x65F6;&#x5C06;&#x7B54;&#x6848;&#x8FDE;&#x540C;&#x7B26;&#x53F7;&#x7D2F;&#x52A0;&#x5230;&#x6240;&#x5C5E;&#x8BE2;&#x95EE;&#x91CC;&#x3002;</p>
<p>&#x79BB;&#x6563;&#x5316;&#x540E;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E09;&#x7EF4;&#x504F;&#x5E8F;&#xFF1A;$x_0&lt;x_1,y_0&lt;y_1,id_0&lt;id_1$&#xFF0C;&#x9700;&#x8981;&#x628A;&#x6240;&#x6709;$&lt;id$&#x7684;&#x503C;&#x90FD;&#x52A0;&#x8FDB;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#xFF0C;&#x7B2C;&#x4E00;&#x7EF4;&#x6309;&#x7167;&#x4F18;&#x5148;$x$&#x5176;&#x6B21;$y$&#x6392;&#x5E8F;&#xFF0C;&#x7B2C;&#x4E8C;&#x7EF4;&#x6839;&#x636E;$id$&#x8FDB;&#x884C;$cdq$&#x5206;&#x6CBB;&#xFF0C;&#x7B2C;&#x4E09;&#x7EF4;&#x6309;&#x7167;$y$&#x63D2;&#x5165;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#x5E76;&#x7EDF;&#x8BA1;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">200100</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">int</span> S, W, n = <span class="number">0</span>, Max;</span><br><span class="line"><span class="keyword">int</span> X[MAX_N], Y[MAX_N];</span><br><span class="line">ll bit[MAX_N];</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> {</span></span><br><span class="line">    <span class="keyword">int</span> x, y, flag, value;</span><br><span class="line">    <span class="keyword">int</span> id, be;</span><br><span class="line">    ll ans;</span><br><span class="line"> </span><br><span class="line">    Query() {}</span><br><span class="line">    Query(<span class="keyword">int</span> _x, <span class="keyword">int</span> _y, <span class="keyword">int</span> _flag, <span class="keyword">int</span> _id, <span class="keyword">int</span> _be, ll _ans): </span><br><span class="line">        x(_x), y(_y), flag(_flag), id(_id), be(_be), ans(_ans) {}</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Query&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">if</span> (x != rhs.x) <span class="keyword">return</span> x &lt; rhs.x;</span><br><span class="line">        <span class="keyword">if</span> (y != rhs.y) <span class="keyword">return</span> y &lt; rhs.y;</span><br><span class="line">        <span class="keyword">return</span> id &lt; rhs.id;</span><br><span class="line">    }</span><br><span class="line">} ques[MAX_N], newq[MAX_N];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; -x; }</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= Max; i += lowbit(i)) {</span><br><span class="line">        bit[i] += value;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">    ll ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">        ret += bit[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (ques[i].id &lt;= mid) newq[tp1++] = ques[i];</span><br><span class="line">        <span class="keyword">else</span> newq[tp2++] = ques[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">memcpy</span>(ques + left, newq + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">    cdq(left, mid);</span><br><span class="line">    tp1 = left;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>; i &lt;= right; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (ques[i].flag != <span class="number">0</span>) { <span class="comment">// not change operation</span></span><br><span class="line">            <span class="keyword">while</span> (tp1 &lt;= mid &amp;&amp; ques[tp1].x &lt;= ques[i].x){</span><br><span class="line">                <span class="keyword">if</span> (ques[tp1].flag == <span class="number">0</span>) { <span class="comment">// change operation</span></span><br><span class="line">                    update(ques[tp1].y, ques[tp1].value);</span><br><span class="line">                }</span><br><span class="line">                tp1++;</span><br><span class="line">            }   </span><br><span class="line">        }</span><br><span class="line">        ques[i].ans += query(ques[i].y);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = tp1 - <span class="number">1</span>; i &gt;= left; --i) {</span><br><span class="line">        <span class="keyword">if</span> (ques[i].flag ==<span class="number">0</span>) {</span><br><span class="line">            update(ques[i].y, -ques[i].value);</span><br><span class="line">        }</span><br><span class="line">    }   </span><br><span class="line">    cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">    tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (tp1 &lt;= mid &amp;&amp; (tp2 &gt; right ||</span><br><span class="line">            ques[tp1] &lt; ques[tp2]))</span><br><span class="line">            newq[i] = ques[tp1++];</span><br><span class="line">        <span class="keyword">else</span> newq[i] = ques[tp2++];</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">memcpy</span>(ques + left, newq + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> Query&amp; a, <span class="keyword">const</span> Query&amp; b)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> a.id &lt; b.id;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;S, &amp;W); <span class="comment">// S &#x65E0;&#x5173;&#x7D27;&#x8981;</span></span><br><span class="line">    <span class="keyword">int</span> tot1 = <span class="number">0</span>, tot2 = <span class="number">0</span>, type;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;type);</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="number">3</span>) <span class="keyword">break</span>;</span><br><span class="line">        ++n;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="number">1</span>) {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;ques[n].x, &amp;ques[n].y, &amp;ques[n].value);</span><br><span class="line">            ques[n].flag = <span class="number">0</span>, ques[n].id = n;</span><br><span class="line">            X[tot1++] = ques[n].x, Y[tot2++] = ques[n].y;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">int</span> x1, y1, x2, y2;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2);</span><br><span class="line">            ques[n] = Query(x1 - <span class="number">1</span>, y1 - <span class="number">1</span>, <span class="number">1</span>, n, n + <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">            ques[n + <span class="number">1</span>] = Query(x2, y1 - <span class="number">1</span>, <span class="number">-1</span>, n + <span class="number">1</span>, n + <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">            ques[n + <span class="number">2</span>] = Query(x1 - <span class="number">1</span>, y2, <span class="number">-1</span>, n + <span class="number">2</span>, n + <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">            ques[n + <span class="number">3</span>] = Query(x2, y2, <span class="number">2</span>, n + <span class="number">3</span>, n + <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">            n += <span class="number">3</span>;</span><br><span class="line">            X[tot1++] = x2, X[tot1++] = x1 - <span class="number">1</span>;</span><br><span class="line">            Y[tot2++] = y2, Y[tot2++] = y1 - <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    sort(X, X + tot1); sort(Y, Y + tot2);</span><br><span class="line">    tot1 = unique(X, X + tot1) - X;</span><br><span class="line">    tot2 = unique(Y, Y + tot2) - Y;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">        ques[i].x = lower_bound(X, X + tot1, ques[i].x) - X + <span class="number">1</span>;</span><br><span class="line">        ques[i].y = lower_bound(Y, Y + tot2, ques[i].y) - Y + <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    sort(ques + <span class="number">1</span>, ques + n + <span class="number">1</span>);</span><br><span class="line">    Max = tot2;</span><br><span class="line">    cdq(<span class="number">1</span>, n);</span><br><span class="line">    sort(ques + <span class="number">1</span>, ques + n + <span class="number">1</span>, cmp);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (ques[i].flag == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (ques[i].flag == <span class="number">2</span>) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ques[i].ans);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">int</span> be = ques[i].be;</span><br><span class="line">            ques[be].ans += ques[i].ans * ques[i].flag;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="bzoj-1429-&#x8D27;&#x5E01;&#x5151;&#x6362;cash"><a href="#BZOJ-1429-&#x8D27;&#x5E01;&#x5151;&#x6362;Cash" class="headerlink" title="[BZOJ 1429 &#x8D27;&#x5E01;&#x5151;&#x6362;Cash]"></a>[BZOJ 1429 &#x8D27;&#x5E01;&#x5151;&#x6362;Cash]</h5><p>&#x7ED9;&#x51FA;$n\leq 100000$&#x5929;&#x6BCF;&#x5929;A&#x548C;B&#x4E24;&#x4E2A;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;$a_i$&#x548C;$b_i$&#xFF08;&#x4E70;&#x5165;&#x548C;&#x5356;&#x51FA;&#x4EF7;&#x683C;&#xFF09;&#xFF0C;&#x8D2D;&#x4E70;&#x65F6;A&#x548C;B&#x4E24;&#x4E2A;&#x80A1;&#x7968;&#x7684;&#x8D2D;&#x4E70;&#x6BD4;&#x4F8B;$rate$&#xFF0C;&#x521D;&#x59CB;&#x65F6;&#x6709;$S$&#x5143;&#xFF0C;&#x6C42;$n$&#x5929;&#x540E;&#x7684;&#x6700;&#x5927;&#x83B7;&#x5229;&#x91CF;&#xFF1F;</p>
<p>&#x7528;$dp[i]$&#x8868;&#x793A;&#x7B2C;$i$&#x5929;&#x53EF;&#x4EE5;&#x7684;&#x6700;&#x5927;&#x83B7;&#x5229;&#x91CF;&#xFF0C;$x_i,y_i$&#x5206;&#x522B;&#x8868;&#x793A;&#x7528;&#x5F53;&#x5929;&#x7684;&#x6700;&#x5927;&#x83B7;&#x5229;&#x91CF;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;A&#x548C;B&#x4E24;&#x4E2A;&#x80A1;&#x7968;&#x7684;&#x6570;&#x91CF;&#x3002;<br>$$<br>\begin{aligned}<br>dp[i] &amp;=x_i*a_i+y_i*b_i \\<br>\frac{x_i}{y_i} &amp;=rate_i<br>\end{aligned}<br>$$<br>&#x53EF;&#x4EE5;&#x89E3;&#x51FA;&#x5BF9;&#x5E94;&#x7684;$x_i$&#x548C;$y_i$&#x3002;&#x8003;&#x8651;$dp$&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=max(x_j*a_i+y_j*b_i)\quad (j &lt; i)<br>$$<br>&#x8F6C;&#x5316;&#x6210;&#x659C;&#x7387;&#xFF0C;$k$&#x51B3;&#x7B56;&#x4F18;&#x4E8E;$j$&#x51B3;&#x7B56;&#xFF0C;&#x4E0D;&#x59A8;&#x8BBE;$x_k &lt; x_j$&#x6709;&#xFF1A;<br>$$<br>x_k*a_i+y_k*b_i &gt; x_j*a_i+y_j*b_i\quad (x_k &gt; x_j)\\<br>k_i=-\frac{a_i}{b_i} &gt; \frac{y_k-y_j}{x_k-x_j}<br>$$<br>&#x56E0;&#x6B64;&#x9700;&#x8981;&#x4EE5;$x_k$&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x51F8;&#x7EBF;&#xFF0C;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x70B9;&#x96C6;$(x_k,y_k)$&#xFF0C;$x_k$&#x662F;&#x5355;&#x8C03;&#x9012;&#x589E;&#x7684;&#xFF0C;&#x76F8;&#x90BB;&#x4E24;&#x70B9;&#x7684;&#x659C;&#x7387;&#x662F;&#x5355;&#x8C03;&#x9012;&#x51CF;&#x7684;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x4E0A;&#x51F8;&#x58F3;&#x3002;&#x7528;&#x5DE6;&#x534A;&#x533A;&#x95F4;&#x5DF2;&#x7ECF;&#x66F4;&#x65B0;&#x597D;&#x7684;$dp$&#x503C;&#x6C42;&#x51FA;&#x4E0A;&#x51F8;&#x58F3;&#x70B9;&#x96C6;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x53F3;&#x534A;&#x533A;&#x7684;&#x659C;&#x7387;&#x53BB;&#x5207;&#x5DE6;&#x534A;&#x533A;&#x7684;&#x70B9;&#x96C6;&#x66F4;&#x65B0;$dp$&#x503C;&#x3002;&#x5DE6;&#x534A;&#x533A;&#x95F4;&#x53EA;&#x9700;&#x8981;&#x70B9;&#x96C6;$(x,y)$&#xFF0C;&#x53F3;&#x534A;&#x533A;&#x95F4;&#x53EA;&#x9700;&#x8981;&#x659C;&#x7387;$k_i=-\frac{a_i}{b_i}$&#x3002;&#x5904;&#x7406;&#x597D;&#x5DE6;&#x534A;&#x8FB9;&#x65F6;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x70B9;&#x96C6;&#x6309;&#x7167;&#x5750;&#x6807;&#x6392;&#x597D;&#x5E8F;&#xFF0C;&#x5904;&#x7406;&#x53F3;&#x534A;&#x8FB9;&#x65F6;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x8BE2;&#x95EE;&#x6309;&#x7167;&#x659C;&#x7387;&#x6392;&#x597D;&#x5E8F;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x7528;&#x4E00;&#x7CFB;&#x5217;&#x8FDE;&#x7EED;&#x53D8;&#x5316;&#x7684;&#x76F4;&#x7EBF;&#x53BB;&#x5207;&#x4E00;&#x4E9B;&#x8FDE;&#x7EED;&#x70B9;&#x7EC4;&#x6210;&#x7684;&#x51F8;&#x58F3;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100100</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-9</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> inf = <span class="number">1e18</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, S;</span><br><span class="line"><span class="keyword">int</span> sta[MAX_N];</span><br><span class="line"><span class="keyword">double</span> ans[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> {</span></span><br><span class="line">	<span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">double</span> a, b, rate, k;</span><br><span class="line">	<span class="keyword">double</span> x, y;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// &#x6309;&#x7167;&#x659C;&#x7387; k &#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x6392;&#x5E8F;</span></span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Query&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> k &gt; rhs.k;</span><br><span class="line">	}</span><br><span class="line">} Q[MAX_N], P[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (j == <span class="number">0</span>) <span class="keyword">return</span> -inf;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(P[i].x - P[j].x) &lt;= eps) <span class="keyword">return</span> inf;</span><br><span class="line">	<span class="keyword">return</span> (P[i].y - P[j].y) / (P[i].x - P[j].x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (left == right) {</span><br><span class="line">		ans[left] = max(ans[left], ans[left - <span class="number">1</span>]);</span><br><span class="line">		P[left].x = ans[left] * P[left].rate / (P[left].a * P[left].rate + P[left].b);</span><br><span class="line">		P[left].y = P[left].x / P[left].rate;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// &#x6309;&#x7167; id &#x5212;&#x5206;&#x533A;&#x95F4;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (P[i].id &lt;= mid) Q[tp1++] = P[i];</span><br><span class="line">		<span class="keyword">else</span> Q[tp2++] = P[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(P + left, Q + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">	<span class="keyword">int</span> top = <span class="number">0</span>;</span><br><span class="line">	cdq(left, mid); <span class="comment">// &#x9012;&#x5F52;&#x5904;&#x7406;&#x5DE6;&#x533A;&#x95F4;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// &#x4ECE;&#x5DE6;&#x533A;&#x95F4;&#x83B7;&#x5F97;&#x4E0A;&#x51F8;&#x58F3;,&#x6B64;&#x65F6;&#x5DF2;&#x7ECF;&#x4FDD;&#x8BC1;&#x5DE6;&#x533A;&#x95F4;&#x70B9;&#x96C6;&#x6309;&#x7167;&#x5750;&#x6807;&#x6392;&#x597D;&#x5E8F;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= mid; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (top  &gt; <span class="number">1</span> &amp;&amp; slope(sta[top], sta[top - <span class="number">1</span>]) &lt;= slope(i, sta[top - <span class="number">1</span>]) + eps) --top;</span><br><span class="line">		sta[++top] = i;</span><br><span class="line">	}</span><br><span class="line">	sta[++top] = <span class="number">0</span>; <span class="comment">// &#x6DFB;&#x52A0;&#x8FB9;&#x754C;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// &#x7528;&#x5DE6;&#x533A;&#x95F4;&#x7684;&#x51F8;&#x58F3;&#x66F4;&#x65B0;&#x53F3;&#x533A;&#x95F4;&#xFF0C;&#x53F3;&#x533A;&#x95F4;&#x4FDD;&#x8BC1;&#x659C;&#x7387;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x6392;&#x5E8F;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>, st = <span class="number">1</span>; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (st &lt; top &amp;&amp; P[i].k - slope(sta[st], sta[st + <span class="number">1</span>]) &lt;= eps) ++st;</span><br><span class="line">		<span class="keyword">int</span> id =  P[i].id;</span><br><span class="line">		ans[id] = max(ans[id], P[sta[st]].x * P[i].a + P[sta[st]].y * P[i].b);</span><br><span class="line">	}</span><br><span class="line">	cdq(mid + <span class="number">1</span>, right);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// &#x628A;&#x5F53;&#x524D;&#x533A;&#x95F4; [left, right] &#x70B9;&#x96C6;&#x6309;&#x5750;&#x6807;&#x6392;&#x5E8F;</span></span><br><span class="line">	tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (tp1 &lt;= mid &amp;&amp; (tp2 &gt; right </span><br><span class="line">			|| P[tp1].x &lt; P[tp2].x </span><br><span class="line">			|| (<span class="built_in">fabs</span>(P[tp1].x - P[tp2].x) &lt;= eps &amp;&amp; P[tp1].y &lt; P[tp2].y))) Q[i] = P[tp1++];</span><br><span class="line">		<span class="keyword">else</span> Q[i] = P[tp2++];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(P + left, Q + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Query));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;S);</span><br><span class="line">	ans[<span class="number">0</span>] = S;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>, &amp;P[i].a, &amp;P[i].b, &amp;P[i].rate);</span><br><span class="line">		P[i].k = -P[i].a / P[i].b, P[i].id = i;</span><br><span class="line">		ans[i] = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	sort(P + <span class="number">1</span>, P + n + <span class="number">1</span>);</span><br><span class="line">	cdq(<span class="number">1</span>, n);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.3lf\n&quot;</span>, ans[n]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="bzoj-2961-&#x5171;&#x70B9;&#x5706;"><a href="#BZOJ-2961-&#x5171;&#x70B9;&#x5706;" class="headerlink" title="[BZOJ 2961 &#x5171;&#x70B9;&#x5706;]"></a>[BZOJ 2961 &#x5171;&#x70B9;&#x5706;]</h5><p>&#x6709;$n\leq 5*10^5$&#x6B21;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li>$0\quad x\quad y\quad$&#x8868;&#x793A;&#x5728;&#x5750;&#x6807;&#x7CFB;&#x4E2D;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x4EE5;$(x, y)$&#x4E3A;&#x5706;&#x5FC3;&#x4E14;&#x8FC7;&#x539F;&#x70B9;&#x7684;&#x5706;</li>
<li>$1\quad x\quad y\quad$&#x8868;&#x793A;&#x8BE2;&#x95EE;&#x70B9;$(x,y)$&#x662F;&#x5426;&#x5728;&#x6240;&#x6709;&#x5DF2;&#x52A0;&#x5165;&#x7684;&#x5706;&#x7684;&#x5185;&#x90E8;&#xFF08;&#x542B;&#x5706;&#x5468;&#xFF09;</li>
</ul>
<p>&#x5BF9;&#x4E8E;&#x6BCF;&#x6B21;&#x8BE2;&#x95EE;&#x8F93;&#x51FA;$Yes$&#x6216;&#x8005;$No$&#xFF0C;&#x8F93;&#x5165;&#x4FDD;&#x8BC1;&#x5706;&#x5FC3;&#x4E25;&#x683C;&#x5728;x&#x8F74;&#x4E0A;&#x65B9;&#xFF08;&#x7EB5;&#x5750;&#x6807;&#x4E3A;&#x6B63;&#xFF09;&#xFF0C;&#x4E14;&#x6A2A;&#x5750;&#x6807;&#x975E;&#x96F6;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x70B9;$(x_0,y_0)$&#x5904;&#x4E8E;&#x5706;&#x5FC3;$(x,y)$&#x4E14;&#x8FC7;&#x539F;&#x70B9;&#x7684;&#x5706;&#x5185;&#x90E8;&#x7B49;&#x4EF7;&#x4E8E;<br>$$<br>(x_0-x)^2+(y_0-y)^2\leq x^2+y^2 \\<br>2x_0x+2y_{0}y\geq x_{0}^2+y_{0}^2<br>$$<br>&#x4E5F;&#x5C31;&#x662F;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x5706;&#x5FC3;&#x5FC5;&#x987B;&#x4F4D;&#x4E8E;&#x534A;&#x5E73;&#x9762;$2x_0x+2y_0y\geq x_{0}^2+y_{0}^2$&#x5185;&#x90E8;&#x3002;&#x5F53;$y_{0}&gt;0$&#x65F6;&#xFF0C;&#x53EF;&#x5F97;$y\geq -\frac{x_0}{y_0}*x+\frac{x_{0}^2+y_{0}^2}{y_0}$&#x3002;&#x4E0D;&#x59A8;&#x8003;&#x8651;&#x6C42;&#x51FA;&#x5728;&#x4E0E;&#x534A;&#x5E73;&#x9762;&#x5782;&#x76F4;&#x7684;&#x65B9;&#x5411;&#x4E0A;&#x7684;&#x6295;&#x5F71;&#x6700;&#x5C0F;&#x7684;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x70B9;&#x4E5F;&#x5728;&#x534A;&#x5E73;&#x9762;&#x5185;&#x90A3;&#x4E48;&#x5FC5;&#x7136;&#x6240;&#x6709;&#x7684;&#x70B9;&#x90FD;&#x5728;&#x534A;&#x5E73;&#x9762;&#x5185;&#xFF0C;&#x53EA;&#x6709;&#x51F8;&#x5305;&#x4E0A;&#x7684;&#x70B9;&#x624D;&#x4F1A;&#x662F;&#x60F3;&#x8981;&#x6C42;&#x7684;&#x70B9;&#x3002;&#x56E0;&#x6B64;&#x5F53;$y_0&gt;0$&#x65F6;&#xFF0C;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x5706;&#x5FC3;&#x6C42;&#x4E00;&#x4E2A;&#x4E0B;&#x51F8;&#x5305;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x67E5;&#x8BE2;&#x70B9;&#x627E;&#x5230;&#x5728;&#x8FD9;&#x4E2A;&#x4E0B;&#x51F8;&#x5305;&#x4E0A;&#x9762;&#x659C;&#x7387;&#x6700;&#x63A5;&#x8FD1;$-\frac{x_0}{y_0}$&#x7684;&#x5706;&#xFF0C;&#x53EA;&#x8981;&#x8FD9;&#x4E2A;&#x5706;&#x5FC3;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x5219;&#x6240;&#x6709;&#x7684;&#x5706;&#x5FC3;&#x90FD;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x3002;&#x5F53;$y_0 &lt; 0$&#x65F6;&#x9700;&#x8981;&#x7EF4;&#x62A4;&#x4E0A;&#x51F8;&#x5305;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">500010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> inf = <span class="number">1e20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> {</span></span><br><span class="line">	<span class="keyword">int</span> type, id, flag;</span><br><span class="line">	<span class="keyword">double</span> x, y, k;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%lf%lf&quot;</span>, &amp;type, &amp;x, &amp;y);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> k &lt; rhs.k;</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">dis</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> hypot(x - rhs.x, y - rhs.y);</span><br><span class="line">	}</span><br><span class="line">} P[MAX_N], Q[MAX_N], below[MAX_N], above[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">slope</span><span class="params">(Point a, Point b)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(a.x - b.x) &lt; eps) <span class="keyword">return</span> inf;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> (a.y - b.y) / (a.x - b.x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (P[i].id &lt;= mid) Q[tp1++] = P[i];</span><br><span class="line">		<span class="keyword">else</span> Q[tp2++] = P[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(P + left, Q + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Point));</span><br><span class="line">	cdq(left, mid);</span><br><span class="line">	<span class="keyword">int</span> tot1 = <span class="number">0</span>, tot2 = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= mid; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (P[i].type) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">while</span> (tot1 &gt; <span class="number">1</span> &amp;&amp; slope(above[tot1], above[tot1 - <span class="number">1</span>]) &lt; slope(P[i], above[tot1])) tot1--;</span><br><span class="line">		above[++tot1] = P[i];</span><br><span class="line">		<span class="keyword">while</span> (tot2 &gt; <span class="number">1</span> &amp;&amp; slope(below[tot2], below[tot2 - <span class="number">1</span>]) &gt;slope(P[i], below[tot2])) tot2--;</span><br><span class="line">		below[++tot2] = P[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> st1 = tot1, st2 = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (!P[i].type) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span> (P[i].y &gt; <span class="number">0</span>) {</span><br><span class="line">			<span class="keyword">while</span> (st2 &lt; tot2 &amp;&amp; slope(below[st2], below[st2 + <span class="number">1</span>]) &lt; P[i].k) ++st2;</span><br><span class="line">			<span class="keyword">if</span> (st2 &lt;= tot2 &amp;&amp; below[st2].dis(P[<span class="number">0</span>]) &lt; below[st2].dis(P[i])) P[i].flag = <span class="number">0</span>;</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="keyword">while</span> (st1 &gt; <span class="number">1</span> &amp;&amp; slope(above[st1], above[st1 - <span class="number">1</span>]) &lt; P[i].k) --st1;</span><br><span class="line">			<span class="keyword">if</span> (st1 &gt;= <span class="number">1</span> &amp;&amp; above[st1].dis(P[<span class="number">0</span>]) &lt; above[st1].dis(P[i])) P[i].flag = <span class="number">0</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">	tp1 = left, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (tp1 &lt;= mid &amp;&amp; (tp2 &gt; right </span><br><span class="line">			|| P[tp1].x &lt; P[tp2].x</span><br><span class="line">			|| (<span class="built_in">fabs</span>(P[tp1].x - P[tp2].x) &lt;= eps &amp;&amp; P[tp1].y &lt; P[tp2].y)))</span><br><span class="line">			Q[i] = P[tp1++]; </span><br><span class="line">		<span class="keyword">else</span> Q[i] = P[tp2++];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(P + left, Q + left, (right - left + <span class="number">1</span>) * <span class="keyword">sizeof</span> (Point));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(Point a, Point b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> a.id &lt; b.id;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	P[<span class="number">0</span>].x = <span class="number">0</span>, P[<span class="number">0</span>].y = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		P[i].input();</span><br><span class="line">		P[i].k = -P[i].x / P[i].y;</span><br><span class="line">		P[i].id = i, P[i].flag = <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">	sort(P + <span class="number">1</span>, P + n + <span class="number">1</span>);</span><br><span class="line">	cdq(<span class="number">1</span>, n);</span><br><span class="line">	sort(P + <span class="number">1</span>, P + n + <span class="number">1</span>, cmp);</span><br><span class="line">	<span class="keyword">int</span> first = <span class="number">1</span>; <span class="comment">// &#x7279;&#x6B8A;&#x5904;&#x7406;&#x8BE2;&#x95EE;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x5706;&#x7684;&#x60C5;&#x51B5;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (P[i].type) {</span><br><span class="line">			<span class="keyword">if</span> (P[i].flag &amp;&amp; !first) <span class="built_in">printf</span>(<span class="string">&quot;Yes\n&quot;</span>);</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;No\n&quot;</span>);</span><br><span class="line">		} <span class="keyword">else</span> <span class="keyword">if</span> (first) first = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">Shift-And算法（bitset优化）</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x57FA;&#x4E8E;&#x4F4D;&#x5E76;&#x884C;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;&#x5982;Shift-And&#x7B97;&#x6CD5;&#x7684;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x662F;&#xFF1A;&#x5C06;&#x6A21;&#x5F0F;&#x4E32;&#x96C6;&#x5408;&#x4E0E;&#x6587;&#x672C;&#x4E32;&#x7684;&#x5339;&#x914D;&#x72B6;&#x6001;&#x7528;&#x4F4D;&#x5411;&#x91CF;&#x5B58;&#x50A8;&#xFF0C;&#x5339;&#x914D;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x7528;&#x4F4D;&#x64CD;&#x4F5C;&#x66F4;&#x65B0;&#x4F4D;&#x5411;&#x91CF;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x5B83;&#x7684;&#x4F18;&#x70B9;&#x662F;&#x6240;&#x9700;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x5C0F;&#xFF0C;&#x5339;&#x914D;&#x901F;&#x5EA6;&#x5FEB;&#xFF1B;&#x7F3A;&#x70B9;&#x662F;&#x7B97;&#x6CD5;&#x6027;&#x80FD;&#x4F1A;&#x968F;&#x6A21;&#x5F0F;&#x4E32;&#x4E2A;&#x6570;&#x7684;&#x589E;&#x591A;&#x800C;&#x4E0B;&#x964D;&#xFF0C;&#x53EA;&#x9002;&#x5408;&#x4E2D;&#x5C0F;&#x89C4;&#x6A21;&#x7684;&#x6A21;&#x5F0F;&#x4E32;&#x96C6;&#x5408;&#x3002;<br><a id="more"></a><br>Shift-And&#x7B97;&#x6CD5;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x65E2;&#x662F;&#x6A21;&#x5F0F;&#x4E32;$p$&#x7684;&#x524D;&#x7F00;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x5DF2;&#x8BFB;&#x5165;&#x6587;&#x672C;&#x7684;&#x540E;&#x7F00;&#x3002;&#x6BCF;&#x8BFB;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6587;&#x672C;&#x5B57;&#x7B26;&#xFF0C;&#x8BE5;&#x7B97;&#x6CD5;&#x91C7;&#x7528;&#x4F4D;&#x5E76;&#x884C;&#x7684;&#x65B9;&#x6CD5;&#x66F4;&#x65B0;&#x8BE5;&#x96C6;&#x5408;&#xFF0C;&#x8BE5;&#x96C6;&#x5408;&#x7528;&#x4E00;&#x4E2A;&#x4F4D;&#x63A9;&#x7801;$D=d_{m}&#x2026;d_1$&#x6765;&#x8868;&#x793A;&#x3002;$D$&#x7684;&#x7B2C;$j$&#x4F4D;&#x88AB;&#x7F6E;&#x4E3A;1&#xFF0C;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;$p_{1}&#x2026;p_{j}$&#x662F;$t_{1}&#x2026;t_{i}$&#x7684;&#x540E;&#x7F00;&#x3002;</p>
<p>Shift-And&#x7B97;&#x6CD5;&#x9996;&#x5148;&#x6784;&#x9020;&#x4E00;&#x4E2A;$m$&#x4F4D;($m$&#x662F;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x957F;&#x5EA6;)&#x7684;&#x5411;&#x91CF;&#x8868;$B[]$&#xFF0C;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x5B57;&#x7B26;&#x5728;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x51FA;&#x73B0;&#x4F4D;&#x7F6E;&#x3002;&#x5982;&#x679C;$p_j$&#x4E3A;&#x5B57;&#x7B26;$c$&#xFF0C;&#x63A9;&#x7801;$B[c]$&#x7684;&#x7B2C;$j$&#x4F4D;&#x88AB;&#x7F6E;&#x4E3A;1&#xFF0C;&#x5426;&#x5219;&#x4E3A;0&#x3002;&#x9996;&#x5148;&#x7F6E;$D=0^m$&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x65B0;&#x8BFB;&#x5165;&#x7684;&#x6587;&#x672C;&#x5B57;&#x7B26;$t_{i+1}$&#xFF0C;&#x7528;&#x5982;&#x4E0B;&#x516C;&#x5F0F;&#x5BF9;$D$&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#xFF1A;$D[i+1]=((D[i]&lt;&lt;1)|0^{m+1}1)\&amp;B[t_{i+1}]$&#x3002;&#x5728;&#x5339;&#x914D;&#x65F6;&#xFF0C;&#x9010;&#x4E2A;&#x626B;&#x63CF;&#x6587;&#x672C;&#x5B57;&#x7B26;&#x5E76;&#x66F4;&#x65B0;&#x5411;&#x91CF;$D$&#xFF0C;&#x5F53;$D[i]$&#x5411;&#x91CF;&#x7684;&#x7B2C;$m$&#x4F4D;&#x4E3A;1&#x65F6;&#xFF0C;&#x5728;&#x6587;&#x672C;&#x4F4D;&#x7F6E;$i$&#x5904;&#x5339;&#x914D;&#x6210;&#x529F;&#x3002;</p>
<p>Shift-And&#x7B97;&#x6CD5;&#x6269;&#x5C55;&#x5230;&#x591A;&#x6A21;&#x5F0F;&#x4E32;&#x65F6;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x4F4D;&#x5411;&#x91CF;$D$&#x5305;&#x88C5;&#x5230;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x5B57;&#x91CC;&#xFF0C;&#x7528;&#x4F4D;&#x5E76;&#x884C;&#x6280;&#x672F;&#x540C;&#x65F6;&#x5BF9;$r$&#x4E2A;&#x4F4D;&#x5411;&#x91CF;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x5B57;&#x548C;&#x5339;&#x914D;&#x63A9;&#x7801;&#x5206;&#x522B;&#x662F;&#x6240;&#x6709;&#x521D;&#x59CB;&#x5316;&#x5B57;&#x548C;&#x6240;&#x6709;&#x5339;&#x914D;&#x63A9;&#x7801;&#x7684;&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x8BBE;&#x673A;&#x5668;&#x5B57;&#x7684;&#x957F;&#x5EA6;&#x4E3A;$w$&#xFF0C;&#x6587;&#x672C;&#x4E32;&#x7684;&#x957F;&#x5EA6;&#x4E3A;$n$&#xFF0C;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x4E2A;&#x6570;&#x4E3A;$r$&#xFF0C;&#x6700;&#x77ED;&#x6A21;&#x5F0F;&#x4E32;&#x957F;&#x5EA6;&#x4E3A;$m$&#xFF0C;&#x90A3;&#x4E48;Shift-And&#x7B97;&#x6CD5;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;$O(n\lceil \frac{m*r}{w}\rceil)$&#x3002;&#x7531;&#x4E8E;&#x91C7;&#x7528;&#x4E86;&#x4F4D;&#x5E76;&#x884C;&#x6280;&#x672F;&#xFF0C;Shift-And&#x7B97;&#x6CD5;&#x7684;&#x5339;&#x914D;&#x901F;&#x5EA6;&#x662F;&#x5F88;&#x5FEB;&#x7684;&#x3002;&#x4F46;&#x4E00;&#x65E6;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x957F;&#x5EA6;&#x548C;&#x8D85;&#x51FA;&#x673A;&#x5668;&#x5B57;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x7B97;&#x6CD5;&#x7684;&#x6027;&#x80FD;&#x90FD;&#x4F1A;&#x53D1;&#x751F;&#x660E;&#x663E;&#x4E0B;&#x964D;&#x3002;</p>
<p>&#x4F7F;&#x7528;bitset&#x4F18;&#x5316;&#xFF0C;&#x5229;&#x7528;bitset&#x7684;&#x4F4D;&#x79FB;&#x7279;&#x6027;&#x548C;&#x6BCF;&#x4E00;&#x4F4D;01&#x8868;&#x793A;&#x5339;&#x914D;&#x72B6;&#x6001;&#x3002;&#x4F8B;&#x5982;&#x5BF9;&#x4E8E;&#x6A21;&#x5F0F;&#x4E32;&#xFF1A;$abc$&#x548C;&#x8BFB;&#x5165;&#x6587;&#x672C;&#xFF1A;$abcabcabc$&#x3002;&#x5148;&#x6839;&#x636E;&#x8BFB;&#x5165;&#x6587;&#x672C;&#x5F97;&#x5230;&#x6BCF;&#x4E2A;&#x5B57;&#x6BCD;&#x5411;&#x91CF;&#x8868;&#x793A;(&#x4ECE;&#x53F3;&#x5F80;&#x5DE6;&#x770B;&#x7B2C;$i$&#x4F4D;&#x4E3A;1&#x8868;&#x793A;&#x8BFB;&#x5165;&#x6587;&#x672C;&#x7684;&#x7B2C;$i$&#x4F4D;&#xFF08;&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;&#x770B;&#xFF09;&#x4E3A;&#x8BE5;&#x5B57;&#x6BCD;)&#xFF1A;<br>bs[a]:001001001<br>bs[b]:010010010<br>bs[c]:100100100<br>&#x7528;dp&#x8868;&#x793A;&#x5339;&#x914D;&#x72B6;&#x6001;&#xFF0C;&#x521D;&#x59CB;&#x65F6;&#xFF1A;dp=111111111&#xFF0C;&#x626B;&#x63CF;&#x6A21;&#x5F0F;&#x4E32;:$abc$&#x3002;<br>&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BCD;a&#xFF0C;(dp &lt;&lt; 1) &amp; bs[a]&#x53EF;&#x5F97;&#xFF1A;dp = (111111110 &amp; 001001001) = 001001001&#xFF0C;&#x8FD9;&#x8868;&#x793A;&#x5B57;&#x6BCD;a&#x53EF;&#x4EE5;&#x5728;&#x6587;&#x672C;&#x4E32;&#x4E2D;&#x7684;&#x54EA;&#x4E9B;&#x4F4D;&#x7F6E;&#x4F5C;&#x4E3A;&#x524D;&#x7F00;&#x3002;<br>&#x5BF9;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x6BCD;b&#xFF0C;(dp &lt;&lt; 1) &amp; bs[b]&#x53EF;&#x5F97;&#xFF1A;dp = (010010010 &amp; 010010010) = 010010010&#xFF0C;&#x8FD9;&#x8868;&#x793A;ab&#x53EF;&#x4EE5;&#x5728;&#x6587;&#x672C;&#x4E32;&#x4E2D;&#x7684;&#x54EA;&#x4E9B;&#x4F4D;&#x7F6E;&#x4F5C;&#x4E3A;&#x524D;&#x7F00;&#x3002;&#x5982;&#x679C;&#x60F3;&#x8981;&#x4EE5;&#x5F53;&#x524D;b&#x7ED3;&#x5C3E;&#x4F5C;&#x4E3A;&#x524D;&#x7F00;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x5FC5;&#x7136;&#x9700;&#x8981;&#x4EE5;&#x524D;&#x4E00;&#x4E2A;&#x5B57;&#x6BCD;a&#x4F5C;&#x4E3A;&#x4E0A;&#x4E00;&#x4E2A;&#x5B57;&#x6BCD;&#x7684;&#x524D;&#x7F00;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5148;dp&#x5DE6;&#x79FB;&#x4E00;&#x4F4D;&#xFF0C;&#x7136;&#x540E;<strong>&#x4E0E;&#x4E0A;</strong>&#x5F53;&#x524D;b&#x53EF;&#x4EE5;&#x5339;&#x914D;&#x7684;&#x4F4D;&#x7F6E;&#x3002;<br>&#x5BF9;&#x4E8E;&#x7B2C;&#x4E09;&#x4E2A;&#x5B57;&#x6BCD;c&#xFF0C;(dp &lt;&lt; 1) &amp; bs[c]&#x53EF;&#x5F97;&#xFF1A;dp = (100100100 &amp; 100100100) = 100100100&#x3002;&#x6B64;&#x65F6;&#x72B6;&#x6001;1&#x7684;&#x4F4D;&#x7F6E;&#x5C31;&#x8868;&#x793A;&#x53EF;&#x4EE5;&#x548C;&#x6A21;&#x5F0F;&#x4E32;&#x5339;&#x914D;&#x7684;<strong>&#x7ED3;&#x5C3E;&#x4F4D;&#x7F6E;</strong>&#x3002;</p>
<p>[HDU 5745]:<br>&#x7ED9;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;$n\leq 10^5$&#x7684;&#x6587;&#x672C;&#x4E32;&#x548C;&#x957F;&#x5EA6;&#x4E3A;$m\leq 5000$&#x7684;&#x6A21;&#x5F0F;&#x4E32;&#xFF0C;&#x5BF9;&#x4E8E;&#x6587;&#x672C;&#x4E32;&#x7684;&#x6BCF;&#x4E2A;&#x5B57;&#x6BCD;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x76F8;&#x90BB;&#x4F4D;&#x7F6E;&#x5B57;&#x6BCD;&#x4EA4;&#x6362;&#x4F46;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x4EA4;&#x53C9;&#x4EA4;&#x6362;&#x3002;&#x4F8B;&#x5982;abcd&#x53EF;&#x4EE5;&#x53D8;&#x6362;&#x6210;bacd,abdc,acbd&#xFF0C;badc,&#x4F46;&#x662F;&#x4E0D;&#x80FD;&#x53D8;&#x6210;bcad,bcda&#x7B49;&#x3002;&#x5BF9;&#x4E8E;&#x6587;&#x672C;&#x4E32;&#x7684;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x5224;&#x65AD;&#x4EE5;&#x5B83;&#x4E3A;&#x8D77;&#x59CB;&#x7684;&#x5B50;&#x4E32;&#x80FD;&#x5426;&#x53D8;&#x6362;&#x6210;&#x6A21;&#x5F0F;&#x4E32;&#x3002;</p>
<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x9650;&#x5236;&#x4E86;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x5B57;&#x6BCD;&#x7684;&#x4EA4;&#x6362;&#x4F4D;&#x7F6E;&#x53EA;&#x80FD;&#x662F;&#x76F8;&#x90BB;&#x7684;&#x4E24;&#x4E2A;&#x3002;&#x7528;$dp[i][j][]$&#x8868;&#x793A;&#x6587;&#x672C;&#x4E32;&#x7684;&#x7B2C;$i$&#x4E2A;&#x4F4D;&#x7F6E;&#x548C;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x7B2C;$j$&#x4E2A;&#x4F4D;&#x7F6E;&#x7684;&#x5339;&#x914D;&#x72B6;&#x6001;&#x3002;&#x7B2C;&#x4E09;&#x7EF4;&#x7528;0,1,2&#x5206;&#x522B;&#x8868;&#x793A;&#x6587;&#x672C;&#x4E32;&#x7684;&#x7B2C;$i$&#x4E2A;&#x5B57;&#x6BCD;&#x548C;&#x7B2C;$i-1$&#x4E2A;&#x5B57;&#x6BCD;&#x4EA4;&#x6362;&#xFF0C;&#x4E0D;&#x52A8;&#x4EE5;&#x53CA;&#x548C;&#x7B2C;$i+1$&#x4E2A;&#x5B57;&#x6BCD;&#x4EA4;&#x6362;&#x4E09;&#x79CD;&#x72B6;&#x6001;&#x3002;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#xFF1A;<br>\begin{aligned}<br>dp[i][j][0] &amp;= dp[i-1][j-1][2]  \&amp;\&amp; a[i]==b[j-1] \\<br>dp[i][j][1] &amp;= (dp[i-1][j-1][0]  | dp[i-1][j][1]) \&amp;\&amp; a[i]==b[j] \\<br>dp[i][j][2] &amp;= (dp[i-1][j-1][0] | dp[i-1][j-1][1]) \&amp;\&amp;  a[i]==b[j+1]<br>\end{aligned}<br>&#x5148;&#x5904;&#x7406;&#x51FA;&#x6587;&#x672C;&#x4E32;&#x4E2D;&#x6BCF;&#x4E2A;&#x5B57;&#x6BCD;&#x51FA;&#x73B0;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x72B6;&#x538B;&#x7B2C;&#x4E00;&#x7EF4;&#xFF0C;&#x7136;&#x540E;&#x679A;&#x4E3E;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x501F;&#x52A9;bitset&#x5DE6;&#x79FB;&#x64CD;&#x4F5C;&#x6A21;&#x62DF;&#x5339;&#x914D;&#x5E76;&#x4E14;&#x6EDA;&#x52A8;&#x6570;&#x7EC4;&#x3002;<br>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(\frac{n*m}{w}),w$&#x662F;&#x673A;&#x5668;&#x5B57;&#x8282;&#x6570;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">5010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m;</span><br><span class="line"><span class="keyword">int</span> ans[MAX_N];</span><br><span class="line"><span class="keyword">char</span> str1[MAX_N], str2[MAX_M];</span><br><span class="line"><span class="built_in">bitset</span>&lt;MAX_N&gt; dp[<span class="number">2</span>][<span class="number">3</span>], bs[<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; ++j) {</span><br><span class="line">			dp[i][j].reset();</span><br><span class="line">			dp[i][j][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) { bs[i].reset(); }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		bs[str1[i] - <span class="string">&apos;a&apos;</span>][i] = <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">	init();</span><br><span class="line">	<span class="keyword">int</span> now = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>][<span class="number">1</span>].<span class="built_in">set</span>(); <span class="comment">// &#x521D;&#x59CB;&#x7F6E;&#x4E3A;1</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">		now ^= <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (i &gt; <span class="number">1</span>) dp[now][<span class="number">0</span>] = (dp[now ^ <span class="number">1</span>][<span class="number">2</span>] &lt;&lt; <span class="number">1</span>) &amp; bs[str2[i - <span class="number">1</span>] - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">		dp[now][<span class="number">1</span>] = ((dp[now ^ <span class="number">1</span>][<span class="number">1</span>] | dp[now ^ <span class="number">1</span>][<span class="number">0</span>]) &lt;&lt; <span class="number">1</span>) &amp; bs[str2[i] - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">		<span class="keyword">if</span> (i &lt;= m - <span class="number">1</span>) dp[now][<span class="number">2</span>] = ((dp[now ^ <span class="number">1</span>][<span class="number">0</span>] | dp[now ^ <span class="number">1</span>][<span class="number">1</span>]) &lt;&lt; <span class="number">1</span>) &amp; bs[str2[i + <span class="number">1</span>] - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">		dp[now][<span class="number">0</span>][<span class="number">0</span>] = dp[now][<span class="number">1</span>][<span class="number">0</span>] = dp[now][<span class="number">2</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	} </span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - m + <span class="number">1</span>; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (dp[now][<span class="number">0</span>][i + m - <span class="number">1</span>] || dp[now][<span class="number">1</span>][i + m - <span class="number">1</span>]) <span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n - m + <span class="number">2</span>; i &lt;= n; ++i) { <span class="comment">// &#x6700;&#x540E;&#x7684; m-1 &#x4E2A;&#x4F4D;&#x7F6E;&#x80AF;&#x5B9A;&#x4E0D;&#x7B26;</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, str1 + <span class="number">1</span>, str2 + <span class="number">1</span>);</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>[2016 &#x5927;&#x8FDE;B]:<br>&#x7ED9;&#x4E00;&#x4E2A;$n\leq 1000$&#xFF0C;&#x4EE3;&#x8868;&#x6570;&#x5B57;&#x957F;&#x5EA6;&#xFF0C;&#x4EE5;&#x53CA;&#x6BCF;&#x4F4D;&#x4E0A;&#x5019;&#x9009;&#x6570;&#x5B57;&#x96C6;&#x5408;&#xFF0C;&#x518D;&#x7ED9;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#x5B57;&#x7B26;&#x4E32;$s(|s|\leq 5*10^{6})$&#xFF0C;&#x8F93;&#x51FA;$s$&#x4E2D;&#x6240;&#x6709;&#x5339;&#x914D;&#x7684;$n$&#x4F4D;&#x6570;&#x5B57;&#x5B50;&#x4E32;&#x3002;</p>
<p>&#x6837;&#x4F8B;&#x8F93;&#x5165;&#xFF1A;<br>4 &#xFF08;&#x4E00;&#x5171;&#x56DB;&#x4F4D;&#xFF09;<br>3 0 9 7 &#xFF08;&#x7B2C;&#x4E00;&#x4F4D;&#x6709;&#x4E09;&#x4E2A;&#x5019;&#x9009;&#x6570;&#x5B57;&#x5206;&#x522B;&#x4E3A;&#xFF1A;0 9 7&#xFF09;<br>2 5 7   &#xFF08;&#x7B2C;&#x4E8C;&#x4F4D;&#x6709;&#x4E24;&#x4E2A;&#x5019;&#x9009;&#x6570;&#x5B57;&#x5206;&#x522B;&#x4E3A;&#xFF1A;5 7&#xFF09;<br>2 2 5   &#xFF08;&#x7B2C;&#x4E09;&#x4F4D;&#x6709;&#x4E24;&#x4E2A;&#x5019;&#x9009;&#x6570;&#x5B57;&#x5206;&#x522B;&#x4E3A;&#xFF1A;2 5&#xFF09;<br>2 4 5   &#xFF08;&#x7B2C;&#x56DB;&#x4F4D;&#x6709;&#x4E24;&#x4E2A;&#x5019;&#x9009;&#x6570;&#x5B57;&#x5206;&#x522B;&#x4E3A;&#xFF1A;4 5&#xFF09;<br>09755420524 &#xFF08;&#x6570;&#x5B57;&#x5B57;&#x7B26;&#x4E32;s&#xFF09;<br>&#x6837;&#x4F8B;&#x8F93;&#x51FA;&#xFF1A;&#xFF08;&#x6240;&#x6709;&#x5339;&#x914D;&#x7684;&#x56DB;&#x4F4D;&#x6570;&#x5B57;&#x5B50;&#x4E32;&#xFF09;<br>9755<br>7554<br>0524</p>
<p>&#x628A;$n$&#x4F4D;&#x6570;&#x5B57;&#x770B;&#x6210;&#x6A21;&#x5F0F;&#x4E32;&#xFF0C;&#x5148;&#x5904;&#x7406;&#x5904;&#x6BCF;&#x4E2A;&#x6570;&#x5B57;&#x53EF;&#x4EE5;&#x5728;&#x6A21;&#x5F0F;&#x4E32;&#x4E2D;&#x7684;&#x5339;&#x914D;&#x4F4D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x626B;&#x63CF;&#x6587;&#x672C;&#x4E32;&#x3002;&#x7528;$dp[i][j]$&#x8868;&#x793A;&#x6587;&#x672C;&#x4E32;&#x7684;&#x7B2C;$i$&#x4E2A;&#x4F4D;&#x7F6E;&#x80FD;&#x5426;&#x548C;&#x6A21;&#x5F0F;&#x4E32;&#x7684;&#x7B2C;$j$&#x4E2A;&#x4F4D;&#x7F6E;&#x5339;&#x914D;&#xFF08;&#x524D;&#x7F00;&#xFF09;&#xFF0C;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#xFF1A;<br>\begin{aligned}<br>dp[i][j]=dp[i-1][j-1] \&amp;\&amp; a[i]\in b[j]<br>\end{aligned}<br>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(\frac{n*m}{w}),w$&#x662F;&#x673A;&#x5668;&#x5B57;&#x8282;&#x6570;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">5000010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, len;</span><br><span class="line"><span class="keyword">char</span> str[MAX_M];</span><br><span class="line"><span class="built_in">bitset</span>&lt;MAX_N&gt; bs[<span class="number">10</span>], dp[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">	len = <span class="built_in">strlen</span>(str + <span class="number">1</span>);</span><br><span class="line">	dp[<span class="number">0</span>].reset(), dp[<span class="number">1</span>].reset();</span><br><span class="line">	dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> now = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i) {</span><br><span class="line">		now ^= <span class="number">1</span>;</span><br><span class="line">		dp[now] = (dp[now ^ <span class="number">1</span>] &lt;&lt; <span class="number">1</span>) &amp; bs[str[i] - <span class="string">&apos;0&apos;</span>];</span><br><span class="line">		dp[now][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (dp[now][n]) {</span><br><span class="line">			<span class="keyword">char</span> ch = str[i + <span class="number">1</span>];</span><br><span class="line">			str[i + <span class="number">1</span>] = <span class="string">&apos;\0&apos;</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str + (i - n + <span class="number">1</span>));</span><br><span class="line">			str[i + <span class="number">1</span>] = ch;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) { bs[i].reset(); }</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> x, y;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x; ++j) {</span><br><span class="line">				<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;y);</span><br><span class="line">				bs[y][i] = <span class="number">1</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str + <span class="number">1</span>);</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">四边形不等式优化</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x5047;&#x5982;&#x5BF9;&#x4E8E;$i &lt; j$&#xFF0C;&#x6709;&#xFF1A;<br>$$w(i,j)+w(i+1,j+1)\leq w(i+1,j)+w(i,j+1)$$<br>&#x79F0;&#x51FD;&#x6570;$w$&#x6EE1;&#x8DB3;&#x56DB;&#x8FB9;&#x5F62;&#x4E0D;&#x7B49;&#x5F0F;&#x3002;<br><a id="more"></a><br>&#x5C06;&#x4E0D;&#x7B49;&#x5F0F;&#x53D8;&#x5F62;&#x5F97;&#xFF1A;<br>$$<br>w(i+1,j+1)- w(i+1,j)\leq w(i,j+1) - w(i,j)<br>$$<br>&#x90A3;&#x4E48;&#x8BC1;&#x660E;&#x51FD;&#x6570;$w$&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x56DB;&#x8FB9;&#x5F62;&#x4E0D;&#x7B49;&#x5F0F;&#xFF0C;&#x5373;&#x8BC1;&#x660E;&#xFF1A;<br>&#x5F53;$j$&#x56FA;&#x5B9A;&#x4E0D;&#x53D8;&#x65F6;&#x662F;&#x5426;&#x6709;&#xFF1A;$w(i,j+1)-w(i,j)$&#x968F;$i$&#x975E;&#x9012;&#x589E;&#x3002;</p>
<ul>
<li>&#x5B9A;&#x7406;1</li>
</ul>
<p>&#x5982;&#x679C;&#x6709;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>m(i,j)=\min_{i &lt; k\leq j}\{ m(i,k-1)+m(k,j)+w(i,j)\} \quad (i &lt; j,m(i,i)=0)<br>$$<br>&#x90A3;&#x4E48;&#x51FD;&#x6570;$m$&#x4E5F;&#x6EE1;&#x8DB3;&#x56DB;&#x8FB9;&#x5F62;&#x4E0D;&#x7B49;&#x5F0F;&#xFF1A;<br>$$<br>m(i,j)+m(i+1,j+1)\leq m(i+1,j)+m(i,j+1),\quad i &lt; j<br>$$</p>
<ul>
<li>&#x5B9A;&#x7406;2</li>
</ul>
<p>&#x5B9A;&#x4E49;$s(i,j)$&#x4E3A;&#x51FD;&#x6570;$m(i,j)$&#x5BF9;&#x5E94;&#x7684;&#x51B3;&#x7B56;&#x53D8;&#x91CF;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x5373;&#xFF1A;<br>$$<br>s(i,j)=\max_{i &lt; k\leq j}\{m(i,j)=w(i,j)+m(i,k-1)+m(k,j)\}<br>$$<br>&#x5E76;&#x4E14;$m(i,j)$&#xFF0C;&#x6EE1;&#x8DB3;&#x56DB;&#x8FB9;&#x5F62;&#x4E0D;&#x7B49;&#x5F0F;&#xFF0C;&#x90A3;&#x4E48;$s(i,j)$&#x5355;&#x8C03;&#xFF0C;&#x5373;&#xFF1A;<br>$$<br>s(i,j)\leq s(i,j+1)\leq s(i+1,j+1)<br>$$<br>&#x56E0;&#x6B64;$m(i,j)$&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#x7B49;&#x4EF7;&#x4E8E;&#xFF1A;<br>$$<br>m(i,j)=\min_{s(i,j-1) &lt; k\leq s(i+1,j)}\{ m(i,k-1)+m(k,j)+w(i,j)\} \quad (i&lt; j,m(i,i)=0)<br>$$<br>&#x8FD9;&#x4E2A;&#x8F6C;&#x79FB;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x662F;&#xFF1A;$O(n^2)$&#x3002;</p>
<ul>
<li>&#x73AF;&#x5F62;&#x77F3;&#x5B50;&#x5806;&#x5408;&#x5E76;</li>
</ul>
<p>[HDU 3506]&#xFF1A;&#x7ED9;$n\leq 1000$&#x4E2A;&#x56F4;&#x6210;&#x4E00;&#x5708;&#x7684;&#x77F3;&#x5B50;&#x5806;&#xFF0C;&#x6BCF;&#x6B21;&#x53EF;&#x4EE5;&#x5408;&#x5E76;&#x76F8;&#x90BB;&#x7684;&#x4E24;&#x4E2A;&#x77F3;&#x5B50;&#x5806;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x77F3;&#x5B50;&#x5806;&#xFF0C;&#x5408;&#x5E76;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x4E24;&#x5806;&#x77F3;&#x5B50;&#x6570;&#x91CF;&#x4E4B;&#x548C;&#xFF0C;&#x6C42;&#x5C06;$n$&#x5806;&#x77F3;&#x5B50;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x5806;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF1F;</p>
<p>&#x5148;&#x5C06;$n$&#x5806;&#x73AF;&#x5F62;&#x77F3;&#x5B50;&#x5C55;&#x5F00;&#x6210;&#x4E00;&#x6392;$2*n$&#x5806;&#x77F3;&#x5B50;&#x3002;&#x7528;$dp[i][j]$&#x8868;&#x793A;&#x5408;&#x5E76;&#x7B2C;$i$&#x5806;&#x5230;&#x7B2C;$j$&#x5806;&#x77F3;&#x5B50;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF0C;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i][j]=min(dp[i][k]+dp[k+1][j])+cost[i][j]\quad (i\leq k\leq j)<br>$$<br>&#x5229;&#x7528;&#x56DB;&#x8FB9;&#x5F62;&#x4E0D;&#x7B49;&#x5F0F;&#x4F18;&#x5316;&#xFF0C;&#x53EA;&#x9700;&#x8BC1;&#x660E;&#xFF1A;&#x5F53;$j$&#x56FA;&#x5B9A;&#x4E0D;&#x53D8;&#x65F6;&#x662F;&#x5426;&#x6709;$cost[i][j+1]-cost[i][j]$&#x968F;$i$&#x5355;&#x8C03;&#x975E;&#x9012;&#x589E;&#x3002;<br>$$<br>cost[i][j]=\sum_{r=i}^{r=j}data[r] \\<br>cost[i][j+1]-cost[i][j]=data[j+1]<br>$$<br>&#x56E0;&#x4E3A;$j$&#x56FA;&#x5B9A;&#x4E0D;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#x5DEE;&#x503C;&#x662F;&#x4E2A;&#x6052;&#x5B9A;&#x503C;&#xFF0C;&#x90A3;&#x4E48;&#x6EE1;&#x8DB3;&#x968F;$i$&#x5355;&#x8C03;&#x975E;&#x9012;&#x589E;&#xFF08;&#x4E0D;&#x53D8;&#xFF09;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n^2)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1010</span> * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> d[MAX_N], sum[MAX_N];</span><br><span class="line"><span class="keyword">int</span> dp[MAX_N][MAX_N], s[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">2</span> * n; ++i) {</span><br><span class="line">		sum[i] = sum[i - <span class="number">1</span>] + d[i];</span><br><span class="line">	}</span><br><span class="line">	d[<span class="number">2</span> * n + <span class="number">1</span>] = d[<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">2</span> * n; ++i) {</span><br><span class="line">		dp[i][i + <span class="number">1</span>] = d[i] + d[i + <span class="number">1</span>];</span><br><span class="line">		s[i][i + <span class="number">1</span>] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> len = <span class="number">3</span>; len &lt;= n; ++len) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i + len - <span class="number">1</span> &lt;= <span class="number">2</span> * n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> j = i + len - <span class="number">1</span>;</span><br><span class="line">			dp[i][j] = INT_MAX;</span><br><span class="line">			<span class="keyword">int</span> a = s[i][j - <span class="number">1</span>], b = s[i + <span class="number">1</span>][j];</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> r = a; r &lt;= b; ++r) {</span><br><span class="line">				<span class="keyword">int</span> tmp = dp[i][r] + dp[r + <span class="number">1</span>][j] + sum[j] - sum[i - <span class="number">1</span>];</span><br><span class="line">				<span class="keyword">if</span> (tmp &lt; dp[i][j]) {</span><br><span class="line">					dp[i][j] = tmp;</span><br><span class="line">					s[i][j] = r;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> ans = INT_MAX;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		ans = min(ans, dp[i][i + n - <span class="number">1</span>]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d[i]);</span><br><span class="line">			d[i + n] = d[i];</span><br><span class="line">			dp[i][i] = <span class="number">0</span>;</span><br><span class="line">			s[i][i] = i;</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<ul>
<li>[HDU 2829]:&#x7ED9;$n\leq 1000$&#x4E2A;&#x6B63;&#x6574;&#x6570;&#x6570;&#xFF0C;&#x5B9A;&#x4E49;&#x4E0B;&#x6807;$i\sim j$&#x7684;&#x4E00;&#x4E32;&#x8FDE;&#x7EED;&#x7684;&#x6CA1;&#x88AB;&#x6321;&#x677F;&#x9694;&#x5F00;&#x7684;&#x4E00;&#x4E32;&#x6570;&#x7684;&#x4EF7;&#x503C;&#x4E3A;&#xFF1A;$\sum_{p=i}^{p=j}data[p]\sum_{q=p+1}^{q=j}{data[q]}$&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6570;&#x65F6;&#x4EF7;&#x503C;&#x4E3A;0&#xFF0C;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x4F4D;&#x7F6E;&#x653E;&#x7F6E;$K\in [0,n)$&#x4E2A;&#x6321;&#x677F;&#xFF0C;&#x4F7F;&#x5F97;&#x6700;&#x7EC8;&#x7684;&#x603B;&#x4EF7;&#x503C;&#x6700;&#x5C0F;&#xFF0C;&#x8F93;&#x51FA;&#x6700;&#x5C0F;&#x603B;&#x4EF7;&#x503C;&#x3002;</li>
</ul>
<p>&#x5B9A;&#x4E49;&#xFF1A;$sum[i]=\sum_{r=1}^{r=i}{data[r]}$&#xFF0C;$fsum[i]=\sum_{r=1}^{r=i}data[r]*sum[r]$<br>$$<br>\begin{aligned}<br>cos[i][j]&amp;=\sum_{p=i}^{p=j}data[p]\sum_{q=p+1}^{q=j}{data[q]} \\<br>&amp;=\sum_{p=i}^{p=j}data[p]*(sum[j]-sum[p]) \\<br>&amp;=sum[j]*(sum[j]-sum[i-1])-(fsum[j]-fsum[i-1])<br>\end{aligned}<br>$$<br>&#x5B9A;&#x4E49;$dp[i][k]$&#x8868;&#x793A;&#x5728;&#x524D;$i$&#x4E2A;&#x6570;&#x653E;&#x7F6E;$k$&#x4E2A;&#x6321;&#x677F;&#x53EF;&#x83B7;&#x5F97;&#x4EF7;&#x503C;&#xFF0C;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i][k]=\min_{0\leq j&lt; i}\{dp[j][k-1]+cost[j+1][i]\}<br>$$<br>&#x8003;&#x8651;&#x56DB;&#x8FB9;&#x5F62;&#x4E0D;&#x7B49;&#x5F0F;&#x4F18;&#x5316;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BC1;&#x660E;&#xFF1A;&#x5F53;$j$&#x56FA;&#x5B9A;&#x65F6;&#xFF0C;$cost[i][j+1]-cost[i][j]$&#x968F;$i$&#x5355;&#x8C03;&#x975E;&#x589E;&#x3002;<br>$$<br>\begin{aligned}<br>cost[i][j+1]-cost[i][j]&amp;=({sum[j+1]}^{2}-fsum[j+1])-({sum[j]}^{2}-fsum[j]) \\<br>&amp;+(sum[j]-sum[j+1])*sum[i-1]<br>\end{aligned}<br>$$<br>&#x56E0;&#x4E3A;$sum[r]$&#x662F;&#x5355;&#x8C03;&#x9012;&#x589E;&#x7684;&#xFF0C;&#x6240;&#x4EE5;$(sum[j]-sum[j+1])*sum[i]$&#x5728;$j$&#x56FA;&#x5B9A;&#x7684;&#x6761;&#x4EF6;&#x4E0B;&#x968F;$i$&#x5355;&#x8C03;&#x9012;&#x51CF;&#xFF0C;&#x6EE1;&#x8DB3;&#x56DB;&#x8FB9;&#x5F62;&#x4E0D;&#x7B49;&#x5F0F;&#x4F18;&#x5316;&#x6761;&#x4EF6;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n*K)$&#xFF0C;&#x5E38;&#x6570;&#x6709;&#x70B9;&#x5927;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> s[MAX_N][MAX_N];</span><br><span class="line">ll data[MAX_N], sum[MAX_N], fsum[MAX_N];</span><br><span class="line">ll cost[MAX_N][MAX_N], dp[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt;= n; ++j) {</span><br><span class="line">			cost[i][j] = cost[j][i] = sum[j] * (sum[j] - sum[i - <span class="number">1</span>]) - (fsum[j] - fsum[i - <span class="number">1</span>]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> (dp));</span><br><span class="line">	<span class="built_in">memset</span>(dp[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (dp[<span class="number">0</span>]));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) { </span><br><span class="line">		dp[i][<span class="number">0</span>] = cost[<span class="number">1</span>][i]; </span><br><span class="line">		s[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= m; ++k) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i) {</span><br><span class="line">			<span class="keyword">if</span> (k &gt;= i) dp[i][k] = <span class="number">0</span>, s[i][k] = i;</span><br><span class="line">			<span class="keyword">else</span> {</span><br><span class="line">				<span class="keyword">int</span> a, b;</span><br><span class="line">				<span class="keyword">if</span> (i == n) a = k - <span class="number">1</span>, b = n - <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">else</span> a = s[i][k - <span class="number">1</span>], b = s[i + <span class="number">1</span>][k];</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = a; j &lt;= b; ++j) {</span><br><span class="line">					<span class="keyword">if</span> (dp[j][k - <span class="number">1</span>] + cost[j + <span class="number">1</span>][i] &lt; dp[i][k]) {</span><br><span class="line">						dp[i][k] = dp[j][k - <span class="number">1</span>] + cost[j + <span class="number">1</span>][i];</span><br><span class="line">						s[i][k] = j;</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n][m]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m) &amp;&amp; (n + m)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;data[i]);</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + data[i];</span><br><span class="line">			fsum[i] = fsum[i - <span class="number">1</span>] + data[i] * sum[i];</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x8003;&#x8651;&#x659C;&#x7387;&#x4F18;&#x5316;&#x3002;&#x4EE4;$k&gt;j$&#xFF0C;&#x4E14;&#xFF1A;<br>$$<br>dp[k][p-1]+cost[k+1][i] &lt; dp[j][p-1]+cost[j+1][i]<br>$$<br>&#x5373;&#xFF1A;<br>$$<br>\begin{aligned}<br>dp[k][p-1]+sum[k]*(sum[k]-sum[i-1])-(fsum[k]-fsum[i-1])&amp;&lt; \\<br>dp[j][p-1]+sum[j]*(sum[j]-sum[i-1])-(fsum[j]-fsum[i-1])<br>\end{aligned}<br>$$<br>&#x5316;&#x7B80;&#x5F97;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{(dp[k][p-1]+fsum[k])-(dp[j]+fsum[j])}{sum[k]-sum[j]}\leq sum[i]<br>$$<br>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n*K)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> Q[MAX_N];</span><br><span class="line">ll data[MAX_N], sum[MAX_N], fsum[MAX_N];</span><br><span class="line">ll dp[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x][id] + fsum[x] - (dp[y][id] + fsum[y]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> sum[x] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		dp[i][<span class="number">0</span>] = sum[i] * sum[i] - fsum[i];</span><br><span class="line">	}</span><br><span class="line">	dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= K; ++k) {</span><br><span class="line">		head = tail = <span class="number">0</span>;</span><br><span class="line">		Q[++tail] = k - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, Q[head + <span class="number">1</span>], Q[head]) &lt;=</span><br><span class="line">						S(Q[head + <span class="number">1</span>], Q[head]) * sum[i]) ++head;</span><br><span class="line">			<span class="keyword">int</span> t = Q[head];</span><br><span class="line">			dp[i][k] = dp[t][k - <span class="number">1</span>] + sum[i] * (sum[i] - sum[t]) - fsum[i] + fsum[t];</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>]) &lt;=</span><br><span class="line">						G(k - <span class="number">1</span>, Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail])) --tail;</span><br><span class="line">			Q[++tail] = i;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n][K]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;K) &amp;&amp; (n + K)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;data[i]);</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + data[i];</span><br><span class="line">			fsum[i] = fsum[i - <span class="number">1</span>] + data[i] * sum[i];</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">斜率优化（三）</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p><a href="http://wenku.baidu.com/view/ef259400bed5b9f3f90f1c3a.html" target="_blank" rel="noopener">&#x7528;&#x5355;&#x8C03;&#x6027;&#x4F18;&#x5316;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x2013;JSOI2009 &#x96C6;&#x8BAD;&#x961F;&#x8BBA;&#x6587;</a><br><a href="http://wenku.baidu.com/view/f6421ce8b8f67c1cfad6b8ac.html" target="_blank" rel="noopener">&#x6D45;&#x8C08;&#x6570;&#x5F62;&#x7ED3;&#x5408;&#x5728;&#x4FE1;&#x606F;&#x5B66;&#x7ADE;&#x8D5B;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x2013;&#x5B89;&#x5FBD;&#x829C;&#x6E56;&#x4E00;&#x4E2D;&#xB7;&#x5468;&#x6E90;</a><br>&#x5728;VJ&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/135311#overview" target="_blank" rel="noopener">Here</a>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x62C9;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#x6574;&#x5408;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;G,K,R&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x3002;&#x3002;&#x3002;R&#x9898;&#x597D;&#x50CF;&#x8FD8;&#x662F;2014 World Final&#x7684;&#x9898;&#x554A;&#x3002;<br><a id="more"></a></p>
<h5 id="o"><a href="#O" class="headerlink" title="O"></a>O</h5><p>[BZOJ 1096]&#xFF1A;&#x6709;$n\leq 10^6$&#x4E2A;&#x5DE5;&#x5382;&#xFF0C;&#x6309;&#x7F16;&#x53F7;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x4ECE;&#x5C71;&#x9876;&#x5411;&#x5C71;&#x811A;&#x5206;&#x5E03;&#xFF0C;&#x7ED9;&#x51FA;&#x6BCF;&#x4E2A;&#x5DE5;&#x5382;&#x8DDD;&#x79BB;&#x7B2C;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x7684;&#x8DDD;&#x79BB;&#x548C;&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x62E5;&#x6709;&#x7684;&#x5546;&#x54C1;&#x6570;&#x91CF;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x5EFA;&#x50A8;&#x5B58;&#x5BA4;&#x7684;&#x4EE3;&#x4EF7;&#xFF0C;&#x5546;&#x54C1;&#x53EA;&#x80FD;&#x5411;&#x4E0B;&#x8FD0;&#x8F93;&#xFF0C;&#x8FD0;&#x8F93;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x5546;&#x54C1;&#x6570;&#x91CF;&#x4E58;&#x4EE5;&#x8DDD;&#x79BB;&#xFF0C;&#x6C42;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x5DE5;&#x5382;&#x5EFA;&#x50A8;&#x5B58;&#x5BA4;&#x4F7F;&#x5F97;&#x603B;&#x4EE3;&#x4EF7;&#x6700;&#x5C0F;&#x3002;</p>
<p>&#x8BB0;&#xFF1A;<br>$$<br>pre[i]=\sum_{r=1}^{r=i}{num[i]} \\<br>sum[i]=\sum_{r=1}^{r=i}{num[i]*dis[i]}<br>$$<br>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=min(dp[j]+dis[i]*(pre[i]-pre[j])-(sum[i]-sum[j])+cost[i])<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x]+sum[x]-(dp[y]+sum[y])}{pre[x]-pre[y]}\leq dis[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] + sum[x] - dp[y] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> pre[x] - pre[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;</span><br><span class="line">			dis[i] * S(Q[head + <span class="number">1</span>], Q[head])) head++;</span><br><span class="line">		<span class="keyword">int</span> pos = Q[head];</span><br><span class="line">		dp[i] = dp[pos] + dis[i] * (pre[i] - pre[pos]) + sum[pos] - sum[i] + cost[i];</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail]) &gt;</span><br><span class="line">								G(i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) tail--; </span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) {</span><br><span class="line">		pre[<span class="number">0</span>] = sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>, &amp;dis[i], &amp;num[i], &amp;cost[i]);</span><br><span class="line">			pre[i] = pre[i - <span class="number">1</span>] + num[i];</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + dis[i] * num[i];</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="p"><a href="#P" class="headerlink" title="P"></a>P</h5><p>[BZOJ 1492]&#xFF1A;&#x7ED9;&#x51FA;$n\leq 10^5$&#x5929;&#x6BCF;&#x5929;A&#x548C;B&#x4E24;&#x79CD;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;&#xFF0C;&#x521D;&#x59CB;&#x65F6;&#x62E5;&#x6709;$S$&#x5143;&#xFF0C;&#x5728;&#x7B2C;$i$&#x5929;&#x53EF;&#x4EE5;&#x6709;&#x4E09;&#x79CD;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li>&#x628A;&#x624B;&#x4E0A;&#x7684;&#x524D;&#x5168;&#x90E8;&#x7528;&#x6765;&#x4E70;&#x80A1;&#x7968;&#xFF0C;&#x80A1;&#x7968;A&#x548C;&#x80A1;&#x7968;B&#x7684;&#x6570;&#x91CF;&#x4E4B;&#x6BD4;&#x5E94;&#x4E3A;$rate[i]$</li>
<li>&#x628A;&#x624B;&#x4E0A;&#x7684;&#x80A1;&#x7968;&#x5168;&#x90E8;&#x5356;&#x51FA;&#xFF0C;&#x5F97;&#x5230;&#x5F53;&#x5929;&#x5E94;&#x5F97;&#x7684;&#x91D1;&#x989D;</li>
<li>&#x4E0D;&#x4E70;&#x4E0D;&#x5356;</li>
</ul>
<p>&#x95EE;&#x6700;&#x7EC8;&#x53EF;&#x4EE5;&#x83B7;&#x5229;&#x591A;&#x5C11;&#xFF1F;</p>
<p>&#x7528;$dp[i]$&#x8868;&#x793A;&#x5728;&#x7B2C;$i$&#x5929;&#x5C06;&#x624B;&#x4E2D;&#x7684;&#x80A1;&#x7968;&#x5168;&#x90E8;&#x5356;&#x51FA;&#x53EF;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x5927;&#x94B1;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x7528;&#x8FD9;&#x4E9B;&#x94B1;&#x6309;&#x7167;$rate[i]$&#x7684;&#x6BD4;&#x4F8B;&#x53EF;&#x4EE5;&#x8D2D;&#x5F97;&#x7684;A&#x7C7B;&#x548C;B&#x7C7B;&#x80A1;&#x7968;&#x7684;&#x6570;&#x91CF;&#x5206;&#x522B;&#x4E3A;&#xFF1A;$a[i]$&#x548C;$b[i]$&#xFF0C;&#x7528;$A[i]$&#x548C;$B[i]$&#x8868;&#x793A;A&#x7C7B;&#x548C;B&#x7C7B;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;&#x3002;</p>
<p>&#x7531;&#xFF1A;<br>$$<br>\begin{aligned}<br>\frac{a[i]}{b[i]}&amp;=rate[i]\\<br>a[i]*A[i]+b[i]*B[i]&amp;=dp[i]<br>\end{aligned}<br>$$<br>&#x53EF;&#x4EE5;&#x89E3;&#x51FA;$a[i]$&#x548C;$b[i]$&#x3002;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=max(a[j]*A[i]+b[j]*B[i])\quad (j&lt; i)<br>$$<br>&#x4EE4;$a[j]=x,b[j]=y,A[i]=a,B[i]=b,dp[i]=G$&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x662F;&#x5728;&#x5DF2;&#x77E5;$a,b$&#x7684;&#x6761;&#x4EF6;&#x4E0B;&#x6C42;$G=a*x+b*y$&#x7684;&#x6700;&#x5927;&#x503C;&#x3002;&#x5316;&#x6210;&#x659C;&#x7387;&#xFF1A;$y=-\frac{a}{b}x+\frac{G}{b}$&#x3002;</p>
<p>&#x5269;&#x4E0B;&#x7684;&#x542C;&#x8BF4;&#x8981;CDQ&#x5206;&#x6CBB;&#x641E;&#xFF0C;&#x7136;&#x800C;&#x8FD8;&#x4E0D;&#x4F1A;&#x554A;&#x3002;&#x3002;&#x3002;<br>&#x53C2;&#x8003;&#x535A;&#x5BA2;&#x94FE;&#x63A5;&#xFF1A;<a href="http://blog.inet198.cn/?creationaugust/article/details/44964863" target="_blank" rel="noopener">Here</a><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> INF = <span class="number">1e18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N	= <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> sta[MAX_N];</span><br><span class="line"><span class="keyword">double</span> S, ans[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt;= eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> {</span></span><br><span class="line">	<span class="keyword">double</span> a, b, rate, k; <span class="comment">// a,b: A &#x548C; B &#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7; k: &#x4EF7;&#x683C;&#x659C;&#x7387;&#xFF0C; cdq &#x6392;&#x5E8F;&#x5173;&#x952E;&#x5B57;</span></span><br><span class="line">	<span class="keyword">double</span> x, y; <span class="comment">// x,y: &#x5356;&#x51FA;&#x540E;&#x53EF;&#x5230;&#x7684; A,B &#x80A1;&#x7968;&#x6570;&#x91CF;</span></span><br><span class="line">	<span class="keyword">int</span> id; </span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Query&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> sgn(k - rhs.k) &gt;= <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">} ques[MAX_N], newq[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">return</span> -INF;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (sgn(ques[a].x - ques[b].x) == <span class="number">0</span>) <span class="keyword">return</span> INF;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> (ques[a].y - ques[b].y) / (ques[a].x - ques[b].x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> low, <span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (low == high) {</span><br><span class="line">		<span class="keyword">int</span> id = ques[low].id;</span><br><span class="line">		ans[low] = max(ans[low], ans[low - <span class="number">1</span>]);</span><br><span class="line">		ques[low].x = ans[low] * ques[low].rate / (ques[low].rate * ques[low].a + ques[low].b);</span><br><span class="line">		ques[low].y = ques[low].x / ques[low].rate;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> mid = (low + high) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> tp1 = low, tp2 = mid + <span class="number">1</span>, top = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = low; i &lt;= high; ++i) { <span class="comment">// &#x6309;&#x65F6;&#x95F4;&#x5212;&#x5206;&#x64CD;&#x4F5C;&#x533A;&#x95F4;</span></span><br><span class="line"> 		<span class="keyword">if</span> (ques[i].id &lt;= mid) newq[tp1++] = ques[i];</span><br><span class="line">		<span class="keyword">else</span> newq[tp2++] = ques[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(ques + low, newq + low, <span class="keyword">sizeof</span> (Query) * (high - low + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">	solve(low, mid);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = low; i &lt;= mid; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (top &gt; <span class="number">1</span> &amp;&amp; sgn(slope(sta[top - <span class="number">1</span>], sta[top]) - slope(sta[top - <span class="number">1</span>], i)) &lt; <span class="number">0</span>) top--;</span><br><span class="line">		sta[++top] = i;</span><br><span class="line">	}</span><br><span class="line">	sta[++top] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>, j = <span class="number">1</span>; i &lt;= high; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (j &lt; top &amp;&amp; sgn(ques[i].k - slope(sta[j], sta[j + <span class="number">1</span>])) &lt; <span class="number">0</span>) ++j;</span><br><span class="line">		ans[ques[i].id] = max(ans[ques[i].id], ques[sta[j]].x * ques[i].a + ques[sta[j]].y * ques[i].b);</span><br><span class="line">	}</span><br><span class="line">	solve(mid + <span class="number">1</span>, high);</span><br><span class="line"></span><br><span class="line">	tp1 = <span class="number">1</span>, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = low; i &lt;= high; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (tp1 &lt;= mid &amp;&amp; (ques[tp1].x &lt; ques[tp2].x || </span><br><span class="line">			sgn((ques[tp1].x - ques[tp2].x) == <span class="number">0</span> &amp;&amp; sgn(ques[tp1]. y - ques[tp2].y) &lt; <span class="number">0</span>)) ||</span><br><span class="line">			tp2 &gt; high) newq[tp1++] = ques[i];</span><br><span class="line">		<span class="keyword">else</span> newq[tp2++] = ques[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(ques + low, newq + low, <span class="keyword">sizeof</span> (Query) * (high - low + <span class="number">1</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%lf&quot;</span>, &amp;n, &amp;S)) {</span><br><span class="line">		ans[<span class="number">0</span>] = S;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>, &amp;ques[i].a, &amp;ques[i].b, &amp;ques[i].rate);</span><br><span class="line">			ques[i].id = i;</span><br><span class="line">			ques[i].k = -ques[i].a / ques[i].b;</span><br><span class="line">			ans[i] = <span class="number">0</span>;</span><br><span class="line">		}</span><br><span class="line">		sort(ques + <span class="number">1</span>, ques + n + <span class="number">1</span>);</span><br><span class="line">		solve(<span class="number">1</span>, n);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%.3lf\n&quot;</span>, ans[n]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="s"><a href="#S" class="headerlink" title="S"></a>S</h5><p>[BZOJ 1010]&#xFF1A;&#x5C06;$n\leq 5*10^4$&#x4E2A;&#x73A9;&#x5177;&#x5206;&#x7EC4;&#x6253;&#x5305;&#xFF0C;&#x6BCF;&#x7EC4;&#x7684;&#x73A9;&#x5177;&#x5FC5;&#x987B;&#x662F;&#x8FDE;&#x7EED;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A;&#x73A9;&#x5177;&#x7684;&#x957F;&#x5EA6;&#x4E3A;$len[i]$&#x3002;&#x5982;&#x679C;&#x5C06;&#x7B2C;$x$&#x5230;&#x7B2C;$y$&#x4E2A;&#x73A9;&#x5177;&#x6253;&#x5305;&#x5230;&#x4E00;&#x7EC4;&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x4EEC;&#x7684;&#x957F;&#x5EA6;$l=y-x+\sum_{i=x}^{i=y}{len[i]}$&#xFF0C;&#x5C06;&#x8FD9;&#x7EC4;&#x73A9;&#x5177;&#x6253;&#x5305;&#x7684;&#x4EE3;&#x4EF7;&#x7B49;&#x4E8E;$(l-L)^2$&#xFF0C;&#x6C42;&#x5C06;&#x6240;&#x6709;&#x73A9;&#x5177;&#x6253;&#x5305;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF0C;&#x6BCF;&#x7EC4;&#x73A9;&#x5177;&#x4E2A;&#x6570;&#x6CA1;&#x6709;&#x9650;&#x5236;&#x3002;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$dp[i]=min(dp[j]+(sum[i]-sum[j]+i-j-1-L)^2)$$<br>&#x4EE4;$C=1+L,f[i]=sum[i]+i$&#xFF0C;&#x53EF;&#x5F97;&#xFF1A;<br>$$dp[i]=min(dp[j]+(f[i]-f[j]-C)^2)$$<br>&#x4EE4;$G(x)=dp[x]+(f[x]+C)^2$&#xFF0C;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$\frac{G(x)-G(y)}{2*(f[x]-f[y])}\leq f[i]$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">50010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, L, C, head, tail;</span><br><span class="line"><span class="keyword">int</span> len[MAX_N], que[MAX_N];</span><br><span class="line">ll sum[MAX_N], f[MAX_N], dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> (f[x] - f[y]) * <span class="number">2</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y] + (f[x] + C) * (f[x] + C) - (f[y] + C) * (f[y] + C);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	C = L + <span class="number">1</span>;</span><br><span class="line">	sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		sum[i] = sum[i - <span class="number">1</span>] + len[i];</span><br><span class="line">		f[i] = sum[i] + i;</span><br><span class="line">	}</span><br><span class="line">	head = <span class="number">0</span>, tail = <span class="number">1</span>;</span><br><span class="line">	que[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt;= tail - <span class="number">2</span> &amp;&amp; G(que[head + <span class="number">1</span>], que[head]) </span><br><span class="line">			&lt;= f[i] * S(que[head + <span class="number">1</span>], que[head]))  head++;</span><br><span class="line">		dp[i] = dp[que[head]] + (f[i] - f[que[head]] - C) * (f[i] - f[que[head]] - C);</span><br><span class="line">		<span class="keyword">while</span> (head &lt;= tail - <span class="number">2</span> &amp;&amp; G(i, que[tail - <span class="number">1</span>]) * S(que[tail - <span class="number">1</span>], que[tail - <span class="number">2</span>]) &lt;= </span><br><span class="line">					  G(que[tail - <span class="number">1</span>], que[tail - <span class="number">2</span>]) * S(i, que[tail - <span class="number">1</span>])) tail--;</span><br><span class="line">		que[tail++] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;L)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;len[i]);</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">斜率优化（二）</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p><a href="http://wenku.baidu.com/view/ef259400bed5b9f3f90f1c3a.html" target="_blank" rel="noopener">&#x7528;&#x5355;&#x8C03;&#x6027;&#x4F18;&#x5316;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x2013;JSOI2009 &#x96C6;&#x8BAD;&#x961F;&#x8BBA;&#x6587;</a><br><a href="http://wenku.baidu.com/view/f6421ce8b8f67c1cfad6b8ac.html" target="_blank" rel="noopener">&#x6D45;&#x8C08;&#x6570;&#x5F62;&#x7ED3;&#x5408;&#x5728;&#x4FE1;&#x606F;&#x5B66;&#x7ADE;&#x8D5B;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x2013;&#x5B89;&#x5FBD;&#x829C;&#x6E56;&#x4E00;&#x4E2D;&#xB7;&#x5468;&#x6E90;</a><br>&#x5728;VJ&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/135311#overview" target="_blank" rel="noopener">Here</a>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x62C9;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#x6574;&#x5408;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;G,K,R&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x3002;&#x3002;&#x3002;R&#x9898;&#x597D;&#x50CF;&#x8FD8;&#x662F;2014 World Final&#x7684;&#x9898;&#x554A;&#x3002;<br><a id="more"></a></p>
<h5 id="f"><a href="#F" class="headerlink" title="F"></a>F</h5><p>F&#x9898;&#x548C;N&#x9898;&#x91CD;&#x590D;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<p>[HDU 3669]&#xFF1A;&#x7ED9;&#x51FA;$n\leq 5*10^4$&#x4E2A;&#x77E9;&#x5F62;&#x7684;&#x957F;&#x548C;&#x5BBD;&#xFF0C;&#x8981;&#x6C42;&#x628A;&#x8FD9;&#x4E9B;&#x77E9;&#x5F62;&#x6700;&#x591A;&#x5206;&#x6210;$K$&#x7EC4;&#xFF0C;&#x6BCF;&#x7EC4;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x6240;&#x6709;&#x8FD9;&#x7EC4;&#x77E9;&#x5F62;&#x7684;&#x6700;&#x5927;&#x5BBD;&#x4E58;&#x4EE5;&#x6700;&#x5927;&#x957F;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>&#x5148;&#x628A;&#x77E9;&#x5F62;&#x6309;&#x7167;&#x4F18;&#x5148;&#x5BBD;&#x5EA6;&#xFF1A;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#xFF0C;&#x5176;&#x6B21;&#x9AD8;&#x5EA6;&#xFF1A;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x7684;&#x987A;&#x5E8F;&#x6392;&#x5E8F;&#xFF0C;&#x5176;&#x6B21;&#x8981;&#x6CE8;&#x610F;&#x5230;&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#x7684;&#x5BBD;&#x548C;&#x957F;&#x90FD;&#x6BD4;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#x5C0F;&#xFF0C;&#x90A3;&#x4E2A;&#x8FD9;&#x4E2A;&#x77E9;&#x5F62;&#x5C31;&#x662F;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x77E9;&#x5F62;&#x7B5B;&#x9009;&#x51FA;&#x7684;&#x77E9;&#x5F62;&#x5E8F;&#x5217;&#x6EE1;&#x8DB3;&#x8FD9;&#x6837;&#x6027;&#x8D28;&#xFF1A;&#x5BBD;&#x9012;&#x51CF;&#x5E76;&#x4E14;&#x957F;&#x9012;&#x589E;&#x3002;</p>
<p>&#x7528;$dp[i][k]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x4E2A;&#x77E9;&#x5F62;&#x5206;&#x6210;$k$&#x7EC4;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF1A;<br>$$<br>dp[i][k]=min(dp[j][k-1]+rec[j+1].w*rec[i].h) \quad (j&lt; i)<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x][p-1]-dp[y][p-1]}{rec[y+1].w-rec[x+1].w}\leq rec[i].h<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> Q[MAX_N];</span><br><span class="line">ll dp[MAX_N][MAX_K];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rec</span> {</span></span><br><span class="line">	<span class="keyword">int</span> w, h;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Rec&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">if</span> (w != rhs.w) <span class="keyword">return</span> w &gt; rhs.w;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> h &gt; rhs.h;</span><br><span class="line">	}</span><br><span class="line">} read[MAX_N], rec[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x][id] - dp[y][id];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> rec[y + <span class="number">1</span>].w - rec[x + <span class="number">1</span>].w;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) { </span><br><span class="line">		dp[i][<span class="number">1</span>] = <span class="number">1l</span>l * rec[<span class="number">1</span>].w * rec[i].h; </span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">2</span>; k &lt;= K; ++k) {</span><br><span class="line">		head = tail = <span class="number">0</span>;</span><br><span class="line">		Q[++tail] = k - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, Q[head + <span class="number">1</span>], Q[head]) </span><br><span class="line">					&lt;= S(Q[head + <span class="number">1</span>], Q[head]) * rec[i].h) ++head;</span><br><span class="line">			<span class="keyword">int</span> t = Q[head];</span><br><span class="line">			dp[i][k] = dp[t][k - <span class="number">1</span>] + <span class="number">1l</span>l * rec[t + <span class="number">1</span>].w * rec[i].h;</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail])</span><br><span class="line">					&gt;= G(k - <span class="number">1</span>, i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) --tail;</span><br><span class="line">			Q[++tail] = i;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	ll ans = (ll)(<span class="number">1e18</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; ++i) {</span><br><span class="line">		ans = min(ans, dp[n][i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;K)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;read[i].w, &amp;read[i].h);</span><br><span class="line">		}</span><br><span class="line">		sort(read, read + n);</span><br><span class="line">		<span class="keyword">int</span> MaxH = <span class="number">0</span>, total = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="keyword">if</span> (read[i].h &gt; MaxH) {</span><br><span class="line">				rec[++total].w = read[i].w;</span><br><span class="line">				rec[total].h = read[i].h;</span><br><span class="line">				MaxH = read[i].h;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		n = total;</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="h-&#x5355;&#x8C03;&#x961F;&#x5217;"><a href="#H-&#x5355;&#x8C03;&#x961F;&#x5217;" class="headerlink" title="H (&#x5355;&#x8C03;&#x961F;&#x5217;)"></a>H (&#x5355;&#x8C03;&#x961F;&#x5217;)</h5><p>[POJ 3401]:&#x5DF2;&#x77E5;$n\leq 2000$&#x5929;&#x6BCF;&#x5929;&#x4E70;&#x5356;&#x4E00;&#x5F20;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;&#x548C;&#x4E70;&#x5356;&#x4E0A;&#x9650;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x5929;&#x53EA;&#x80FD;&#x9009;&#x62E9;&#x4E70;&#x6216;&#x8005;&#x5356;&#x6216;&#x8005;&#x4E0D;&#x4EA4;&#x6613;&#xFF0C;&#x800C;&#x4E14;&#x4E24;&#x6B21;&#x4EA4;&#x6613;&#x65E5;&#x671F;&#x4E2D;&#x95F4;&#x81F3;&#x5C11;&#x8981;&#x95F4;&#x9694;$W$&#x5929;&#xFF0C;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x6301;&#x6709;$Max$&#x5F20;&#x80A1;&#x7968;&#x3002;&#x521D;&#x59CB;&#x65F6;&#x6709;&#x65E0;&#x9650;&#x91CF;&#x7684;&#x94B1;&#xFF0C;&#x6C42;&#x6700;&#x7EC8;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x83B7;&#x5229;&#x591A;&#x5C11;&#xFF1F;</p>
<p>&#x7528;$dp[i][j]$&#x8868;&#x793A;&#x5728;&#x7B2C;$i$&#x5929;&#x62E5;&#x6709;$j$&#x5F20;&#x80A1;&#x7968;&#x65F6;&#x7684;&#x6700;&#x591A;&#x83B7;&#x5229;&#x3002;</p>
<ul>
<li><p>&#x7B2C;$i$&#x5929;&#x4E0D;&#x4E70;&#x4E0D;&#x5356;<br>$$dp[i][j]=dp[i - 1][j]$$</p>
</li>
<li><p>&#x7B2C;$i$&#x5929;&#x4E70;&#x80A1;&#x7968;<br>$$dp[i][j]=max(dp[r][k]-cost[i]*(j-k))\quad (r\leq i - W - 1,k&lt; j)$$</p>
</li>
<li><p>&#x7B2C;$i$&#x5929;&#x5356;&#x80A1;&#x7968;<br>$$dp[i][j]=max(dp[r][k]+value[i]*(k-j))\quad (r\leq i - W - 1,k&gt; j)$$</p>
</li>
</ul>
<p>&#x8003;&#x8651;&#x5B9E;&#x9645;&#x610F;&#x4E49;&#x4E0A;&#x9762;&#x5F0F;&#x5B50;&#x4E2D;&#x7684;$r$&#x5C31;&#x5E94;&#x8BE5;&#x662F;$i-W-1$&#x3002;&#x628A;&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x6539;&#x5199;&#x4E00;&#x4E0B;&#xFF1A;<br>$$<br>dp[i][j]=(dp[i-W-1][k]+buy[i]*k)-buy[i]*j (k&lt; j)<br>$$<br>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x524D;&#x9762;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x6C42;&#x524D;&#x7F00;&#x6700;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528;&#x5355;&#x8C03;&#x961F;&#x5217;&#x6765;&#x4FDD;&#x5B58;&#x524D;&#x7F00;&#x6700;&#x5927;&#x3002;&#x5BF9;&#x4E8E;&#x4E70;&#x80A1;&#x7968;&#x7684;&#x884C;&#x4E3A;&#x540C;&#x6837;&#x8FD9;&#x6837;&#x5B50;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;$k&gt;j$&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5012;&#x7740;&#x5904;&#x7406;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">2010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, Max, W, head, tail;</span><br><span class="line"><span class="keyword">int</span> cost[MAX_N], value[MAX_N], buy[MAX_N], sell[MAX_N];</span><br><span class="line"><span class="comment">// cost &#x548C; value: &#x4E70;&#x5356;&#x5355;&#x4EF7;&#xFF0C; buy &#x548C; sell: &#x4E70;&#x5356;&#x4E0A;&#x9650;</span></span><br><span class="line"><span class="keyword">int</span> dp[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Que</span> {</span></span><br><span class="line">	<span class="keyword">int</span> num, sum;</span><br><span class="line">	<span class="comment">// num&#xFF1A; &#x80A1;&#x7968;&#x6570;&#x91CF; sum: &#x5DF2;&#x7ECF;&#x83B7;&#x5229;&#x91CF;</span></span><br><span class="line">	Que() {}</span><br><span class="line">	Que(<span class="keyword">int</span> _num, <span class="keyword">int</span> _sum): num(_num), sum(_sum) {}</span><br><span class="line">} que[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="built_in">memset</span>(dp[i], <span class="number">-0x3f</span>, <span class="keyword">sizeof</span> (dp[i]));</span><br><span class="line">	<span class="comment">// &#x9884;&#x5904;&#x7406;&#x524D; W &#x5929;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= buy[<span class="number">0</span>]; ++j) { dp[<span class="number">0</span>][j] = -j * cost[<span class="number">0</span>]; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= W; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= Max; ++j) {</span><br><span class="line">			dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">			<span class="keyword">if</span> (j &lt;= buy[i]) dp[i][j] = max(dp[i][j], -j * cost[i]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = W + <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">		head = tail = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= Max; ++j) {</span><br><span class="line">			dp[i][j] = dp[i - <span class="number">1</span>][j]; <span class="comment">// &#x4E0D;&#x4E70;&#x4E0D;&#x5356;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">// &#x4E70;</span></span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[tail - <span class="number">1</span>].sum &lt; dp[i - W - <span class="number">1</span>][j] + j * cost[i]) {</span><br><span class="line">				tail--;</span><br><span class="line">			}</span><br><span class="line">			que[tail++] = Que(j, dp[i - W - <span class="number">1</span>][j] + j * cost[i]);</span><br><span class="line">			<span class="comment">// &#x4FDD;&#x8BC1;&#x4E70;&#x7684;&#x6570;&#x91CF;&#x4E0D;&#x8D85;&#x8FC7;&#x4E0A;&#x9650;</span></span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; j - que[head].num &gt; buy[i]) head++;</span><br><span class="line">			dp[i][j] = max(dp[i][j], que[head].sum - j * cost[i]);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		head = tail = <span class="number">0</span>; <span class="comment">// &#x5356;</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = Max; j &gt;= <span class="number">0</span>; --j) {</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[tail - <span class="number">1</span>].sum &lt; dp[i - W - <span class="number">1</span>][j] + j * value[i]) {</span><br><span class="line">				tail--;</span><br><span class="line">			}</span><br><span class="line">			que[tail++] = Que(j, dp[i - W - <span class="number">1</span>][j] + j * value[i]);</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[head].num - j &gt; sell[i]) head++;</span><br><span class="line">			dp[i][j] = max(dp[i][j], que[head].sum - j * value[i]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Max; ++i) {</span><br><span class="line">		ans = max(ans, dp[n - <span class="number">1</span>][i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;Max, &amp;W);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;cost[i], &amp;value[i], &amp;buy[i], &amp;sell[i]);</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="i"><a href="#I" class="headerlink" title="I"></a>I</h5><p>[POJ 2018]&#xFF1A;&#x548C;A&#x9898;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> sum[x] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> x - y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = <span class="number">0</span>, tail = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> pos = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(pos, Q[tail] * S(pos, Q[tail - <span class="number">1</span>]) </span><br><span class="line">			&lt;= G(pos, Q[tail - <span class="number">1</span>]) * S(pos, Q[tail]))) --tail;</span><br><span class="line">		Q[++tail] = pos;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(i, Q[head]) * S(i, Q[head + <span class="number">1</span>]) </span><br><span class="line">			&lt;= G(i, Q[head + <span class="number">1</span>]) * S(i, Q[head])) ++head;</span><br><span class="line"></span><br><span class="line">		dp[i] = <span class="number">1.0</span> * G(i, Q[head]) / S(i , Q[head]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		ans = max(ans, dp[i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (<span class="keyword">int</span>)(ans * <span class="number">1000</span>));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="j"><a href="#J" class="headerlink" title="J"></a>J</h5><p>&#x548C;M&#x9898;&#x91CD;&#x590D;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<p>[POJ 1260]:&#x9700;&#x8981;&#x8D2D;&#x4E70;$n\leq 100$&#x4E2A;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x7ED9;&#x51FA;&#x6BCF;&#x79CD;&#x73CD;&#x73E0;&#x7684;&#x8D2D;&#x4E70;&#x6570;&#x91CF;&#x548C;&#x5355;&#x4EF7;&#xFF0C;&#x9AD8;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x5355;&#x4EF7;&#x8981;&#x5927;&#x4E8E;&#x4F4E;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x5355;&#x4EF7;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x9AD8;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#x4EE3;&#x66FF;&#x4F4E;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x4F46;&#x6570;&#x91CF;&#x8981;&#x4E00;&#x81F4;&#x3002;&#x5982;&#x679C;&#x8D2D;&#x4E70;&#x4E86;&#x4E00;&#x4E2A;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x4E0D;&#x8BBA;&#x6570;&#x91CF;&#x591A;&#x5C11;&#xFF0C;&#x9700;&#x8981;&#x989D;&#x5916;&#x591A;&#x4ED8;10&#x4E2A;&#x8BE5;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x91D1;&#x94B1;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;&#x4F4E;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#x4E0D;&#x4F1A;&#x88AB;&#x8DF3;&#x7EA7;&#x201C;&#x4EE3;&#x4E3A;&#x8D2D;&#x4E70;&#x201D;&#x3002;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=min(dp[j]+(sum[i]-sum[j])*cost[i])<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x]-dp[y]}{sum[x]-sum[y]}\leq cost[i]<br>$$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> sum[x] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;= </span><br><span class="line">					cost[i] * S(Q[head + <span class="number">1</span>], Q[head])) ++head;</span><br><span class="line">		dp[i] = dp[Q[head]] + (sum[i] - sum[Q[head]] + <span class="number">10</span>) * cost[i];</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail])</span><br><span class="line">			&gt;= G(i, Q[tail]) * S(Q[tail], Q[tail  - <span class="number">1</span>])) --tail;</span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">		sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;num[i], &amp;cost[i]);</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + num[i];</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="l"><a href="#L" class="headerlink" title="L"></a>L</h5><p>&#x8FD9;&#x9898;&#x5176;&#x5B9E;&#x662F;&#x4E2A;BFS&#xFF0C;&#x62C9;&#x9519;&#x9898;&#x4E86;&#x3002;&#x3002;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x526A;&#x679D;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">110</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>] = {{<span class="number">-1</span>, <span class="number">0</span>}, {<span class="number">1</span>, <span class="number">0</span>}, {<span class="number">0</span>, <span class="number">-1</span>}, {<span class="number">0</span>, <span class="number">1</span>}};</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m, limit, sx, sy, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> s[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">int</span> see[MAX_N][MAX_N], dis[MAX_N][MAX_N], vis[MAX_N][MAX_N];</span><br><span class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; state[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> {</span></span><br><span class="line">	<span class="keyword">int</span> x, y, step;</span><br><span class="line">	<span class="keyword">int</span> flag1, flag2;</span><br><span class="line"></span><br><span class="line">	Node() {}</span><br><span class="line">	Node(<span class="keyword">int</span> _x, <span class="keyword">int</span> _y, <span class="keyword">int</span> _step, <span class="keyword">int</span> _flag1, <span class="keyword">int</span> _flag2): </span><br><span class="line">		x(_x), y(_y), step(_step), flag1(_flag1), flag2(_flag2) {}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="built_in">queue</span>&lt;Node&gt; Q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span>&amp; value, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (s[x][y] == <span class="string">&apos;.&apos;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (s[x][y] == <span class="string">&apos;D&apos;</span>) {</span><br><span class="line">		value += <span class="number">1</span>;</span><br><span class="line">	} <span class="keyword">else</span> <span class="keyword">if</span> (s[x][y] == <span class="string">&apos;E&apos;</span>) {</span><br><span class="line">		value += <span class="number">2</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetSee</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">memset</span>(see, <span class="number">0</span>, <span class="keyword">sizeof</span> (see));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (s[i][j] == <span class="string">&apos;D&apos;</span> || s[i][j] == <span class="string">&apos;E&apos;</span> || s[i][j] == <span class="string">&apos;X&apos;</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">int</span> find = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = j + <span class="number">1</span>; k &lt; m; ++k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, i, k)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = j - <span class="number">1</span>; k &gt;= <span class="number">0</span>; --k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, i, k)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i - <span class="number">1</span>; k &gt;= <span class="number">0</span>; --k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, k, j)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i + <span class="number">1</span>; k &lt; n; ++k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, k, j)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			see[i][j] = find;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (see[sx][sy] == <span class="number">3</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> (dis));</span><br><span class="line">	<span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> (vis));</span><br><span class="line">	<span class="keyword">while</span> (!Q.empty()) Q.pop();</span><br><span class="line">	state[sx][sy].first = (see[sx][sy] == <span class="number">1</span> || see[sx][sy] == <span class="number">3</span>);</span><br><span class="line">	state[sx][sy].second = (see[sx][sy] &gt;= <span class="number">2</span>);</span><br><span class="line">	Q.push(Node(sx, sy, <span class="number">0</span>, see[sx][sy] == <span class="number">1</span> || see[sx][sy] == <span class="number">3</span>, see[sx][sy] &gt;= <span class="number">2</span>));</span><br><span class="line">	<span class="keyword">while</span> (!Q.empty()) {</span><br><span class="line">		Node cur = Q.front();</span><br><span class="line">		Q.pop();</span><br><span class="line">		<span class="keyword">int</span> x = cur.x, y = cur.y, step = cur.step, f1 = cur.flag1, f2 = cur.flag2;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) {</span><br><span class="line">			<span class="keyword">int</span> nxtx = x + dir[i][<span class="number">0</span>], nxty = y + dir[i][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span> (nxtx &lt; <span class="number">0</span> || nxtx &gt;= n || nxty &lt; <span class="number">0</span> || nxty &gt;= m) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (s[nxtx][nxty] != <span class="string">&apos;.&apos;</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">int</span> nxtf1 = (f1 || see[nxtx][nxty] == <span class="number">1</span> || see[nxtx][nxty] == <span class="number">3</span>);</span><br><span class="line">			<span class="keyword">int</span> nxtf2 = (f2 || see[nxtx][nxty] &gt;= <span class="number">2</span>);</span><br><span class="line">			<span class="keyword">if</span> (vis[nxtx][nxty]) {</span><br><span class="line">				<span class="keyword">if</span> (!(nxtf1 &gt; state[nxtx][nxty].first || nxtf2 &gt; state[nxtx][nxty].second)) {</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			state[nxtx][nxty].first = nxtf1;</span><br><span class="line">			state[nxtx][nxty].second = nxtf2;</span><br><span class="line">			vis[nxtx][nxty] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (nxtf1 &amp;&amp; nxtf2) {</span><br><span class="line">				dis[nxtx][nxty] = step + <span class="number">1</span>;</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> (step + <span class="number">1</span> &lt; limit) {</span><br><span class="line">				Q.push(Node(nxtx, nxty, step + <span class="number">1</span>, nxtf1, nxtf2));</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> ans = inf;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			ans = min(ans, dis[i][j]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (ans &gt; limit) ans = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;limit);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i]);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">				<span class="keyword">if</span> (s[i][j] == <span class="string">&apos;S&apos;</span>) {</span><br><span class="line">					sx = i, sy = j;</span><br><span class="line">				}</span><br><span class="line">				state[i][j].first = state[i][j].second = <span class="number">0</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		GetSee();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Case %d:\n%d\n&quot;</span>, ++cases, bfs());</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="q"><a href="#Q" class="headerlink" title="Q"></a>Q</h5><p>[UVA 12594]&#xFF1A;&#x5148;&#x7ED9;&#x51FA;26&#x4E2A;&#x5B57;&#x6BCD;&#x7684;&#x4E00;&#x79CD;&#x5168;&#x6392;&#x5217;&#xFF0C;&#x518D;&#x7ED9;&#x51FA;&#x957F;&#x5EA6;&#x4E3A;$n\leq 20000$&#x7684;&#x5B57;&#x6BCD;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8981;&#x6C42;&#x5C06;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x5206;&#x6210;$K$&#x6BB5;&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;$p$&#x6BB5;&#x7684;&#x7B2C;$i$&#x4E2A;&#x5B57;&#x7B26;&#x4ECE;&#x5B83;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x4EF7;&#x503C;&#x662F;$(i-pos[s[i]])*pos[s[i]]$&#xFF0C;&#x5176;&#x4E2D;$pos[s[i]]$&#x8868;&#x793A;$s[i]$&#x8FD9;&#x4E2A;&#x5B57;&#x6BCD;&#x5728;&#x7ED9;&#x51FA;&#x7684;&#x6392;&#x5217;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4F4D;&#x7F6E;&#x4E0B;&#x6807;&#x4ECE;0&#x5F00;&#x59CB;&#x3002;&#x6C42;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x5C0F;&#x4EF7;&#x503C;&#xFF1F;</p>
<p>&#x8BBE;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x4E0B;&#x6807;&#x4ECE;1&#x5F00;&#x59CB;&#xFF0C;&#x521D;&#x59CB;&#x5316;$ans=-\sum_{i=1}^{i=n}{pos[s[i]]*pos[s[i]]}$&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x9700;&#x8981;&#x8BA1;&#x7B97;$i*pos[s[i]]$&#x90E8;&#x5206;&#x4E86;&#xFF0C;&#x8BB0;&#xFF1A;<br>$$<br>pre[i]=\sum_{r=1}^{r=i}{pos[s[i]]} \\<br>sum[i]=\sum_{r=1}^{r=i}{(i-1)*pos[s[i]]}<br>$$<br>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i][p]=dp[j][p-1]+sum[i]-sum[j]-(pre[i]-pre[j])*j<br>$$<br>&#x4EE4;$G(x)=dp[x][k]-sum[x]+pre[x]*x$&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{x-y}\leq pre[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">20010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_K = <span class="number">510</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, K, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> head[MAX_K], tail[MAX_K];</span><br><span class="line"><span class="keyword">int</span> pos[<span class="number">30</span>], Q[MAX_K][MAX_N];</span><br><span class="line"><span class="keyword">char</span> s1[<span class="number">30</span>], s2[MAX_N];</span><br><span class="line">ll ans, dp[MAX_K][MAX_N], sum[MAX_N], pre[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[id][x] - sum[x] + pre[x] * x - (dp[id][y] - sum[y] + pre[y] * y);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> x - y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= K; ++i) {</span><br><span class="line">		head[i] = tail[i] = Q[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memset</span>(dp[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (dp[<span class="number">0</span>]));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = min(i, K); k &gt;= <span class="number">1</span>; --k) {</span><br><span class="line">			<span class="keyword">while</span> (head[k - <span class="number">1</span>] &lt; tail[k - <span class="number">1</span>] &amp;&amp; G(k - <span class="number">1</span>, Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>] + <span class="number">1</span>], Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]])</span><br><span class="line">					&lt;= S(Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>] + <span class="number">1</span>], Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]]) * pre[i]) head[k - <span class="number">1</span>]++;</span><br><span class="line">			<span class="keyword">int</span> t = Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]];</span><br><span class="line">			dp[k][i] = dp[k - <span class="number">1</span>][t] + sum[i] - sum[t] - (pre[i] - pre[t]) * t;</span><br><span class="line">			<span class="keyword">while</span> (head[k] &lt; tail[k] &amp;&amp; G(k, i, Q[k][tail[k]]) * S(Q[k][tail[k]], Q[k][tail[k] - <span class="number">1</span>])</span><br><span class="line">				    &lt;= S(i, Q[k][tail[k]]) * G(k, Q[k][tail[k]], Q[k][tail[k] - <span class="number">1</span>])) tail[k]--;</span><br><span class="line">			Q[k][++tail[k]] = i;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	ans += dp[K][n];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Case %d: %lld\n&quot;</span>, ++cases, ans);</span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, s1, &amp;K);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s2 + <span class="number">1</span>);</span><br><span class="line">		n = <span class="built_in">strlen</span>(s2 + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) {</span><br><span class="line">			pos[s1[i] - <span class="string">&apos;a&apos;</span>] = i;</span><br><span class="line">		}</span><br><span class="line">		sum[<span class="number">0</span>] = pre[<span class="number">0</span>] = ans =  <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> t = pos[s2[i] - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">			pre[i] = pre[i - <span class="number">1</span>] + t;</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + (i - <span class="number">1</span>) * t;</span><br><span class="line">			ans -= t * t;</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">斜率优化（一）</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p><a href="http://wenku.baidu.com/view/ef259400bed5b9f3f90f1c3a.html" target="_blank" rel="noopener">&#x7528;&#x5355;&#x8C03;&#x6027;&#x4F18;&#x5316;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x2013;JSOI2009 &#x96C6;&#x8BAD;&#x961F;&#x8BBA;&#x6587;</a><br><a href="http://wenku.baidu.com/view/f6421ce8b8f67c1cfad6b8ac.html" target="_blank" rel="noopener">&#x6D45;&#x8C08;&#x6570;&#x5F62;&#x7ED3;&#x5408;&#x5728;&#x4FE1;&#x606F;&#x5B66;&#x7ADE;&#x8D5B;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x2013;&#x5B89;&#x5FBD;&#x829C;&#x6E56;&#x4E00;&#x4E2D;&#xB7;&#x5468;&#x6E90;</a><br>&#x5728;VJ&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/135311#overview" target="_blank" rel="noopener">Here</a>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x62C9;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#x6574;&#x5408;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;G,K,R&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x3002;&#x3002;&#x3002;R&#x9898;&#x597D;&#x50CF;&#x8FD8;&#x662F;2014 World Final&#x7684;&#x9898;&#x554A;&#x3002;<br><a id="more"></a></p>
<h5 id="a"><a href="#A" class="headerlink" title="A"></a>A</h5><p>[HDU 2993]:&#x7ED9;$n\leq 10^5$&#x4E2A;&#x6B63;&#x6574;&#x6570;&#xFF0C;&#x6C42;&#x957F;&#x5EA6;&#x4E0D;&#x5C11;&#x4E8E;$k$&#x7684;&#x6700;&#x5927;&#x5B50;&#x533A;&#x95F4;&#x5E73;&#x5747;&#x503C;&#x3002;</p>
<p>&#x7528;$dp[i]$&#x8868;&#x793A;&#x4EE5;$i$&#x4F4D;&#x7F6E;&#x7ED3;&#x5C3E;&#x7684;&#x957F;&#x5EA6;&#x4E0D;&#x5C11;&#x4E8E;$k$&#x7684;&#x6700;&#x5927;&#x5B50;&#x533A;&#x95F4;&#x5E73;&#x5747;&#x503C;&#xFF0C;$sum[i]$&#x8868;&#x793A;&#x524D;&#x7F00;&#x548C;&#x3002;<br>$$<br>dp[i]=max(\frac{sum[i]-sum[j]}{i-j}) \quad (j\leq i - k)<br>$$</p>
<p>&#x8FD9;&#x9898;&#x9700;&#x8981;&#x7528;&#x975E;&#x5E38;&#x201C;&#x7F8E;&#x5999;&#x201D;&#x7684;&#x5FEB;&#x8BFB;&#x624D;&#x80FD;&#x8FC7;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> data[MAX_N], sum[MAX_N], Q[MAX_N];</span><br><span class="line"><span class="keyword">double</span> dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FastIO</span> {</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> S = <span class="number">1000000</span>;</span><br><span class="line">	<span class="keyword">int</span> wpos, pos, len;</span><br><span class="line">	<span class="keyword">char</span> wbuf[S];</span><br><span class="line">	FastIO():wpos(<span class="number">0</span>){}</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">xchar</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">char</span> buf[S];</span><br><span class="line">		<span class="keyword">if</span> (pos == len) pos = <span class="number">0</span>, len = fread(buf, <span class="number">1</span>, S, <span class="built_in">stdin</span>);</span><br><span class="line">		<span class="keyword">if</span> (pos == len) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">return</span> buf[pos++];</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">xint</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">int</span> c = xchar(), x = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (c &lt;= <span class="number">32</span> &amp;&amp; ~c) c = xchar();</span><br><span class="line">		<span class="keyword">if</span> (c == <span class="number">-1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">for</span> (; c &gt;= <span class="string">&apos;0&apos;</span> &amp;&amp; c &lt;= <span class="string">&apos;9&apos;</span>; c = xchar()) x = x * <span class="number">10</span> + (c - <span class="string">&apos;0&apos;</span>);</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	}</span><br><span class="line">} io;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt;= eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1.0</span> * (sum[b] - sum[a]) / (b - a);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> j = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; sgn(slope(Q[tail], j) - slope(Q[tail - <span class="number">1</span>], Q[tail])) &lt;= <span class="number">0</span>) tail--;</span><br><span class="line">		Q[++tail] = j;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; sgn(slope(Q[head], Q[head + <span class="number">1</span>]) - slope(Q[head + <span class="number">1</span>], i)) &lt;= <span class="number">0</span>) head++;</span><br><span class="line">		dp[i] = slope(Q[head], i);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		ans = max(ans, dp[i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span>(;;) {</span><br><span class="line">		n = io.xint(); K = io.xint();</span><br><span class="line">	<span class="comment">//	scanf(&quot;%d%d&quot;, &amp;n, &amp;K);</span></span><br><span class="line">		<span class="keyword">if</span> (n == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">		sum[<span class="number">0</span>] = data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			data[i] = io.xint();</span><br><span class="line">	<span class="comment">//		scanf(&quot;%d&quot;, &amp;data[i]);</span></span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + data[i];</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="b"><a href="#B" class="headerlink" title="B"></a>B</h5><p>[HDU 3045]:&#x5C06;$n\leq 4*10^5$&#x5934;&#x725B;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x7EC4;&#xFF0C;&#x6BCF;&#x7EC4;&#x81F3;&#x5C11;$K$&#x5934;&#x725B;&#xFF0C;&#x6BCF;&#x7EC4;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x6BCF;&#x5934;&#x725B;&#x7684;&#x6743;&#x503C;&#x51CF;&#x53BB;&#x8FD9;&#x7EC4;&#x6700;&#x5C0F;&#x6743;&#x503C;&#x4E4B;&#x548C;&#xFF0C;&#x6C42;&#x5C06;$n$&#x5934;&#x725B;&#x5206;&#x7EC4;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>&#x5148;&#x6392;&#x5E8F;&#x3002;&#x7528;$dp[i]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x5934;&#x725B;&#x89E3;&#x51B3;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF0C;$sum[i]$&#x8868;&#x793A;&#x524D;&#x7F00;&#x548C;&#x3002;<br>$$<br>dp[i]=min(dp[j]+sum[i]-sum[j]-(i-j)*data[j+1])\quad (j\leq i-K)<br>$$<br>&#x4EE4;$G(x)=dp[x]-sum[x]+x*data[x+1]$&#xFF0C;&#x8F6C;&#x5316;&#x4E00;&#x4E0B;&#x53EF;&#x5F97;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{data[x+1]-data[y+1]} \leq i<br>$$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> Q[MAX_N];</span><br><span class="line">ll data[MAX_N], sum[MAX_N], dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - sum[x] + data[x + <span class="number">1</span>] * x - (dp[y] - sum[y] + data[y + <span class="number">1</span>] * y);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> data[x + <span class="number">1</span>] - data[y + <span class="number">1</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = <span class="number">0</span>, tail = <span class="number">-1</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; K; ++i) { dp[i] = <span class="number">0</span>; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> jj = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(jj, Q[tail]) &gt;= G(jj, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) tail--;</span><br><span class="line">		<span class="keyword">if</span> (jj &gt;= K) Q[++tail] = jj;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt; S(Q[head + <span class="number">1</span>], Q[head]) * i) head++;</span><br><span class="line">		dp[i] = dp[Q[head]] + sum[i] - sum[Q[head]] - (i - Q[head]) * data[Q[head] + <span class="number">1</span>];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;K)) {</span><br><span class="line">		sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;data[i]);</span><br><span class="line">		}</span><br><span class="line">		sort(data + <span class="number">1</span>, data + n + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + data[i];</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="c"><a href="#C" class="headerlink" title="C"></a>C</h5><p>[POJ 1180]:&#x6709;$n\leq 10^4$&#x4EF6;&#x5546;&#x54C1;&#x9700;&#x8981;&#x52A0;&#x5DE5;&#xFF0C;&#x6BCF;&#x4EF6;&#x5546;&#x54C1;&#x6709;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;$O(i)$&#x548C;$F(i)$&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x8FDE;&#x7EED;&#x7684;&#x4E00;&#x4E9B;&#x5546;&#x54C1;&#x770B;&#x6210;&#x4E00;&#x7EC4;&#x4E00;&#x8D77;&#x52A0;&#x5DE5;&#xFF0C;&#x6BCF;&#x52A0;&#x5DE5;&#x4E00;&#x7EC4;&#x9700;&#x8981;$S$&#x7684;&#x65F6;&#x95F4;&#x8D77;&#x52A8;&#x673A;&#x5668;&#xFF0C;&#x5047;&#x8BBE;&#x5728;&#x65F6;&#x523B;$t$&#x5F00;&#x59CB;&#x52A0;&#x5DE5;&#x4ECE;$i\sim j$&#x7684;&#x5546;&#x54C1;&#xFF0C;&#x90A3;&#x4E48;&#x52A0;&#x5DE5;&#x5B8C;&#x8FD9;&#x4E9B;&#x5546;&#x54C1;&#x7684;&#x8017;&#x65F6;&#x662F;&#xFF1A;$t+S+\sum_{r=i}^{r=j}{O(r)}=t+T$&#xFF0C;&#x9700;&#x8981;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#xFF1A;$(t+T)*\sum_{r=i}^{r=j}{F(r)}$,&#x5E76;&#x4E14;&#x4E0B;&#x4E00;&#x7EC4;&#x7684;&#x5F00;&#x59CB;&#x65F6;&#x523B;&#x662F;$t+T$&#xFF0C;&#x521D;&#x59CB;&#x65F6;&#x523B;&#x662F;0&#x3002;&#x6C42;&#x52A0;&#x5DE5;&#x5B8C;&#x8FD9;&#x4E9B;&#x5546;&#x54C1;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF1F;</p>
<p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6BCF;&#x52A0;&#x5DE5;&#x5B8C;&#x4E00;&#x7EC4;&#x5546;&#x54C1;&#x7684;&#x8FD9;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#xFF1A;$T=S+\sum_{r=i}^{r=j}{O(r)}$&#x5BF9;&#x4E8E;&#x540E;&#x9762;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x90FD;&#x662F;&#x6709;&#x5F71;&#x54CD;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x628A;&#x8FD9;&#x90E8;&#x5206;&#x5F71;&#x54CD;&#x8BA1;&#x7B97;&#x7D2F;&#x52A0;&#xFF0C;&#x5F71;&#x54CD;&#x662F;&#xFF1A;<br>$$T*\sum_{r=i+1}^{n}{F(r)}=T*fsum(j)$$<br>&#x4E8E;&#x662F;&#x7528;$dp[j]$&#x8868;&#x793A;&#x52A0;&#x5DE5;&#x5B8C;$j\sim n$&#x5546;&#x54C1;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF0C;$tsum[i]$&#x548C;$fsum[i]$&#x8868;&#x793A;&#x5206;&#x522B;$O[]$&#x548C;$F[]$&#x7684;&#x540E;&#x7F00;&#x548C;&#x3002;<br>$$<br>dp[i]=min(dp[j]+(S+tsum[i]-tsum[j])*fsum[i])\quad (i&lt; j\leq n)<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x]-dp[y]}{tsum[x]-tsum[y]}\leq fsum[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> tsum[x] - tsum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = n + <span class="number">1</span>;</span><br><span class="line">	dp[n + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;=</span><br><span class="line">				fsum[i] * S(Q[head + <span class="number">1</span>], Q[head])) ++head;</span><br><span class="line">		dp[i] = dp[Q[head]] + (tsum[i] - tsum[Q[head]] + s) * fsum[i];</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail]) &gt; </span><br><span class="line">				G(i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) --tail;</span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[<span class="number">1</span>]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="d"><a href="#D" class="headerlink" title="D"></a>D</h5><p>[POJ 3709]:&#x5C06;$n\leq 5*10^5$&#x4E2A;&#x6570;&#xFF0C;&#x53D8;&#x6210;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#xFF1A;&#x628A;&#x8FDE;&#x7EED;&#x76F8;&#x540C;&#x7684;&#x6570;&#x5B57;&#x770B;&#x6210;&#x4E00;&#x6BB5;&#xFF0C;&#x6BCF;&#x6BB5;&#x5185;&#x6570;&#x5B57;&#x4E2A;&#x6570;&#x4E0D;&#x5C11;&#x4E8E;$k$&#x4E2A;&#x3002;&#x5E76;&#x4E14;&#x6BCF;&#x4E2A;&#x6570;&#x5B57;&#x53EA;&#x80FD;&#x53D8;&#x5C0F;&#xFF0C;&#x53D8;&#x5316;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x53D8;&#x5316;&#x524D;&#x540E;&#x6570;&#x5B57;&#x4E4B;&#x5DEE;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>&#x56E0;&#x4E3A;&#x6570;&#x5B57;&#x53EA;&#x80FD;&#x53D8;&#x5C0F;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x7B80;&#x5355;&#x4E86;&#x8BB8;&#x591A;&#x3002;&#x7528;$sum[i]$&#x8868;&#x793A;&#x524D;&#x7F00;&#x548C;&#xFF0C;$dp[i]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x4E2A;&#x6570;&#x89E3;&#x51B3;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x3002;<br>$$dp[i]=min(dp[j]+sum[i]-sum[j]-(i-j)*data[i+1])\quad (j\leq i - k)$$<br>&#x4EE4;$G(x)=dp[x]-sum[x]+x*data[x+1]$&#xFF0C;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{data[x+1]-data[y+1]} \leq i<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - sum[x] + data[x + <span class="number">1</span>] * x - (dp[y] - sum[y] + data[y + <span class="number">1</span>] * y);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> data[x + <span class="number">1</span>] - data[y + <span class="number">1</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; K; ++i) { dp[i] = INF; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> pos = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(pos, Q[tail]) </span><br><span class="line">			&gt;= S(Q[tail], Q[tail - <span class="number">1</span>]) * G(pos, Q[tail])) tail--;</span><br><span class="line">		<span class="keyword">if</span> (pos &gt;= K) Q[++tail] = pos;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;= S(Q[head + <span class="number">1</span>], Q[head]) * i) ++head;</span><br><span class="line">		dp[i] = dp[Q[head]] + (sum[i] - sum[Q[head]] - (i - Q[head]) * data[Q[head] + <span class="number">1</span>]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="e"><a href="#E" class="headerlink" title="E"></a>E</h5><p>[POJ 3709]&#xFF1A;&#x5C06;$n\leq 5*10^5$&#x4E2A;&#x5355;&#x8BCD;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x884C;&#xFF0C;&#x5982;&#x679C;$i\sim j$&#x5355;&#x8BCD;&#x5728;&#x540C;&#x4E00;&#x884C;&#x5219;&#x4EE3;&#x4EF7;&#x4E3A;&#xFF1A;${(\sum_{r=i}^{r=j}{C[r]})}^{2}+m$&#xFF0C;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>$dp$&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=min(dp[j]+{(sum[i]-sum[j])}^{2}+m) \quad (j &lt; i)<br>$$<br>&#x4EE4;$G(x)=dp[x]+sum[x]*sum[x]$&#xFF0C;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{2*(sum[x]-sum[y])}\leq sum[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y] + sum[x] * sum[x] - sum[y] * sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">2</span> * (sum[x] - sum[y]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;= S(Q[head + <span class="number">1</span>], Q[head]) * sum[i]) head++;</span><br><span class="line">		dp[i] = dp[Q[head]] + (sum[i]  - sum[Q[head]]) * (sum[i] - sum[Q[head]]) + m;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail]) &gt;= G(i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) tail--;</span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>



  <nav class="pagination clearfix">
  <ul>
    
    <span class="page-number current">1</span><a class="page-number" href="/categories/齐东语/page/2/">2</a><a class="extend next" rel="next" href="/categories/齐东语/page/2/"><i class="fa fa-chevron-circle-right" aria-hidden="true"></i></a>
  </ul>
</nav>

</section>
    <footer id="footer" role="contentinfo">
    <div>&copy; 2018 <a href="/">瀚清</a>.
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Designed by <a href="http://rainylog.com" target="_blank">Rainy.</a>
	</div>
</footer><!-- end #footer -->

  </div>
  <script src="/lib/fancybox/dist/jquery.fancybox.min.js"></script>

  <script src="/js/helper.js"></script>
  <script src="/js/_third-party/gitment.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
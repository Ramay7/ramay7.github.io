<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>category: 思无涯 | 瀚清</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="瀚清">
<meta property="og:url" content="http://yoursite.com/categories/思无涯/page/2/index.html">
<meta property="og:site_name" content="瀚清">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="瀚清">
  
    <link rel="alternate" href="/atom.xml" title="瀚清" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/lib/jquery/dist/jquery.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
  
  
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="wrapper">
    <header id="header" class="clearfix">
	<a id="logo" href="/" title="瀚清">瀚清</a>
	
	<nav id="nav-menu" class="clearfix">
		<form id="search" method="post" action="./" role="search">
			<input id="search-input" type="text" name="s" class="inputbox" value="搜索" onfocus="if (value =='搜索'){value =''}" onblur="if (value ==''){value='搜索'}">
		</form>
		<ul>
      
				
        <li><a class="main-nav-link" href="/">主页</a></li>
      
				
        <li><a class="main-nav-link" href="/archives">归档</a></li>
      
		</ul>
	</nav>
</header>
    <section id="main" class="clearfix">
  <article class="post-detail">
    <h1 class="post-title"><a href="/">2016ICPC 沈阳 E,I 搜索，斜率dp</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>e_e<br><a id="more"></a></p>
<h4 id="e"><a href="#E" class="headerlink" title="E"></a>E</h4><h5 id="&#x9898;&#x76EE;&#x94FE;&#x63A5;"><a href="#&#x9898;&#x76EE;&#x94FE;&#x63A5;" class="headerlink" title="&#x9898;&#x76EE;&#x94FE;&#x63A5;"></a>&#x9898;&#x76EE;&#x94FE;&#x63A5;</h5><p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5952" target="_blank" rel="noopener">HDU 5952</a></p>
<h5 id="&#x9898;&#x610F;"><a href="#&#x9898;&#x610F;" class="headerlink" title="&#x9898;&#x610F;"></a>&#x9898;&#x610F;</h5><p>&#x7ED9;$n\leq 100$&#x4E2A;&#x70B9;&#x548C;$m\leq 1000$&#x6761;&#x8FB9;&#x7684;&#x65E0;&#x5411;&#x56FE;&#xFF0C;&#x4ECE;&#x4E2D;&#x627E;&#x5230;&#x56E2;&#x5927;&#x5C0F;&#x4E3A;$S\in [2,10]$&#x7684;&#x56E2;&#x6570;&#x91CF;&#x3002;&#x4E00;&#x4E2A;&#x56E2;&#x662F;&#x56FE;&#x4E2D;&#x4EFB;&#x610F;&#x4E24;&#x70B9;&#x4E4B;&#x95F4;&#x90FD;&#x6709;&#x4E00;&#x6761;&#x8FB9;&#x7684;&#x56FE;&#xFF0C;&#x56E2;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x56E2;&#x4E2D;&#x70B9;&#x7684;&#x4E2A;&#x6570;&#x3002;&#x8F93;&#x5165;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x70B9;&#x7684;&#x5EA6;&#x4E0D;&#x8D85;&#x8FC7;20&#x3002;</p>
<h5 id="&#x5206;&#x6790;"><a href="#&#x5206;&#x6790;" class="headerlink" title="&#x5206;&#x6790;"></a>&#x5206;&#x6790;</h5><p>&#x4E00;&#x5F00;&#x59CB;&#x5EFA;&#x65E0;&#x5411;&#x56FE;&#xFF0C;&#x8DD1;&#x7206;&#x641C;TLE&#xFF0C;&#x7136;&#x540E;&#x679A;&#x4E3E;&#x56E2;&#x7684;&#x5927;&#x5C0F;$i:1\sim S$,&#x4E0D;&#x65AD;&#x6269;&#x5927;&#x56E2;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x7528;$vector$&#x5B58;&#x9009;&#x62E9;&#x65B9;&#x6848;&#xFF0C;&#x6700;&#x540E;$vec[S].size()$&#x5C31;&#x662F;&#x7B54;&#x6848;&#xFF0C;&#x7136;&#x800C;MLE:(</p>
<p>&#x6700;&#x5173;&#x952E;&#x7684;&#x662F;&#xFF1A;<strong>&#x5EFA;&#x6709;&#x5411;&#x56FE;&#xFF0C;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x56E2;&#x53EA;&#x4F1A;&#x88AB;&#x904D;&#x5386;&#x4E00;&#x6B21;&#x3002;</strong>&#x63A5;&#x4E0B;&#x6765;&#x76F4;&#x63A5;&#x679A;&#x4E3E;&#x56E2;&#x7684;&#x201C;&#x8D77;&#x70B9;&#x201D;&#xFF0C;&#x7206;&#x641C;&#xFF0C;&#x7528;&#x6570;&#x7EC4;&#x8BB0;&#x5F55;&#x5DF2;&#x7ECF;&#x9009;&#x62E9;&#x70B9;&#xFF0C;&#x6BCF;&#x6B21;&#x65B0;&#x6DFB;&#x52A0;&#x70B9;&#x7684;&#x65F6;&#x5019;&#x5224;&#x65AD;&#x65B0;&#x52A0;&#x70B9;&#x80FD;&#x5426;&#x548C;&#x5DF2;&#x9009;&#x7684;&#x70B9;&#x90FD;&#x6709;&#x8FB9;&#xFF0C;&#x76F4;&#x5230;&#x56E2;&#x7684;&#x5927;&#x5C0F;&#x4E3A;$S$&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(100*C_{20}^{9})$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">110</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m, S;</span><br><span class="line"><span class="keyword">int</span> degree[MAX_N], link[MAX_N][MAX_N], can[MAX_N];</span><br><span class="line">ll ans;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; edge[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> sum)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (sum == S) {</span><br><span class="line">        ans++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; edge[u].size(); ++i) {</span><br><span class="line">        <span class="keyword">int</span> v = edge[u][i], flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= sum; ++j) {</span><br><span class="line">            <span class="keyword">if</span> (link[v][can[j]] == <span class="number">0</span>) {</span><br><span class="line">                flag = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            can[sum + <span class="number">1</span>] = v;</span><br><span class="line">            dfs(v, sum + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">    ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (degree[i] &lt; S - <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        can[<span class="number">1</span>] = i;</span><br><span class="line">        dfs(i, <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;S);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) edge[i].clear();</span><br><span class="line">        <span class="built_in">memset</span>(link, <span class="number">0</span>, <span class="keyword">sizeof</span> (link));</span><br><span class="line">        <span class="built_in">memset</span>(degree, <span class="number">0</span>, <span class="keyword">sizeof</span> (degree));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">            <span class="keyword">int</span> u, v;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">            <span class="keyword">if</span> (link[u][v]) <span class="keyword">continue</span>;</span><br><span class="line">            degree[u]++;</span><br><span class="line">            link[u][v] = link[v][u] = <span class="number">1</span>;</span><br><span class="line">            edge[u].push_back(v);</span><br><span class="line">        }</span><br><span class="line">        solve();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="i"><a href="#I" class="headerlink" title="I"></a>I</h4><h5 id="&#x9898;&#x76EE;&#x94FE;&#x63A5;"><a href="#&#x9898;&#x76EE;&#x94FE;&#x63A5;-1" class="headerlink" title="&#x9898;&#x76EE;&#x94FE;&#x63A5;"></a>&#x9898;&#x76EE;&#x94FE;&#x63A5;</h5><p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5956" target="_blank" rel="noopener">HDU 5956</a></p>
<h5 id="&#x9898;&#x610F;"><a href="#&#x9898;&#x610F;-1" class="headerlink" title="&#x9898;&#x610F;"></a>&#x9898;&#x610F;</h5><p>&#x7ED9;&#x4E00;&#x4E2A;$n\leq 100000$&#x4E2A;&#x7ED3;&#x70B9;&#x7684;&#x6709;&#x6839;&#x6811;&#xFF0C;&#x6839;&#x8282;&#x70B9;&#x4E3A;1&#x3002;&#x8FB9;&#x6743;$\leq 100$&#x3002;&#x5C06;&#x9898;&#x610F;&#x8F6C;&#x5316;&#x4E00;&#x4E0B;&#x53EF;&#x5F97;&#xFF1A;$dp[1]=-P,dp[i]=\min (dp[j]+dis(i,j)^2)+P$&#xFF0C;&#x5176;&#x4E2D;$P$&#x662F;&#x7ED9;&#x5B9A;&#x7684;&#x5E38;&#x6570;$P\leq 10^6,j$&#x662F;$i$&#x7684;&#x7956;&#x5148;&#x3002;&#x6C42;$\max(dp[i])$&#x3002;</p>
<h5 id="&#x5206;&#x6790;"><a href="#&#x5206;&#x6790;-1" class="headerlink" title="&#x5206;&#x6790;"></a>&#x5206;&#x6790;</h5><p>&#x4E0A;&#x9762;&#x7684;&#x9898;&#x610F;&#x8F6C;&#x5316;&#x548C;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x9898;&#x610F;&#x7684;&#x4F18;&#x70B9;&#x5728;&#x4E8E;&#x53EF;&#x4EE5;&#x4ECE;&#x6839;dfs&#x5904;&#x7406;&#xFF0C;&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;&#x7956;&#x5148;&#x3002;</p>
<p>&#x5B9A;&#x4E49;$dis[i]$&#x662F;&#x7ED3;&#x70B9;$i$&#x5230;&#x6839;&#x8282;&#x70B9;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>\begin{aligned}<br>dp[i]&amp;=\min(dp[j]+(dis[j]-dis[i])^2)+P \\<br>&amp;=\min(dp[j]+dis[j]^2-2*dis[j]*dis[i])+dis[i]^2+P<br>\end{aligned}<br>$$<br>&#x8003;&#x8651;&#x659C;&#x7387;&#x4F18;&#x5316;&#x3002;&#x5047;&#x8BBE;$k$&#x5904;&#x51B3;&#x7B56;&#x4F18;&#x4E8E;$j$&#x5904;&#x51B3;&#x7B56;&#xFF0C;&#x4E14;$dis[k]&gt;dis[j]$&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>\begin{aligned}<br>dis[k]^2-2*dis[k]*dis[i]+dp[k] &lt; dis[j]^2-2*dis[j]*dis[i]+dp[j]\\<br>\frac{(dis[k]^2+dp[k])-(dis[j]^2+dp[j])}{2*(dis[k]-dis[j])} &lt; dis[i]<br>\end{aligned}<br>$$<br>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x663E;&#x7136;&#x7684;&#x659C;&#x7387;&#x4F18;&#x5316;&#x7684;&#x5F0F;&#x5B50;&#x4E86;&#x3002;&#x5269;&#x4E0B;&#x7684;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#xFF0C;&#x5C31;&#x662F;dfs&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5220;&#x70B9;&#x548C;&#x8FD8;&#x539F;&#x70B9;&#x95EE;&#x9898;&#x3002;&#x6211;&#x662F;&#x6BCF;&#x5C42;&#x7528;&#x4E24;&#x4E2A;vector&#x4FDD;&#x5B58;&#x4E00;&#x4E0B;&#x961F;&#x5217;&#x9996;&#x548C;&#x961F;&#x5217;&#x5C3E;&#x5220;&#x9664;&#x7684;&#x70B9;&#xFF0C;dfs&#x7ED3;&#x675F;&#x540E;&#x518D;&#x8FD8;&#x539F;&#x56DE;&#x6765;&#xFF0C;&#x6574;&#x4F53;&#x601D;&#x8DEF;&#x6BD4;&#x8F83;&#x66B4;&#x529B;&#xFF0C;&#x65F6;&#x9650;4000ms&#xFF0C;&#x8DD1;&#x4E86;1500ms&#x3002;</p>
<p>&#x6B63;&#x89E3;&#x662F;&#xFF1A;&#x6811;&#x5206;&#x6CBB;+&#x659C;&#x7387;&#x4F18;&#x5316;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> ll INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, P, tot, head, tail;</span><br><span class="line"><span class="keyword">int</span> Head[MAX_N], Q[MAX_N], dis[MAX_N];</span><br><span class="line">ll dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> {</span></span><br><span class="line">	<span class="keyword">int</span> v, w, next;</span><br><span class="line"></span><br><span class="line">	Edge() {}</span><br><span class="line">	Edge(<span class="keyword">int</span> _v, <span class="keyword">int</span> _w, <span class="keyword">int</span> _next): v(_v), w(_w), next(_next) {}</span><br><span class="line">} edge[MAX_N * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">memset</span>(Head, <span class="number">-1</span>, <span class="keyword">sizeof</span> (Head));</span><br><span class="line">	<span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> (dp));</span><br><span class="line">	tot = head = tail = <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>{</span><br><span class="line">	edge[tot] = Edge(v, w, Head[u]);</span><br><span class="line">	Head[u] = tot++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1l</span>l * dis[a] * dis[a] + dp[a] - (<span class="number">1l</span>l * dis[b] * dis[b] + dp[b]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">2l</span>l * (dis[a] - dis[b]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> p)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> tp1, tp2, id;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pre, suf;</span><br><span class="line">	tp1 = head, tp2 = tail;</span><br><span class="line">	<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;</span><br><span class="line">			 S(Q[head + <span class="number">1</span>], Q[head]) * dis[u]) {</span><br><span class="line">		pre.push_back(Q[head++]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (u != <span class="number">1</span>) {</span><br><span class="line">		id = Q[head];</span><br><span class="line">		dp[u] = min(dp[u], dp[id] + <span class="number">1l</span>l * (dis[u] - dis[id]) * (dis[u] - dis[id]) + P);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(u, Q[tail]) </span><br><span class="line">		&gt; G(u, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) {</span><br><span class="line">		suf.push_back(Q[tail--]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (u != <span class="number">1</span>) Q[++tail] = u;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = Head[u]; i != <span class="number">-1</span>; i = edge[i].next) {</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">		<span class="keyword">if</span> (v == p) <span class="keyword">continue</span>;</span><br><span class="line">		dis[v] = dis[u] + w;</span><br><span class="line">		dfs(v, u);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> size1 = pre.size(), size2 = suf.size();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size1; ++i) {</span><br><span class="line">		Q[tp1 + i] = pre[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size2; ++i) {</span><br><span class="line">		Q[tp2 - i] = suf[i];</span><br><span class="line">	}</span><br><span class="line">	head = tp1, tail = tp2;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		init();</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;P);</span><br><span class="line">		dp[<span class="number">1</span>] = -P, dis[<span class="number">1</span>] = <span class="number">0</span>, Q[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> u, v, w;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;u, &amp;v, &amp;w);</span><br><span class="line">			AddEdge(u, v, w);</span><br><span class="line">			AddEdge(v, u, w);</span><br><span class="line">		}</span><br><span class="line">		dfs(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">		ll ans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			ans = max(ans, dp[i]);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">hihoCoder 1384 2016北京网赛B 倍增、贪心</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x7ED9;&#x51FA;$n\leq 3*10^5$&#x4E2A;&#x6570;$p_1,p_2,&#x2026;,p_n(p_{i}\leq 2^{20})$, &#x8981;&#x628A;&#x8FD9;$n$&#x4E2A;&#x6570;&#x5212;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x6BB5;(&#x6BCF;&#x6BB5;&#x90FD;&#x662F;&#x8FDE;&#x7EED;&#x7684;), &#x6BCF;&#x6BB5;&#x7684;&#x4EE3;&#x4EF7;&#x8FD9;&#x4E48;&#x8BA1;&#x7B97;: &#x4ECE;&#x6BCF;&#x6BB5;&#x4E2D;&#x9009;&#x51FA;$m$(&#x4E0D;&#x591F;$m$&#x5BF9;&#x7684;&#x8BDD;, &#x9009;&#x51FA;&#x6700;&#x591A;&#x7684;&#x5BF9;&#x6570;)&#x5BF9;&#x6570;,&#x8BA1;&#x7B97;&#x6BCF;&#x5BF9;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x503C;,&#xFF0C;&#x7136;&#x540E;&#x6C42;&#x5E73;&#x65B9;&#x548C;&#xFF0C;&#x4EE3;&#x4EF7;&#x662F;&#x6240;&#x6709;&#x9009;&#x6CD5;&#x7684;&#x5E73;&#x65B9;&#x548C;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x8BB0;&#x4E3A;$SPD$&#x3002;&#x6C42;&#x6700;&#x5C11;&#x7684;&#x5212;&#x5206;&#x6BB5;&#x6570;&#xFF0C;&#xFF0C;&#x4F7F;&#x5F97;&#x6BCF;&#x6BB5;&#x7684;SPDSPD&#x90FD;&#x4E0D;&#x5927;&#x4E8E;$K\leq 10^{18}$&#x3002;<br><a id="more"></a><br>&#x53C2;&#x8003;<a href="https://async.icpc-camp.org/d/565-2016-icpc" target="_blank" rel="noopener">Camp&#x7684;&#x9898;&#x89E3;</a>&#xFF1A;<br>&#x5BF9;&#x4E8E;&#x56FA;&#x5B9A;&#x7684;&#x4E00;&#x6BB5;&#x6570;&#xFF0C;&#x663E;&#x7136;&#x6392;&#x5E8F;&#x540E;&#x4ECE;&#x4E24;&#x8FB9;&#x4E00;&#x5BF9;&#x4E00;&#x5BF9;&#x5339;&#x914D;&#x80FD;&#x8BA9;&#x4EE3;&#x4EF7;&#x6700;&#x5927;&#xFF0C;&#x8BBE;$w(l,r)$&#x4E3A;$[l,r]$&#x8FD9;&#x6BB5;&#x533A;&#x95F4;&#x7684;&#x4EE3;&#x4EF7;&#xFF0C;&#x663E;&#x7136;&#x6709;$w(l+1,r) \le w(l, r), w(l , r - 1) \le w(l , r)$&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x8D2A;&#x5FC3;&#x3002;<br>&#x56FA;&#x5B9A;&#x5DE6;&#x7AEF;&#x70B9;$l$&#x540E;&#x6BCF;&#x6B21;&#x9009;&#x6EE1;&#x8DB3;$w(l , r) \le K$&#x7684;&#x6700;&#x5927;&#x7684; $r$&#x3002;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x600E;&#x4E48;&#x7B97;&#x8FD9;&#x4E2A;$r$&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x8BA1;&#x7B97;&#x51FA;&#x6EE1;&#x8DB3;$w(l , l+2^k - 1) \le k$&#x7684;&#x6700;&#x5927;&#x7684;$k$&#xFF0C;&#x7136;&#x540E;&#x5728;$[l+2^k-1 , l+2^{k+1})$&#x8FD9;&#x4E2A;&#x533A;&#x95F4;&#x91CC;&#x4E8C;&#x5206;$r$&#x5373;&#x53EF;&#x3002;<br>&#x7B97;&#x4E00;&#x6B21;$w(l,r)$&#x66B4;&#x529B;&#x662F;$O(w \log w)$&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x96BE;&#x8BC1;&#x660E;&#x8FD9;&#x6837;&#x505A;&#x590D;&#x6742;&#x5EA6;&#x4E3A;$O(n \log^2 n)$&#x3002;</p>
<p>&#x6280;&#x5DE7;&#x5904;&#x7406;&#xFF1A;&#x5728;$[low, high]$&#x533A;&#x95F4;&#x4E8C;&#x5206;&#x7B54;&#x6848;&#x65F6;&#xFF0C;&#x5148;&#x5C06;$[i, high]$&#x533A;&#x95F4;&#x6240;&#x6709;&#x6570;&#x6392;&#x5E8F;&#xFF0C;&#x6BCF;&#x6B21;&#x9A8C;&#x8BC1;$[i,x]$&#x662F;&#x5426;&#x53EF;&#x884C;&#x65F6;&#xFF0C;&#x5224;&#x65AD;&#x6570;&#x5B57;&#x7684;$id$&#x662F;&#x5426;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;$x$&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">500010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m;</span><br><span class="line">ll K, data[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Store</span> {</span></span><br><span class="line">	ll data;</span><br><span class="line">	<span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Store&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">if</span> (data != rhs.data) <span class="keyword">return</span> data &lt; rhs.data;</span><br><span class="line">		<span class="keyword">return</span> id &lt; rhs.id;</span><br><span class="line">	}</span><br><span class="line">} store[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetStore</span><span class="params">(<span class="keyword">int</span> st, <span class="keyword">int</span> ed)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = st; i &lt;= ed; ++i) {</span><br><span class="line">		store[tot].data = data[i];</span><br><span class="line">		store[tot++].id = i;</span><br><span class="line">	}</span><br><span class="line">	sort(store, store + tot);</span><br><span class="line">	<span class="keyword">return</span> tot;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check1</span><span class="params">(<span class="keyword">int</span> st, <span class="keyword">int</span> ed)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> tot = GetStore(st, ed);</span><br><span class="line">	ll sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = tot - <span class="number">1</span>; i &lt; m &amp;&amp; i &lt; j; ++i, --j) {</span><br><span class="line">		ll tmp = store[j].data - store[i].data;</span><br><span class="line">		sum += tmp * tmp;</span><br><span class="line">		<span class="keyword">if</span> (sum &gt; K) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> tot)</span> </span>{</span><br><span class="line">	ll sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = tot - <span class="number">1</span>, cnt = <span class="number">0</span>; i &lt; j; ) {</span><br><span class="line">		<span class="keyword">while</span> (i &lt; j &amp;&amp; store[i].id &gt; x) ++i;</span><br><span class="line">		<span class="keyword">while</span> (i &lt; j &amp;&amp; store[j].id &gt; x) --j;</span><br><span class="line">		<span class="keyword">if</span> (i &gt;= j) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		ll tmp = store[j].data - store[i].data;</span><br><span class="line">		sum += tmp * tmp;</span><br><span class="line">		++cnt, ++i, --j;</span><br><span class="line">		<span class="keyword">if</span> (sum &gt; K) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (cnt == m) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, last; i &lt;= n; i = last + <span class="number">1</span>) {</span><br><span class="line">		<span class="keyword">int</span> limit = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= n; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (!check1(i, i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">			limit = j;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">int</span> low = i + (<span class="number">1</span> &lt;&lt; (limit)) - <span class="number">1</span>, high = i + (<span class="number">1</span> &lt;&lt; (limit + <span class="number">1</span>)) - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (high &gt; n) high = n;</span><br><span class="line">		<span class="keyword">int</span> tot = GetStore(i, high);</span><br><span class="line">		last = low;</span><br><span class="line">		<span class="keyword">while</span> (low &lt;= high) {</span><br><span class="line">			<span class="keyword">int</span> mid = (low + high) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (check2(mid, tot)) low = mid + <span class="number">1</span>, last = mid;</span><br><span class="line">			<span class="keyword">else</span> high = mid - <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line"><span class="comment">//		printf(&quot;i = %d last = %d\n&quot;, i, last);</span></span><br><span class="line">		ans++;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%lld&quot;</span>, &amp;n, &amp;m, &amp;K);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;data[i]);</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">hihoCoder 1387 2016 北京网赛E LCA、树上同种颜色结点直径</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>$n\leq 5*10^5$&#x4E2A;&#x7ED3;&#x70B9;&#x7684;&#x6811;&#xFF0C;&#x6BCF;&#x4E2A;&#x7ED3;&#x70B9;&#x7528;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E0D;&#x8D85;&#x8FC7;10&#x7684;&#x5C0F;&#x5199;&#x82F1;&#x6587;&#x5B57;&#x7B26;&#x4E32;&#x6807;&#x8BC6;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x6210;&#x4E00;&#x79CD;&#x989C;&#x8272;&#xFF0C; &#x6709;$Q\leq 10^5$&#x6B21;&#x8BE2;&#x95EE;&#xFF0C;&#x6BCF;&#x6B21;&#x8BE2;&#x95EE;&#x6811;&#x4E0A;&#x4E24;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF08;&#x4E24;&#x79CD;&#x989C;&#x8272;&#xFF09;&#x7684;&#x8DEF;&#x5F84;&#x7684;&#x6700;&#x957F;&#x8DDD;&#x79BB;&#xFF1F;<br><a id="more"></a><br>&#x5148;&#x901A;&#x8FC7;RMQ&#x4EE5;$O(n\log n)$&#x7684;&#x590D;&#x6742;&#x5EA6;&#x9884;&#x5904;&#x7406;&#xFF0C;&#x4EE5;&#x4FBF;$O(1)$&#x67E5;&#x8BE2;&#x6811;&#x4E0A;&#x4E24;&#x70B9;&#x7684;&#x6700;&#x8FDC;&#x8DDD;&#x79BB;&#xFF0C;&#x7136;&#x540E;&#x7528;$diamter[i]$&#x8BB0;&#x5F55;&#x989C;&#x8272;$i$&#x7684;&#x6811;&#x4E0A;&#x76F4;&#x5F84;&#x7684;&#x4E24;&#x7AEF;&#x70B9;&#xFF0C;$O(n)$&#x626B;&#x4E00;&#x904D;&#x3002;&#x5BF9;&#x4E8E;&#x67E5;&#x8BE2;&#x989C;&#x8272;$i$&#x548C;$j$&#x7684;&#x6811;&#x4E0A;&#x6700;&#x957F;&#x8DEF;&#x5F84;&#xFF0C;&#x5047;&#x8BBE;$i$&#x548C;$j$&#x540C;&#x79CD;&#x989C;&#x8272;&#x7684;&#x76F4;&#x5F84;&#x7684;&#x4E24;&#x7AEF;&#x70B9;&#x5206;&#x522B;&#x4E3A;$(a,b)$&#x548C;$(c,d)$&#xFF0C;&#x90A3;&#x4E48;&#xFF1A;<br>$$<br>Ans=\max (\max(dis(a,c),dis(a,d)),\max(dis(b,c),dis(b,d)));<br>$$<br>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n\log n + Q)$</p>
<p>&#x6CE8;&#x610F;C++&#x5173;&#x95ED;&#x540C;&#x6B65;&#x540E;&#xFF0C;cin/cout&#x548C;scanf/printf&#x4E0D;&#x80FD;&#x6DF7;&#x7528;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">510000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Q, tot, edge_num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> head[MAX_N], dis[MAX_N], id[MAX_N];</span><br><span class="line"><span class="keyword">int</span> depth[MAX_N * <span class="number">2</span>], vis[MAX_N * <span class="number">2</span>], dp[MAX_N * <span class="number">2</span>][<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; diameter[MAX_N];</span><br><span class="line"><span class="built_in">string</span> name[MAX_N];</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> {</span></span><br><span class="line">	<span class="keyword">int</span> v, next;</span><br><span class="line">} edge[MAX_N * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>{</span><br><span class="line">	edge[edge_num].v = v;</span><br><span class="line">	edge[edge_num].next = head[u];</span><br><span class="line">	head[u] = edge_num++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> p, <span class="keyword">int</span> d, <span class="keyword">int</span>&amp; k)</span> </span>{</span><br><span class="line">	vis[k] = u, id[u] = k;</span><br><span class="line">	depth[k++] = d;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i != <span class="number">-1</span>; i = edge[i].next) {</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">		<span class="keyword">if</span> (v == p) <span class="keyword">continue</span>;</span><br><span class="line">		dis[v] = dis[u] + <span class="number">1</span>;</span><br><span class="line">		dfs(v, u, d + <span class="number">1</span>, k);</span><br><span class="line">		vis[k] = u;</span><br><span class="line">		depth[k++] = d;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RMQ</span><span class="params">(<span class="keyword">int</span> root)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">	dfs(root, <span class="number">-1</span>, <span class="number">0</span>, k);</span><br><span class="line">	<span class="keyword">int</span> m = k;</span><br><span class="line">	<span class="keyword">int</span> e = (<span class="keyword">int</span>)log2(m + <span class="number">1.0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) { dp[i][<span class="number">0</span>] = i; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= e; ++j) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt; m; ++i) {</span><br><span class="line">			<span class="keyword">int</span> nxt = i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>));</span><br><span class="line">			<span class="keyword">if</span>(depth[dp[i][j - <span class="number">1</span>]] &lt; depth[dp[nxt][j - <span class="number">1</span>]]) {</span><br><span class="line">				dp[i][j] = dp[i][j - <span class="number">1</span>];</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				dp[i][j] = dp[nxt][j - <span class="number">1</span>];</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">GetDis</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> left = min(id[u], id[v]), right = max(id[u], id[v]);</span><br><span class="line">	<span class="keyword">int</span> k = (<span class="keyword">int</span>)log2(right - left + <span class="number">1.0</span>);</span><br><span class="line">	<span class="keyword">int</span> pos, nxt = right - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (depth[dp[left][k]] &lt; depth[dp[nxt][k]]) {</span><br><span class="line">		pos = dp[left][k];</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		pos = dp[nxt][k];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> dis[u] + dis[v] - <span class="number">2</span> * dis[vis[pos]]; </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">	RMQ(<span class="number">1</span>);</span><br><span class="line">	<span class="comment">// &#x540C;&#x79CD;&#x989C;&#x8272;&#x76F4;&#x5F84;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> be = mp[name[i]];</span><br><span class="line">		<span class="keyword">if</span> (diameter[be].first == <span class="number">0</span>) {</span><br><span class="line">			diameter[be] = make_pair(i, i);</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="keyword">int</span> a = diameter[be].first, b = diameter[be].second;</span><br><span class="line">			<span class="keyword">int</span> len = GetDis(a, b), len1 = GetDis(a, i), len2 = GetDis(b, i);</span><br><span class="line">			<span class="keyword">if</span> (len1 &gt; len) {</span><br><span class="line">				len = len1;</span><br><span class="line">				diameter[be] = make_pair(a, i);</span><br><span class="line">			} </span><br><span class="line">			<span class="keyword">if</span> (len2 &gt; len) {</span><br><span class="line">				diameter[be] = make_pair(b, i);</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">while</span> (Q--) {</span><br><span class="line">		<span class="built_in">string</span> s1, s2;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">		<span class="keyword">if</span> (mp.find(s1) == mp.end() || mp.find(s2) == mp.end()) {</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="keyword">int</span> x = mp[s1], y = mp[s2];</span><br><span class="line">			<span class="keyword">int</span> a = diameter[x].first, b = diameter[x].second;</span><br><span class="line">			<span class="keyword">int</span> c = diameter[y].first, d = diameter[y].second;</span><br><span class="line">			<span class="keyword">int</span> ans = max(GetDis(a, c), GetDis(a, d));</span><br><span class="line">			ans = max(ans, max(GetDis(b, c), GetDis(b, d)));</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; ans + <span class="number">1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">	mp.clear();</span><br><span class="line">	edge_num = tot = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) {</span><br><span class="line">		head[i] = <span class="number">-1</span>;</span><br><span class="line">		dis[i] = <span class="number">0</span>;</span><br><span class="line">		diameter[i] = make_pair(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	ios_base::sync_with_stdio(<span class="number">0</span>); <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; Q) {</span><br><span class="line">		init();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; name[i];</span><br><span class="line">			<span class="keyword">if</span> (mp.find(name[i]) == mp.end()) {</span><br><span class="line">				mp[name[i]] = ++tot;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> u, v;</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v;</span><br><span class="line">			AddEdge(u, v);</span><br><span class="line">			AddEdge(v, u);</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">Codeforces 396C dfs序+树状数组</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x7ED9;&#x4E00;&#x4E2A;$n\leq 3*10^5$&#x4E2A;&#x7ED3;&#x70B9;&#xFF0C;&#x6839;&#x4E3A;1&#x7684;&#x6811;&#x3002;&#x521D;&#x59CB;&#x65F6;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x503C;&#x5747;&#x4E3A;0&#xFF0C;&#x6709;$Q\leq 3*10^5$&#x79CD;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li>$1\quad v\quad x\quad  k:$&#x5BF9;&#x4E8E;&#x4EE5;$v$&#x4E3A;&#x6839;&#x7684;&#x5B50;&#x6811;&#xFF0C;&#x5982;&#x679C;&#x7ED3;&#x70B9;$i$&#x5230;$v$&#x7684;&#x8DDD;&#x79BB;&#x4E3A;$dis$&#xFF0C;&#x90A3;&#x4E48;$i$&#x7684;&#x6743;&#x503C;&#x5C06;&#x589E;&#x52A0;$x-dis*k$&#xFF0C;&#x8DDD;&#x79BB;&#x5C31;&#x662F;&#x8DEF;&#x5F84;&#x4E0A;&#x8FB9;&#x7684;&#x6570;&#x91CF;&#xFF0C;$v$&#x7ED3;&#x70B9;&#x7684;&#x6743;&#x503C;&#x5C06;&#x589E;&#x52A0;$x$&#x3002;</li>
<li>$2\quad v:$&#x67E5;&#x8BE2;$v$&#x7ED3;&#x70B9;&#x7684;&#x6743;&#x503C;</li>
</ul>
<p>&#x5BF9;&#x4E8E;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x8F93;&#x51FA;&#x7B54;&#x6848;&#xFF0C;&#x7ED3;&#x679C;&#x6A21;$1e9+7$&#x3002;<br><a id="more"></a><br>&#x628A;&#x4EE5;$v$&#x4E3A;&#x6839;&#x7684;&#x5B50;&#x6811;&#x7ED3;&#x70B9;&#x8F6C;&#x5316;&#x6210;$dfs$&#x5E8F;&#xFF0C;&#x5E76;&#x4E14;&#x5F97;&#x5230;&#x6BCF;&#x4E2A;&#x7ED3;&#x70B9;&#x7684;&#x6DF1;&#x5EA6;$depth[v]$&#x3002;&#x7136;&#x540E;&#x5BF9;&#x4E8E;&#x6BCF;&#x6B21;&#x7B2C;1&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x4EE5;$v$&#x4E3A;&#x6839;&#x7684;&#x5B50;&#x6811;&#x4E0A;&#x7ED3;&#x70B9;$i$&#x76F8;&#x5F53;&#x4E8E;&#x6743;&#x503C;&#x589E;&#x52A0;&#x4E86;<br>$$<br>x-(depth[i]-depth[v])*k=x+depth[v]*k-depth[i]*k<br>$$<br>&#x4E5F;&#x5C31;&#x662F;&#x5BF9;&#x4E8E;$dfs$&#x5E8F;&#x4E0A;&#x7684;&#x533A;&#x95F4;$[left[v],right[v]]$&#x4E0A;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x7ED3;&#x70B9;$i$&#x90FD;&#x9700;&#x8981;&#x589E;&#x52A0;$x+depth[v]*k$&#xFF0C;&#x7136;&#x540E;&#x51CF;&#x6389;$depth[i]*k$&#xFF0C;&#x628A;&#x52A0;&#x51CF;&#x7684;&#x6743;&#x503C;&#x770B;&#x6210;&#x4E24;&#x9897;&#x6811;&#x72B6;&#x6570;&#x7EC4;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x533A;&#x95F4;&#x66F4;&#x65B0;&#xFF0C;&#x5355;&#x70B9;&#x67E5;&#x8BE2;&#xFF0C;&#x7EF4;&#x62A4;&#x4E00;&#x4E0B;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(Q*\log n)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">300010</span>;</span><br><span class="line"><span class="keyword">const</span> ll mod = (ll)(<span class="number">1e9</span>) + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, d = <span class="number">0</span>, Q;</span><br><span class="line"><span class="keyword">int</span> depth[MAX_N], left[MAX_N], right[MAX_N];</span><br><span class="line">ll add[MAX_N], sub[MAX_N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; son[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">	left[u] = ++d;</span><br><span class="line">	depth[u] = k;</span><br><span class="line">	<span class="keyword">int</span> size = son[u].size();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; ++i) {</span><br><span class="line">		dfs(son[u][i], k + <span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	right[u] = d;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{ <span class="keyword">return</span> x &amp; -x; }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(ll *bit, <span class="keyword">int</span> x, ll value)</span> </span>{</span><br><span class="line">	value %= mod;</span><br><span class="line">	<span class="keyword">if</span> (value &lt; <span class="number">0</span>) value += mod;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= n; i += lowbit(i)) {</span><br><span class="line">		bit[i] += value;</span><br><span class="line">		<span class="keyword">if</span> (bit[i] &gt;= mod) bit[i] -= mod;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(ll *bit, <span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">	ll ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &gt; <span class="number">0</span>; i -= lowbit(i)) {</span><br><span class="line">		ret += bit[i];</span><br><span class="line">		<span class="keyword">if</span> (ret &gt;= mod) ret -= mod;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> t;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">		son[t].push_back(i);</span><br><span class="line">	}</span><br><span class="line">	dfs(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;Q);</span><br><span class="line">	<span class="keyword">while</span> (Q--) {</span><br><span class="line">		<span class="keyword">int</span> type, id, x, k;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;type);</span><br><span class="line">		<span class="keyword">if</span> (type == <span class="number">1</span>) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;id, &amp;x, &amp;k);</span><br><span class="line">			ll value = <span class="number">1l</span>l * depth[id] * k % mod + x;</span><br><span class="line">			update(add, left[id], value);</span><br><span class="line">			update(add, right[id] + <span class="number">1</span>, -value);</span><br><span class="line">			update(sub, left[id], k);</span><br><span class="line">			update(sub, right[id] + <span class="number">1</span>, -k);</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;id);</span><br><span class="line">			ll ans = (query(add, left[id]) - query(sub, left[id]) * depth[id] % mod) % mod;</span><br><span class="line">			<span class="keyword">if</span> (ans &lt; <span class="number">0</span>) ans += mod;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">HDU 5550 2015CCPC K dp</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x6709;$n\leq 4000$&#x5C42;&#x697C;&#x623F;&#xFF0C;&#x6BCF;&#x5C42;&#x5404;&#x6709;$a_{i}$&#x548C;$b_{i}(a_{i},b_{i}\leq 10^{9})$&#x4E2A;&#x4EBA;&#x60F3;&#x6E38;&#x6CF3;&#x548C;&#x6253;&#x4E52;&#x4E53;&#x7403;&#xFF0C;&#x6BCF;&#x5C42;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x95F4;&#x4E00;&#x4E2A;&#x6CF3;&#x6C60;&#x6216;&#x8005;&#x4E00;&#x5F20;&#x4E52;&#x4E53;&#x7403;&#x684C;&#x3002;&#x6BCF;&#x4E2A;&#x4EBA;&#x4F1A;&#x627E;&#x6700;&#x8FD1;&#x7684;&#x697C;&#x5C42;&#x6EE1;&#x8DB3;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x4EE3;&#x4EF7;&#x662F;&#x884C;&#x8D70;&#x697C;&#x5C42;&#x5DEE;&#xFF0C;&#x6BCF;&#x4E2A;&#x6CF3;&#x6C60;&#x548C;&#x4E52;&#x4E53;&#x7403;&#x684C;&#x4E0D;&#x9650;&#x5BB9;&#x91CF;&#xFF0C;&#x540C;&#x4E00;&#x697C;&#x5C42;&#x4E0D;&#x9700;&#x8981;&#x8017;&#x8D39;&#x4EE3;&#x4EF7;&#x3002;&#x6240;&#x6709;&#x697C;&#x5C42;&#x4E2D;&#x5FC5;&#x987B;&#x81F3;&#x5C11;&#x5EFA;&#x9020;&#x4E00;&#x4E2A;&#x6CF3;&#x6C60;&#x6216;&#x8005;&#x4E52;&#x4E53;&#x7403;&#x684C;&#x3002;&#x6C42;&#x6EE1;&#x8DB3;&#x6240;&#x6709;&#x4EBA;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x3002;<br><a id="more"></a></p>
<p>&#x6BD4;&#x8D5B;&#x7684;&#x65F6;&#x5019;&#x5E76;&#x6CA1;&#x6709;&#x505A;&#x51FA;&#x6765;&#xFF0C;sadness&#x2026;&#x2026;</p>
<p>&#x7528;0&#x8868;&#x793A;&#x5EFA;&#x9020;&#x6CF3;&#x6C60;&#xFF0C;1&#x8868;&#x793A;&#x5EFA;&#x9020;&#x4E52;&#x4E53;&#x7403;&#x684C;&#x3002;&#x4E00;&#x5F00;&#x59CB;&#x662F;&#x60F3;&#x5B9A;&#x4E49;&#xFF1A;$dp[i][0]$&#x8868;&#x793A;&#x7B2C;$i$&#x5C42;&#x5EFA;&#x9020;&#x6CF3;&#x6C60;&#x65F6;&#x5C06;&#x524D;$i$&#x5C42;&#x6240;&#x6709;&#x4EBA;&#x5B89;&#x6392;&#x5B8C;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF0C;&#x7136;&#x540E;&#x679A;&#x4E3E;&#x4E0A;&#x4E00;&#x4E2A;&#x540C;&#x6837;&#x4E5F;&#x662F;&#x5EFA;&#x9020;&#x6CF3;&#x6C60;&#x7684;&#x697C;&#x5C42;&#x4F4D;&#x7F6E;$j$&#x8FDB;&#x884C;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#xFF0C;&#x8FD9;&#x6837;&#x5B50;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;$j\sim i$&#x4E4B;&#x95F4;&#x7684;&#x697C;&#x5C42;&#x90FD;&#x662F;&#x5EFA;&#x9020;&#x4E52;&#x4E53;&#x7403;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x79CD;&#x5B9A;&#x4E49;&#x662F;<strong>&#x5177;&#x6709;&#x540E;&#x6548;&#x6027;&#x7684;&#xFF01;&#xFF01;&#xFF01;</strong></p>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5B9A;&#x4E49;<strong>$dp[i][0]$&#x8868;&#x793A;&#x7B2C;$i$&#x5C42;&#x5EFA;&#x9020;&#x6CF3;&#x6C60;&#x5E76;&#x4E14;&#x7B2C;$i+1$&#x5C42;&#x5EFA;&#x9020;&#x4E52;&#x4E53;&#x7403;&#x684C;&#x65F6;&#x5B89;&#x6392;&#x5B8C;&#x524D;$i$&#x5C42;&#x6240;&#x6709;&#x4EBA;&#x7684;&#x4EE3;&#x4EF7;</strong>&#xFF0C;&#x8FD9;&#x6837;&#x5B9A;&#x4E49;&#x7684;&#x597D;&#x5904;&#x662F;&#x5728;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;<strong>&#x907F;&#x514D;&#x540E;&#x6548;&#x6027;&#xFF01;&#xFF01;&#xFF01;</strong></p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#xFF1A;&#x679A;&#x4E3E;&#x4E0A;&#x4E00;&#x4E2A;<strong>&#x5EFA;&#x9020;&#x4E52;&#x4E53;&#x7403;&#x684C;&#x7684;&#x697C;&#x5C42;</strong>&#xFF0C;&#x5373;$dp[j][1]$&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x4E8E;$(j,i)$&#x4E4B;&#x95F4;&#x7684;&#x697C;&#x5C42;&#xFF08;&#x5F00;&#x533A;&#x95F4;&#xFF09;&#x5168;&#x90E8;&#x90FD;&#x662F;&#x5EFA;&#x9020;&#x6CF3;&#x6C60;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;$dp[j][1]$&#x6070;&#x597D;&#x662F;&#x7B26;&#x5408;&#x5176;&#x5B9A;&#x4E49;&#x7684;&#xFF1A;&#x56E0;&#x4E3A;&#x7B2C;$j+1$&#x5C42;&#x5EFA;&#x9020;&#x7684;&#x201C;&#x76F8;&#x53CD;&#x7684;&#x201D;&#x8BBE;&#x65BD;&#x3002;&#x90A3;&#x4E48;&#x53EA;&#x9700;&#x8981;&#x8003;&#x8651;&#x5C06;&#x8FD9;&#x4E9B;&#x4EBA;&#x5B89;&#x6392;&#x7684;<strong>&#x6700;&#x8FD1;&#x7684;&#x4E52;&#x4E53;&#x7403;&#x684C;&#x7684;&#x697C;&#x5C42;</strong>&#x5373;&#x53EF;&#xFF1A;&#x4ECE;&#x4E2D;&#x95F4;&#x5206;&#x6210;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x90E8;&#x5206;&#x5411;&#x4E0A;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x90E8;&#x5206;&#x5411;&#x4E0B;&#x3002;&#x8003;&#x8651;&#x5230;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x4EE3;&#x4EF7;&#x548C;&#x697C;&#x5C42;&#x5DEE;&#x6709;&#x5173;&#xFF0C;&#x5982;&#x679C;&#x9010;&#x4E2A;&#x8BA1;&#x7B97;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x518D;&#x52A0;&#x4E00;&#x4E2A;$n$&#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x90A3;&#x4E48;&#x603B;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x5C31;&#x662F;$O(n^3)$&#x7684;&#x4E86;&#xFF0C;&#x663E;&#x7136;&#x4E0D;&#x884C;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x8003;&#x8651;&#x9884;&#x5904;&#x7406;&#x3002;&#x6682;&#x65F6;&#x53EA;&#x8003;&#x8651;&#x60F3;&#x6253;&#x4E52;&#x4E53;&#x7403;&#x7684;&#x4EBA;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5BF9;&#x4E8E;&#x60F3;&#x6E38;&#x6CF3;&#x7684;&#x4EBA;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x53EA;&#x9700;&#x518D;&#x52A0;&#x4E00;&#x7EF4;&#xFF0C;01&#x8868;&#x793A;&#x5C31;&#x884C;&#x4E86;&#x3002;&#x7528;$sum[i]$&#x8868;&#x793A;&#x4EBA;&#x6570;&#x7684;&#x524D;&#x7F00;&#x548C;&#xFF0C;&#x4E0B;&#x6807;&#x4ECE;1&#x5F00;&#x59CB;&#xFF1A;<br>$$sum[i]=\sum_{k=1}^{k=i}{num[k]}$$<br>&#x7528;$pre[i]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x5C42;&#x7684;&#x6240;&#x6709;&#x4EBA;&#x90FD;&#x79FB;&#x5230;&#x7B2C;0&#x5C42;&#x7684;&#x4EE3;&#x4EF7;&#x548C;&#xFF1A;<br>$$pre[i]=\sum_{k=1}^{k=i}{k*num[k]}$$<br>&#x90A3;&#x4E48;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x533A;&#x95F4;$[a,b]$&#x7684;&#x4EBA;&#x79FB;&#x52A8;&#x5230;$a$&#x7684;&#x4EE3;&#x4EF7;&#x5C31;&#x662F;&#xFF1A;<br>$$pre[b]-pre[a]-(sum[b]-sum[a])*a$$<br>&#x5BF9;&#x4E8E;&#x540E;&#x79FB;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5728;&#x8BB0;&#x5F55;&#x4E00;&#x4E2A;&#x540E;&#x7F00;&#x548C;$suf[i]$&#x8868;&#x793A;&#x628A;&#x7B2C;$i$&#x5C42;&#x7684;&#x4EBA;&#x90FD;&#x79FB;&#x52A8;&#x5230;&#x7B2C;$n+1$&#x5C42;&#x7684;&#x4EE3;&#x4EF7;&#x548C;&#xFF0C;&#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#x4E5F;&#x53EF;&#x4EE5;$O(1)$&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x83B7;&#x5F97;&#x5C06;&#x4E00;&#x4E2A;&#x533A;&#x95F4;&#x7684;&#x4EBA;&#x79FB;&#x52A8;&#x5230;&#x67D0;&#x4E2A;&#x697C;&#x5C42;&#x65F6;&#x7684;&#x4EE3;&#x4EF7;&#x3002;</p>
<p>&#x6700;&#x540E;&#x5904;&#x7406;&#x4E00;&#x4E0B;&#x8FB9;&#x754C;&#x60C5;&#x51B5;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x603B;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x662F;&#xFF1A;$O(n^2)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">4010</span>;</span><br><span class="line"><span class="keyword">const</span> ll INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, cases = <span class="number">0</span>;</span><br><span class="line">ll value[MAX_N][<span class="number">2</span>], sum[MAX_N][<span class="number">2</span>], pre[MAX_N][<span class="number">2</span>], suf[MAX_N][<span class="number">2</span>];</span><br><span class="line">ll dp[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	sum[<span class="number">0</span>][<span class="number">0</span>] = sum[<span class="number">0</span>][<span class="number">1</span>] = pre[<span class="number">0</span>][<span class="number">0</span>] = pre[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		sum[i][<span class="number">0</span>] = sum[i - <span class="number">1</span>][<span class="number">0</span>] + value[i][<span class="number">0</span>];</span><br><span class="line">		sum[i][<span class="number">1</span>] = sum[i - <span class="number">1</span>][<span class="number">1</span>] + value[i][<span class="number">1</span>];</span><br><span class="line">		pre[i][<span class="number">0</span>] = pre[i - <span class="number">1</span>][<span class="number">0</span>] + value[i][<span class="number">0</span>] * i;</span><br><span class="line">		pre[i][<span class="number">1</span>] = pre[i - <span class="number">1</span>][<span class="number">1</span>] + value[i][<span class="number">1</span>] * i; </span><br><span class="line">	}</span><br><span class="line">	suf[n + <span class="number">1</span>][<span class="number">0</span>] = suf[n + <span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i) {</span><br><span class="line">		suf[i][<span class="number">0</span>] = suf[i + <span class="number">1</span>][<span class="number">0</span>] + value[i][<span class="number">0</span>] * (n - i + <span class="number">1</span>);</span><br><span class="line">		suf[i][<span class="number">1</span>] = suf[i + <span class="number">1</span>][<span class="number">1</span>] + value[i][<span class="number">1</span>] * (n - i + <span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Down</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> id)</span> <span class="comment">// [a, b] --&gt; b + 1</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> suf[a][id] - suf[b + <span class="number">1</span>][id] - (sum[b][id] - sum[a - <span class="number">1</span>][id]) * (n - b);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Up</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> id)</span> <span class="comment">// [a, b] --&gt; a</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> pre[b][id] - pre[a][id] - (sum[b][id] - sum[a][id]) * a;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">int</span> mid = (a + b) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (b &lt; n) {</span><br><span class="line">		<span class="keyword">return</span> Up(a, mid, id) + Down(mid + <span class="number">1</span>, b, id);</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		<span class="keyword">return</span> Up(a, b, id);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	init();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		dp[i][<span class="number">0</span>] = dp[i][<span class="number">1</span>] = INF;</span><br><span class="line">		<span class="keyword">if</span> (i &lt; n) dp[i][<span class="number">0</span>] = Down(<span class="number">1</span>, i, <span class="number">1</span>); <span class="comment">// &#x524D;i&#x4E2A;&#x5168;&#x90E8;&#x9009;0</span></span><br><span class="line">		<span class="keyword">if</span> (i &lt; n) dp[i][<span class="number">1</span>] = Down(<span class="number">1</span>, i, <span class="number">0</span>); <span class="comment">// &#x524D;i&#x4E2A;&#x5168;&#x90E8;&#x9009;1</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">1</span>; --j) {</span><br><span class="line">			dp[i][<span class="number">0</span>] = min(dp[i][<span class="number">0</span>], dp[j][<span class="number">1</span>] + work(j, i, <span class="number">1</span>));</span><br><span class="line">			dp[i][<span class="number">1</span>] = min(dp[i][<span class="number">1</span>], dp[j][<span class="number">0</span>] + work(j, i, <span class="number">0</span>));</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	ll ret = min(dp[n][<span class="number">0</span>], dp[n][<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %lld\n&quot;</span>, ++cases, ret);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;value[i][<span class="number">0</span>], &amp;value[i][<span class="number">1</span>]);</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">Codeforces 373 E 线段树+矩阵快速幂</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x5B9A;&#x4E49;Fibonacci&#x6570;&#x5217;&#xFF1A;$f(1)=f(2)=1,f(x)=f(x-1)+f(x-2)(x&gt;2)$&#x3002;&#x7ED9;$n\leq 10^{5}$&#x4E2A;&#x6570;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x64CD;&#x4F5C;&#xFF1A;&#x533A;&#x95F4;&#x52A0;&#x503C;&#x548C;&#x533A;&#x95F4;&#x6C42;&#x548C;&#xFF0C;&#x5BF9;&#x4E8E;&#x6C42;&#x548C;&#x64CD;&#x4F5C;&#x8F93;&#x51FA;&#xFF1A;$\sum_{i=L}^{i=R}{f(a_i)}$&#x3002;</p>
<a id="more"></a>
<p>&#x9898;&#x76EE;&#x94FE;&#x63A5;&#xFF1A;<a href="http://codeforces.com/contest/719/problem/E" target="_blank" rel="noopener">Here</a></p>
<p>&#x8FD9;&#x4E2A;&#x5BF9;&#x4E8E;&#x77E9;&#x9635;&#x4E58;&#x6CD5;&#x548C;&#x52A0;&#x6CD5;&#x8981;&#x6709;&#x4E00;&#x70B9;&#x8BA4;&#x8BC6;&#x3002;&#x77E9;&#x9635;&#x76F8;&#x52A0;&#x518D;&#x4E58;&#x7684;&#x7ED3;&#x679C;&#x548C;&#x76F8;&#x4E58;&#x518D;&#x52A0;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF08;&#x6EE1;&#x8DB3;&#x7ED3;&#x5408;&#x5F8B;&#xFF09;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x6570;$a_i$&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x5F97;&#x5230;&#x3002;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;$2*2$&#x7684;&#x77E9;&#x9635;&#xFF1A;<br>$$<br>fibo=<br>\begin{bmatrix}<br> 0 &amp; 1 \\<br> 1 &amp; 1<br>\end{bmatrix}<br>$$<br>&#x53D1;&#x73B0;&#xFF1A;$fibo^{a_i-1}$&#x7684;&#x7B2C;&#x4E00;&#x884C;&#x7684;&#x6570;&#x5B57;&#x4E4B;&#x548C;&#x6070;&#x4E3A;$f(a_i)$&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x5C31;&#x662F;&#x5E73;&#x5E38;&#x6C42;Fibonacci&#x6570;&#x5217;&#x7684;&#x7CFB;&#x6570;&#x77E9;&#x9635;&#x3002;</p>
<p>&#x9700;&#x8981;&#x5728;&#x7EBF;&#x6BB5;&#x6811;&#x4E2D;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x533A;&#x95F4;&#x77E9;&#x9635;&#x4E4B;&#x548C;&#x4E0E;$lazy$&#x6807;&#x8BB0;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x533A;&#x95F4;&#x52A0;&#x503C;$x$&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x8FD9;&#x4E2A;&#x533A;&#x95F4;&#x7684;&#x6240;&#x6709;&#x6570;&#x5B57;&#x77E9;&#x9635;&#x4E58;&#x4EE5;&#xFF1A;$fibo^x$&#x3002;&#x5BFB;&#x5E38;&#x7684;push_down&#x548C;push_up&#x64CD;&#x4F5C;&#x5C31;&#x8DB3;&#x4EE5;&#x89E3;&#x51B3;&#x3002;</p>
<p>&#x6BD4;&#x8F83;&#x96BE;&#x60F3;&#x7684;&#x5C31;&#x662F;&#x5728;&#x7EBF;&#x6BB5;&#x6811;&#x4E2D;<strong>&#x4FDD;&#x5B58;&#x7CFB;&#x6570;&#x77E9;&#x9635;</strong>&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson(x) (x &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson(x) (x &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll mod = (ll)(<span class="number">1e9</span>) + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> {</span></span><br><span class="line">	ll data[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>{ </span><br><span class="line">		<span class="built_in">memset</span>(data, <span class="number">0</span>, <span class="keyword">sizeof</span> (data));</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">unit</span><span class="params">()</span> </span>{</span><br><span class="line">		data[<span class="number">0</span>][<span class="number">0</span>] = data[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">		data[<span class="number">1</span>][<span class="number">0</span>] = data[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	Matrix <span class="keyword">operator</span> + (<span class="keyword">const</span> Matrix&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		Matrix ret;</span><br><span class="line">		ret.clear();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) {</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; ++j) {</span><br><span class="line">				ret.data[i][j] = data[i][j] + rhs.data[i][j];</span><br><span class="line">				<span class="keyword">if</span> (ret.data[i][j] &gt;= mod) ret.data[i][j] -= mod;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	}</span><br><span class="line">	Matrix <span class="keyword">operator</span> * (<span class="keyword">const</span> Matrix&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		Matrix ret;</span><br><span class="line">		ret.clear();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) {</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; ++j) {</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">2</span>; ++k) {</span><br><span class="line">					ret.data[i][j] += data[i][k] * rhs.data[k][j] % mod;</span><br><span class="line">					<span class="keyword">if</span> (ret.data[i][j] &gt;= mod) ret.data[i][j] -= mod;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	}</span><br><span class="line">	Matrix <span class="keyword">operator</span> ^ (<span class="keyword">int</span> <span class="built_in">exp</span>) <span class="keyword">const</span> {</span><br><span class="line">		Matrix ret, tmp;</span><br><span class="line">		ret.unit();</span><br><span class="line">		<span class="built_in">memcpy</span>(tmp.data, data, <span class="keyword">sizeof</span> (data)); </span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">exp</span>) {</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">exp</span> &amp; <span class="number">1</span>) ret = ret * tmp;</span><br><span class="line">			tmp = tmp * tmp;</span><br><span class="line">			<span class="built_in">exp</span> &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> data[MAX_N];</span><br><span class="line">Matrix mat[MAX_N], fibo;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stree</span> {</span></span><br><span class="line">	<span class="keyword">int</span> left, right;</span><br><span class="line">	Matrix mat, lazy;</span><br><span class="line">} stree [MAX_N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> cur)</span> </span>{</span><br><span class="line">	stree[cur].mat = stree[lson(cur)].mat + stree[rson(cur)].mat;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> cur)</span> </span>{</span><br><span class="line">	stree[cur].left = left, stree[cur].right = right;</span><br><span class="line">	stree[cur].mat.clear();</span><br><span class="line">	stree[cur].lazy.unit();</span><br><span class="line">	<span class="keyword">if</span> (left == right) {</span><br><span class="line">		stree[cur].mat = mat[left];</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	build(left, mid, lson(cur));</span><br><span class="line">	build(mid + <span class="number">1</span>, right, rson(cur));</span><br><span class="line">	push_up(cur);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> cur)</span> </span>{</span><br><span class="line">	Matrix lazy = stree[cur].lazy;</span><br><span class="line">	stree[lson(cur)].lazy = stree[lson(cur)].lazy * lazy;</span><br><span class="line">	stree[lson(cur)].mat = stree[lson(cur)].mat * lazy;</span><br><span class="line">	stree[rson(cur)].lazy = stree[rson(cur)].lazy * lazy;</span><br><span class="line">	stree[rson(cur)].mat = stree[rson(cur)].mat * lazy;</span><br><span class="line">	stree[cur].lazy.unit();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, Matrix c, <span class="keyword">int</span> cur)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> left = stree[cur].left, right = stree[cur].right;</span><br><span class="line">	<span class="keyword">if</span> (left == a &amp;&amp; right == b) {</span><br><span class="line">		stree[cur].mat = stree[cur].mat * c;</span><br><span class="line">		stree[cur].lazy = stree[cur].lazy * c;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line">	push_down(cur);</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (b &lt;= mid) update(a, b, c, lson(cur));</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (a &gt; mid) update(a, b, c, rson(cur));</span><br><span class="line">	<span class="keyword">else</span> {</span><br><span class="line">		update(a, mid, c, lson(cur));</span><br><span class="line">		update(mid + <span class="number">1</span>, b, c, rson(cur));</span><br><span class="line">	}</span><br><span class="line">	push_up(cur);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> cur)</span> </span>{</span><br><span class="line">	ll ret;</span><br><span class="line">	<span class="keyword">int</span> left = stree[cur].left, right = stree[cur].right;</span><br><span class="line">	<span class="keyword">if</span> (left == a &amp;&amp; right == b) {</span><br><span class="line">		ret = stree[cur].mat.data[<span class="number">0</span>][<span class="number">0</span>] + stree[cur].mat.data[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">		<span class="keyword">if</span> (ret &gt;= mod) ret -= mod;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	}</span><br><span class="line">	push_down(cur);</span><br><span class="line">	<span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (b &lt;= mid) <span class="keyword">return</span> query(a, b, lson(cur));</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (a &gt; mid) <span class="keyword">return</span> query(a, b, rson(cur));</span><br><span class="line">	<span class="keyword">else</span> {</span><br><span class="line">		ret = query(a, mid, lson(cur)) + query(mid + <span class="number">1</span>, b, rson(cur));</span><br><span class="line">		<span class="keyword">if</span> (ret &gt;= mod) ret -= mod;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span> </span>{</span><br><span class="line">	build(<span class="number">0</span>, n - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">while</span> (m--) {</span><br><span class="line">		<span class="keyword">int</span> type, a, b, x;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;type, &amp;a, &amp;b);</span><br><span class="line">		a--, b--;</span><br><span class="line">		<span class="keyword">if</span> (type == <span class="number">1</span>) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">			Matrix tmp = fibo ^ x;</span><br><span class="line">			update(a, b, tmp, <span class="number">1</span>);</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, query(a, b, <span class="number">1</span>));</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	fibo.data[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>, fibo.data[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	fibo.data[<span class="number">1</span>][<span class="number">0</span>] = fibo.data[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;data[i]);</span><br><span class="line">			mat[i] = fibo ^ (data[i] - <span class="number">1</span>);</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">HDU 5720 判断构成三角形、区间合并</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x5730;&#x4E0A;&#x6709;$n(\leq 10^{5})$&#x6839;&#x957F;&#x5EA6;&#x4E3A;$a[i]  (a[i]\leq 10^{18})$&#x7684;&#x6811;&#x679D;&#xFF0C;&#x624B;&#x4E0A;&#x73B0;&#x5728;&#x6709;&#x957F;&#x5EA6;&#x4E3A;$[L,R]  (L\leq R\leq 10^{18})$&#x7684;$R-L+1$&#x6839;&#x6811;&#x679D;&#xFF0C;&#x95EE;&#x53EF;&#x4EE5;&#x4E22;&#x4E0B;&#x591A;&#x5C11;&#x79CD;&#x6811;&#x679D;&#x53EF;&#x4EE5;&#x548C;&#x5730;&#x4E0A;&#x5DF2;&#x6709;&#x7684;$n$&#x6839;&#x6811;&#x679D;&#x4E0D;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#xFF1F;&#x53EA;&#x9700;&#x8981;&#x65B0;&#x52A0;&#x5165;&#x7684;&#x6811;&#x679D;&#x65E0;&#x6CD5;&#x4E0E;&#x5730;&#x4E0A;&#x4EFB;&#x610F;&#x4E24;&#x6761;&#x6811;&#x679D;&#x65E0;&#x6CD5;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x3002; &#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x5730;&#x4E0A;&#x7684;&#x6811;&#x679D;&#x65E0;&#x6CD5;&#x5F62;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x3002;<br><a id="more"></a></p>
<p>&#x9898;&#x76EE;&#x94FE;&#x63A5;&#xFF1A;<a href="http://acm.hdu.edu.cn/showproblem.php?pid=5720" target="_blank" rel="noopener">Here</a></p>
<p>&#x8003;&#x8651;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x4E22;&#x4E0B;&#x7684;&#x6811;&#x679D;&#x957F;&#x5EA6;&#x4E3A;$c$&#x548C;&#x5730;&#x4E0A;&#x7684;&#x957F;&#x5EA6;&#x4E3A;$a,b(a\geq b)$&#x7684;&#x4E24;&#x6839;&#x6811;&#x679D;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#xFF1A;<br>$$a-b&lt; c &lt; a + b$$<br>&#x5373;&#xFF1A;<br>$$a - b + 1\leq c \leq a + b - 1$$</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x679A;&#x4E3E;$a$&#xFF0C;&#x9700;&#x8981;&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x533A;&#x95F4;&#x5C3D;&#x53EF;&#x80FD;&#x53D8;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x5148;&#x5C06;&#x539F;&#x6765;&#x6570;&#x636E;&#x6392;&#x5E8F;&#xFF0C;&#x5982;&#x679C;$a=data[i]$&#xFF0C;&#x90A3;&#x4E48;$b$&#x5C31;&#x662F;$data[i-1]$&#x3002;&#x8FD9;&#x6837;&#x5B50;&#x4E00;&#x6765;&#x5C31;&#x4F1A;&#x5F97;&#x5230;$n-1$&#x4E2A;&#x533A;&#x95F4;&#xFF0C;&#x533A;&#x95F4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x503C;&#x90FD;&#x662F;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x533A;&#x95F4;&#x5408;&#x5E76;&#x3002;&#x5148;&#x628A;&#x533A;&#x95F4;&#x6309;&#x7167;&#x4F18;&#x5148;&#x5DE6;&#x7AEF;&#x70B9;&#x5176;&#x6B21;&#x53F3;&#x7AEF;&#x70B9;&#x6392;&#x5E8F;&#xFF0C;&#x904D;&#x5386;&#x6240;&#x6709;&#x7684;&#x533A;&#x95F4;&#xFF0C;&#x7528;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x8868;&#x793A;&#x5F53;&#x524D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x56E0;&#x4E3A;&#x533A;&#x95F4;&#x4E2D;&#x7684;&#x503C;&#x90FD;&#x662F;&#x6784;&#x6210;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7EDF;&#x8BA1;&#x7684;&#x662F;&#x533A;&#x95F4;&#x5916;&#x7684;&#x6570;&#x5B57;&#x4E2A;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x9700;&#x8981;&#x6EE1;&#x8DB3;&#x5728;&#x533A;&#x95F4;$[L,R]$&#x8FD9;&#x4E2A;&#x8303;&#x56F4;&#x5185;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(T*n*\log n)$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios_base::sync_with_stdio(0); cin.tie(0);</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n;</span><br><span class="line">ll data[MAX_N];</span><br><span class="line">ll L, R;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Interval</span> {</span></span><br><span class="line">	ll left, right;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Interval&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">if</span>(left != rhs.left) <span class="keyword">return</span> left &lt; rhs.left;</span><br><span class="line">		<span class="keyword">return</span> right &lt; rhs.right;</span><br><span class="line">	}</span><br><span class="line">}inter[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">MergeInterval</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	ll res = <span class="number">0</span>, st = L;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="keyword">if</span>(inter[i].left &gt; R) <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">if</span>(inter[i].left &gt; st) {</span><br><span class="line">			res += (inter[i].left - st);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span>(st &lt;= inter[i].right) st = inter[i].right + <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span>(st &lt;= R) res += (R - st + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span>(T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%lld%lld&quot;</span>, &amp;n, &amp;L, &amp;R);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;data[i]);</span><br><span class="line">		}</span><br><span class="line">		sort(data, data + n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">			inter[i].left = data[i] - data[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">			inter[i].right = data[i] + data[i - <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line">		sort(inter + <span class="number">1</span>, inter + n);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, MergeInterval());</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">BZOJ 2734 集合选数 [思路题]</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x6C42;$n(n\leq 10^5)$&#x4EE5;&#x5185;&#x6EE1;&#x8DB3;&#x4E0B;&#x5217;&#x6761;&#x4EF6;&#x7684;&#x5B50;&#x96C6;&#x7684;&#x4E2A;&#x6570;&#xFF1A;&#x5982;&#x679C;$x$&#x5728;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x5185;&#xFF0C;&#x90A3;&#x4E48;$2*x,3*x$&#x90FD;&#x4E0D;&#x80FD;&#x5728;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x5185;&#x3002;&#x4F8B;&#x5982;&#xFF1A;$n=4$&#xFF0C;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x5B50;&#x96C6;&#x662F;&#xFF1A;$\{1\},\{1&#xFF0C;4\}&#xFF0C;\{2\}&#xFF0C;\{2&#xFF0C;3\}&#xFF0C;\{3\}&#xFF0C;\{3&#xFF0C;4\}&#xFF0C;\{4\}$&#xFF0C;&#x4E00;&#x5171;8&#x4E2A;&#x3002;<br><a id="more"></a></p>
<p>&#x9898;&#x76EE;&#x94FE;&#x63A5;&#xFF1A;<a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2734" target="_blank" rel="noopener">Here</a></p>
<p>&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;<a href="http://blog.csdn.net/wzq_qwq/article/details/49361339" target="_blank" rel="noopener">Here</a></p>
<p>&#x5F88;&#x96BE;&#x60F3;&#x5230;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#x77E9;&#x9635;&#xFF1A;<br><img src="/images/20160924.JPG" alt="20160924"></p>
<p>&#x8FD9;&#x6837;&#x7684;&#x6570;&#x5B57;&#x77E9;&#x9635;&#x6700;&#x591A;&#x4F1A;&#x6709;&#xFF1A;17&#x884C;11&#x5217;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x6BCF;&#x884C;&#x7684;&#x6570;&#x5B57;&#x663E;&#x7136;&#x4E0D;&#x80FD;&#x53D6;&#x5DE6;&#x53F3;&#x76F8;&#x90BB;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x76F8;&#x90BB;&#x884C;&#x7684;&#x72B6;&#x6001;&#x663E;&#x7136;&#x4E0D;&#x80FD;&#x540C;&#x4E00;&#x5217;&#x90FD;&#x53D6;&#x3002;</p>
<p>&#x6BCF;&#x79CD;&#x77E9;&#x9635;&#x65B9;&#x6848;&#x5148;&#x6784;&#x9020;&#x77E9;&#x9635;&#xFF0C;&#x7136;&#x540E;&#x72B6;&#x538B;dp+&#x6EDA;&#x52A8;&#x6570;&#x7EC4;&#x9012;&#x63A8;&#xFF0C;&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x7684;&#x53EF;&#x80FD;&#x77E9;&#x9635;&#x65B9;&#x6848;&#x4E58;&#x6CD5;&#x539F;&#x7406;&#x8FDE;&#x4E58;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x867D;&#x7136;&#x65F6;&#x9650;&#x7ED9;&#x4E86;10s&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;AC&#x53EA;&#x8981;660MS&#xFF0C;Orz&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> ll mod = (ll)(<span class="number">1e9</span>) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> mat[<span class="number">18</span>][<span class="number">13</span>], vis[MAX_N], col[<span class="number">18</span>];</span><br><span class="line">ll dp[<span class="number">2</span>][<span class="number">1</span> &lt;&lt; <span class="number">12</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">wyr</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">int</span> row;</span><br><span class="line">	<span class="comment">// &#x6784;&#x9020;&#x77E9;&#x9635;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; ; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (i == <span class="number">1</span>) mat[i][<span class="number">0</span>] = x;</span><br><span class="line">		<span class="keyword">else</span> mat[i][<span class="number">0</span>] = <span class="number">2</span> * mat[i - <span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">if</span> (mat[i][<span class="number">0</span>] &gt; n) {</span><br><span class="line">			row = i - <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		}</span><br><span class="line">		vis[mat[i][<span class="number">0</span>]] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; ; ++j) {</span><br><span class="line">			mat[i][j] = mat[i][j - <span class="number">1</span>] * <span class="number">3</span>;</span><br><span class="line">			<span class="keyword">if</span> (mat[i][j] &gt; n) {</span><br><span class="line">				col[i] = j; <span class="comment">// &#x6BCF;&#x4E00;&#x884C;&#x7684;&#x5217;&#x6570;</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			vis[mat[i][j]] = <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span> (dp));</span><br><span class="line">	dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>, col[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> cur = <span class="number">0</span>;</span><br><span class="line">	ll ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= row; ++i) {</span><br><span class="line">		cur ^= <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">memset</span>(dp[cur], <span class="number">0</span>, <span class="keyword">sizeof</span> (dp[cur]));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">0</span>; s &lt; (<span class="number">1</span> &lt;&lt; col[i]); ++s) {</span><br><span class="line">			<span class="keyword">if</span> (s &amp; (s &lt;&lt; <span class="number">1</span>)) <span class="keyword">continue</span>; <span class="comment">// &#x540C;&#x4E00;&#x884C;&#x4E0D;&#x80FD;&#x53D6;&#x76F8;&#x90BB;</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> pre = <span class="number">0</span>; pre &lt; (<span class="number">1</span> &lt;&lt; col[i - <span class="number">1</span>]); ++pre) {</span><br><span class="line">				<span class="keyword">if</span> (dp[cur ^ <span class="number">1</span>][pre] == <span class="number">0</span> || (pre &amp; s)) <span class="keyword">continue</span>; <span class="comment">// &#x4E0A;&#x4E00;&#x884C;&#x72B6;&#x6001;&#x5B58;&#x5728;&#x5E76;&#x4E14;&#x4E0D;&#x80FD;&#x53D6;&#x76F8;&#x90BB;&#x5217;</span></span><br><span class="line">				dp[cur][s] += dp[cur ^ <span class="number">1</span>][pre];</span><br><span class="line">				<span class="keyword">if</span> (dp[cur][s] &gt;= mod) dp[cur][s] -= mod;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (i == row) {</span><br><span class="line">				ret += dp[cur][s];</span><br><span class="line">				<span class="keyword">if</span> (ret &gt;= mod) ret -= mod;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	ll ans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (vis[i] == <span class="number">0</span>) {</span><br><span class="line">			ans = ans * wyr(i) % mod;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">UVALive 6188 2012东京 G (计算几何+状压)</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x4E2D;&#x6709;$n(n\leq 2000)$&#x4E2A;&#x6C14;&#x7403;&#xFF08;&#x770B;&#x6210;&#x7403;&#x4F53;&#xFF09;&#x548C;$m(m\leq 15)$&#x4E2A;&#x5149;&#x6E90;&#xFF0C;&#x6C14;&#x7403;&#x7684;&#x8868;&#x9762;&#x4F1A;&#x963B;&#x6321;&#x5149;&#x7EBF;&#x7684;&#x4F20;&#x64AD;&#x5E76;&#x4E14;&#x7531;&#x4E8E;&#x67D0;&#x4E9B;&#x539F;&#x56E0;&#x6C14;&#x7403;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x91CD;&#x53E0;&#xFF0C;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x70B9;&#x548C;&#x5149;&#x5F3A;&#x548C;&#x8DDD;&#x79BB;&#x7684;&#x8BA1;&#x7B97;&#x516C;&#x5F0F;&#xFF0C;&#x6C42;&#x6700;&#x591A;&#x79FB;&#x9664;$R(R\leq n)$&#x4E2A;&#x6C14;&#x7403;&#x5728;&#x56FA;&#x5B9A;&#x70B9;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x5927;&#x5149;&#x5F3A;&#xFF1F;<br><a id="more"></a></p>
<h4 id="&#x9898;&#x76EE;&#x94FE;&#x63A5;"><a href="#&#x9898;&#x76EE;&#x94FE;&#x63A5;" class="headerlink" title="&#x9898;&#x76EE;&#x94FE;&#x63A5;"></a>&#x9898;&#x76EE;&#x94FE;&#x63A5;</h4><p><a href="https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=4199" target="_blank" rel="noopener">Here</a></p>
<h4 id="&#x5206;&#x6790;"><a href="#&#x5206;&#x6790;" class="headerlink" title="&#x5206;&#x6790;"></a>&#x5206;&#x6790;</h4><p>&#x4E4B;&#x524D;&#x6BCF;&#x5199;&#x8FC7;&#x4E09;&#x7EF4;&#x7684;&#x8BA1;&#x7B97;&#x51E0;&#x4F55;&#xFF0C;&#x8FD9;&#x6B21;&#x5C31;&#x505A;&#x7740;&#x73A9;&#x73A9;&#xFF0C;&#x6A21;&#x7248;&#x76F4;&#x63A5;&#x8D34;&#x4E86;kuangbin&#x7684;&#x3002;</p>
<p>&#x9996;&#x5148;&#x9700;&#x8981;&#x5224;&#x65AD;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x5149;&#x6E90;&#x6709;&#x54EA;&#x4E9B;&#x6C14;&#x7403;&#x963B;&#x6321;&#x5B83;&#x7167;&#x5C04;&#x5230;&#x56FA;&#x5B9A;&#x70B9;&#x3002;&#x8FD9;&#x4E2A;&#x5229;&#x7528;&#x7A7A;&#x95F4;&#x70B9;&#x5230;&#x76F4;&#x7EBF;&#x8DDD;&#x79BB;&#x516C;&#x5F0F;&#x518D;&#x548C;&#x6C14;&#x7403;&#x7684;&#x534A;&#x5F84;&#x6BD4;&#x8F83;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#xFF0C;&#x4F46;&#x662F;&#x522B;&#x5FD8;&#x4E86;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;<strong>&#x5149;&#x6E90;&#x548C;&#x56FA;&#x5B9A;&#x70B9;&#x90FD;&#x5728;&#x6C14;&#x7403;&#x5185;&#x90E8;&#x65F6;&#xFF0C;&#x662F;&#x4E0D;&#x53D7;&#x5F53;&#x524D;&#x6C14;&#x7403;&#x5F71;&#x54CD;&#x7684;&#x3002;</strong></p>
<p>&#x8003;&#x8651;&#x5230;&#x5149;&#x6E90;&#x6700;&#x591A;&#x53EA;&#x6709;15&#x4E2A;&#xFF0C;&#x53EF;&#x4EE5;<strong>&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x72B6;&#x538B;&#x9009;&#x62E9;&#x4E86;&#x54EA;&#x4E9B;&#x5149;&#x6E90;</strong>&#xFF0C;&#x7136;&#x540E;&#x628A;&#x9009;&#x62E9;&#x7684;&#x5149;&#x6E90;&#x9700;&#x8981;&#x79FB;&#x9664;&#x7684;&#x6C14;&#x7403;&#x6807;&#x8BB0;&#x4E0B;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x5224;&#x65AD;&#x6570;&#x91CF;&#x662F;&#x4E0D;&#x662F;&#x5927;&#x4E8E;$R$&#xFF0C;&#x5C31;&#x884C;&#x4E86;&#x3002;</p>
<p>&#x4E00;&#x5F00;&#x59CB;&#x6211;&#x7528;<code>set</code>&#x5B58;&#x6BCF;&#x4E2A;&#x5149;&#x6E90;&#x9700;&#x8981;&#x79FB;&#x9664;&#x7684;&#x6C14;&#x7403;&#x7F16;&#x53F7;&#xFF0C;&#x7136;&#x540E;&#x4E5F;&#x662F;<code>set</code>&#x5B58;&#x9009;&#x62E9;&#x4E86;&#x67D0;&#x4E9B;&#x5149;&#x6E90;&#x540E;&#x6700;&#x7EC8;&#x9700;&#x8981;&#x79FB;&#x9664;&#x7684;&#x6C14;&#x7403;&#x7F16;&#x53F7;&#xFF08;&#x76F8;&#x5F53;&#x4E8E;&#x53BB;&#x91CD;&#x4E86;&#xFF09;&#xFF0C;&#x7ED3;&#x679C;TLE&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x524D;&#x8005;&#x6539;&#x6210;<code>vector</code>&#xFF0C;&#x540E;&#x8005;&#x6539;&#x6210;<code>vis&#x6570;&#x7EC4;&#x6807;&#x8BB0;</code>&#xFF0C;&#x5C31;&#x8FC7;&#x4E86;&#x3002;&#x65F6;&#x9650;&#x662F;3000ms&#xFF0C;&#x8DD1;&#x4E86;2400+ms&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x662F;&#xFF1A;$O(2^{m}*m*n)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">2010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt;= eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> {</span> <span class="comment">// &#x4E09;&#x7EF4;&#x70B9;&#x5B9A;&#x4E49;</span></span><br><span class="line">	<span class="keyword">double</span> x, y, z;</span><br><span class="line"></span><br><span class="line">	Point() {}</span><br><span class="line">	Point(<span class="keyword">double</span> _x, <span class="keyword">double</span> _y, <span class="keyword">double</span> _z): x(_x), y(_y), z(_z) {}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>, &amp;x, &amp;y, &amp;z);</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%.2lf %.2lf %.2lf\n&quot;</span>, x, y, z);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> sgn(x - rhs.x) == <span class="number">0</span> &amp;&amp; sgn(y - rhs.y) == <span class="number">0</span> &amp;&amp; sgn(z - rhs.z) == <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">len</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sqrt</span>(x * x + y * y + z * z);</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">len2</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> x * x + y * y + z * z;</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">dis</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sqrt</span>((x - rhs.x) * (x - rhs.x) + </span><br><span class="line">				(y - rhs.y) * (y - rhs.y) + (z - rhs.z) * (z - rhs.z));</span><br><span class="line">	}</span><br><span class="line">	Point <span class="keyword">operator</span> - (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> Point(x - rhs.x, y - rhs.y, z - rhs.z);</span><br><span class="line">	}</span><br><span class="line">	Point <span class="keyword">operator</span> + (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> Point(x + rhs.x, y + rhs.y, z + rhs.z);</span><br><span class="line">	}</span><br><span class="line">	Point <span class="keyword">operator</span> * (<span class="keyword">const</span> <span class="keyword">double</span>&amp; d) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> Point(x * d, y * d, z * d);</span><br><span class="line">	}</span><br><span class="line">	Point <span class="keyword">operator</span> / (<span class="keyword">const</span> <span class="keyword">double</span>&amp; d) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> Point(x / d, y / d, z /d);</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{ <span class="comment">// &#x70B9;&#x4E58;</span></span><br><span class="line">		<span class="keyword">return</span> x * rhs.x + y * rhs.y + z * rhs.z;</span><br><span class="line">	}</span><br><span class="line">	<span class="function">Point <span class="title">cross</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{ <span class="comment">// &#x53C9;&#x4E58;</span></span><br><span class="line">		<span class="keyword">return</span> Point(y * rhs.z - z * rhs.y, </span><br><span class="line">			z * rhs.x - x * rhs.z, x * rhs.y - y * rhs.x);</span><br><span class="line">	}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span> {</span> <span class="comment">// &#x4E09;&#x7EF4;&#x7EBF;&#x6BB5;&#x3001;&#x76F4;&#x7EBF;&#x5B9A;&#x4E49;</span></span><br><span class="line">	Point st, ed;</span><br><span class="line"></span><br><span class="line">	Line() {}</span><br><span class="line">	Line(Point _st, Point _ed): st(_st), ed(_ed) {}</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span> </span>{</span><br><span class="line">		st.input();</span><br><span class="line">		ed.input();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Line&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> st == rhs.st &amp;&amp; ed == rhs.ed;</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">length</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> st.dis(ed);</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">point_to_line</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{ <span class="comment">// &#x70B9;&#x5230;&#x76F4;&#x7EBF;&#x8DDD;&#x79BB;</span></span><br><span class="line">		<span class="keyword">return</span> ((ed - st).cross(rhs - st)).len() / st.dis(ed);</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">point_to_seg</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{ <span class="comment">// &#x70B9;&#x5230;&#x7EBF;&#x6BB5;&#x8DDD;&#x79BB;</span></span><br><span class="line">		<span class="keyword">if</span> (sgn((rhs - st).dot(ed - st)) &lt; <span class="number">0</span> || sgn((rhs - ed).dot(st - ed)) &lt; <span class="number">0</span>) {</span><br><span class="line">			<span class="keyword">return</span> min(rhs.dis(st), rhs.dis(ed));</span><br><span class="line">		} </span><br><span class="line">		<span class="keyword">return</span> point_to_line(rhs);</span><br><span class="line">	}</span><br><span class="line">	<span class="function">Point <span class="title">projection</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{ <span class="comment">// &#x70B9;&#x5230;&#x76F4;&#x7EBF;&#x7684;&#x6295;&#x5F71;</span></span><br><span class="line"> 		<span class="keyword">return</span> st + ( ((ed - st) * ((ed - st).dot(rhs - st))) / ((ed - st).len2()) );</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">point_on_line</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{ <span class="comment">// &#x5224;&#x65AD;&#x70B9;&#x662F;&#x5426;&#x5728;&#x76F4;&#x7EBF;&#x4E0A;</span></span><br><span class="line">		<span class="keyword">return</span> sgn( ((st - rhs).cross(ed - rhs)).len() ) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">			   sgn( (st - rhs).dot(ed - rhs) ) == <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, R;</span><br><span class="line"><span class="keyword">double</span> r[MAX_N], value[<span class="number">20</span>], w[<span class="number">20</span>];</span><br><span class="line">Point point[MAX_N], light[<span class="number">20</span>], ori;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> vis[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">InBall</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">double</span> d1 = light[i].dis(point[j]), d2 = ori.dis(point[j]);</span><br><span class="line">	<span class="keyword">if</span> (sgn(d1 - r[j]) &lt; <span class="number">0</span> &amp;&amp; sgn(d2 - r[j]) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) {</span><br><span class="line">		vec[i].clear();</span><br><span class="line">		Line line = Line(light[i], ori);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (InBall(i, j)) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">double</span> d = line.point_to_seg(point[j]);</span><br><span class="line">			<span class="keyword">if</span> (sgn(d - r[j]) &lt; <span class="number">0</span>) vec[i].push_back(j);</span><br><span class="line">		}</span><br><span class="line">		value[i] = w[i] / ( (light[i] - ori).len2() );</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> state = <span class="number">1</span>; state &lt; (<span class="number">1</span> &lt;&lt; m); ++state) {</span><br><span class="line">		<span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> (vis));</span><br><span class="line">		<span class="keyword">double</span> tmp = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (state &amp; (<span class="number">1</span> &lt;&lt; j)) {</span><br><span class="line">				tmp += value[j];</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; vec[j].size(); ++k) {</span><br><span class="line">					vis[vec[j][k]] = <span class="number">1</span>;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) { num += vis[i]; }</span><br><span class="line">		<span class="keyword">if</span> (num &lt;= R) ans = max(ans, tmp);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.5lf\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;R) &amp;&amp; (n || m || R)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			point[i].input();</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;r[i]);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) {</span><br><span class="line">			light[i].input();</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;w[i]);</span><br><span class="line">		}</span><br><span class="line">		ori.input();</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x770B;&#x5230;&#x7F51;&#x4E0A;&#x6709;&#x9898;&#x89E3;&#x7528;&#x5230;&#x4E86;<code>bitset</code>&#x4F18;&#x5316;&#xFF0C;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x679C;&#x7136;&#x5F88;&#x5FEB;&#xFF0C;&#x53EA;&#x6709;700ms&#xFF0C;&#x5C31;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bitset</span>&lt;MAX_N&gt; bit[<span class="number">20</span>], total;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) {</span><br><span class="line">		bit[i].reset();</span><br><span class="line">		Line line = Line(light[i], ori);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (InCircle(i, j)) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">double</span> d = line.point_to_seg(point[j]);</span><br><span class="line">			<span class="keyword">if</span> (sgn(d - r[j]) &lt; <span class="number">0</span>) bit[i][j] = <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line">		value[i] = w[i] / ( (light[i] - ori).len2() );</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> state = <span class="number">1</span>; state &lt; (<span class="number">1</span> &lt;&lt; m); ++state) {</span><br><span class="line">		total.reset();</span><br><span class="line">		<span class="keyword">double</span> tmp = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (state &amp; (<span class="number">1</span> &lt;&lt; j)) {</span><br><span class="line">				tmp += value[j];</span><br><span class="line">				total |= bit[j];</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (total.count() &lt;= R) ans = max(ans, tmp);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.5lf\n&quot;</span>, ans);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x8FD9;&#x9053;&#x9898;&#x6211;&#x89C9;&#x5F97;&#x96BE;&#x70B9;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x7684;&#x4E24;&#x53E5;&#x52A0;&#x7C97;&#x7684;&#x8BDD;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5509;:-(&#xFF0C;&#x624B;&#x52A8;&#x6ED1;&#x7A3D;&#x3002;</p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">Codeforces 259 B 状压dp</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x7ED9;$n(n\leq 100)$&#x4E2A;&#x6570;&#xFF0C;&#x6BCF;&#x4E2A;&#x6570;$a[i]\in [1,30]$&#xFF0C;&#x8981;&#x6C42;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;$b[]$&#xFF0C;&#x6EE1;&#x8DB3;$b$&#x6570;&#x7EC4;&#x5185;&#x7684;&#x4EFB;&#x610F;&#x4E24;&#x4E2A;&#x6570;&#x4E92;&#x7D20;&#xFF0C;&#x5E76;&#x4E14;$\sum{|a[i]-b[i]|}$&#x6700;&#x5C0F;&#xFF0C;&#x8F93;&#x51FA;&#x6570;&#x7EC4;$b$&#x3002;<br><a id="more"></a></p>
<h4 id="&#x9898;&#x76EE;&#x94FE;&#x63A5;"><a href="#&#x9898;&#x76EE;&#x94FE;&#x63A5;" class="headerlink" title="&#x9898;&#x76EE;&#x94FE;&#x63A5;"></a>&#x9898;&#x76EE;&#x94FE;&#x63A5;</h4><p><a href="http://codeforces.com/problemset/problem/453/B" target="_blank" rel="noopener">Here</a></p>
<h4 id="&#x5206;&#x6790;"><a href="#&#x5206;&#x6790;" class="headerlink" title="&#x5206;&#x6790;"></a>&#x5206;&#x6790;</h4><p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;$b[i]\leq 59$&#xFF0C;&#x56E0;&#x4E3A;$b[i]=1$&#x662F;&#x80AF;&#x5B9A;&#x7B26;&#x5408;&#x7684;&#xFF0C;&#x5982;&#x679C;$a[i]\leq 30$&#x548C;&#x5927;&#x4E8E;59&#x7684;&#x6570;&#x5339;&#x914D;&#xFF0C;&#x90A3;&#x4E48;&#x5DEE;&#x503C;&#x7684;&#x7EDD;&#x5BF9;&#x503C;&#x5C31;&#x4F1A;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x548C;1&#x5339;&#x914D;&#xFF0C;&#x6240;&#x4EE5;&#x81F3;&#x5C11;&#x548C;1&#x5339;&#x914D;&#x7B54;&#x6848;&#x4E0D;&#x4F1A;&#x66F4;&#x5DEE;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x5728;&#x6211;&#x505A;&#x5B8C;<a href="https://ramay7.github.io/2016/11/04/UVALive-6188-2012%E4%B8%9C%E4%BA%AC-G-%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95-%E7%8A%B6%E5%8E%8B/" target="_blank" rel="noopener">UVALive 6188</a>&#x540E;&#xFF0C;&#x60F3;&#x5230;&#x4E86;&#x4E00;&#x79CD;&#x601D;&#x8DEF;&#x3002;&#x679A;&#x4E3E;&#x8FD9;&#x4E9B;&#x6570;&#x6240;&#x6709;&#x7684;&#x53EF;&#x80FD;&#x5339;&#x914D;&#x7684;&#x6570;&#x5B57;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x5148;&#x7B3C;&#x7EDF;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x679A;&#x4E3E;&#x6240;&#x6709;60&#x4EE5;&#x5185;&#x7684;&#x7D20;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;$b[i]$&#x90FD;&#x662F;&#x7D20;&#x6570;&#x548C;1&#x80AF;&#x5B9A;&#x662F;&#x7B26;&#x5408;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;$b[i]$&#x4E2D;&#x51FA;&#x73B0;&#x4E00;&#x4E9B;&#x975E;&#x7D20;&#x6570;&#xFF0C;&#x4F8B;&#x5982;&#x7ED9;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x6837;&#x4F8B;&#xFF1A;</p>
<blockquote>
<p>a[i]: 1 6 4 2 8<br>b[i]: 1 5 3 1 8</p>
</blockquote>
<p>&#x751A;&#x81F3;&#x4F60;&#x53EF;&#x4EE5;&#x6784;&#x9020;&#x4E00;&#x4E9B;&#x6837;&#x4F8B;&#x4F7F;&#x5F97;$b[i]$&#x4E2D;&#x5B58;&#x5728;&#x975E;&#x7D20;&#x6570;&#xFF1A;</p>
<blockquote>
<p>a[i]: 5 7 15<br>b[i]: 5 7 16</p>
</blockquote>
<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x60F3;&#x4E86;&#x597D;&#x4E45;&#x4E5F;&#x6CA1;&#x529E;&#x6CD5;&#x89E3;&#x51B3;&#x3002;&#x9898;&#x89E3;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#x3002;&#x6BCF;&#x4E2A;$b[i]&lt;60$&#x662F;&#x4E00;&#x5B9A;&#x7684;&#xFF0C;&#x800C;&#x4E14;60&#x4EE5;&#x5185;&#x7684;&#x7D20;&#x6570;&#xFF08;&#x53EF;&#x4EE5;&#x4E0D;&#x5305;&#x62EC;59&#xFF09;&#x4E00;&#x5171;&#x6709;16&#x4E2A;&#xFF0C;&#x7136;&#x540E;&#x5BF9;60&#x4EE5;&#x5185;&#x7684;&#x6240;&#x6709;&#x6570;&#x7528;&#x4E00;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x4FDD;&#x5B58;&#x5B83;&#x7684;&#x6240;&#x6709;&#x7D20;&#x56E0;&#x5B50;&#xFF0C;&#x8BBE;&#x4E3A;$factor[]$&#xFF0C;&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x679A;&#x4E3E;&#x6BCF;&#x4E2A;$a[i]$&#x7684;&#x5339;&#x914D;&#x60C5;&#x51B5;&#xFF0C;&#x5BF9;&#x4E8E;&#x5339;&#x914D;&#x72B6;&#x6001;&#x8981;&#x6C42;<strong>&#x7D20;&#x56E0;&#x5B50;&#x6700;&#x591A;&#x53EA;&#x6709;1&#x4E2A;</strong>&#xFF0C;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x72B6;&#x538B;&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x7528;&#x5230;&#x7684;&#x7D20;&#x56E0;&#x5B50;&#x3002;</p>
<p>&#x7528;$dp[s][i]$&#x8868;&#x793A;&#x5339;&#x914D;&#x524D;$i$&#x4E2A;&#x6570;&#x65F6;$\sum{|a[i]-b[i]|}$&#x7684;&#x6700;&#x5C0F;&#x503C;&#x65F6;&#x7684;&#x72B6;&#x6001;&#x4E3A;$s$(&#x7528;&#x5230;&#x7684;&#x7D20;&#x56E0;&#x5B50;)&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;$i+1$&#x4E2A;&#x6570;$a[i]$&#xFF0C;&#x6211;&#x4EEC;&#x679A;&#x4E3E;&#x5B83;&#x548C;$k$&#x5339;&#x914D;&#xFF0C;&#x53EA;&#x8981;&#x6EE1;&#x8DB3;$s\&amp;factor[k]=0$,&#x90A3;&#x4E48;&#x5C31;&#x6EE1;&#x8DB3;&#x4E86;$b[i]$&#x4E2D;&#x4EFB;&#x610F;&#x4E24;&#x4E2A;&#x6570;&#x4E92;&#x7D20;&#x3002;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x66F4;&#x65B0;&#xFF1A;<br>$$dp[s|factor[k][i+1]=min(dp[s][i]+abs(a[i]-k))$$</p>
<p>&#x6700;&#x540E;&#x5BF9;&#x6BCF;&#x4E2A;&#x72B6;&#x6001;&#x8BB0;&#x4E2A;&#x6700;&#x4F18;&#x89E3;&#x65F6;&#x7684;&#x5339;&#x914D;$b[i]$&#xFF0C;&#x7136;&#x540E;&#x4ECE;&#x540E;&#x5F80;&#x524D;$dfs$&#x5C31;&#x80FD;&#x8FD8;&#x539F;$b[i]$&#x4E86;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(n*2^{16}*60)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> prime[] = {<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>};</span><br><span class="line"><span class="comment">// 16 numbers</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> data[<span class="number">110</span>], ans[<span class="number">110</span>], factor[<span class="number">60</span>];</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">1</span> &lt;&lt; <span class="number">16</span>][<span class="number">110</span>], last[<span class="number">1</span> &lt;&lt; <span class="number">16</span>][<span class="number">110</span>]; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (id == <span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">	ans[id] = last[state][id];</span><br><span class="line">	dfs(id - <span class="number">1</span>, state - factor[ans[id]]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> (dp));</span><br><span class="line">	dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">0</span>; s &lt; (<span class="number">1</span> &lt;&lt; <span class="number">16</span>); ++s) {</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt; <span class="number">60</span>; ++k) {</span><br><span class="line">				<span class="keyword">if</span> (factor[k] &amp; s) <span class="keyword">continue</span>;</span><br><span class="line">				<span class="keyword">if</span> (dp[s | factor[k]][i] &gt; dp[s][i - <span class="number">1</span>] + <span class="built_in">abs</span>(data[i] - k)) {</span><br><span class="line">					dp[s | factor[k]][i] = dp[s][i - <span class="number">1</span>] + <span class="built_in">abs</span>(data[i] - k);</span><br><span class="line">					last[s | factor[k]][i] = k;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> Min = inf, State;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">0</span>; s &lt; (<span class="number">1</span> &lt;&lt; <span class="number">16</span>); ++s) {</span><br><span class="line">		<span class="keyword">if</span> (dp[s][n] &lt; Min) {</span><br><span class="line">			Min = dp[s][n];</span><br><span class="line">			State = s;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	dfs(n, State);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans[i]);</span><br><span class="line">		<span class="keyword">if</span> (i &lt; n) <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">memset</span>(factor, <span class="number">0</span>, <span class="keyword">sizeof</span> (factor));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; <span class="number">60</span>; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; ++j) { <span class="comment">// &#x4FDD;&#x5B58;&#x6BCF;&#x4E2A;&#x6570;&#x7684;&#x7D20;&#x56E0;&#x5B50;</span></span><br><span class="line">			<span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) {</span><br><span class="line">				factor[i] += (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;data[i]);</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

    </div>
  </article>



  <nav class="pagination clearfix">
  <ul>
    
    <a class="extend prev" rel="prev" href="/categories/思无涯/"><i class="fa fa-chevron-circle-left" aria-hidden="true"></i></a><a class="page-number" href="/categories/思无涯/">1</a><span class="page-number current">2</span><a class="page-number" href="/categories/思无涯/page/3/">3</a><a class="extend next" rel="next" href="/categories/思无涯/page/3/"><i class="fa fa-chevron-circle-right" aria-hidden="true"></i></a>
  </ul>
</nav>

</section>
    <footer id="footer" role="contentinfo">
    <div>&copy; 2018 <a href="/">瀚清</a>.
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Designed by <a href="http://rainylog.com" target="_blank">Rainy.</a>
	</div>
</footer><!-- end #footer -->

  </div>
  <script src="/lib/fancybox/dist/jquery.fancybox.min.js"></script>

  <script src="/js/helper.js"></script>
  <script src="/js/_third-party/gitment.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>tag: 斜率dp | 瀚清</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="瀚清">
<meta property="og:url" content="http://yoursite.com/tags/斜率dp/index.html">
<meta property="og:site_name" content="瀚清">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="瀚清">
  
    <link rel="alternate" href="/atom.xml" title="瀚清" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/lib/jquery/dist/jquery.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
  
  
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="wrapper">
    <header id="header" class="clearfix">
	<a id="logo" href="/" title="瀚清">瀚清</a>
	
	<nav id="nav-menu" class="clearfix">
		<form id="search" method="post" action="./" role="search">
			<input id="search-input" type="text" name="s" class="inputbox" value="搜索" onfocus="if (value =='搜索'){value =''}" onblur="if (value ==''){value='搜索'}">
		</form>
		<ul>
      
				
        <li><a class="main-nav-link" href="/">主页</a></li>
      
				
        <li><a class="main-nav-link" href="/archives">归档</a></li>
      
		</ul>
	</nav>
</header>
    <section id="main" class="clearfix">
  <article class="post-detail">
    <h1 class="post-title"><a href="/"> HDU 3842 [11年 WF] 分治+斜率dp</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 8</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>&#x6709;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#xFF0C;&#x5DE5;&#x5382;&#x6BCF;&#x5929;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x653E;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x3002;&#x7ED9;&#x51FA;&#x6BCF;&#x53F0;&#x673A;&#x5668;&#x7684;&#x552E;&#x4EF7;$P_i$&#xFF0C;&#x53EF;&#x4EE5;&#x8D2D;&#x4E70;&#x7684;&#x65F6;&#x95F4;$D_i$&#xFF08;&#x4E14;&#x53EA;&#x80FD;&#x5728;$D_i$&#x5929;&#x8D2D;&#x4E70;&#xFF0C;&#x5982;&#x679C;$D_i$&#x5929;&#x4E0D;&#x8D2D;&#x4E70;&#x90A3;&#x4E48;&#x4EE5;&#x540E;&#x5C31;&#x4E0D;&#x80FD;&#x88AB;&#x8D2D;&#x4E70;&#x5230;&#xFF09;&#xFF0C;&#x6BCF;&#x5929;&#x53EF;&#x4EE5;&#x4EA7;&#x751F;&#x7684;&#x5229;&#x6DA6;$G_i$&#xFF08;&#x5728;$D_i$&#x5929;&#x5F00;&#x59CB;&#x4EA7;&#x751F;&#xFF09;&#xFF0C;&#x5356;&#x6389;&#x7684;&#x56DE;&#x6536;&#x4EF7;&#x683C;$R_i$&#xFF08;&#x5356;&#x6389;&#x5F53;&#x5929;&#x4E0D;&#x80FD;&#x4EA7;&#x751F;&#x4EF7;&#x503C;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x5728;&#x5356;&#x6389;&#x5F53;&#x5929;&#x518D;&#x6B21;&#x8D2D;&#x4E70;&#x65B0;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x8981;&#x6CE8;&#x610F;&#x6BCF;&#x5929;&#x6700;&#x591A;&#x62E5;&#x6709;&#x4E00;&#x53F0;&#x673A;&#x5668;&#xFF09;&#xFF0C;&#x6BCF;&#x53F0;&#x673A;&#x5668;&#x7684;&#x79DF;&#x501F;&#x65F6;&#x95F4;&#x4E0D;&#x9650;&#x3002;&#x7ED9;$n\leq 10^5$&#x53F0;&#x673A;&#x5668;&#x548C;&#x521D;&#x59CB;&#x91D1;&#x94B1;$C$&#xFF0C;&#x6C42;&#x5728;$D\leq 10^9$&#x5929;&#x540E;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x6700;&#x5927;&#x7684;&#x5229;&#x6DA6;&#xFF1F;&#x5728;$D+1$&#x5929;&#x5356;&#x6389;&#x6240;&#x6709;&#x7684;&#x673A;&#x5668;&#x3002;<br><a id="more"></a></p>
<p>&#x9898;&#x76EE;&#x94FE;&#x63A5;&#xFF1A;<a href="http://acm.hdu.edu.cn/showproblem.php?pid=3842" target="_blank" rel="noopener">Here</a></p>
<p>&#x9996;&#x5148;&#x628A;&#x673A;&#x5668;&#x6309;&#x7167;&#x8D2D;&#x4E70;&#x65F6;&#x95F4;&#x6392;&#x5E8F;&#xFF0C;&#x7528;$dp[i]$&#x8868;&#x793A;&#x5728;&#x65F6;&#x523B;$D_i$&#x5356;&#x6389;&#x673A;&#x5668;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x5927;&#x5229;&#x6DA6;&#xFF0C;&#x5219;&#xFF1A;<br>$$<br>dp[i]=\max(dp[i-1], dp[j]-P[j]+R[j]+G[j]*(D[i]-D[j]-1)) \quad (dp[j] &gt; P[j])<br>$$<br>&#x76F8;&#x5F53;&#x4E8E;&#x4ECE;$D[j]$&#x5929;&#x8D2D;&#x4E70;&#x7B2C;$j$&#x53F0;&#x673A;&#x5668;&#x5E76;&#x4E00;&#x76F4;&#x4F7F;&#x7528;&#x5230;$D_i$&#x5929;&#xFF0C;&#x5728;$D_i$&#x5929;&#x5356;&#x51FA;&#x3002;</p>
<p>&#x4EE4;$A[j]=dp[j]-P[j]+R[j]-G[j]*(D[j]+1)$&#xFF0C;&#x5219;<br>$$<br>dp[i]=\max (dp[i-1], A[j]+G[j]*D[i]))\quad (dp[j] &gt; P[j])<br>$$<br>&#x76F8;&#x5F53;&#x4E8E;&#x5E73;&#x9762;&#x4E0A;&#x6709;&#x82E5;&#x5E72;&#x70B9;&#x5BF9;$(x=G[j], y=A[j])$&#x627E;&#x76F4;&#x7EBF;$y=-D[i]*x+dp[i]]$&#x7684;&#x6700;&#x5927;&#x622A;&#x8DDD;&#x3002;&#x56E0;&#x4E3A;&#x4E8B;&#x5148;&#x5DF2;&#x7ECF;&#x6309;&#x7167;$D_i$&#x6392;&#x5E8F;&#xFF0C;&#x6240;&#x4EE5;$D[i]$&#x5355;&#x8C03;&#x9012;&#x589E;&#x3002;</p>
<p>&#x5F97;&#x5230;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>-D[i]&lt; \frac{A[j]-A[k]}{G[j]-G[k]}<br>$$<br>&#x7EF4;&#x62A4;&#x4E0A;&#x51F8;&#x5305;&#x3002;&#x6CE8;&#x610F;&#x7EF4;&#x62A4;&#x51F8;&#x5305;&#x65F6;&#x8981;&#x7528;&#x53C9;&#x79EF;&#x4EE3;&#x66FF;&#x659C;&#x7387;&#xFF0C;&#x907F;&#x514D;&#x8BEF;&#x5DEE;&#xFF01;</p>
<p>&#x5206;&#x6CBB;&#x4E00;&#x4E0B;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x662F;&#xFF1A;$O(n\log ^ 2 n)$&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> inf = <span class="number">1e18</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, C, tot, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> Q[MAX_N];</span><br><span class="line">ll dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Machine</span> {</span></span><br><span class="line">    <span class="keyword">int</span> D, P, G, R;</span><br><span class="line"></span><br><span class="line">    Machine() {}</span><br><span class="line">    Machine(<span class="keyword">int</span> _D, <span class="keyword">int</span> _P, <span class="keyword">int</span> _R, <span class="keyword">int</span> _G): </span><br><span class="line">        D(_D), P(_P), R(_R), G(_G) {}</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Machine&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">return</span> D &lt; rhs.D;</span><br><span class="line">    }</span><br><span class="line">} mach[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> {</span></span><br><span class="line">    ll x, y;</span><br><span class="line"></span><br><span class="line">    Point() {}</span><br><span class="line">    Point(ll _x, ll _y): x(_x), y(_y) {}</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">if</span> (x != rhs.x) <span class="keyword">return</span> x &lt; rhs.x;</span><br><span class="line">        <span class="keyword">return</span> y &lt; rhs.y;</span><br><span class="line">    }</span><br><span class="line">    Point <span class="keyword">operator</span> - (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">return</span> Point(x - rhs.x, y - rhs.y);</span><br><span class="line">    }</span><br><span class="line">    Point <span class="keyword">operator</span> + (<span class="keyword">const</span> Point&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">        <span class="keyword">return</span> Point(x + rhs.x, y + rhs.y);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(<span class="keyword">const</span> Point&amp; rhs)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.0</span> * x * rhs.y - <span class="number">1.0</span> * y * rhs.x; </span><br><span class="line">    }</span><br><span class="line">} P[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">0</span>) <span class="keyword">return</span> -inf;</span><br><span class="line">    <span class="keyword">if</span> (P[i].x == P[j].x) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span> * (P[i].y - P[j].y) / (P[i].x - P[j].x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left == right) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (left + right) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    cdq(left, mid);</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= mid; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (dp[i] &gt;= mach[i].P) {</span><br><span class="line">            ll tmp = dp[i] - mach[i].P + mach[i].R - <span class="number">1l</span>l * mach[i].G * (mach[i].D + <span class="number">1</span>);</span><br><span class="line">            P[tot++] = Point(mach[i].G, tmp);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    sort(P, P + tot);</span><br><span class="line">    <span class="keyword">int</span> tp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tot; ++i) {</span><br><span class="line">        <span class="keyword">while</span> (tp &gt; <span class="number">1</span> &amp;&amp; (P[Q[tp - <span class="number">1</span>]] - P[Q[tp]]).cross(P[i] - P[Q[tp]]) &lt;= <span class="number">0</span>) --tp;</span><br><span class="line">        Q[++tp] = i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (!tp) {</span><br><span class="line">        cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    Q[++tp] = <span class="number">0</span>; <span class="comment">// &#x6DFB;&#x52A0;&#x8FB9;&#x754C;</span></span><br><span class="line">    <span class="keyword">int</span> st = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>; i &lt;= right; ++i) {</span><br><span class="line">        <span class="keyword">while</span> (slope(Q[st], Q[st + <span class="number">1</span>]) &gt;= -mach[i].D) ++st;</span><br><span class="line">        <span class="keyword">int</span> id = Q[st];</span><br><span class="line">        dp[i] = max(dp[i], <span class="number">1l</span>l * P[id].x * mach[i].D + P[id].y);</span><br><span class="line">    }</span><br><span class="line">    cdq(mid + <span class="number">1</span>, right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;C, &amp;tot) &amp;&amp; (n + C + tot)) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">            <span class="keyword">int</span> D, P, R, G;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;D, &amp;P, &amp;R, &amp;G);</span><br><span class="line">            mach[i] = Machine(D, P, R, G);</span><br><span class="line">        }</span><br><span class="line">        sort(mach + <span class="number">1</span>, mach + <span class="number">1</span> + n);</span><br><span class="line">        mach[++n] = Machine(tot + <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) dp[i] = C;</span><br><span class="line">        cdq(<span class="number">1</span>, n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case %d: %lld\n&quot;</span>, ++cases, dp[n]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">2016ICPC 沈阳 E,I 搜索，斜率dp</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/思无涯/">思无涯</a>
  
  </li>
</ul>
    <div class="post-content">
      <p>e_e<br><a id="more"></a></p>
<h4 id="e"><a href="#E" class="headerlink" title="E"></a>E</h4><h5 id="&#x9898;&#x76EE;&#x94FE;&#x63A5;"><a href="#&#x9898;&#x76EE;&#x94FE;&#x63A5;" class="headerlink" title="&#x9898;&#x76EE;&#x94FE;&#x63A5;"></a>&#x9898;&#x76EE;&#x94FE;&#x63A5;</h5><p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5952" target="_blank" rel="noopener">HDU 5952</a></p>
<h5 id="&#x9898;&#x610F;"><a href="#&#x9898;&#x610F;" class="headerlink" title="&#x9898;&#x610F;"></a>&#x9898;&#x610F;</h5><p>&#x7ED9;$n\leq 100$&#x4E2A;&#x70B9;&#x548C;$m\leq 1000$&#x6761;&#x8FB9;&#x7684;&#x65E0;&#x5411;&#x56FE;&#xFF0C;&#x4ECE;&#x4E2D;&#x627E;&#x5230;&#x56E2;&#x5927;&#x5C0F;&#x4E3A;$S\in [2,10]$&#x7684;&#x56E2;&#x6570;&#x91CF;&#x3002;&#x4E00;&#x4E2A;&#x56E2;&#x662F;&#x56FE;&#x4E2D;&#x4EFB;&#x610F;&#x4E24;&#x70B9;&#x4E4B;&#x95F4;&#x90FD;&#x6709;&#x4E00;&#x6761;&#x8FB9;&#x7684;&#x56FE;&#xFF0C;&#x56E2;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x56E2;&#x4E2D;&#x70B9;&#x7684;&#x4E2A;&#x6570;&#x3002;&#x8F93;&#x5165;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x70B9;&#x7684;&#x5EA6;&#x4E0D;&#x8D85;&#x8FC7;20&#x3002;</p>
<h5 id="&#x5206;&#x6790;"><a href="#&#x5206;&#x6790;" class="headerlink" title="&#x5206;&#x6790;"></a>&#x5206;&#x6790;</h5><p>&#x4E00;&#x5F00;&#x59CB;&#x5EFA;&#x65E0;&#x5411;&#x56FE;&#xFF0C;&#x8DD1;&#x7206;&#x641C;TLE&#xFF0C;&#x7136;&#x540E;&#x679A;&#x4E3E;&#x56E2;&#x7684;&#x5927;&#x5C0F;$i:1\sim S$,&#x4E0D;&#x65AD;&#x6269;&#x5927;&#x56E2;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x7528;$vector$&#x5B58;&#x9009;&#x62E9;&#x65B9;&#x6848;&#xFF0C;&#x6700;&#x540E;$vec[S].size()$&#x5C31;&#x662F;&#x7B54;&#x6848;&#xFF0C;&#x7136;&#x800C;MLE:(</p>
<p>&#x6700;&#x5173;&#x952E;&#x7684;&#x662F;&#xFF1A;<strong>&#x5EFA;&#x6709;&#x5411;&#x56FE;&#xFF0C;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x56E2;&#x53EA;&#x4F1A;&#x88AB;&#x904D;&#x5386;&#x4E00;&#x6B21;&#x3002;</strong>&#x63A5;&#x4E0B;&#x6765;&#x76F4;&#x63A5;&#x679A;&#x4E3E;&#x56E2;&#x7684;&#x201C;&#x8D77;&#x70B9;&#x201D;&#xFF0C;&#x7206;&#x641C;&#xFF0C;&#x7528;&#x6570;&#x7EC4;&#x8BB0;&#x5F55;&#x5DF2;&#x7ECF;&#x9009;&#x62E9;&#x70B9;&#xFF0C;&#x6BCF;&#x6B21;&#x65B0;&#x6DFB;&#x52A0;&#x70B9;&#x7684;&#x65F6;&#x5019;&#x5224;&#x65AD;&#x65B0;&#x52A0;&#x70B9;&#x80FD;&#x5426;&#x548C;&#x5DF2;&#x9009;&#x7684;&#x70B9;&#x90FD;&#x6709;&#x8FB9;&#xFF0C;&#x76F4;&#x5230;&#x56E2;&#x7684;&#x5927;&#x5C0F;&#x4E3A;$S$&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;$O(100*C_{20}^{9})$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">110</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m, S;</span><br><span class="line"><span class="keyword">int</span> degree[MAX_N], link[MAX_N][MAX_N], can[MAX_N];</span><br><span class="line">ll ans;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; edge[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> sum)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (sum == S) {</span><br><span class="line">        ans++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; edge[u].size(); ++i) {</span><br><span class="line">        <span class="keyword">int</span> v = edge[u][i], flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= sum; ++j) {</span><br><span class="line">            <span class="keyword">if</span> (link[v][can[j]] == <span class="number">0</span>) {</span><br><span class="line">                flag = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            can[sum + <span class="number">1</span>] = v;</span><br><span class="line">            dfs(v, sum + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">    ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (degree[i] &lt; S - <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        can[<span class="number">1</span>] = i;</span><br><span class="line">        dfs(i, <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--) {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;S);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) edge[i].clear();</span><br><span class="line">        <span class="built_in">memset</span>(link, <span class="number">0</span>, <span class="keyword">sizeof</span> (link));</span><br><span class="line">        <span class="built_in">memset</span>(degree, <span class="number">0</span>, <span class="keyword">sizeof</span> (degree));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) {</span><br><span class="line">            <span class="keyword">int</span> u, v;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">            <span class="keyword">if</span> (link[u][v]) <span class="keyword">continue</span>;</span><br><span class="line">            degree[u]++;</span><br><span class="line">            link[u][v] = link[v][u] = <span class="number">1</span>;</span><br><span class="line">            edge[u].push_back(v);</span><br><span class="line">        }</span><br><span class="line">        solve();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="i"><a href="#I" class="headerlink" title="I"></a>I</h4><h5 id="&#x9898;&#x76EE;&#x94FE;&#x63A5;"><a href="#&#x9898;&#x76EE;&#x94FE;&#x63A5;-1" class="headerlink" title="&#x9898;&#x76EE;&#x94FE;&#x63A5;"></a>&#x9898;&#x76EE;&#x94FE;&#x63A5;</h5><p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5956" target="_blank" rel="noopener">HDU 5956</a></p>
<h5 id="&#x9898;&#x610F;"><a href="#&#x9898;&#x610F;-1" class="headerlink" title="&#x9898;&#x610F;"></a>&#x9898;&#x610F;</h5><p>&#x7ED9;&#x4E00;&#x4E2A;$n\leq 100000$&#x4E2A;&#x7ED3;&#x70B9;&#x7684;&#x6709;&#x6839;&#x6811;&#xFF0C;&#x6839;&#x8282;&#x70B9;&#x4E3A;1&#x3002;&#x8FB9;&#x6743;$\leq 100$&#x3002;&#x5C06;&#x9898;&#x610F;&#x8F6C;&#x5316;&#x4E00;&#x4E0B;&#x53EF;&#x5F97;&#xFF1A;$dp[1]=-P,dp[i]=\min (dp[j]+dis(i,j)^2)+P$&#xFF0C;&#x5176;&#x4E2D;$P$&#x662F;&#x7ED9;&#x5B9A;&#x7684;&#x5E38;&#x6570;$P\leq 10^6,j$&#x662F;$i$&#x7684;&#x7956;&#x5148;&#x3002;&#x6C42;$\max(dp[i])$&#x3002;</p>
<h5 id="&#x5206;&#x6790;"><a href="#&#x5206;&#x6790;-1" class="headerlink" title="&#x5206;&#x6790;"></a>&#x5206;&#x6790;</h5><p>&#x4E0A;&#x9762;&#x7684;&#x9898;&#x610F;&#x8F6C;&#x5316;&#x548C;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x9898;&#x610F;&#x7684;&#x4F18;&#x70B9;&#x5728;&#x4E8E;&#x53EF;&#x4EE5;&#x4ECE;&#x6839;dfs&#x5904;&#x7406;&#xFF0C;&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;&#x7956;&#x5148;&#x3002;</p>
<p>&#x5B9A;&#x4E49;$dis[i]$&#x662F;&#x7ED3;&#x70B9;$i$&#x5230;&#x6839;&#x8282;&#x70B9;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>\begin{aligned}<br>dp[i]&amp;=\min(dp[j]+(dis[j]-dis[i])^2)+P \\<br>&amp;=\min(dp[j]+dis[j]^2-2*dis[j]*dis[i])+dis[i]^2+P<br>\end{aligned}<br>$$<br>&#x8003;&#x8651;&#x659C;&#x7387;&#x4F18;&#x5316;&#x3002;&#x5047;&#x8BBE;$k$&#x5904;&#x51B3;&#x7B56;&#x4F18;&#x4E8E;$j$&#x5904;&#x51B3;&#x7B56;&#xFF0C;&#x4E14;$dis[k]&gt;dis[j]$&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x5F97;&#xFF1A;<br>$$<br>\begin{aligned}<br>dis[k]^2-2*dis[k]*dis[i]+dp[k] &lt; dis[j]^2-2*dis[j]*dis[i]+dp[j]\\<br>\frac{(dis[k]^2+dp[k])-(dis[j]^2+dp[j])}{2*(dis[k]-dis[j])} &lt; dis[i]<br>\end{aligned}<br>$$<br>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x663E;&#x7136;&#x7684;&#x659C;&#x7387;&#x4F18;&#x5316;&#x7684;&#x5F0F;&#x5B50;&#x4E86;&#x3002;&#x5269;&#x4E0B;&#x7684;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#xFF0C;&#x5C31;&#x662F;dfs&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5220;&#x70B9;&#x548C;&#x8FD8;&#x539F;&#x70B9;&#x95EE;&#x9898;&#x3002;&#x6211;&#x662F;&#x6BCF;&#x5C42;&#x7528;&#x4E24;&#x4E2A;vector&#x4FDD;&#x5B58;&#x4E00;&#x4E0B;&#x961F;&#x5217;&#x9996;&#x548C;&#x961F;&#x5217;&#x5C3E;&#x5220;&#x9664;&#x7684;&#x70B9;&#xFF0C;dfs&#x7ED3;&#x675F;&#x540E;&#x518D;&#x8FD8;&#x539F;&#x56DE;&#x6765;&#xFF0C;&#x6574;&#x4F53;&#x601D;&#x8DEF;&#x6BD4;&#x8F83;&#x66B4;&#x529B;&#xFF0C;&#x65F6;&#x9650;4000ms&#xFF0C;&#x8DD1;&#x4E86;1500ms&#x3002;</p>
<p>&#x6B63;&#x89E3;&#x662F;&#xFF1A;&#x6811;&#x5206;&#x6CBB;+&#x659C;&#x7387;&#x4F18;&#x5316;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> ll INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, P, tot, head, tail;</span><br><span class="line"><span class="keyword">int</span> Head[MAX_N], Q[MAX_N], dis[MAX_N];</span><br><span class="line">ll dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> {</span></span><br><span class="line">	<span class="keyword">int</span> v, w, next;</span><br><span class="line"></span><br><span class="line">	Edge() {}</span><br><span class="line">	Edge(<span class="keyword">int</span> _v, <span class="keyword">int</span> _w, <span class="keyword">int</span> _next): v(_v), w(_w), next(_next) {}</span><br><span class="line">} edge[MAX_N * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">memset</span>(Head, <span class="number">-1</span>, <span class="keyword">sizeof</span> (Head));</span><br><span class="line">	<span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> (dp));</span><br><span class="line">	tot = head = tail = <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>{</span><br><span class="line">	edge[tot] = Edge(v, w, Head[u]);</span><br><span class="line">	Head[u] = tot++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1l</span>l * dis[a] * dis[a] + dp[a] - (<span class="number">1l</span>l * dis[b] * dis[b] + dp[b]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">2l</span>l * (dis[a] - dis[b]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> p)</span> </span>{</span><br><span class="line">	<span class="keyword">int</span> tp1, tp2, id;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pre, suf;</span><br><span class="line">	tp1 = head, tp2 = tail;</span><br><span class="line">	<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;</span><br><span class="line">			 S(Q[head + <span class="number">1</span>], Q[head]) * dis[u]) {</span><br><span class="line">		pre.push_back(Q[head++]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (u != <span class="number">1</span>) {</span><br><span class="line">		id = Q[head];</span><br><span class="line">		dp[u] = min(dp[u], dp[id] + <span class="number">1l</span>l * (dis[u] - dis[id]) * (dis[u] - dis[id]) + P);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(u, Q[tail]) </span><br><span class="line">		&gt; G(u, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) {</span><br><span class="line">		suf.push_back(Q[tail--]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (u != <span class="number">1</span>) Q[++tail] = u;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = Head[u]; i != <span class="number">-1</span>; i = edge[i].next) {</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">		<span class="keyword">if</span> (v == p) <span class="keyword">continue</span>;</span><br><span class="line">		dis[v] = dis[u] + w;</span><br><span class="line">		dfs(v, u);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> size1 = pre.size(), size2 = suf.size();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size1; ++i) {</span><br><span class="line">		Q[tp1 + i] = pre[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size2; ++i) {</span><br><span class="line">		Q[tp2 - i] = suf[i];</span><br><span class="line">	}</span><br><span class="line">	head = tp1, tail = tp2;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		init();</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;P);</span><br><span class="line">		dp[<span class="number">1</span>] = -P, dis[<span class="number">1</span>] = <span class="number">0</span>, Q[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> u, v, w;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;u, &amp;v, &amp;w);</span><br><span class="line">			AddEdge(u, v, w);</span><br><span class="line">			AddEdge(v, u, w);</span><br><span class="line">		}</span><br><span class="line">		dfs(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">		ll ans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			ans = max(ans, dp[i]);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">斜率优化（三）</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p><a href="http://wenku.baidu.com/view/ef259400bed5b9f3f90f1c3a.html" target="_blank" rel="noopener">&#x7528;&#x5355;&#x8C03;&#x6027;&#x4F18;&#x5316;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x2013;JSOI2009 &#x96C6;&#x8BAD;&#x961F;&#x8BBA;&#x6587;</a><br><a href="http://wenku.baidu.com/view/f6421ce8b8f67c1cfad6b8ac.html" target="_blank" rel="noopener">&#x6D45;&#x8C08;&#x6570;&#x5F62;&#x7ED3;&#x5408;&#x5728;&#x4FE1;&#x606F;&#x5B66;&#x7ADE;&#x8D5B;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x2013;&#x5B89;&#x5FBD;&#x829C;&#x6E56;&#x4E00;&#x4E2D;&#xB7;&#x5468;&#x6E90;</a><br>&#x5728;VJ&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/135311#overview" target="_blank" rel="noopener">Here</a>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x62C9;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#x6574;&#x5408;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;G,K,R&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x3002;&#x3002;&#x3002;R&#x9898;&#x597D;&#x50CF;&#x8FD8;&#x662F;2014 World Final&#x7684;&#x9898;&#x554A;&#x3002;<br><a id="more"></a></p>
<h5 id="o"><a href="#O" class="headerlink" title="O"></a>O</h5><p>[BZOJ 1096]&#xFF1A;&#x6709;$n\leq 10^6$&#x4E2A;&#x5DE5;&#x5382;&#xFF0C;&#x6309;&#x7F16;&#x53F7;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x4ECE;&#x5C71;&#x9876;&#x5411;&#x5C71;&#x811A;&#x5206;&#x5E03;&#xFF0C;&#x7ED9;&#x51FA;&#x6BCF;&#x4E2A;&#x5DE5;&#x5382;&#x8DDD;&#x79BB;&#x7B2C;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x7684;&#x8DDD;&#x79BB;&#x548C;&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x62E5;&#x6709;&#x7684;&#x5546;&#x54C1;&#x6570;&#x91CF;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x5EFA;&#x50A8;&#x5B58;&#x5BA4;&#x7684;&#x4EE3;&#x4EF7;&#xFF0C;&#x5546;&#x54C1;&#x53EA;&#x80FD;&#x5411;&#x4E0B;&#x8FD0;&#x8F93;&#xFF0C;&#x8FD0;&#x8F93;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x5546;&#x54C1;&#x6570;&#x91CF;&#x4E58;&#x4EE5;&#x8DDD;&#x79BB;&#xFF0C;&#x6C42;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x5DE5;&#x5382;&#x5EFA;&#x50A8;&#x5B58;&#x5BA4;&#x4F7F;&#x5F97;&#x603B;&#x4EE3;&#x4EF7;&#x6700;&#x5C0F;&#x3002;</p>
<p>&#x8BB0;&#xFF1A;<br>$$<br>pre[i]=\sum_{r=1}^{r=i}{num[i]} \\<br>sum[i]=\sum_{r=1}^{r=i}{num[i]*dis[i]}<br>$$<br>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=min(dp[j]+dis[i]*(pre[i]-pre[j])-(sum[i]-sum[j])+cost[i])<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x]+sum[x]-(dp[y]+sum[y])}{pre[x]-pre[y]}\leq dis[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] + sum[x] - dp[y] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> pre[x] - pre[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;</span><br><span class="line">			dis[i] * S(Q[head + <span class="number">1</span>], Q[head])) head++;</span><br><span class="line">		<span class="keyword">int</span> pos = Q[head];</span><br><span class="line">		dp[i] = dp[pos] + dis[i] * (pre[i] - pre[pos]) + sum[pos] - sum[i] + cost[i];</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail]) &gt;</span><br><span class="line">								G(i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) tail--; </span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) {</span><br><span class="line">		pre[<span class="number">0</span>] = sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>, &amp;dis[i], &amp;num[i], &amp;cost[i]);</span><br><span class="line">			pre[i] = pre[i - <span class="number">1</span>] + num[i];</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + dis[i] * num[i];</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="p"><a href="#P" class="headerlink" title="P"></a>P</h5><p>[BZOJ 1492]&#xFF1A;&#x7ED9;&#x51FA;$n\leq 10^5$&#x5929;&#x6BCF;&#x5929;A&#x548C;B&#x4E24;&#x79CD;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;&#xFF0C;&#x521D;&#x59CB;&#x65F6;&#x62E5;&#x6709;$S$&#x5143;&#xFF0C;&#x5728;&#x7B2C;$i$&#x5929;&#x53EF;&#x4EE5;&#x6709;&#x4E09;&#x79CD;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li>&#x628A;&#x624B;&#x4E0A;&#x7684;&#x524D;&#x5168;&#x90E8;&#x7528;&#x6765;&#x4E70;&#x80A1;&#x7968;&#xFF0C;&#x80A1;&#x7968;A&#x548C;&#x80A1;&#x7968;B&#x7684;&#x6570;&#x91CF;&#x4E4B;&#x6BD4;&#x5E94;&#x4E3A;$rate[i]$</li>
<li>&#x628A;&#x624B;&#x4E0A;&#x7684;&#x80A1;&#x7968;&#x5168;&#x90E8;&#x5356;&#x51FA;&#xFF0C;&#x5F97;&#x5230;&#x5F53;&#x5929;&#x5E94;&#x5F97;&#x7684;&#x91D1;&#x989D;</li>
<li>&#x4E0D;&#x4E70;&#x4E0D;&#x5356;</li>
</ul>
<p>&#x95EE;&#x6700;&#x7EC8;&#x53EF;&#x4EE5;&#x83B7;&#x5229;&#x591A;&#x5C11;&#xFF1F;</p>
<p>&#x7528;$dp[i]$&#x8868;&#x793A;&#x5728;&#x7B2C;$i$&#x5929;&#x5C06;&#x624B;&#x4E2D;&#x7684;&#x80A1;&#x7968;&#x5168;&#x90E8;&#x5356;&#x51FA;&#x53EF;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x5927;&#x94B1;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x7528;&#x8FD9;&#x4E9B;&#x94B1;&#x6309;&#x7167;$rate[i]$&#x7684;&#x6BD4;&#x4F8B;&#x53EF;&#x4EE5;&#x8D2D;&#x5F97;&#x7684;A&#x7C7B;&#x548C;B&#x7C7B;&#x80A1;&#x7968;&#x7684;&#x6570;&#x91CF;&#x5206;&#x522B;&#x4E3A;&#xFF1A;$a[i]$&#x548C;$b[i]$&#xFF0C;&#x7528;$A[i]$&#x548C;$B[i]$&#x8868;&#x793A;A&#x7C7B;&#x548C;B&#x7C7B;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;&#x3002;</p>
<p>&#x7531;&#xFF1A;<br>$$<br>\begin{aligned}<br>\frac{a[i]}{b[i]}&amp;=rate[i]\\<br>a[i]*A[i]+b[i]*B[i]&amp;=dp[i]<br>\end{aligned}<br>$$<br>&#x53EF;&#x4EE5;&#x89E3;&#x51FA;$a[i]$&#x548C;$b[i]$&#x3002;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=max(a[j]*A[i]+b[j]*B[i])\quad (j&lt; i)<br>$$<br>&#x4EE4;$a[j]=x,b[j]=y,A[i]=a,B[i]=b,dp[i]=G$&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x662F;&#x5728;&#x5DF2;&#x77E5;$a,b$&#x7684;&#x6761;&#x4EF6;&#x4E0B;&#x6C42;$G=a*x+b*y$&#x7684;&#x6700;&#x5927;&#x503C;&#x3002;&#x5316;&#x6210;&#x659C;&#x7387;&#xFF1A;$y=-\frac{a}{b}x+\frac{G}{b}$&#x3002;</p>
<p>&#x5269;&#x4E0B;&#x7684;&#x542C;&#x8BF4;&#x8981;CDQ&#x5206;&#x6CBB;&#x641E;&#xFF0C;&#x7136;&#x800C;&#x8FD8;&#x4E0D;&#x4F1A;&#x554A;&#x3002;&#x3002;&#x3002;<br>&#x53C2;&#x8003;&#x535A;&#x5BA2;&#x94FE;&#x63A5;&#xFF1A;<a href="http://blog.inet198.cn/?creationaugust/article/details/44964863" target="_blank" rel="noopener">Here</a><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> INF = <span class="number">1e18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N	= <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> sta[MAX_N];</span><br><span class="line"><span class="keyword">double</span> S, ans[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt;= eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> {</span></span><br><span class="line">	<span class="keyword">double</span> a, b, rate, k; <span class="comment">// a,b: A &#x548C; B &#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7; k: &#x4EF7;&#x683C;&#x659C;&#x7387;&#xFF0C; cdq &#x6392;&#x5E8F;&#x5173;&#x952E;&#x5B57;</span></span><br><span class="line">	<span class="keyword">double</span> x, y; <span class="comment">// x,y: &#x5356;&#x51FA;&#x540E;&#x53EF;&#x5230;&#x7684; A,B &#x80A1;&#x7968;&#x6570;&#x91CF;</span></span><br><span class="line">	<span class="keyword">int</span> id; </span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Query&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">return</span> sgn(k - rhs.k) &gt;= <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">} ques[MAX_N], newq[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">return</span> -INF;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (sgn(ques[a].x - ques[b].x) == <span class="number">0</span>) <span class="keyword">return</span> INF;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> (ques[a].y - ques[b].y) / (ques[a].x - ques[b].x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> low, <span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (low == high) {</span><br><span class="line">		<span class="keyword">int</span> id = ques[low].id;</span><br><span class="line">		ans[low] = max(ans[low], ans[low - <span class="number">1</span>]);</span><br><span class="line">		ques[low].x = ans[low] * ques[low].rate / (ques[low].rate * ques[low].a + ques[low].b);</span><br><span class="line">		ques[low].y = ques[low].x / ques[low].rate;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> mid = (low + high) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> tp1 = low, tp2 = mid + <span class="number">1</span>, top = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = low; i &lt;= high; ++i) { <span class="comment">// &#x6309;&#x65F6;&#x95F4;&#x5212;&#x5206;&#x64CD;&#x4F5C;&#x533A;&#x95F4;</span></span><br><span class="line"> 		<span class="keyword">if</span> (ques[i].id &lt;= mid) newq[tp1++] = ques[i];</span><br><span class="line">		<span class="keyword">else</span> newq[tp2++] = ques[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(ques + low, newq + low, <span class="keyword">sizeof</span> (Query) * (high - low + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">	solve(low, mid);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = low; i &lt;= mid; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (top &gt; <span class="number">1</span> &amp;&amp; sgn(slope(sta[top - <span class="number">1</span>], sta[top]) - slope(sta[top - <span class="number">1</span>], i)) &lt; <span class="number">0</span>) top--;</span><br><span class="line">		sta[++top] = i;</span><br><span class="line">	}</span><br><span class="line">	sta[++top] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>, j = <span class="number">1</span>; i &lt;= high; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (j &lt; top &amp;&amp; sgn(ques[i].k - slope(sta[j], sta[j + <span class="number">1</span>])) &lt; <span class="number">0</span>) ++j;</span><br><span class="line">		ans[ques[i].id] = max(ans[ques[i].id], ques[sta[j]].x * ques[i].a + ques[sta[j]].y * ques[i].b);</span><br><span class="line">	}</span><br><span class="line">	solve(mid + <span class="number">1</span>, high);</span><br><span class="line"></span><br><span class="line">	tp1 = <span class="number">1</span>, tp2 = mid + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = low; i &lt;= high; ++i) {</span><br><span class="line">		<span class="keyword">if</span> (tp1 &lt;= mid &amp;&amp; (ques[tp1].x &lt; ques[tp2].x || </span><br><span class="line">			sgn((ques[tp1].x - ques[tp2].x) == <span class="number">0</span> &amp;&amp; sgn(ques[tp1]. y - ques[tp2].y) &lt; <span class="number">0</span>)) ||</span><br><span class="line">			tp2 &gt; high) newq[tp1++] = ques[i];</span><br><span class="line">		<span class="keyword">else</span> newq[tp2++] = ques[i];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memcpy</span>(ques + low, newq + low, <span class="keyword">sizeof</span> (Query) * (high - low + <span class="number">1</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%lf&quot;</span>, &amp;n, &amp;S)) {</span><br><span class="line">		ans[<span class="number">0</span>] = S;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>, &amp;ques[i].a, &amp;ques[i].b, &amp;ques[i].rate);</span><br><span class="line">			ques[i].id = i;</span><br><span class="line">			ques[i].k = -ques[i].a / ques[i].b;</span><br><span class="line">			ans[i] = <span class="number">0</span>;</span><br><span class="line">		}</span><br><span class="line">		sort(ques + <span class="number">1</span>, ques + n + <span class="number">1</span>);</span><br><span class="line">		solve(<span class="number">1</span>, n);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%.3lf\n&quot;</span>, ans[n]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="s"><a href="#S" class="headerlink" title="S"></a>S</h5><p>[BZOJ 1010]&#xFF1A;&#x5C06;$n\leq 5*10^4$&#x4E2A;&#x73A9;&#x5177;&#x5206;&#x7EC4;&#x6253;&#x5305;&#xFF0C;&#x6BCF;&#x7EC4;&#x7684;&#x73A9;&#x5177;&#x5FC5;&#x987B;&#x662F;&#x8FDE;&#x7EED;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A;&#x73A9;&#x5177;&#x7684;&#x957F;&#x5EA6;&#x4E3A;$len[i]$&#x3002;&#x5982;&#x679C;&#x5C06;&#x7B2C;$x$&#x5230;&#x7B2C;$y$&#x4E2A;&#x73A9;&#x5177;&#x6253;&#x5305;&#x5230;&#x4E00;&#x7EC4;&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x4EEC;&#x7684;&#x957F;&#x5EA6;$l=y-x+\sum_{i=x}^{i=y}{len[i]}$&#xFF0C;&#x5C06;&#x8FD9;&#x7EC4;&#x73A9;&#x5177;&#x6253;&#x5305;&#x7684;&#x4EE3;&#x4EF7;&#x7B49;&#x4E8E;$(l-L)^2$&#xFF0C;&#x6C42;&#x5C06;&#x6240;&#x6709;&#x73A9;&#x5177;&#x6253;&#x5305;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF0C;&#x6BCF;&#x7EC4;&#x73A9;&#x5177;&#x4E2A;&#x6570;&#x6CA1;&#x6709;&#x9650;&#x5236;&#x3002;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$dp[i]=min(dp[j]+(sum[i]-sum[j]+i-j-1-L)^2)$$<br>&#x4EE4;$C=1+L,f[i]=sum[i]+i$&#xFF0C;&#x53EF;&#x5F97;&#xFF1A;<br>$$dp[i]=min(dp[j]+(f[i]-f[j]-C)^2)$$<br>&#x4EE4;$G(x)=dp[x]+(f[x]+C)^2$&#xFF0C;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$\frac{G(x)-G(y)}{2*(f[x]-f[y])}\leq f[i]$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">50010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, L, C, head, tail;</span><br><span class="line"><span class="keyword">int</span> len[MAX_N], que[MAX_N];</span><br><span class="line">ll sum[MAX_N], f[MAX_N], dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> (f[x] - f[y]) * <span class="number">2</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y] + (f[x] + C) * (f[x] + C) - (f[y] + C) * (f[y] + C);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	C = L + <span class="number">1</span>;</span><br><span class="line">	sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		sum[i] = sum[i - <span class="number">1</span>] + len[i];</span><br><span class="line">		f[i] = sum[i] + i;</span><br><span class="line">	}</span><br><span class="line">	head = <span class="number">0</span>, tail = <span class="number">1</span>;</span><br><span class="line">	que[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt;= tail - <span class="number">2</span> &amp;&amp; G(que[head + <span class="number">1</span>], que[head]) </span><br><span class="line">			&lt;= f[i] * S(que[head + <span class="number">1</span>], que[head]))  head++;</span><br><span class="line">		dp[i] = dp[que[head]] + (f[i] - f[que[head]] - C) * (f[i] - f[que[head]] - C);</span><br><span class="line">		<span class="keyword">while</span> (head &lt;= tail - <span class="number">2</span> &amp;&amp; G(i, que[tail - <span class="number">1</span>]) * S(que[tail - <span class="number">1</span>], que[tail - <span class="number">2</span>]) &lt;= </span><br><span class="line">					  G(que[tail - <span class="number">1</span>], que[tail - <span class="number">2</span>]) * S(i, que[tail - <span class="number">1</span>])) tail--;</span><br><span class="line">		que[tail++] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;L)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;len[i]);</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">斜率优化（二）</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p><a href="http://wenku.baidu.com/view/ef259400bed5b9f3f90f1c3a.html" target="_blank" rel="noopener">&#x7528;&#x5355;&#x8C03;&#x6027;&#x4F18;&#x5316;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x2013;JSOI2009 &#x96C6;&#x8BAD;&#x961F;&#x8BBA;&#x6587;</a><br><a href="http://wenku.baidu.com/view/f6421ce8b8f67c1cfad6b8ac.html" target="_blank" rel="noopener">&#x6D45;&#x8C08;&#x6570;&#x5F62;&#x7ED3;&#x5408;&#x5728;&#x4FE1;&#x606F;&#x5B66;&#x7ADE;&#x8D5B;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x2013;&#x5B89;&#x5FBD;&#x829C;&#x6E56;&#x4E00;&#x4E2D;&#xB7;&#x5468;&#x6E90;</a><br>&#x5728;VJ&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/135311#overview" target="_blank" rel="noopener">Here</a>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x62C9;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#x6574;&#x5408;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;G,K,R&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x3002;&#x3002;&#x3002;R&#x9898;&#x597D;&#x50CF;&#x8FD8;&#x662F;2014 World Final&#x7684;&#x9898;&#x554A;&#x3002;<br><a id="more"></a></p>
<h5 id="f"><a href="#F" class="headerlink" title="F"></a>F</h5><p>F&#x9898;&#x548C;N&#x9898;&#x91CD;&#x590D;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<p>[HDU 3669]&#xFF1A;&#x7ED9;&#x51FA;$n\leq 5*10^4$&#x4E2A;&#x77E9;&#x5F62;&#x7684;&#x957F;&#x548C;&#x5BBD;&#xFF0C;&#x8981;&#x6C42;&#x628A;&#x8FD9;&#x4E9B;&#x77E9;&#x5F62;&#x6700;&#x591A;&#x5206;&#x6210;$K$&#x7EC4;&#xFF0C;&#x6BCF;&#x7EC4;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x6240;&#x6709;&#x8FD9;&#x7EC4;&#x77E9;&#x5F62;&#x7684;&#x6700;&#x5927;&#x5BBD;&#x4E58;&#x4EE5;&#x6700;&#x5927;&#x957F;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>&#x5148;&#x628A;&#x77E9;&#x5F62;&#x6309;&#x7167;&#x4F18;&#x5148;&#x5BBD;&#x5EA6;&#xFF1A;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#xFF0C;&#x5176;&#x6B21;&#x9AD8;&#x5EA6;&#xFF1A;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x7684;&#x987A;&#x5E8F;&#x6392;&#x5E8F;&#xFF0C;&#x5176;&#x6B21;&#x8981;&#x6CE8;&#x610F;&#x5230;&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#x7684;&#x5BBD;&#x548C;&#x957F;&#x90FD;&#x6BD4;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#x5C0F;&#xFF0C;&#x90A3;&#x4E2A;&#x8FD9;&#x4E2A;&#x77E9;&#x5F62;&#x5C31;&#x662F;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x77E9;&#x5F62;&#x7B5B;&#x9009;&#x51FA;&#x7684;&#x77E9;&#x5F62;&#x5E8F;&#x5217;&#x6EE1;&#x8DB3;&#x8FD9;&#x6837;&#x6027;&#x8D28;&#xFF1A;&#x5BBD;&#x9012;&#x51CF;&#x5E76;&#x4E14;&#x957F;&#x9012;&#x589E;&#x3002;</p>
<p>&#x7528;$dp[i][k]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x4E2A;&#x77E9;&#x5F62;&#x5206;&#x6210;$k$&#x7EC4;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF1A;<br>$$<br>dp[i][k]=min(dp[j][k-1]+rec[j+1].w*rec[i].h) \quad (j&lt; i)<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x][p-1]-dp[y][p-1]}{rec[y+1].w-rec[x+1].w}\leq rec[i].h<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> Q[MAX_N];</span><br><span class="line">ll dp[MAX_N][MAX_K];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rec</span> {</span></span><br><span class="line">	<span class="keyword">int</span> w, h;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Rec&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">if</span> (w != rhs.w) <span class="keyword">return</span> w &gt; rhs.w;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> h &gt; rhs.h;</span><br><span class="line">	}</span><br><span class="line">} read[MAX_N], rec[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x][id] - dp[y][id];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> rec[y + <span class="number">1</span>].w - rec[x + <span class="number">1</span>].w;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) { </span><br><span class="line">		dp[i][<span class="number">1</span>] = <span class="number">1l</span>l * rec[<span class="number">1</span>].w * rec[i].h; </span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">2</span>; k &lt;= K; ++k) {</span><br><span class="line">		head = tail = <span class="number">0</span>;</span><br><span class="line">		Q[++tail] = k - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, Q[head + <span class="number">1</span>], Q[head]) </span><br><span class="line">					&lt;= S(Q[head + <span class="number">1</span>], Q[head]) * rec[i].h) ++head;</span><br><span class="line">			<span class="keyword">int</span> t = Q[head];</span><br><span class="line">			dp[i][k] = dp[t][k - <span class="number">1</span>] + <span class="number">1l</span>l * rec[t + <span class="number">1</span>].w * rec[i].h;</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail])</span><br><span class="line">					&gt;= G(k - <span class="number">1</span>, i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) --tail;</span><br><span class="line">			Q[++tail] = i;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	ll ans = (ll)(<span class="number">1e18</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; ++i) {</span><br><span class="line">		ans = min(ans, dp[n][i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;K)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;read[i].w, &amp;read[i].h);</span><br><span class="line">		}</span><br><span class="line">		sort(read, read + n);</span><br><span class="line">		<span class="keyword">int</span> MaxH = <span class="number">0</span>, total = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="keyword">if</span> (read[i].h &gt; MaxH) {</span><br><span class="line">				rec[++total].w = read[i].w;</span><br><span class="line">				rec[total].h = read[i].h;</span><br><span class="line">				MaxH = read[i].h;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		n = total;</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="h-&#x5355;&#x8C03;&#x961F;&#x5217;"><a href="#H-&#x5355;&#x8C03;&#x961F;&#x5217;" class="headerlink" title="H (&#x5355;&#x8C03;&#x961F;&#x5217;)"></a>H (&#x5355;&#x8C03;&#x961F;&#x5217;)</h5><p>[POJ 3401]:&#x5DF2;&#x77E5;$n\leq 2000$&#x5929;&#x6BCF;&#x5929;&#x4E70;&#x5356;&#x4E00;&#x5F20;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;&#x548C;&#x4E70;&#x5356;&#x4E0A;&#x9650;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x5929;&#x53EA;&#x80FD;&#x9009;&#x62E9;&#x4E70;&#x6216;&#x8005;&#x5356;&#x6216;&#x8005;&#x4E0D;&#x4EA4;&#x6613;&#xFF0C;&#x800C;&#x4E14;&#x4E24;&#x6B21;&#x4EA4;&#x6613;&#x65E5;&#x671F;&#x4E2D;&#x95F4;&#x81F3;&#x5C11;&#x8981;&#x95F4;&#x9694;$W$&#x5929;&#xFF0C;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x6301;&#x6709;$Max$&#x5F20;&#x80A1;&#x7968;&#x3002;&#x521D;&#x59CB;&#x65F6;&#x6709;&#x65E0;&#x9650;&#x91CF;&#x7684;&#x94B1;&#xFF0C;&#x6C42;&#x6700;&#x7EC8;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x83B7;&#x5229;&#x591A;&#x5C11;&#xFF1F;</p>
<p>&#x7528;$dp[i][j]$&#x8868;&#x793A;&#x5728;&#x7B2C;$i$&#x5929;&#x62E5;&#x6709;$j$&#x5F20;&#x80A1;&#x7968;&#x65F6;&#x7684;&#x6700;&#x591A;&#x83B7;&#x5229;&#x3002;</p>
<ul>
<li><p>&#x7B2C;$i$&#x5929;&#x4E0D;&#x4E70;&#x4E0D;&#x5356;<br>$$dp[i][j]=dp[i - 1][j]$$</p>
</li>
<li><p>&#x7B2C;$i$&#x5929;&#x4E70;&#x80A1;&#x7968;<br>$$dp[i][j]=max(dp[r][k]-cost[i]*(j-k))\quad (r\leq i - W - 1,k&lt; j)$$</p>
</li>
<li><p>&#x7B2C;$i$&#x5929;&#x5356;&#x80A1;&#x7968;<br>$$dp[i][j]=max(dp[r][k]+value[i]*(k-j))\quad (r\leq i - W - 1,k&gt; j)$$</p>
</li>
</ul>
<p>&#x8003;&#x8651;&#x5B9E;&#x9645;&#x610F;&#x4E49;&#x4E0A;&#x9762;&#x5F0F;&#x5B50;&#x4E2D;&#x7684;$r$&#x5C31;&#x5E94;&#x8BE5;&#x662F;$i-W-1$&#x3002;&#x628A;&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x6539;&#x5199;&#x4E00;&#x4E0B;&#xFF1A;<br>$$<br>dp[i][j]=(dp[i-W-1][k]+buy[i]*k)-buy[i]*j (k&lt; j)<br>$$<br>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x524D;&#x9762;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x6C42;&#x524D;&#x7F00;&#x6700;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528;&#x5355;&#x8C03;&#x961F;&#x5217;&#x6765;&#x4FDD;&#x5B58;&#x524D;&#x7F00;&#x6700;&#x5927;&#x3002;&#x5BF9;&#x4E8E;&#x4E70;&#x80A1;&#x7968;&#x7684;&#x884C;&#x4E3A;&#x540C;&#x6837;&#x8FD9;&#x6837;&#x5B50;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;$k&gt;j$&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5012;&#x7740;&#x5904;&#x7406;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">2010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, Max, W, head, tail;</span><br><span class="line"><span class="keyword">int</span> cost[MAX_N], value[MAX_N], buy[MAX_N], sell[MAX_N];</span><br><span class="line"><span class="comment">// cost &#x548C; value: &#x4E70;&#x5356;&#x5355;&#x4EF7;&#xFF0C; buy &#x548C; sell: &#x4E70;&#x5356;&#x4E0A;&#x9650;</span></span><br><span class="line"><span class="keyword">int</span> dp[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Que</span> {</span></span><br><span class="line">	<span class="keyword">int</span> num, sum;</span><br><span class="line">	<span class="comment">// num&#xFF1A; &#x80A1;&#x7968;&#x6570;&#x91CF; sum: &#x5DF2;&#x7ECF;&#x83B7;&#x5229;&#x91CF;</span></span><br><span class="line">	Que() {}</span><br><span class="line">	Que(<span class="keyword">int</span> _num, <span class="keyword">int</span> _sum): num(_num), sum(_sum) {}</span><br><span class="line">} que[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="built_in">memset</span>(dp[i], <span class="number">-0x3f</span>, <span class="keyword">sizeof</span> (dp[i]));</span><br><span class="line">	<span class="comment">// &#x9884;&#x5904;&#x7406;&#x524D; W &#x5929;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= buy[<span class="number">0</span>]; ++j) { dp[<span class="number">0</span>][j] = -j * cost[<span class="number">0</span>]; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= W; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= Max; ++j) {</span><br><span class="line">			dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">			<span class="keyword">if</span> (j &lt;= buy[i]) dp[i][j] = max(dp[i][j], -j * cost[i]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = W + <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">		head = tail = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= Max; ++j) {</span><br><span class="line">			dp[i][j] = dp[i - <span class="number">1</span>][j]; <span class="comment">// &#x4E0D;&#x4E70;&#x4E0D;&#x5356;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">// &#x4E70;</span></span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[tail - <span class="number">1</span>].sum &lt; dp[i - W - <span class="number">1</span>][j] + j * cost[i]) {</span><br><span class="line">				tail--;</span><br><span class="line">			}</span><br><span class="line">			que[tail++] = Que(j, dp[i - W - <span class="number">1</span>][j] + j * cost[i]);</span><br><span class="line">			<span class="comment">// &#x4FDD;&#x8BC1;&#x4E70;&#x7684;&#x6570;&#x91CF;&#x4E0D;&#x8D85;&#x8FC7;&#x4E0A;&#x9650;</span></span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; j - que[head].num &gt; buy[i]) head++;</span><br><span class="line">			dp[i][j] = max(dp[i][j], que[head].sum - j * cost[i]);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		head = tail = <span class="number">0</span>; <span class="comment">// &#x5356;</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = Max; j &gt;= <span class="number">0</span>; --j) {</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[tail - <span class="number">1</span>].sum &lt; dp[i - W - <span class="number">1</span>][j] + j * value[i]) {</span><br><span class="line">				tail--;</span><br><span class="line">			}</span><br><span class="line">			que[tail++] = Que(j, dp[i - W - <span class="number">1</span>][j] + j * value[i]);</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[head].num - j &gt; sell[i]) head++;</span><br><span class="line">			dp[i][j] = max(dp[i][j], que[head].sum - j * value[i]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Max; ++i) {</span><br><span class="line">		ans = max(ans, dp[n - <span class="number">1</span>][i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;Max, &amp;W);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;cost[i], &amp;value[i], &amp;buy[i], &amp;sell[i]);</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="i"><a href="#I" class="headerlink" title="I"></a>I</h5><p>[POJ 2018]&#xFF1A;&#x548C;A&#x9898;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> sum[x] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> x - y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = <span class="number">0</span>, tail = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> pos = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(pos, Q[tail] * S(pos, Q[tail - <span class="number">1</span>]) </span><br><span class="line">			&lt;= G(pos, Q[tail - <span class="number">1</span>]) * S(pos, Q[tail]))) --tail;</span><br><span class="line">		Q[++tail] = pos;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(i, Q[head]) * S(i, Q[head + <span class="number">1</span>]) </span><br><span class="line">			&lt;= G(i, Q[head + <span class="number">1</span>]) * S(i, Q[head])) ++head;</span><br><span class="line"></span><br><span class="line">		dp[i] = <span class="number">1.0</span> * G(i, Q[head]) / S(i , Q[head]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		ans = max(ans, dp[i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (<span class="keyword">int</span>)(ans * <span class="number">1000</span>));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="j"><a href="#J" class="headerlink" title="J"></a>J</h5><p>&#x548C;M&#x9898;&#x91CD;&#x590D;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<p>[POJ 1260]:&#x9700;&#x8981;&#x8D2D;&#x4E70;$n\leq 100$&#x4E2A;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x7ED9;&#x51FA;&#x6BCF;&#x79CD;&#x73CD;&#x73E0;&#x7684;&#x8D2D;&#x4E70;&#x6570;&#x91CF;&#x548C;&#x5355;&#x4EF7;&#xFF0C;&#x9AD8;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x5355;&#x4EF7;&#x8981;&#x5927;&#x4E8E;&#x4F4E;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x5355;&#x4EF7;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x9AD8;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#x4EE3;&#x66FF;&#x4F4E;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x4F46;&#x6570;&#x91CF;&#x8981;&#x4E00;&#x81F4;&#x3002;&#x5982;&#x679C;&#x8D2D;&#x4E70;&#x4E86;&#x4E00;&#x4E2A;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x4E0D;&#x8BBA;&#x6570;&#x91CF;&#x591A;&#x5C11;&#xFF0C;&#x9700;&#x8981;&#x989D;&#x5916;&#x591A;&#x4ED8;10&#x4E2A;&#x8BE5;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x91D1;&#x94B1;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;&#x4F4E;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#x4E0D;&#x4F1A;&#x88AB;&#x8DF3;&#x7EA7;&#x201C;&#x4EE3;&#x4E3A;&#x8D2D;&#x4E70;&#x201D;&#x3002;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=min(dp[j]+(sum[i]-sum[j])*cost[i])<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x]-dp[y]}{sum[x]-sum[y]}\leq cost[i]<br>$$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> sum[x] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;= </span><br><span class="line">					cost[i] * S(Q[head + <span class="number">1</span>], Q[head])) ++head;</span><br><span class="line">		dp[i] = dp[Q[head]] + (sum[i] - sum[Q[head]] + <span class="number">10</span>) * cost[i];</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail])</span><br><span class="line">			&gt;= G(i, Q[tail]) * S(Q[tail], Q[tail  - <span class="number">1</span>])) --tail;</span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">		sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;num[i], &amp;cost[i]);</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + num[i];</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="l"><a href="#L" class="headerlink" title="L"></a>L</h5><p>&#x8FD9;&#x9898;&#x5176;&#x5B9E;&#x662F;&#x4E2A;BFS&#xFF0C;&#x62C9;&#x9519;&#x9898;&#x4E86;&#x3002;&#x3002;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x526A;&#x679D;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">110</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>] = {{<span class="number">-1</span>, <span class="number">0</span>}, {<span class="number">1</span>, <span class="number">0</span>}, {<span class="number">0</span>, <span class="number">-1</span>}, {<span class="number">0</span>, <span class="number">1</span>}};</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m, limit, sx, sy, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> s[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">int</span> see[MAX_N][MAX_N], dis[MAX_N][MAX_N], vis[MAX_N][MAX_N];</span><br><span class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; state[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> {</span></span><br><span class="line">	<span class="keyword">int</span> x, y, step;</span><br><span class="line">	<span class="keyword">int</span> flag1, flag2;</span><br><span class="line"></span><br><span class="line">	Node() {}</span><br><span class="line">	Node(<span class="keyword">int</span> _x, <span class="keyword">int</span> _y, <span class="keyword">int</span> _step, <span class="keyword">int</span> _flag1, <span class="keyword">int</span> _flag2): </span><br><span class="line">		x(_x), y(_y), step(_step), flag1(_flag1), flag2(_flag2) {}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="built_in">queue</span>&lt;Node&gt; Q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span>&amp; value, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (s[x][y] == <span class="string">&apos;.&apos;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (s[x][y] == <span class="string">&apos;D&apos;</span>) {</span><br><span class="line">		value += <span class="number">1</span>;</span><br><span class="line">	} <span class="keyword">else</span> <span class="keyword">if</span> (s[x][y] == <span class="string">&apos;E&apos;</span>) {</span><br><span class="line">		value += <span class="number">2</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetSee</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">memset</span>(see, <span class="number">0</span>, <span class="keyword">sizeof</span> (see));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (s[i][j] == <span class="string">&apos;D&apos;</span> || s[i][j] == <span class="string">&apos;E&apos;</span> || s[i][j] == <span class="string">&apos;X&apos;</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">int</span> find = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = j + <span class="number">1</span>; k &lt; m; ++k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, i, k)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = j - <span class="number">1</span>; k &gt;= <span class="number">0</span>; --k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, i, k)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i - <span class="number">1</span>; k &gt;= <span class="number">0</span>; --k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, k, j)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i + <span class="number">1</span>; k &lt; n; ++k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, k, j)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			see[i][j] = find;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (see[sx][sy] == <span class="number">3</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> (dis));</span><br><span class="line">	<span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> (vis));</span><br><span class="line">	<span class="keyword">while</span> (!Q.empty()) Q.pop();</span><br><span class="line">	state[sx][sy].first = (see[sx][sy] == <span class="number">1</span> || see[sx][sy] == <span class="number">3</span>);</span><br><span class="line">	state[sx][sy].second = (see[sx][sy] &gt;= <span class="number">2</span>);</span><br><span class="line">	Q.push(Node(sx, sy, <span class="number">0</span>, see[sx][sy] == <span class="number">1</span> || see[sx][sy] == <span class="number">3</span>, see[sx][sy] &gt;= <span class="number">2</span>));</span><br><span class="line">	<span class="keyword">while</span> (!Q.empty()) {</span><br><span class="line">		Node cur = Q.front();</span><br><span class="line">		Q.pop();</span><br><span class="line">		<span class="keyword">int</span> x = cur.x, y = cur.y, step = cur.step, f1 = cur.flag1, f2 = cur.flag2;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) {</span><br><span class="line">			<span class="keyword">int</span> nxtx = x + dir[i][<span class="number">0</span>], nxty = y + dir[i][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span> (nxtx &lt; <span class="number">0</span> || nxtx &gt;= n || nxty &lt; <span class="number">0</span> || nxty &gt;= m) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (s[nxtx][nxty] != <span class="string">&apos;.&apos;</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">int</span> nxtf1 = (f1 || see[nxtx][nxty] == <span class="number">1</span> || see[nxtx][nxty] == <span class="number">3</span>);</span><br><span class="line">			<span class="keyword">int</span> nxtf2 = (f2 || see[nxtx][nxty] &gt;= <span class="number">2</span>);</span><br><span class="line">			<span class="keyword">if</span> (vis[nxtx][nxty]) {</span><br><span class="line">				<span class="keyword">if</span> (!(nxtf1 &gt; state[nxtx][nxty].first || nxtf2 &gt; state[nxtx][nxty].second)) {</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			state[nxtx][nxty].first = nxtf1;</span><br><span class="line">			state[nxtx][nxty].second = nxtf2;</span><br><span class="line">			vis[nxtx][nxty] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (nxtf1 &amp;&amp; nxtf2) {</span><br><span class="line">				dis[nxtx][nxty] = step + <span class="number">1</span>;</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> (step + <span class="number">1</span> &lt; limit) {</span><br><span class="line">				Q.push(Node(nxtx, nxty, step + <span class="number">1</span>, nxtf1, nxtf2));</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> ans = inf;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			ans = min(ans, dis[i][j]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (ans &gt; limit) ans = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;limit);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i]);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">				<span class="keyword">if</span> (s[i][j] == <span class="string">&apos;S&apos;</span>) {</span><br><span class="line">					sx = i, sy = j;</span><br><span class="line">				}</span><br><span class="line">				state[i][j].first = state[i][j].second = <span class="number">0</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		GetSee();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Case %d:\n%d\n&quot;</span>, ++cases, bfs());</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="q"><a href="#Q" class="headerlink" title="Q"></a>Q</h5><p>[UVA 12594]&#xFF1A;&#x5148;&#x7ED9;&#x51FA;26&#x4E2A;&#x5B57;&#x6BCD;&#x7684;&#x4E00;&#x79CD;&#x5168;&#x6392;&#x5217;&#xFF0C;&#x518D;&#x7ED9;&#x51FA;&#x957F;&#x5EA6;&#x4E3A;$n\leq 20000$&#x7684;&#x5B57;&#x6BCD;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8981;&#x6C42;&#x5C06;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x5206;&#x6210;$K$&#x6BB5;&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;$p$&#x6BB5;&#x7684;&#x7B2C;$i$&#x4E2A;&#x5B57;&#x7B26;&#x4ECE;&#x5B83;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x4EF7;&#x503C;&#x662F;$(i-pos[s[i]])*pos[s[i]]$&#xFF0C;&#x5176;&#x4E2D;$pos[s[i]]$&#x8868;&#x793A;$s[i]$&#x8FD9;&#x4E2A;&#x5B57;&#x6BCD;&#x5728;&#x7ED9;&#x51FA;&#x7684;&#x6392;&#x5217;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4F4D;&#x7F6E;&#x4E0B;&#x6807;&#x4ECE;0&#x5F00;&#x59CB;&#x3002;&#x6C42;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x5C0F;&#x4EF7;&#x503C;&#xFF1F;</p>
<p>&#x8BBE;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x4E0B;&#x6807;&#x4ECE;1&#x5F00;&#x59CB;&#xFF0C;&#x521D;&#x59CB;&#x5316;$ans=-\sum_{i=1}^{i=n}{pos[s[i]]*pos[s[i]]}$&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x9700;&#x8981;&#x8BA1;&#x7B97;$i*pos[s[i]]$&#x90E8;&#x5206;&#x4E86;&#xFF0C;&#x8BB0;&#xFF1A;<br>$$<br>pre[i]=\sum_{r=1}^{r=i}{pos[s[i]]} \\<br>sum[i]=\sum_{r=1}^{r=i}{(i-1)*pos[s[i]]}<br>$$<br>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i][p]=dp[j][p-1]+sum[i]-sum[j]-(pre[i]-pre[j])*j<br>$$<br>&#x4EE4;$G(x)=dp[x][k]-sum[x]+pre[x]*x$&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{x-y}\leq pre[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">20010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_K = <span class="number">510</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, K, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> head[MAX_K], tail[MAX_K];</span><br><span class="line"><span class="keyword">int</span> pos[<span class="number">30</span>], Q[MAX_K][MAX_N];</span><br><span class="line"><span class="keyword">char</span> s1[<span class="number">30</span>], s2[MAX_N];</span><br><span class="line">ll ans, dp[MAX_K][MAX_N], sum[MAX_N], pre[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[id][x] - sum[x] + pre[x] * x - (dp[id][y] - sum[y] + pre[y] * y);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> x - y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= K; ++i) {</span><br><span class="line">		head[i] = tail[i] = Q[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memset</span>(dp[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (dp[<span class="number">0</span>]));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = min(i, K); k &gt;= <span class="number">1</span>; --k) {</span><br><span class="line">			<span class="keyword">while</span> (head[k - <span class="number">1</span>] &lt; tail[k - <span class="number">1</span>] &amp;&amp; G(k - <span class="number">1</span>, Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>] + <span class="number">1</span>], Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]])</span><br><span class="line">					&lt;= S(Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>] + <span class="number">1</span>], Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]]) * pre[i]) head[k - <span class="number">1</span>]++;</span><br><span class="line">			<span class="keyword">int</span> t = Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]];</span><br><span class="line">			dp[k][i] = dp[k - <span class="number">1</span>][t] + sum[i] - sum[t] - (pre[i] - pre[t]) * t;</span><br><span class="line">			<span class="keyword">while</span> (head[k] &lt; tail[k] &amp;&amp; G(k, i, Q[k][tail[k]]) * S(Q[k][tail[k]], Q[k][tail[k] - <span class="number">1</span>])</span><br><span class="line">				    &lt;= S(i, Q[k][tail[k]]) * G(k, Q[k][tail[k]], Q[k][tail[k] - <span class="number">1</span>])) tail[k]--;</span><br><span class="line">			Q[k][++tail[k]] = i;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	ans += dp[K][n];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Case %d: %lld\n&quot;</span>, ++cases, ans);</span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, s1, &amp;K);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s2 + <span class="number">1</span>);</span><br><span class="line">		n = <span class="built_in">strlen</span>(s2 + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) {</span><br><span class="line">			pos[s1[i] - <span class="string">&apos;a&apos;</span>] = i;</span><br><span class="line">		}</span><br><span class="line">		sum[<span class="number">0</span>] = pre[<span class="number">0</span>] = ans =  <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> t = pos[s2[i] - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">			pre[i] = pre[i - <span class="number">1</span>] + t;</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + (i - <span class="number">1</span>) * t;</span><br><span class="line">			ans -= t * t;</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>

  <article class="post-detail">
    <h1 class="post-title"><a href="/">斜率优化（一）</a></h1>
    <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
    <div class="post-content">
      <p><a href="http://wenku.baidu.com/view/ef259400bed5b9f3f90f1c3a.html" target="_blank" rel="noopener">&#x7528;&#x5355;&#x8C03;&#x6027;&#x4F18;&#x5316;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x2013;JSOI2009 &#x96C6;&#x8BAD;&#x961F;&#x8BBA;&#x6587;</a><br><a href="http://wenku.baidu.com/view/f6421ce8b8f67c1cfad6b8ac.html" target="_blank" rel="noopener">&#x6D45;&#x8C08;&#x6570;&#x5F62;&#x7ED3;&#x5408;&#x5728;&#x4FE1;&#x606F;&#x5B66;&#x7ADE;&#x8D5B;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x2013;&#x5B89;&#x5FBD;&#x829C;&#x6E56;&#x4E00;&#x4E2D;&#xB7;&#x5468;&#x6E90;</a><br>&#x5728;VJ&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/135311#overview" target="_blank" rel="noopener">Here</a>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x62C9;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#x6574;&#x5408;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;G,K,R&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x3002;&#x3002;&#x3002;R&#x9898;&#x597D;&#x50CF;&#x8FD8;&#x662F;2014 World Final&#x7684;&#x9898;&#x554A;&#x3002;<br><a id="more"></a></p>
<h5 id="a"><a href="#A" class="headerlink" title="A"></a>A</h5><p>[HDU 2993]:&#x7ED9;$n\leq 10^5$&#x4E2A;&#x6B63;&#x6574;&#x6570;&#xFF0C;&#x6C42;&#x957F;&#x5EA6;&#x4E0D;&#x5C11;&#x4E8E;$k$&#x7684;&#x6700;&#x5927;&#x5B50;&#x533A;&#x95F4;&#x5E73;&#x5747;&#x503C;&#x3002;</p>
<p>&#x7528;$dp[i]$&#x8868;&#x793A;&#x4EE5;$i$&#x4F4D;&#x7F6E;&#x7ED3;&#x5C3E;&#x7684;&#x957F;&#x5EA6;&#x4E0D;&#x5C11;&#x4E8E;$k$&#x7684;&#x6700;&#x5927;&#x5B50;&#x533A;&#x95F4;&#x5E73;&#x5747;&#x503C;&#xFF0C;$sum[i]$&#x8868;&#x793A;&#x524D;&#x7F00;&#x548C;&#x3002;<br>$$<br>dp[i]=max(\frac{sum[i]-sum[j]}{i-j}) \quad (j\leq i - k)<br>$$</p>
<p>&#x8FD9;&#x9898;&#x9700;&#x8981;&#x7528;&#x975E;&#x5E38;&#x201C;&#x7F8E;&#x5999;&#x201D;&#x7684;&#x5FEB;&#x8BFB;&#x624D;&#x80FD;&#x8FC7;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> data[MAX_N], sum[MAX_N], Q[MAX_N];</span><br><span class="line"><span class="keyword">double</span> dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FastIO</span> {</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> S = <span class="number">1000000</span>;</span><br><span class="line">	<span class="keyword">int</span> wpos, pos, len;</span><br><span class="line">	<span class="keyword">char</span> wbuf[S];</span><br><span class="line">	FastIO():wpos(<span class="number">0</span>){}</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">xchar</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">char</span> buf[S];</span><br><span class="line">		<span class="keyword">if</span> (pos == len) pos = <span class="number">0</span>, len = fread(buf, <span class="number">1</span>, S, <span class="built_in">stdin</span>);</span><br><span class="line">		<span class="keyword">if</span> (pos == len) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">return</span> buf[pos++];</span><br><span class="line">	}</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">xint</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">int</span> c = xchar(), x = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (c &lt;= <span class="number">32</span> &amp;&amp; ~c) c = xchar();</span><br><span class="line">		<span class="keyword">if</span> (c == <span class="number">-1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">for</span> (; c &gt;= <span class="string">&apos;0&apos;</span> &amp;&amp; c &lt;= <span class="string">&apos;9&apos;</span>; c = xchar()) x = x * <span class="number">10</span> + (c - <span class="string">&apos;0&apos;</span>);</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	}</span><br><span class="line">} io;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt;= eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1.0</span> * (sum[b] - sum[a]) / (b - a);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> j = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; sgn(slope(Q[tail], j) - slope(Q[tail - <span class="number">1</span>], Q[tail])) &lt;= <span class="number">0</span>) tail--;</span><br><span class="line">		Q[++tail] = j;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; sgn(slope(Q[head], Q[head + <span class="number">1</span>]) - slope(Q[head + <span class="number">1</span>], i)) &lt;= <span class="number">0</span>) head++;</span><br><span class="line">		dp[i] = slope(Q[head], i);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		ans = max(ans, dp[i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span>(;;) {</span><br><span class="line">		n = io.xint(); K = io.xint();</span><br><span class="line">	<span class="comment">//	scanf(&quot;%d%d&quot;, &amp;n, &amp;K);</span></span><br><span class="line">		<span class="keyword">if</span> (n == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">		sum[<span class="number">0</span>] = data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			data[i] = io.xint();</span><br><span class="line">	<span class="comment">//		scanf(&quot;%d&quot;, &amp;data[i]);</span></span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + data[i];</span><br><span class="line">		}</span><br><span class="line">		solve();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="b"><a href="#B" class="headerlink" title="B"></a>B</h5><p>[HDU 3045]:&#x5C06;$n\leq 4*10^5$&#x5934;&#x725B;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x7EC4;&#xFF0C;&#x6BCF;&#x7EC4;&#x81F3;&#x5C11;$K$&#x5934;&#x725B;&#xFF0C;&#x6BCF;&#x7EC4;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x6BCF;&#x5934;&#x725B;&#x7684;&#x6743;&#x503C;&#x51CF;&#x53BB;&#x8FD9;&#x7EC4;&#x6700;&#x5C0F;&#x6743;&#x503C;&#x4E4B;&#x548C;&#xFF0C;&#x6C42;&#x5C06;$n$&#x5934;&#x725B;&#x5206;&#x7EC4;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>&#x5148;&#x6392;&#x5E8F;&#x3002;&#x7528;$dp[i]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x5934;&#x725B;&#x89E3;&#x51B3;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF0C;$sum[i]$&#x8868;&#x793A;&#x524D;&#x7F00;&#x548C;&#x3002;<br>$$<br>dp[i]=min(dp[j]+sum[i]-sum[j]-(i-j)*data[j+1])\quad (j\leq i-K)<br>$$<br>&#x4EE4;$G(x)=dp[x]-sum[x]+x*data[x+1]$&#xFF0C;&#x8F6C;&#x5316;&#x4E00;&#x4E0B;&#x53EF;&#x5F97;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{data[x+1]-data[y+1]} \leq i<br>$$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> Q[MAX_N];</span><br><span class="line">ll data[MAX_N], sum[MAX_N], dp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - sum[x] + data[x + <span class="number">1</span>] * x - (dp[y] - sum[y] + data[y + <span class="number">1</span>] * y);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> data[x + <span class="number">1</span>] - data[y + <span class="number">1</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = <span class="number">0</span>, tail = <span class="number">-1</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; K; ++i) { dp[i] = <span class="number">0</span>; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> jj = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(jj, Q[tail]) &gt;= G(jj, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) tail--;</span><br><span class="line">		<span class="keyword">if</span> (jj &gt;= K) Q[++tail] = jj;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt; S(Q[head + <span class="number">1</span>], Q[head]) * i) head++;</span><br><span class="line">		dp[i] = dp[Q[head]] + sum[i] - sum[Q[head]] - (i - Q[head]) * data[Q[head] + <span class="number">1</span>];</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;K)) {</span><br><span class="line">		sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;data[i]);</span><br><span class="line">		}</span><br><span class="line">		sort(data + <span class="number">1</span>, data + n + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + data[i];</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="c"><a href="#C" class="headerlink" title="C"></a>C</h5><p>[POJ 1180]:&#x6709;$n\leq 10^4$&#x4EF6;&#x5546;&#x54C1;&#x9700;&#x8981;&#x52A0;&#x5DE5;&#xFF0C;&#x6BCF;&#x4EF6;&#x5546;&#x54C1;&#x6709;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;$O(i)$&#x548C;$F(i)$&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x8FDE;&#x7EED;&#x7684;&#x4E00;&#x4E9B;&#x5546;&#x54C1;&#x770B;&#x6210;&#x4E00;&#x7EC4;&#x4E00;&#x8D77;&#x52A0;&#x5DE5;&#xFF0C;&#x6BCF;&#x52A0;&#x5DE5;&#x4E00;&#x7EC4;&#x9700;&#x8981;$S$&#x7684;&#x65F6;&#x95F4;&#x8D77;&#x52A8;&#x673A;&#x5668;&#xFF0C;&#x5047;&#x8BBE;&#x5728;&#x65F6;&#x523B;$t$&#x5F00;&#x59CB;&#x52A0;&#x5DE5;&#x4ECE;$i\sim j$&#x7684;&#x5546;&#x54C1;&#xFF0C;&#x90A3;&#x4E48;&#x52A0;&#x5DE5;&#x5B8C;&#x8FD9;&#x4E9B;&#x5546;&#x54C1;&#x7684;&#x8017;&#x65F6;&#x662F;&#xFF1A;$t+S+\sum_{r=i}^{r=j}{O(r)}=t+T$&#xFF0C;&#x9700;&#x8981;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#xFF1A;$(t+T)*\sum_{r=i}^{r=j}{F(r)}$,&#x5E76;&#x4E14;&#x4E0B;&#x4E00;&#x7EC4;&#x7684;&#x5F00;&#x59CB;&#x65F6;&#x523B;&#x662F;$t+T$&#xFF0C;&#x521D;&#x59CB;&#x65F6;&#x523B;&#x662F;0&#x3002;&#x6C42;&#x52A0;&#x5DE5;&#x5B8C;&#x8FD9;&#x4E9B;&#x5546;&#x54C1;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF1F;</p>
<p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6BCF;&#x52A0;&#x5DE5;&#x5B8C;&#x4E00;&#x7EC4;&#x5546;&#x54C1;&#x7684;&#x8FD9;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#xFF1A;$T=S+\sum_{r=i}^{r=j}{O(r)}$&#x5BF9;&#x4E8E;&#x540E;&#x9762;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x90FD;&#x662F;&#x6709;&#x5F71;&#x54CD;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x628A;&#x8FD9;&#x90E8;&#x5206;&#x5F71;&#x54CD;&#x8BA1;&#x7B97;&#x7D2F;&#x52A0;&#xFF0C;&#x5F71;&#x54CD;&#x662F;&#xFF1A;<br>$$T*\sum_{r=i+1}^{n}{F(r)}=T*fsum(j)$$<br>&#x4E8E;&#x662F;&#x7528;$dp[j]$&#x8868;&#x793A;&#x52A0;&#x5DE5;&#x5B8C;$j\sim n$&#x5546;&#x54C1;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF0C;$tsum[i]$&#x548C;$fsum[i]$&#x8868;&#x793A;&#x5206;&#x522B;$O[]$&#x548C;$F[]$&#x7684;&#x540E;&#x7F00;&#x548C;&#x3002;<br>$$<br>dp[i]=min(dp[j]+(S+tsum[i]-tsum[j])*fsum[i])\quad (i&lt; j\leq n)<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x]-dp[y]}{tsum[x]-tsum[y]}\leq fsum[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> tsum[x] - tsum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = n + <span class="number">1</span>;</span><br><span class="line">	dp[n + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;=</span><br><span class="line">				fsum[i] * S(Q[head + <span class="number">1</span>], Q[head])) ++head;</span><br><span class="line">		dp[i] = dp[Q[head]] + (tsum[i] - tsum[Q[head]] + s) * fsum[i];</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail]) &gt; </span><br><span class="line">				G(i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) --tail;</span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[<span class="number">1</span>]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="d"><a href="#D" class="headerlink" title="D"></a>D</h5><p>[POJ 3709]:&#x5C06;$n\leq 5*10^5$&#x4E2A;&#x6570;&#xFF0C;&#x53D8;&#x6210;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#xFF1A;&#x628A;&#x8FDE;&#x7EED;&#x76F8;&#x540C;&#x7684;&#x6570;&#x5B57;&#x770B;&#x6210;&#x4E00;&#x6BB5;&#xFF0C;&#x6BCF;&#x6BB5;&#x5185;&#x6570;&#x5B57;&#x4E2A;&#x6570;&#x4E0D;&#x5C11;&#x4E8E;$k$&#x4E2A;&#x3002;&#x5E76;&#x4E14;&#x6BCF;&#x4E2A;&#x6570;&#x5B57;&#x53EA;&#x80FD;&#x53D8;&#x5C0F;&#xFF0C;&#x53D8;&#x5316;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x53D8;&#x5316;&#x524D;&#x540E;&#x6570;&#x5B57;&#x4E4B;&#x5DEE;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>&#x56E0;&#x4E3A;&#x6570;&#x5B57;&#x53EA;&#x80FD;&#x53D8;&#x5C0F;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x7B80;&#x5355;&#x4E86;&#x8BB8;&#x591A;&#x3002;&#x7528;$sum[i]$&#x8868;&#x793A;&#x524D;&#x7F00;&#x548C;&#xFF0C;$dp[i]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x4E2A;&#x6570;&#x89E3;&#x51B3;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x3002;<br>$$dp[i]=min(dp[j]+sum[i]-sum[j]-(i-j)*data[i+1])\quad (j\leq i - k)$$<br>&#x4EE4;$G(x)=dp[x]-sum[x]+x*data[x+1]$&#xFF0C;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{data[x+1]-data[y+1]} \leq i<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - sum[x] + data[x + <span class="number">1</span>] * x - (dp[y] - sum[y] + data[y + <span class="number">1</span>] * y);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> data[x + <span class="number">1</span>] - data[y + <span class="number">1</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; K; ++i) { dp[i] = INF; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> pos = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(pos, Q[tail]) </span><br><span class="line">			&gt;= S(Q[tail], Q[tail - <span class="number">1</span>]) * G(pos, Q[tail])) tail--;</span><br><span class="line">		<span class="keyword">if</span> (pos &gt;= K) Q[++tail] = pos;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;= S(Q[head + <span class="number">1</span>], Q[head]) * i) ++head;</span><br><span class="line">		dp[i] = dp[Q[head]] + (sum[i] - sum[Q[head]] - (i - Q[head]) * data[Q[head] + <span class="number">1</span>]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="e"><a href="#E" class="headerlink" title="E"></a>E</h5><p>[POJ 3709]&#xFF1A;&#x5C06;$n\leq 5*10^5$&#x4E2A;&#x5355;&#x8BCD;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x884C;&#xFF0C;&#x5982;&#x679C;$i\sim j$&#x5355;&#x8BCD;&#x5728;&#x540C;&#x4E00;&#x884C;&#x5219;&#x4EE3;&#x4EF7;&#x4E3A;&#xFF1A;${(\sum_{r=i}^{r=j}{C[r]})}^{2}+m$&#xFF0C;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>$dp$&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=min(dp[j]+{(sum[i]-sum[j])}^{2}+m) \quad (j &lt; i)<br>$$<br>&#x4EE4;$G(x)=dp[x]+sum[x]*sum[x]$&#xFF0C;&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{2*(sum[x]-sum[y])}\leq sum[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y] + sum[x] * sum[x] - sum[y] * sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="number">2</span> * (sum[x] - sum[y]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;= S(Q[head + <span class="number">1</span>], Q[head]) * sum[i]) head++;</span><br><span class="line">		dp[i] = dp[Q[head]] + (sum[i]  - sum[Q[head]]) * (sum[i] - sum[Q[head]]) + m;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail]) &gt;= G(i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) tail--;</span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

    </div>
  </article>


</section>
    <footer id="footer" role="contentinfo">
    <div>&copy; 2018 <a href="/">瀚清</a>.
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Designed by <a href="http://rainylog.com" target="_blank">Rainy.</a>
	</div>
</footer><!-- end #footer -->

  </div>
  <script src="/lib/fancybox/dist/jquery.fancybox.min.js"></script>

  <script src="/js/helper.js"></script>
  <script src="/js/_third-party/gitment.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
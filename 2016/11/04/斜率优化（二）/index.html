<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>斜率优化（二） | 瀚清</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="用单调性优化动态规划–JSOI2009 集训队论文浅谈数形结合在信息学竞赛中的应用–安徽芜湖一中·周源在VJ上开了一个专题：Here，其实也是拉了别人的整合一下，其中G,K,R并不会做。。。R题好像还是2014 World Final的题啊。">
<meta name="keywords" content="斜率dp,ACM-ICPC-Template">
<meta property="og:type" content="article">
<meta property="og:title" content="斜率优化（二）">
<meta property="og:url" content="http://yoursite.com/2016/11/04/斜率优化（二）/index.html">
<meta property="og:site_name" content="瀚清">
<meta property="og:description" content="用单调性优化动态规划–JSOI2009 集训队论文浅谈数形结合在信息学竞赛中的应用–安徽芜湖一中·周源在VJ上开了一个专题：Here，其实也是拉了别人的整合一下，其中G,K,R并不会做。。。R题好像还是2014 World Final的题啊。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2016-11-04T07:00:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="斜率优化（二）">
<meta name="twitter:description" content="用单调性优化动态规划–JSOI2009 集训队论文浅谈数形结合在信息学竞赛中的应用–安徽芜湖一中·周源在VJ上开了一个专题：Here，其实也是拉了别人的整合一下，其中G,K,R并不会做。。。R题好像还是2014 World Final的题啊。">
  
    <link rel="alternate" href="/atom.xml" title="瀚清" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/lib/jquery/dist/jquery.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
  
  
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="wrapper">
    <header id="header" class="clearfix">
	<a id="logo" href="/" title="瀚清">瀚清</a>
	
	<nav id="nav-menu" class="clearfix">
		<form id="search" method="post" action="./" role="search">
			<input id="search-input" type="text" name="s" class="inputbox" value="搜索" onfocus="if (value =='搜索'){value =''}" onblur="if (value ==''){value='搜索'}">
		</form>
		<ul>
      
				
        <li><a class="main-nav-link" href="/">主页</a></li>
      
				
        <li><a class="main-nav-link" href="/archives">归档</a></li>
      
		</ul>
	</nav>
</header>
    <section id="main" class="clearfix"><article class="post-detail">
  <h1 class="post-title"><a href="/">斜率优化（二）</a></h1>
  <ul class="post-meta">
  <li><i class="fa fa-user"></i> 作者 ramay7</li>
  <li><i class="fa fa-calendar"></i> 日期 Nov 4</li>
  <li><i class="fa fa-folder"></i> 分类
  
    <a class="article-category-link" href="/categories/齐东语/">齐东语</a>
  
  </li>
</ul>
  <div class="post-content">
      
      <p><a href="http://wenku.baidu.com/view/ef259400bed5b9f3f90f1c3a.html" target="_blank" rel="noopener">&#x7528;&#x5355;&#x8C03;&#x6027;&#x4F18;&#x5316;&#x52A8;&#x6001;&#x89C4;&#x5212;&#x2013;JSOI2009 &#x96C6;&#x8BAD;&#x961F;&#x8BBA;&#x6587;</a><br><a href="http://wenku.baidu.com/view/f6421ce8b8f67c1cfad6b8ac.html" target="_blank" rel="noopener">&#x6D45;&#x8C08;&#x6570;&#x5F62;&#x7ED3;&#x5408;&#x5728;&#x4FE1;&#x606F;&#x5B66;&#x7ADE;&#x8D5B;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x2013;&#x5B89;&#x5FBD;&#x829C;&#x6E56;&#x4E00;&#x4E2D;&#xB7;&#x5468;&#x6E90;</a><br>&#x5728;VJ&#x4E0A;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x4E13;&#x9898;&#xFF1A;<a href="http://bak2.vjudge.net/contest/135311#overview" target="_blank" rel="noopener">Here</a>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x62C9;&#x4E86;&#x522B;&#x4EBA;&#x7684;&#x6574;&#x5408;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;G,K,R&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x3002;&#x3002;&#x3002;R&#x9898;&#x597D;&#x50CF;&#x8FD8;&#x662F;2014 World Final&#x7684;&#x9898;&#x554A;&#x3002;<br><a id="more"></a></p>
<h5 id="f"><a href="#F" class="headerlink" title="F"></a>F</h5><p>F&#x9898;&#x548C;N&#x9898;&#x91CD;&#x590D;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<p>[HDU 3669]&#xFF1A;&#x7ED9;&#x51FA;$n\leq 5*10^4$&#x4E2A;&#x77E9;&#x5F62;&#x7684;&#x957F;&#x548C;&#x5BBD;&#xFF0C;&#x8981;&#x6C42;&#x628A;&#x8FD9;&#x4E9B;&#x77E9;&#x5F62;&#x6700;&#x591A;&#x5206;&#x6210;$K$&#x7EC4;&#xFF0C;&#x6BCF;&#x7EC4;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x6240;&#x6709;&#x8FD9;&#x7EC4;&#x77E9;&#x5F62;&#x7684;&#x6700;&#x5927;&#x5BBD;&#x4E58;&#x4EE5;&#x6700;&#x5927;&#x957F;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x548C;&#xFF1F;</p>
<p>&#x5148;&#x628A;&#x77E9;&#x5F62;&#x6309;&#x7167;&#x4F18;&#x5148;&#x5BBD;&#x5EA6;&#xFF1A;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#xFF0C;&#x5176;&#x6B21;&#x9AD8;&#x5EA6;&#xFF1A;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x7684;&#x987A;&#x5E8F;&#x6392;&#x5E8F;&#xFF0C;&#x5176;&#x6B21;&#x8981;&#x6CE8;&#x610F;&#x5230;&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#x7684;&#x5BBD;&#x548C;&#x957F;&#x90FD;&#x6BD4;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#x5C0F;&#xFF0C;&#x90A3;&#x4E2A;&#x8FD9;&#x4E2A;&#x77E9;&#x5F62;&#x5C31;&#x662F;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x77E9;&#x5F62;&#x7B5B;&#x9009;&#x51FA;&#x7684;&#x77E9;&#x5F62;&#x5E8F;&#x5217;&#x6EE1;&#x8DB3;&#x8FD9;&#x6837;&#x6027;&#x8D28;&#xFF1A;&#x5BBD;&#x9012;&#x51CF;&#x5E76;&#x4E14;&#x957F;&#x9012;&#x589E;&#x3002;</p>
<p>&#x7528;$dp[i][k]$&#x8868;&#x793A;&#x5C06;&#x524D;$i$&#x4E2A;&#x77E9;&#x5F62;&#x5206;&#x6210;$k$&#x7EC4;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#xFF1A;<br>$$<br>dp[i][k]=min(dp[j][k-1]+rec[j+1].w*rec[i].h) \quad (j&lt; i)<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x][p-1]-dp[y][p-1]}{rec[y+1].w-rec[x+1].w}\leq rec[i].h<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, K, head, tail;</span><br><span class="line"><span class="keyword">int</span> Q[MAX_N];</span><br><span class="line">ll dp[MAX_N][MAX_K];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rec</span> {</span></span><br><span class="line">	<span class="keyword">int</span> w, h;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Rec&amp; rhs) <span class="keyword">const</span> {</span><br><span class="line">		<span class="keyword">if</span> (w != rhs.w) <span class="keyword">return</span> w &gt; rhs.w;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> h &gt; rhs.h;</span><br><span class="line">	}</span><br><span class="line">} read[MAX_N], rec[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x][id] - dp[y][id];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> rec[y + <span class="number">1</span>].w - rec[x + <span class="number">1</span>].w;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) { </span><br><span class="line">		dp[i][<span class="number">1</span>] = <span class="number">1l</span>l * rec[<span class="number">1</span>].w * rec[i].h; </span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">2</span>; k &lt;= K; ++k) {</span><br><span class="line">		head = tail = <span class="number">0</span>;</span><br><span class="line">		Q[++tail] = k - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, Q[head + <span class="number">1</span>], Q[head]) </span><br><span class="line">					&lt;= S(Q[head + <span class="number">1</span>], Q[head]) * rec[i].h) ++head;</span><br><span class="line">			<span class="keyword">int</span> t = Q[head];</span><br><span class="line">			dp[i][k] = dp[t][k - <span class="number">1</span>] + <span class="number">1l</span>l * rec[t + <span class="number">1</span>].w * rec[i].h;</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(k - <span class="number">1</span>, Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail])</span><br><span class="line">					&gt;= G(k - <span class="number">1</span>, i, Q[tail]) * S(Q[tail], Q[tail - <span class="number">1</span>])) --tail;</span><br><span class="line">			Q[++tail] = i;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	ll ans = (ll)(<span class="number">1e18</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; ++i) {</span><br><span class="line">		ans = min(ans, dp[n][i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;K)) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;read[i].w, &amp;read[i].h);</span><br><span class="line">		}</span><br><span class="line">		sort(read, read + n);</span><br><span class="line">		<span class="keyword">int</span> MaxH = <span class="number">0</span>, total = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="keyword">if</span> (read[i].h &gt; MaxH) {</span><br><span class="line">				rec[++total].w = read[i].w;</span><br><span class="line">				rec[total].h = read[i].h;</span><br><span class="line">				MaxH = read[i].h;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		n = total;</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="h-&#x5355;&#x8C03;&#x961F;&#x5217;"><a href="#H-&#x5355;&#x8C03;&#x961F;&#x5217;" class="headerlink" title="H (&#x5355;&#x8C03;&#x961F;&#x5217;)"></a>H (&#x5355;&#x8C03;&#x961F;&#x5217;)</h5><p>[POJ 3401]:&#x5DF2;&#x77E5;$n\leq 2000$&#x5929;&#x6BCF;&#x5929;&#x4E70;&#x5356;&#x4E00;&#x5F20;&#x80A1;&#x7968;&#x7684;&#x5355;&#x4EF7;&#x548C;&#x4E70;&#x5356;&#x4E0A;&#x9650;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x5929;&#x53EA;&#x80FD;&#x9009;&#x62E9;&#x4E70;&#x6216;&#x8005;&#x5356;&#x6216;&#x8005;&#x4E0D;&#x4EA4;&#x6613;&#xFF0C;&#x800C;&#x4E14;&#x4E24;&#x6B21;&#x4EA4;&#x6613;&#x65E5;&#x671F;&#x4E2D;&#x95F4;&#x81F3;&#x5C11;&#x8981;&#x95F4;&#x9694;$W$&#x5929;&#xFF0C;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x6301;&#x6709;$Max$&#x5F20;&#x80A1;&#x7968;&#x3002;&#x521D;&#x59CB;&#x65F6;&#x6709;&#x65E0;&#x9650;&#x91CF;&#x7684;&#x94B1;&#xFF0C;&#x6C42;&#x6700;&#x7EC8;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x83B7;&#x5229;&#x591A;&#x5C11;&#xFF1F;</p>
<p>&#x7528;$dp[i][j]$&#x8868;&#x793A;&#x5728;&#x7B2C;$i$&#x5929;&#x62E5;&#x6709;$j$&#x5F20;&#x80A1;&#x7968;&#x65F6;&#x7684;&#x6700;&#x591A;&#x83B7;&#x5229;&#x3002;</p>
<ul>
<li><p>&#x7B2C;$i$&#x5929;&#x4E0D;&#x4E70;&#x4E0D;&#x5356;<br>$$dp[i][j]=dp[i - 1][j]$$</p>
</li>
<li><p>&#x7B2C;$i$&#x5929;&#x4E70;&#x80A1;&#x7968;<br>$$dp[i][j]=max(dp[r][k]-cost[i]*(j-k))\quad (r\leq i - W - 1,k&lt; j)$$</p>
</li>
<li><p>&#x7B2C;$i$&#x5929;&#x5356;&#x80A1;&#x7968;<br>$$dp[i][j]=max(dp[r][k]+value[i]*(k-j))\quad (r\leq i - W - 1,k&gt; j)$$</p>
</li>
</ul>
<p>&#x8003;&#x8651;&#x5B9E;&#x9645;&#x610F;&#x4E49;&#x4E0A;&#x9762;&#x5F0F;&#x5B50;&#x4E2D;&#x7684;$r$&#x5C31;&#x5E94;&#x8BE5;&#x662F;$i-W-1$&#x3002;&#x628A;&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x6539;&#x5199;&#x4E00;&#x4E0B;&#xFF1A;<br>$$<br>dp[i][j]=(dp[i-W-1][k]+buy[i]*k)-buy[i]*j (k&lt; j)<br>$$<br>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x524D;&#x9762;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x6C42;&#x524D;&#x7F00;&#x6700;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528;&#x5355;&#x8C03;&#x961F;&#x5217;&#x6765;&#x4FDD;&#x5B58;&#x524D;&#x7F00;&#x6700;&#x5927;&#x3002;&#x5BF9;&#x4E8E;&#x4E70;&#x80A1;&#x7968;&#x7684;&#x884C;&#x4E3A;&#x540C;&#x6837;&#x8FD9;&#x6837;&#x5B50;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;$k&gt;j$&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5012;&#x7740;&#x5904;&#x7406;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">2010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, Max, W, head, tail;</span><br><span class="line"><span class="keyword">int</span> cost[MAX_N], value[MAX_N], buy[MAX_N], sell[MAX_N];</span><br><span class="line"><span class="comment">// cost &#x548C; value: &#x4E70;&#x5356;&#x5355;&#x4EF7;&#xFF0C; buy &#x548C; sell: &#x4E70;&#x5356;&#x4E0A;&#x9650;</span></span><br><span class="line"><span class="keyword">int</span> dp[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Que</span> {</span></span><br><span class="line">	<span class="keyword">int</span> num, sum;</span><br><span class="line">	<span class="comment">// num&#xFF1A; &#x80A1;&#x7968;&#x6570;&#x91CF; sum: &#x5DF2;&#x7ECF;&#x83B7;&#x5229;&#x91CF;</span></span><br><span class="line">	Que() {}</span><br><span class="line">	Que(<span class="keyword">int</span> _num, <span class="keyword">int</span> _sum): num(_num), sum(_sum) {}</span><br><span class="line">} que[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="built_in">memset</span>(dp[i], <span class="number">-0x3f</span>, <span class="keyword">sizeof</span> (dp[i]));</span><br><span class="line">	<span class="comment">// &#x9884;&#x5904;&#x7406;&#x524D; W &#x5929;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= buy[<span class="number">0</span>]; ++j) { dp[<span class="number">0</span>][j] = -j * cost[<span class="number">0</span>]; }</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= W; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= Max; ++j) {</span><br><span class="line">			dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">			<span class="keyword">if</span> (j &lt;= buy[i]) dp[i][j] = max(dp[i][j], -j * cost[i]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = W + <span class="number">1</span>; i &lt; n; ++i) {</span><br><span class="line">		head = tail = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= Max; ++j) {</span><br><span class="line">			dp[i][j] = dp[i - <span class="number">1</span>][j]; <span class="comment">// &#x4E0D;&#x4E70;&#x4E0D;&#x5356;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">// &#x4E70;</span></span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[tail - <span class="number">1</span>].sum &lt; dp[i - W - <span class="number">1</span>][j] + j * cost[i]) {</span><br><span class="line">				tail--;</span><br><span class="line">			}</span><br><span class="line">			que[tail++] = Que(j, dp[i - W - <span class="number">1</span>][j] + j * cost[i]);</span><br><span class="line">			<span class="comment">// &#x4FDD;&#x8BC1;&#x4E70;&#x7684;&#x6570;&#x91CF;&#x4E0D;&#x8D85;&#x8FC7;&#x4E0A;&#x9650;</span></span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; j - que[head].num &gt; buy[i]) head++;</span><br><span class="line">			dp[i][j] = max(dp[i][j], que[head].sum - j * cost[i]);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		head = tail = <span class="number">0</span>; <span class="comment">// &#x5356;</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = Max; j &gt;= <span class="number">0</span>; --j) {</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[tail - <span class="number">1</span>].sum &lt; dp[i - W - <span class="number">1</span>][j] + j * value[i]) {</span><br><span class="line">				tail--;</span><br><span class="line">			}</span><br><span class="line">			que[tail++] = Que(j, dp[i - W - <span class="number">1</span>][j] + j * value[i]);</span><br><span class="line">			<span class="keyword">while</span> (head &lt; tail &amp;&amp; que[head].num - j &gt; sell[i]) head++;</span><br><span class="line">			dp[i][j] = max(dp[i][j], que[head].sum - j * value[i]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Max; ++i) {</span><br><span class="line">		ans = max(ans, dp[n - <span class="number">1</span>][i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;Max, &amp;W);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;cost[i], &amp;value[i], &amp;buy[i], &amp;sell[i]);</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="i"><a href="#I" class="headerlink" title="I"></a>I</h5><p>[POJ 2018]&#xFF1A;&#x548C;A&#x9898;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#x3002;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> sum[x] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> x - y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = <span class="number">0</span>, tail = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">int</span> pos = i - K;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(pos, Q[tail] * S(pos, Q[tail - <span class="number">1</span>]) </span><br><span class="line">			&lt;= G(pos, Q[tail - <span class="number">1</span>]) * S(pos, Q[tail]))) --tail;</span><br><span class="line">		Q[++tail] = pos;</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(i, Q[head]) * S(i, Q[head + <span class="number">1</span>]) </span><br><span class="line">			&lt;= G(i, Q[head + <span class="number">1</span>]) * S(i, Q[head])) ++head;</span><br><span class="line"></span><br><span class="line">		dp[i] = <span class="number">1.0</span> * G(i, Q[head]) / S(i , Q[head]);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= n; ++i) {</span><br><span class="line">		ans = max(ans, dp[i]);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (<span class="keyword">int</span>)(ans * <span class="number">1000</span>));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="j"><a href="#J" class="headerlink" title="J"></a>J</h5><p>&#x548C;M&#x9898;&#x91CD;&#x590D;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<p>[POJ 1260]:&#x9700;&#x8981;&#x8D2D;&#x4E70;$n\leq 100$&#x4E2A;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x7ED9;&#x51FA;&#x6BCF;&#x79CD;&#x73CD;&#x73E0;&#x7684;&#x8D2D;&#x4E70;&#x6570;&#x91CF;&#x548C;&#x5355;&#x4EF7;&#xFF0C;&#x9AD8;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x5355;&#x4EF7;&#x8981;&#x5927;&#x4E8E;&#x4F4E;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x5355;&#x4EF7;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x9AD8;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#x4EE3;&#x66FF;&#x4F4E;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x4F46;&#x6570;&#x91CF;&#x8981;&#x4E00;&#x81F4;&#x3002;&#x5982;&#x679C;&#x8D2D;&#x4E70;&#x4E86;&#x4E00;&#x4E2A;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#xFF0C;&#x4E0D;&#x8BBA;&#x6570;&#x91CF;&#x591A;&#x5C11;&#xFF0C;&#x9700;&#x8981;&#x989D;&#x5916;&#x591A;&#x4ED8;10&#x4E2A;&#x8BE5;&#x7B49;&#x7EA7;&#x73CD;&#x73E0;&#x7684;&#x91D1;&#x94B1;&#x3002;&#x6C42;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;&#x4F4E;&#x7B49;&#x7EA7;&#x7684;&#x73CD;&#x73E0;&#x4E0D;&#x4F1A;&#x88AB;&#x8DF3;&#x7EA7;&#x201C;&#x4EE3;&#x4E3A;&#x8D2D;&#x4E70;&#x201D;&#x3002;</p>
<p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i]=min(dp[j]+(sum[i]-sum[j])*cost[i])<br>$$<br>&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{dp[x]-dp[y]}{sum[x]-sum[y]}\leq cost[i]<br>$$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[x] - dp[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> sum[x] - sum[y];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	head = tail = <span class="number">0</span>;</span><br><span class="line">	Q[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[head + <span class="number">1</span>], Q[head]) &lt;= </span><br><span class="line">					cost[i] * S(Q[head + <span class="number">1</span>], Q[head])) ++head;</span><br><span class="line">		dp[i] = dp[Q[head]] + (sum[i] - sum[Q[head]] + <span class="number">10</span>) * cost[i];</span><br><span class="line">		<span class="keyword">while</span> (head &lt; tail &amp;&amp; G(Q[tail], Q[tail - <span class="number">1</span>]) * S(i, Q[tail])</span><br><span class="line">			&gt;= G(i, Q[tail]) * S(Q[tail], Q[tail  - <span class="number">1</span>])) --tail;</span><br><span class="line">		Q[++tail] = i;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, dp[n]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">		sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;num[i], &amp;cost[i]);</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + num[i];</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="l"><a href="#L" class="headerlink" title="L"></a>L</h5><p>&#x8FD9;&#x9898;&#x5176;&#x5B9E;&#x662F;&#x4E2A;BFS&#xFF0C;&#x62C9;&#x9519;&#x9898;&#x4E86;&#x3002;&#x3002;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x526A;&#x679D;&#x3002;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">110</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>] = {{<span class="number">-1</span>, <span class="number">0</span>}, {<span class="number">1</span>, <span class="number">0</span>}, {<span class="number">0</span>, <span class="number">-1</span>}, {<span class="number">0</span>, <span class="number">1</span>}};</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, m, limit, sx, sy, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> s[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">int</span> see[MAX_N][MAX_N], dis[MAX_N][MAX_N], vis[MAX_N][MAX_N];</span><br><span class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; state[MAX_N][MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> {</span></span><br><span class="line">	<span class="keyword">int</span> x, y, step;</span><br><span class="line">	<span class="keyword">int</span> flag1, flag2;</span><br><span class="line"></span><br><span class="line">	Node() {}</span><br><span class="line">	Node(<span class="keyword">int</span> _x, <span class="keyword">int</span> _y, <span class="keyword">int</span> _step, <span class="keyword">int</span> _flag1, <span class="keyword">int</span> _flag2): </span><br><span class="line">		x(_x), y(_y), step(_step), flag1(_flag1), flag2(_flag2) {}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="built_in">queue</span>&lt;Node&gt; Q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span>&amp; value, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (s[x][y] == <span class="string">&apos;.&apos;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (s[x][y] == <span class="string">&apos;D&apos;</span>) {</span><br><span class="line">		value += <span class="number">1</span>;</span><br><span class="line">	} <span class="keyword">else</span> <span class="keyword">if</span> (s[x][y] == <span class="string">&apos;E&apos;</span>) {</span><br><span class="line">		value += <span class="number">2</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetSee</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">memset</span>(see, <span class="number">0</span>, <span class="keyword">sizeof</span> (see));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			<span class="keyword">if</span> (s[i][j] == <span class="string">&apos;D&apos;</span> || s[i][j] == <span class="string">&apos;E&apos;</span> || s[i][j] == <span class="string">&apos;X&apos;</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">int</span> find = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = j + <span class="number">1</span>; k &lt; m; ++k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, i, k)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = j - <span class="number">1</span>; k &gt;= <span class="number">0</span>; --k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, i, k)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i - <span class="number">1</span>; k &gt;= <span class="number">0</span>; --k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, k, j)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i + <span class="number">1</span>; k &lt; n; ++k) {</span><br><span class="line">				<span class="keyword">if</span> (check(find, k, j)) <span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">			see[i][j] = find;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">if</span> (see[sx][sy] == <span class="number">3</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> (dis));</span><br><span class="line">	<span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> (vis));</span><br><span class="line">	<span class="keyword">while</span> (!Q.empty()) Q.pop();</span><br><span class="line">	state[sx][sy].first = (see[sx][sy] == <span class="number">1</span> || see[sx][sy] == <span class="number">3</span>);</span><br><span class="line">	state[sx][sy].second = (see[sx][sy] &gt;= <span class="number">2</span>);</span><br><span class="line">	Q.push(Node(sx, sy, <span class="number">0</span>, see[sx][sy] == <span class="number">1</span> || see[sx][sy] == <span class="number">3</span>, see[sx][sy] &gt;= <span class="number">2</span>));</span><br><span class="line">	<span class="keyword">while</span> (!Q.empty()) {</span><br><span class="line">		Node cur = Q.front();</span><br><span class="line">		Q.pop();</span><br><span class="line">		<span class="keyword">int</span> x = cur.x, y = cur.y, step = cur.step, f1 = cur.flag1, f2 = cur.flag2;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) {</span><br><span class="line">			<span class="keyword">int</span> nxtx = x + dir[i][<span class="number">0</span>], nxty = y + dir[i][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span> (nxtx &lt; <span class="number">0</span> || nxtx &gt;= n || nxty &lt; <span class="number">0</span> || nxty &gt;= m) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (s[nxtx][nxty] != <span class="string">&apos;.&apos;</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">int</span> nxtf1 = (f1 || see[nxtx][nxty] == <span class="number">1</span> || see[nxtx][nxty] == <span class="number">3</span>);</span><br><span class="line">			<span class="keyword">int</span> nxtf2 = (f2 || see[nxtx][nxty] &gt;= <span class="number">2</span>);</span><br><span class="line">			<span class="keyword">if</span> (vis[nxtx][nxty]) {</span><br><span class="line">				<span class="keyword">if</span> (!(nxtf1 &gt; state[nxtx][nxty].first || nxtf2 &gt; state[nxtx][nxty].second)) {</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			state[nxtx][nxty].first = nxtf1;</span><br><span class="line">			state[nxtx][nxty].second = nxtf2;</span><br><span class="line">			vis[nxtx][nxty] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (nxtf1 &amp;&amp; nxtf2) {</span><br><span class="line">				dis[nxtx][nxty] = step + <span class="number">1</span>;</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> (step + <span class="number">1</span> &lt; limit) {</span><br><span class="line">				Q.push(Node(nxtx, nxty, step + <span class="number">1</span>, nxtf1, nxtf2));</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> ans = inf;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">			ans = min(ans, dis[i][j]);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (ans &gt; limit) ans = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;limit);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i]);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) {</span><br><span class="line">				<span class="keyword">if</span> (s[i][j] == <span class="string">&apos;S&apos;</span>) {</span><br><span class="line">					sx = i, sy = j;</span><br><span class="line">				}</span><br><span class="line">				state[i][j].first = state[i][j].second = <span class="number">0</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		GetSee();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Case %d:\n%d\n&quot;</span>, ++cases, bfs());</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h5 id="q"><a href="#Q" class="headerlink" title="Q"></a>Q</h5><p>[UVA 12594]&#xFF1A;&#x5148;&#x7ED9;&#x51FA;26&#x4E2A;&#x5B57;&#x6BCD;&#x7684;&#x4E00;&#x79CD;&#x5168;&#x6392;&#x5217;&#xFF0C;&#x518D;&#x7ED9;&#x51FA;&#x957F;&#x5EA6;&#x4E3A;$n\leq 20000$&#x7684;&#x5B57;&#x6BCD;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8981;&#x6C42;&#x5C06;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x5206;&#x6210;$K$&#x6BB5;&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;$p$&#x6BB5;&#x7684;&#x7B2C;$i$&#x4E2A;&#x5B57;&#x7B26;&#x4ECE;&#x5B83;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x4EF7;&#x503C;&#x662F;$(i-pos[s[i]])*pos[s[i]]$&#xFF0C;&#x5176;&#x4E2D;$pos[s[i]]$&#x8868;&#x793A;$s[i]$&#x8FD9;&#x4E2A;&#x5B57;&#x6BCD;&#x5728;&#x7ED9;&#x51FA;&#x7684;&#x6392;&#x5217;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4F4D;&#x7F6E;&#x4E0B;&#x6807;&#x4ECE;0&#x5F00;&#x59CB;&#x3002;&#x6C42;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x5C0F;&#x4EF7;&#x503C;&#xFF1F;</p>
<p>&#x8BBE;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x4E0B;&#x6807;&#x4ECE;1&#x5F00;&#x59CB;&#xFF0C;&#x521D;&#x59CB;&#x5316;$ans=-\sum_{i=1}^{i=n}{pos[s[i]]*pos[s[i]]}$&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x9700;&#x8981;&#x8BA1;&#x7B97;$i*pos[s[i]]$&#x90E8;&#x5206;&#x4E86;&#xFF0C;&#x8BB0;&#xFF1A;<br>$$<br>pre[i]=\sum_{r=1}^{r=i}{pos[s[i]]} \\<br>sum[i]=\sum_{r=1}^{r=i}{(i-1)*pos[s[i]]}<br>$$<br>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>dp[i][p]=dp[j][p-1]+sum[i]-sum[j]-(pre[i]-pre[j])*j<br>$$<br>&#x4EE4;$G(x)=dp[x][k]-sum[x]+pre[x]*x$&#x659C;&#x7387;&#x65B9;&#x7A0B;&#xFF1A;<br>$$<br>\frac{G(x)-G(y)}{x-y}\leq pre[i]<br>$$<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">20010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_K = <span class="number">510</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, n, K, cases = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> head[MAX_K], tail[MAX_K];</span><br><span class="line"><span class="keyword">int</span> pos[<span class="number">30</span>], Q[MAX_K][MAX_N];</span><br><span class="line"><span class="keyword">char</span> s1[<span class="number">30</span>], s2[MAX_N];</span><br><span class="line">ll ans, dp[MAX_K][MAX_N], sum[MAX_N], pre[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">G</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> dp[id][x] - sum[x] + pre[x] * x - (dp[id][y] - sum[y] + pre[y] * y);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">return</span> x - y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wyr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= K; ++i) {</span><br><span class="line">		head[i] = tail[i] = Q[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">memset</span>(dp[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> (dp[<span class="number">0</span>]));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = min(i, K); k &gt;= <span class="number">1</span>; --k) {</span><br><span class="line">			<span class="keyword">while</span> (head[k - <span class="number">1</span>] &lt; tail[k - <span class="number">1</span>] &amp;&amp; G(k - <span class="number">1</span>, Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>] + <span class="number">1</span>], Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]])</span><br><span class="line">					&lt;= S(Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>] + <span class="number">1</span>], Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]]) * pre[i]) head[k - <span class="number">1</span>]++;</span><br><span class="line">			<span class="keyword">int</span> t = Q[k - <span class="number">1</span>][head[k - <span class="number">1</span>]];</span><br><span class="line">			dp[k][i] = dp[k - <span class="number">1</span>][t] + sum[i] - sum[t] - (pre[i] - pre[t]) * t;</span><br><span class="line">			<span class="keyword">while</span> (head[k] &lt; tail[k] &amp;&amp; G(k, i, Q[k][tail[k]]) * S(Q[k][tail[k]], Q[k][tail[k] - <span class="number">1</span>])</span><br><span class="line">				    &lt;= S(i, Q[k][tail[k]]) * G(k, Q[k][tail[k]], Q[k][tail[k] - <span class="number">1</span>])) tail[k]--;</span><br><span class="line">			Q[k][++tail[k]] = i;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	ans += dp[K][n];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Case %d: %lld\n&quot;</span>, ++cases, ans);</span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) {</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, s1, &amp;K);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s2 + <span class="number">1</span>);</span><br><span class="line">		n = <span class="built_in">strlen</span>(s2 + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) {</span><br><span class="line">			pos[s1[i] - <span class="string">&apos;a&apos;</span>] = i;</span><br><span class="line">		}</span><br><span class="line">		sum[<span class="number">0</span>] = pre[<span class="number">0</span>] = ans =  <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) {</span><br><span class="line">			<span class="keyword">int</span> t = pos[s2[i] - <span class="string">&apos;a&apos;</span>];</span><br><span class="line">			pre[i] = pre[i - <span class="number">1</span>] + t;</span><br><span class="line">			sum[i] = sum[i - <span class="number">1</span>] + (i - <span class="number">1</span>) * t;</span><br><span class="line">			ans -= t * t;</span><br><span class="line">		}</span><br><span class="line">		wyr();</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

  </div>
  
    <div class="tags">
    <span><i class="fa fa-tags"></i> 标签</span>
      
        <ul class="post-tag-list"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/ACM-ICPC-Template/">ACM-ICPC-Template</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/斜率dp/">斜率dp</a></li></ul>
      
    </div>
  

</article>

<!-- Comments -->

<!-- End Comments --></section>
    <footer id="footer" role="contentinfo">
    <div>&copy; 2018 <a href="/">瀚清</a>.
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Designed by <a href="http://rainylog.com" target="_blank">Rainy.</a>
	</div>
</footer><!-- end #footer -->

  </div>
  <script src="/lib/fancybox/dist/jquery.fancybox.min.js"></script>

  <script src="/js/helper.js"></script>
  <script src="/js/_third-party/gitment.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>